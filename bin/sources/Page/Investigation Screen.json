{
  "$type": "Bespoke.Sph.Domain.Page, domain.sph",
  "PageId": 16,
  "Name": "Investigation Screen",
  "IsRazor": true,
  "IsPartial": false,
  "VirtualPath": "~/Views/Workflow_2002_33/InvestigationScreen.cshtml",
  "Tag": "wf_2002_3aa668ed-598b-4ac6-845a-230b7e1a7deb",
  "Version": 33,
  "Mode": null,
  "Extension": null,
  "Code": "@using System.Web.Mvc.Html\r\n@using Bespoke.Sph.Domain\r\n@using Newtonsoft.Json\r\n@model Bespoke.Sph.Workflows_2002_33.InvestigationScreenViewModel\r\n\r\n@{\r\n    ViewBag.Title = Model.Instance.Name;\r\n    Layout = \"~/Views/Shared/_Layout.cshtml\";\r\n    const string controllerString = \"Controller\";\r\n    var setting = new JsonSerializerSettings {TypeNameHandling = TypeNameHandling.All};\r\n    var confirmationText = Model.Screen.ConfirmationOptions.Value;\r\n    \r\n}\r\n\r\n<div class=\"row\">\r\n    <h1>@Model.Screen.FormDesign.Name</h1>\r\n    <span>@Model.Screen.FormDesign.Description</span>\r\n</div>\r\n<div class=\"row\">\r\n    <form class=\"form-horizontal\" id=\"workflow-start-form\" data-bind=\"with: instance\">\r\n        @foreach (var fe in Model.Screen.FormDesign.FormElementCollection)\r\n        {\r\n            fe.Path = fe.Path.ConvertJavascriptObjectToFunction();\r\n            fe.SetDefaultLayout(Model.Screen.FormDesign);\r\n            @Html.EditorFor(f => fe)\r\n        }\r\n   \r\n    </form>\r\n\r\n</div>\r\n\r\n\r\n@section scripts\r\n{\r\n    <script type=\"text/javascript\" src=\"/Workflow_2002_33/Schemas\"></script>\r\n    <script type=\"text/javascript\">\r\n        require(['services/datacontext', 'jquery','services/app', 'services/system'], function(context,jquery,app, system) {\r\n\r\n            \r\n           var instance = context.toObservable(@Html.Raw(JsonConvert.SerializeObject(Model.Instance, setting)),/@Model.Namespace.Replace(\".\",\"\\\\.\")\\.(.*?),/),\r\n               screen = context.toObservable(@Html.Raw(JsonConvert.SerializeObject(Model.Screen, setting)),/@Model.Namespace.Replace(\".\",\"\\\\.\")\\.(.*?),/),\r\n               vm = {\r\n                id : @Model.Instance.WorkflowDefinitionId,\r\n                instance : ko.observable(instance),    \r\n                screen : ko.observable(screen),\r\n                isBusy : ko.observable(),\r\n                save : function(){\r\n                      var tcs = new $.Deferred(),\r\n                            data = ko.mapping.toJSON(vm.instance),\r\n                            button = $(this);\r\n\r\n                        button.prop('disabled', true);\r\n                        context.post(data, \"/workflow_2002_33/SaveInvestigationScreen\")\r\n                            .then(function(result) {\r\n                                tcs.resolve(result);\r\n                                @if(Model.Screen.ConfirmationOptions.Type == \"Message\")\r\n                                {\r\n                                    <text>\r\n                                    var msg = _.template('@Html.Raw(confirmationText)')(result.wf);\r\n                                    app.showMessage(msg, '@Model.Screen.Name', ['OK'])\r\n                                        .done(function(dr){\r\n                                            console.log(dr);\r\n                                        });\r\n                                    </text>\r\n                                }else\r\n                                {\r\n                                    <text>\r\n                                    window.location = \"@confirmationText\";\r\n                                    </text>\r\n                                }\r\n                       \r\n\r\n                            });\r\n                        return tcs.promise();\r\n                }\r\n            };\r\n            \r\n            instance.addChildItem = function(list, type){\r\n                return function(){\r\n                    if(typeof type === \"function\"){\r\n                        list.push(type(system.guid()));\r\n                        return;\r\n                    }\r\n                    var item = new bespoke.sph.w_2002_33[type](system.guid());\r\n                    list.push(item);\r\n                }\r\n            };\r\n            \r\n            instance.removeChildItem = function(list, obj){\r\n                return function(){\r\n                    list.remove(obj);\r\n                }\r\n            };\r\n\r\n            ko.applyBindings(vm, document.getElementById('body'));\r\n            @*  the div#body is defined in _Layout.cshtml, if you use different Layout then this has got to changed accordingly *@\r\n\r\n      \r\n        });\r\n\r\n    </script>\r\n}",
  "CreatedBy": "admin",
  "CreatedDate": "2014-02-28T15:10:16.1141973+08:00",
  "ChangedBy": "admin",
  "ChangedDate": "2014-02-28T15:10:16.1131972+08:00",
  "WebId": "bfcf4c37-b5bc-4369-a78b-d2d5648e13df"
}