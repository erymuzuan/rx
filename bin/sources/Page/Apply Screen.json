{
  "$type": "Bespoke.Sph.Domain.Page, domain.sph",
  "PageId": 6028,
  "Name": "Apply Screen",
  "IsRazor": true,
  "IsPartial": false,
  "VirtualPath": "~/Views/Workflow_2002_33/ApplyScreen.cshtml",
  "Tag": "wf_2002_4122d09e-40cd-4558-93eb-ed18f6309f09",
  "Version": 33,
  "Mode": null,
  "Extension": null,
  "Code": "@using System.Web.Mvc.Html\n@using Bespoke.Sph.Domain\n@using Newtonsoft.Json\n@model Bespoke.Sph.Workflows_2002_33.ApplyScreenViewModel\n\n@{\n    ViewBag.Title = Model.Instance.Name;\n    Layout = \"~/Views/Shared/_Layout.cshtml\";\n    const string controllerString = \"Controller\";\n    var setting = new JsonSerializerSettings {TypeNameHandling = TypeNameHandling.All};\n    var confirmationText = Model.Screen.ConfirmationOptions.Value;\n    \n}\n\n<div class=\"row\">\n    <h1>@Model.Screen.FormDesign.Name</h1>\n    <span>@Model.Screen.FormDesign.Description</span>\n</div>\n<div class=\"row\">\n    <form class=\"form-horizontal\" id=\"workflow-start-form\" data-bind=\"with: instance\">\n        @foreach (var fe in Model.Screen.FormDesign.FormElementCollection)\n        {\n            var fe1 = fe;\n            fe1.Path = fe.Path.ConvertJavascriptObjectToFunction();\n            fe1.SetDefaultLayout(Model.Screen.FormDesign);\n            @(fe.UseDisplayTemplate ? Html.DisplayFor(f => fe1) : Html.EditorFor(f => fe1))\n        }\n   \n    </form>\n\n</div>\n\n\n@section scripts\n{\n    <script type=\"text/javascript\" src=\"/Workflow_2002_33/Schemas\"></script>\n    <script type=\"text/javascript\">\n        require(['services/datacontext', 'jquery','services/app', 'services/system', 'services/config'], function(context,jquery,app, system, config) {\n\n            \n           var instance = context.toObservable(@Html.Raw(JsonConvert.SerializeObject(Model.Instance, setting)),/@Model.Namespace.Replace(\".\",\"\\\\.\")\\.(.*?),/),\n               screen = context.toObservable(@Html.Raw(JsonConvert.SerializeObject(Model.Screen, setting)),/@Model.Namespace.Replace(\".\",\"\\\\.\")\\.(.*?),/),\n               vm = {\n                id : @Model.Instance.WorkflowDefinitionId,\n                instance : ko.observable(instance),    \n                screen : ko.observable(screen),\n                config : config,\n                isBusy : ko.observable(),\n                save : function(){\n                      var tcs = new $.Deferred(),\n                            data = ko.mapping.toJSON(vm.instance),\n                            button = $(this);\n\n                        button.prop('disabled', true);\n                        context.post(data, \"/workflow_2002_33/SaveApplyScreen\")\n                            .then(function(result) {\n                                tcs.resolve(result);\n                                @if(Model.Screen.ConfirmationOptions.Type == \"Message\")\n                                {\n                                    <text>\n                                    var msg = _.template('@Html.Raw(confirmationText)')(result.wf);\n                                    app.showMessage(msg, '@Model.Screen.Name', ['OK'])\n                                        .done(function(dr){\n                                            console.log(dr);\n                                        });\n                                    </text>\n                                }else\n                                {\n                                    <text>\n                                    window.location = \"@confirmationText\";\n                                    </text>\n                                }\n                       \n\n                            });\n                        return tcs.promise();\n                }\n            };\n            \n            instance.addChildItem = function(list, type){\n                return function(){\n                     list.push(new type(system.guid()));                  \n                }\n            };\n            \n            instance.removeChildItem = function(list, obj){\n                return function(){\n                    list.remove(obj);\n                }\n            };\n\n            ko.applyBindings(vm, document.getElementById('body'));\n            @*  the div#body is defined in _Layout.cshtml, if you use different Layout then this has got to changed accordingly *@\n\n      \n        });\n\n    </script>\n}",
  "CreatedBy": "admin",
  "CreatedDate": "2014-04-22T13:43:41.6986154+08:00",
  "ChangedBy": "admin",
  "ChangedDate": "2014-04-22T13:43:41.6986154+08:00",
  "WebId": "297ec0e9-1641-47ff-929d-2b6c579124c3"
}