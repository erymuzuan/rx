{"version":3,"sources":["string.js","_pager.js","_ko.workflow.js","_ko.entity.js","_ko.kendo.js","_ko.bootstrap.js","_function.prototypes.js","_constants.js","_uiready.js","_utils.js","_task.js","_theme.js","_references.js"],"names":["window","$type","String","__typeName","__class","$prototype","prototype","endsWith","suffix","this","substr","length","startsWith","prefix","trim","replace","trimEnd","trimStart","format","args","_toFormattedString","arguments","useLocale","result","i","open","indexOf","close","slice","charAt","Error","brace","substring","colonIndex","argNumber","parseInt","isNaN","argFormat","arg","toFormattedString","localeFormat","toString","bespoke","utils","ServerPager","options","element","count","sizes","defaultSize","changed","console","log","self2","rows","_","range","pagerDataSource","kendo","data","DataSource","pageSize","hidden","pager","kendoPager","dataSource","pageSizes","page","bind","update","count2","j","setTimeout","destroy","empty","size","pg","dropdownlist","$","find","value","e","ko","bindingHandlers","workflowFormPathIntellisense","init","valueAccessor","allBindingsAccessor","schema","unwrap","allBindings","setup","input","div","css","height","hide","before","c","completely","fontSize","color","fontFamily","setText","ix","hasOwnProperty","push","sort","currentObject","onChange","text","lastIndexOf","props","split","each","v","startFrom","repaint","attr","blur","val","parent","padding","prop","activityClass","act","fullName","name","exec","addClass","checkedItems","item","dataFor","list","change","checked","is","remove","typeahead","id","members","Bloodhound","datumTokenizer","d","tokenizers","whitespace","Path","queryTokenizer","nonword","prefetch","initialize","highlight","displayKey","source","ttAdapter","on","typeaheadExceptions","exceptions","activityPopover","wd","pop","popover","title","Name","html","content","WebId","document","preventDefault","app","require","objectbuilders","link","hasClass","showMessage","done","removeActivity","editActivity","setStartActivity","comboBoxLookupOptions","$select","lookup","caption","context","displayPath","valuePath","query","promise","getListAsync","entity","getTuplesAsync","field","field2","add","Option","Item1","Item2","subscribe","tree","system","searchbox","member","selected","jsTreeData","state","opened","getNodeMemberType","type","TypeName","memberNameSubscription","memberTypeNameSubscription","recurseChildMember","node","children","MemberCollection","map","setNodePropertyForChildOfValueObject","tag","isObservable","childOfValueMember","observable","ref","jstree","parents","n","get_node","valueMember","loadJsTree","dispose","allowFilter","cm","mb1","AllowMultiple","edit","rename_node","set_type","event","mbr","oldParent","old_parent","oldCollections","collection","splice","position","ev","mb","core","animation","check_callback","operation","nodeParent","nodePosition","more","target","themes","stripes","dnd","is_draggable","contextmenu","items","$node","sel","get_selected","simpleMenu","label","action","child","sph","domain","SimpleMember","guid","newNode","create_node","valueObjectMenu","typeName","ValueObjectMember","complexChildMenu","ComplexMember","removeMenu","p","parentMember","child2","delete_node","types","default","icon","System.String, mscorlib","valid_children","System.DateTime, mscorlib","System.Int32, mscorlib","System.Decimal, mscorlib","System.Boolean, mscorlib","Bespoke.Sph.Domain.ValueObjectMember, domain.sph","Bespoke.Sph.Domain.ComplexMember, domain.sph","plugins","to","keyup","clearTimeout","search","help","href","click","substringMatcher","strs","q","cb","matches","substringRegex","RegExp","str","test","typeaheadUrl","ttl","url","suggestions","obj","limit","remote","tt1","filter","entityTypeaheadPath","datacontext","config","idOrName","typeaheadEntity","toCamelCase","match","p1","p2","offset","toUpperCase","toLowerCase","camel","ed","toJS","applicationName","hideDropDown","loadOneAsync","edf","Id","cssTypeahead","results","extractor","paths","path","s","local","minLength","updater","$element","matcher","tquery","chart","Entity","JSON","parse","Query","Type","tcs","Deferred","searchAsync","buckets","aggregations","category","key_as_string","key","doc_count","categories","kendoChart","theme","chartArea","background","legend","seriesDefaults","labels","visible","template","series","categoryAxis","majorGridLines","tooltip","resolve","getScalarAsync","EntityViewId","viewName","refresh","iconPicker","$input","$picker","append","dialog","app2","showDialog","observableArray","getSingletonObservableArray","$link","stopPropagation","virtualElements","allowedBindings","lookupText","setTextContent","ele","textContent","unwrapObservable","undefined","innerTextNode","firstChild","nodeType","nextSibling","setDomNodeChildren","ownerDocument","createTextNode","readonly","ro","kendoEditor","$editor","updating","editor","update2","ke","kendoDropDownListValue","currentModelValue","dd","nv","modelValue","kendoComboBox","decimal","money","textbox","parseFloat","fm","toFixed","a","tagName","tv","date","dv","defaultFormat","inputFormat","moment","invalid","year","dateString","kendoUpload","logger","extensions","async","saveUrl","removeUrl","autoUpload","multiple","error","logError","select","files","extension","join","success","info","storeId","response","uploaded","removed","oldFile","post","stringify","then","kendoDate","currentValue","picker","kendoDatePicker","enable","toDate","kendoDateTime","kendoDateTimePicker","slideVisible","toggle","slideDown","slideUp","kendoEnable","removeClass","removeAttr","command","viewModel","$button","inputValue","isvisible","show","$spinner","$warning","form","checkValidity","fail","err","o","message","button","status","statusText","responseText","responseJSON","responseJson","unwrapClick","property","accessor","fieldImage","img","ft","stringArrayAutoComplete","kendoAutoComplete","placeholder","separator","pathAutoComplete","get","json","chain","t","dataTextField","which","filtered","commandWithParameter","callback","parameter","commandParameter","completeText","bindingAccessor","$filterInput","$serverLoadButton","$form","pagedSearch","searchPaging","after","submit","filterAndSearch","dofilter","$rows","$tr","throttled","throttle","siblings","serverPaging","pagerHidden","$pagerPanel","startLoad","fadeTo","endLoad","setItemsSource","loadAsync","includeTotal","lo","itemCollection","executedQuery","initialQuery","searchButton","cultures","pageChanged","tcs1","pagerOptions","toJSON","q2","from","query_string","default_field","bool","messages","FORM_IS_NOT_VALID","bootstrapDropDown","valueAccesor","anchor","dropDown","one","optionOrText","placement","tooltipPlacement","bootstrapPopover","bootstrapTooltip","cssAutoComplete","bootstrap","styleSheets","rules","r","selectorText","autocomplete","va","scroll","Function","partial","fn","Array","call","apply","ServerOperationStatus","OK","ERROR","messagesText","SAVE_SUCCESS","_uiready","view","getElementById","dir","jQuery","Task","fromResult","returnValue","delay","bindingContext","valueUnwrapped","Theme"],"mappings":"CA4BA,SAAWA,GAEPC,MAAQC,OACRD,MAAME,WAAa,SACnBF,MAAMG,SAAU,EAEhBC,WAAaJ,MAAMK,UACnBD,WAAWE,SAAW,SAAyBC,GAI3C,MAAQC,MAAKC,OAAOD,KAAKE,OAASH,EAAOG,UAAYH,GAGzDH,WAAWO,WAAa,SAA2BC,GAI/C,MAAQJ,MAAKC,OAAO,EAAGG,EAAOF,UAAYE,GAG9CR,WAAWS,KAAO,WAGd,MAAOL,MAAKM,QAAQ,aAAc,KAGtCV,WAAWW,QAAU,WAGjB,MAAOP,MAAKM,QAAQ,OAAQ,KAGhCV,WAAWY,UAAY,WAGnB,MAAOR,MAAKM,QAAQ,OAAQ,KAGhCd,MAAMiB,OAAS,SAAuBA,EAAQC,GAK1C,MAAOjB,QAAOkB,oBAAmB,EAAOC,YAG5CpB,MAAMmB,mBAAqB,SAAmCE,EAAWH,GAIrE,IAAK,GAHDI,GAAS,GACTL,EAASC,EAAK,GAETK,EAAI,IAAK,CAEd,GAAIC,GAAOP,EAAOQ,QAAQ,IAAKF,GAC3BG,EAAQT,EAAOQ,QAAQ,IAAKF,EAChC,IAAY,EAAPC,GAAsB,EAARE,EAAY,CAE3BJ,GAAUL,EAAOU,MAAMJ,EACvB,OAEJ,GAAKG,EAAQ,IAAgBF,EAARE,GAAyB,EAAPF,GAAvC,CAEI,GAAiC,MAA7BP,EAAOW,OAAOF,EAAQ,GACtB,KAAM,IAAIG,OAAM,mCAGpBP,IAAUL,EAAOU,MAAMJ,EAAGG,EAAQ,GAClCH,EAAIG,EAAQ,MAShB,IAJAJ,GAAUL,EAAOU,MAAMJ,EAAGC,GAC1BD,EAAIC,EAAO,EAGc,MAArBP,EAAOW,OAAOL,GAAlB,CAMA,GAAY,EAARG,EAAW,KAAM,IAAIG,OAAM,mCAM/B,IAAIC,GAAQb,EAAOc,UAAUR,EAAGG,GAC5BM,EAAaF,EAAML,QAAQ,KAC3BQ,EAAYC,SAAuB,EAAbF,EAAkBF,EAAQA,EAAMC,UAAU,EAAGC,GAAa,IAAM,CAE1F,IAAIG,MAAMF,GAAY,KAAM,IAAIJ,OAAM,6BAEtC,IAAIO,GAA0B,EAAbJ,EAAkB,GAAKF,EAAMC,UAAUC,EAAa,GAEjEK,EAAMnB,EAAKe,IACK,mBAAV,IAAiC,OAARI,KAC/BA,EAAM,IAKNf,GADAe,EAAIC,kBACMD,EAAIC,kBAAkBF,GACzBf,GAAagB,EAAIE,aACdF,EAAIE,aAAaH,GACpBC,EAAIpB,OACDoB,EAAIpB,OAAOmB,GAEXC,EAAIG,WAElBjB,EAAIG,EAAQ,MAlCRJ,IAAU,IACVC,IAoCR,MAAOD,KAGZvB;ACzIH,GAAI0C,SAAUA,WACdA,SAAQC,SAERD,QAAQC,MAAMC,YAAc,SAAUC,GAClCA,EAAUA,KACV,IAAIC,GAAUD,EAAQC,QAClBC,EAAQF,EAAQE,OAAS,EACzBC,EAAQH,EAAQG,QAAU,GAAI,GAAI,IAClCC,EAAcJ,EAAQI,aAAe,GACrCC,EAAUL,EAAQK,SAAW,WACzBC,QAAQC,IAAI,oBAEhBC,EAAQ5C,KACR6C,EAAOC,EAAEC,MAAMT,GACfU,EAAkB,GAAIC,OAAMC,KAAKC,YAC7BD,KAAML,EACNO,SAAUZ,GAElB,IAAIJ,EAAQiB,OACR,MAAOT,EAGX,IAAIU,GAAQjB,EAAQkB,YAChBC,WAAYR,EACZS,UAAWlB,IACZW,KAAK,aACRI,GAAMI,KAAK,GACXJ,EAAMK,KAAK,SAAU,WACblB,GACAA,EAAQa,EAAMI,OAAQJ,EAAMF,cAIpCR,EAAMgB,OAAS,SAAUC,GACrBhB,IACA,KAAK,GAAIiB,GAAI,EAAOD,EAAJC,EAAaA,IACzBjB,EAAKiB,GAAKA,CAEdC,YAAW,WACPf,EAAgBE,KAAKL,IACtB,MAEPD,EAAMoB,QAAU,WACZV,EAAMU,UACN3B,EAAQ4B,SAGZrB,EAAMQ,SAAW,SAAUc,GAIvB,MAHIA,IACAZ,EAAMF,SAASc,GAEZZ,EAAMF,YAEjBR,EAAMc,KAAO,SAAUS,GAInB,MAHIA,IACAb,EAAMI,KAAKS,GAERb,EAAMI,OAGjB,IAAIU,GAAeC,EAAEhC,GAASiC,KAAK,UAAUpB,KAAK,oBAWlD,OAVAkB,GAAaT,KAAK,SAAU,WACxB,IACIlB,EAAQ,EAAGf,SAAS1B,KAAKuE,UAC3B,MAAOC,OAON5B;AChEX6B,GAAGC,gBAAgBC,8BACfC,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIP,GAAQM,IACRE,EAASN,GAAGO,OAAOT,EAAMQ,QACzBE,EAAcH,IACdI,EAAQ,WACJ,GAAIC,GAAQd,EAAEhC,GACL+C,EAAMf,EAAE,eAAegB,KACnBC,OAAU,QAEvBH,GAAMI,OAAOC,OAAOJ,EAEpB,IAAIK,GAAIC,WAAWN,EAAI,IACnBO,SAAU,OACVC,MAAO,QACPC,WAAY,6CAGhBJ,GAAEK,QAAQrB,GAAGO,OAAOC,EAAYV,OAChC,KAAK,GAAIwB,KAAMhB,GACX,GAAIA,EAAOiB,eAAeD,GAAK,CAC3B,GAAW,UAAPA,EAAgB,QACpB,IAAW,iBAAPA,EAAuB,QAC3B,IAAW,oBAAPA,EAA0B,QAC9B,IAAW,UAAPA,EAAgB,QACpB,IAAW,UAAPA,EAAgB,QACpBN,GAAErD,QAAQ6D,KAAK,GAAKF,GAG5BN,EAAErD,QAAQ8D,MAEV,IAAIC,GAAgBpB,CACpBU,GAAEW,SAAW,SAAUC,GACnB,GAAIA,EAAKC,YAAY,OAASD,EAAKnG,OAAS,EAAG,CAC3CuF,EAAErD,UACF,IAAImE,GAAQF,EAAKG,MAAM,IAEvBL,GAAgBpB,EAChBjC,EAAEyD,GAAOE,KAAK,SAAUC,GACV,KAANA,IACJP,EAAgBA,EAAcO,MAElChE,QAAQC,IAAI,gBAAiBwD,EAC7B,KAAK,GAAIpF,KAAKoF,GACV,GAAIA,EAAcH,eAAejF,GAAI,CACjC,GAAU,UAANA,EAAe,QACnB,IAAU,iBAANA,EAAsB,QAC1B,IAAU,oBAANA,EAAyB,QAC7B,IAAU,UAANA,EAAe,QACnB,IAAU,UAANA,EAAe,QACnB0E,GAAErD,QAAQ6D,KAAK,GAAKlF,GAG5B0E,EAAErD,QAAQ8D,OACVT,EAAEkB,UAAYN,EAAKC,YAAY,KAAO,EAE1Cb,EAAEmB,WAGNnB,EAAEmB,UACFvC,EAAEoB,EAAEN,OACC0B,KAAK,eAAgB,OACrBC,KAAK,WACF7B,EAAYV,MAAMF,EAAErE,MAAM+G,SAC3BC,SAAS1C,KAAK,SAChBe,KAAM4B,QAAW,WAAY3B,OAAU,SAExCjB,EAAEhC,GAAS6E,KAAK,aAChB7C,EAAEoB,EAAEN,OAAO+B,KAAK,YAAY,GAOxChC,OAKRT,GAAGC,gBAAgByC,eACfvC,KAAM,SAAUvC,EAASwC,GAErB,GAAIO,GAAMf,EAAEhC,GACR+E,EAAM3C,GAAGO,OAAOH,KACpBwC,EAAgC,kBAAdD,GAAI5H,MAAuB4H,EAAI5H,QAAU4H,EAAI5H,MAC/D8H,EAAO,+BAA+BC,KAAKF,GAAU,EAErDjC,GAAIoC,SAAS,cAAcA,SAAS,cAAgBF,KAI5D7C,GAAGC,gBAAgB+C,cACf7C,KAAM,SAAUvC,EAASwC,GACrB,GAAI6C,GAAOjD,GAAGkD,QAAQtF,GAClBuF,EAAO/C,GAEXR,GAAEhC,GAASwF,OAAO,WACd,GAAIC,GAAUzD,EAAErE,MAAM+H,GAAG,WACrBD,GACAF,EAAK3B,KAAKyB,GAEVE,EAAKI,OAAON,OAO5BjD,GAAGC,gBAAgBuD,WACfrD,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIoD,GAAKzD,GAAGO,OAAOH,KACfI,EAAcH,GAElB,IAAkB,mBAAPoD,GAAX,CAGA,GAAIC,GAAU,GAAIC,aACdC,eAAgB,SAAUC,GAAK,MAAOF,YAAWG,WAAWC,WAAWF,EAAEG,OACzEC,eAAgBN,WAAWG,WAAWI,QACtCC,SAAU,6BAA+BV,EAAK,kBAGlDC,GAAQU,aACRxE,EAAEhC,GAAS4F,WAAYa,WAAW,IAC9BxB,KAAM,eAAiBY,EACvBa,WAAY,OACZC,OAAQb,EAAQc,cAEfC,GAAG,mBAAoB,WACpBjE,EAAYV,MAAMF,EAAErE,MAAM+G,YAI1CtC,GAAGC,gBAAgByE,qBACfvE,KAAM,SAAUvC,EAASwC,EAAeC,GAGpC,GAAIG,GAAcH,IAEdsE,EAAa,GAAIhB,aACjBC,eAAgBD,WAAWG,WAAWC,WACtCE,eAAgBN,WAAWG,WAAWC,WACtCI,SAAU,oCAGdvE,GAAEhC,GAAS4F,UAAU,MACjBX,KAAM,aACN0B,OAAQI,IACTF,GAAG,mBAAoB,WACtBjE,EAAYV,MAAMF,EAAErE,MAAM+G,WAOtCtC,GAAGC,gBAAgB2E,iBACfzE,KAAM,SAAUvC,EAASwC,GAErB,GAAIO,GAAMf,EAAEhC,GACR+E,EAAM3C,GAAGO,OAAOH,KAChBwC,EAAgC,kBAAdD,GAAI5H,MAAuB4H,EAAI5H,QAAU4H,EAAI5H,MAC/D8H,EAAO,+BAA+BC,KAAKF,GAAU,GACrDiC,EAAK7E,GAAGkD,QAAQvC,EAAI4B,SAAS,IAAIsC,KACjCC,EAAMnE,EAAIoE,SACNC,MAAOnC,EAAO,MAAQF,EAAIsC,OAC1BC,MAAM,EACNC,QAAS,WAKL,MAJAvF,GAAE,mBAAmBmF,QAAQ,QAC7BpE,EAAId,KAAK,mBAAmBkD,SAASJ,EAAIyC,SACzCzE,EAAId,KAAK,qBAAqBkD,SAASJ,EAAIyC,SAC3CzE,EAAId,KAAK,oBAAoBkD,SAASJ,EAAIyC,SACnCzE,EAAId,KAAK,oBAAoBqF,SAKhDJ,GAAIL,GAAG,mBAAoB,WACvBnF,WAAW,WAAcwF,EAAIC,QAAQ,SAAY,OAGrDnF,EAAEyF,UAAUZ,GAAG,QAAS,KAAO9B,EAAIyC,QAAS,SAAUrF,GAClDA,EAAEuF,gBACF,IAAIC,GAAMC,QAAQC,eAAeF,KAC7BG,EAAO9F,EAAErE,KACTmK,GAAKC,SAAS,oBACdJ,EAAIK,YAAY,gDAAiD,mBAAoB,MAAO,OACvFC,KAAK,SAAUxJ,GACG,QAAXA,GACAwI,EAAGiB,eAAenD,OAI9B+C,EAAKC,SAAS,kBACdd,EAAGkB,aAAapD,KAEhB+C,EAAKC,SAAS,mBACdd,EAAGmB,iBAAiBrD,SAMpC3C,GAAGC,gBAAgBgG,uBACf9F,KAAM,SAAUvC,EAASwC,GACrB,GAAI8F,GAAUtG,EAAEhC,GACZuI,EAASnG,GAAGO,OAAOH,KACnBN,EAAQqG,EAAOrG,MACfsG,EAAUD,EAAOC,QACjBC,EAAUb,QAAQ,wBAClBc,EAActG,GAAGO,OAAO4F,EAAOG,aAC/BC,EAAYvG,GAAGO,OAAO4F,EAAOI,WAE7B9F,EAAQ,SAAU+F,GAGlB,GAAIC,GAAUzG,GAAGO,OAAO4F,EAAOI,aAAevG,GAAGO,OAAO4F,EAAOG,aAC3DD,EAAQK,aAAa1G,GAAGO,OAAO4F,EAAOQ,QAASH,EAAOxG,GAAGO,OAAO4F,EAAOI,YACvEF,EAAQO,gBACJD,OAAQ3G,GAAGO,OAAO4F,EAAOQ,QACzBH,MAAOA,EACPK,MAAON,EACPO,OAAQR,GAIhBG,GAAQZ,KAAK,SAAU1C,GACnBvF,EAAQD,QAAQlC,OAAS,EACrB2K,GACAxI,EAAQmJ,IAAI,GAAIC,QAAOZ,EAAS,KAEpC/H,EAAE8E,GAAMnB,KAAK,SAAUC,GACnB,MAAiB,gBAANA,OACPrE,GAAQmJ,IAAI,GAAIC,QAAO/E,EAAGA,IAGP,gBAAZA,GAAEgF,OAAyC,gBAAZhF,GAAEiF,UACxCtJ,GAAQmJ,IAAI,GAAIC,QAAO/E,EAAEiF,MAAOjF,EAAEgF,QAGV,gBAAjBhF,GAAEsE,IAAqD,gBAAnBtE,GAAEqE,OAC7C1I,GAAQmJ,IAAI,GAAIC,QAAO/E,EAAEsE,GAAYtE,EAAEqE,KAD3C,SAMJJ,EAAQ5D,IAAItC,GAAGO,OAAOT,IACjB2E,GAAG,SAAU,WACV3E,EAAMoG,EAAQ5D,WAK9B7B,GAAMT,GAAGO,OAAO4F,EAAOK,QAEK,kBAAjBL,GAAOK,OACwB,kBAA3BL,GAAOK,MAAMW,WACpBhB,EAAOK,MAAMW,UAAU,SAAUlF,GAC7BxB,EAAMT,GAAGO,OAAO0B,OAKhC9C,OAAQ,SAAUvB,EAASwC,GACvB,GAAI+F,GAASnG,GAAGO,OAAOH,KACnBN,EAAQqG,EAAOrG,KACnBF,GAAEhC,GAAS0E,IAAItC,GAAGO,OAAOT;ACjRjCE,GAAGC,gBAAgBmH,MACfjH,KAAM,SAAUvC,EAASwC,GACrB,GAAIiH,GAAS7B,QAAQC,eAAe4B,QAChCvH,EAAQM,IACRuG,EAAS3G,GAAGO,OAAOT,EAAM6G,QACzBW,EAAYtH,GAAGO,OAAOT,EAAMwH,WAC5BC,EAASzH,EAAM0H,SACfC,GACI7F,KAAM+E,EAAO1B,OACbyC,OACIC,QAAQ,EACRH,UAAU,IAGlBI,EAAoB,SAAU3F,GAC1B,GAAI4F,GAAO7H,GAAGO,OAAO0B,EAAE6F,WAAa9H,GAAGO,OAAO0B,EAAElH,MAIhD,OAHI8M,GAAKrL,QAAQ,KAAO,IACpBqL,EAAO7H,GAAGO,OAAO0B,EAAElH,QAEhB8M,GAEXE,EAAyB,KACzBC,EAA6B,KAC7BC,EAAqB,SAAUC,GAC3BA,EAAKC,SAAW9J,EAAE6J,EAAKzJ,KAAK2J,oBAAoBC,IAAI,SAAUpG,GAE1D,GAAI4F,GAAOD,EAAkB3F,EAC7B,QACIL,KAAMK,EAAEgD,OACRyC,MAAO,OACPG,KAAMA,EACNpJ,KAAMwD,KAGd5D,EAAE6J,EAAKC,UAAUnG,KAAKiG,IAE1BK,EAAuC,SAAUJ,EAAMK,GAC9CvI,GAAGwI,aAAaD,EAAIE,sBACrBF,EAAIE,mBAAqBzI,GAAG0I,YAAW,GAE3C,IAAIC,GAAM/I,EAAEhC,GAASgL,QAAO,GACrBC,EAAUxK,EAAE6J,EAAKW,SAASR,IAAI,SAAUS,GAAK,MAAOH,GAAII,SAASD,KACjEE,EAAc3K,EAAEwK,GAAShJ,KAAK,SAAUiJ,GAAK,MAAkB,qDAAXA,EAAEjB,MAC7DU,GAAIE,mBAAmBO,IAAe,IAE1CC,EAAa,WACTxB,EAAWU,SAAW9J,EAAEsI,EAAOyB,oBAAoBC,IAAI,SAAUpG,GAE7D,OACIL,KAAM5B,GAAGO,OAAO0B,EAAEgD,MAClByC,MAAO,OACPG,KAAMD,EAAkB3F,GACxBxD,KAAMwD,KAGd5D,EAAEoJ,EAAWU,UAAUnG,KAAKiG,GAC5BrI,EAAEhC,GACG6G,GAAG,qBAAsB,SAAUyD,EAAMV,GACtC,GAAsB,kBAAXD,GAAX,CAGIQ,IACAA,EAAuBmB,UACvBnB,EAAyB,MAGzBC,IACAA,EAA2BkB,UAC3BlB,EAA6B,KAGjC,IAAIO,GAAMf,EAASU,KAAKzJ,IACxB,IAAI8J,EAAK,CACL,GAA2B,YAAvBf,EAASU,KAAKL,KACd,MAGC7H,IAAGwI,aAAaD,EAAIE,sBACrBF,EAAIE,mBAAqBzI,GAAG0I,YAAW,IAEtC1I,GAAGwI,aAAaD,EAAIY,eACrBZ,EAAIY,YAAcnJ,GAAG0I,YAAW,GAGpC,IAAIC,GAAM/I,EAAEhC,GAASgL,QAAO,GACrBC,EAAUxK,EAAEmJ,EAASU,KAAKW,SAASR,IAAI,SAAUS,GAAK,MAAOH,GAAII,SAASD,KAC1EE,EAAc3K,EAAEwK,GAAShJ,KAAK,SAAUiJ,GAAK,MAAkB,qDAAXA,EAAEjB,MAG7D,IAFAU,EAAIE,mBAAmBO,IAAe,IAEjCA,EAAa,CAEd,GAAII,GAAK/K,EAAEwK,GAAShJ,KAAK,SAAUiJ,GAC/B,GAAIO,GAAMP,EAAErK,IACZ,OAAkB,iDAAXqK,EAAEjB,MAA2D7H,GAAGO,OAAO8I,EAAIC,gBAElFF,IACAb,EAAIY,aAAY,GAKnBZ,EAAIE,sBACLE,EAAIY,KAAK/B,EAASU,MAEtBX,EAAOgB,GAEPR,EAAyBR,IAAStC,KAAKkC,UAAU,SAAUtE,GACvDjD,EAAEhC,GAASgL,QAAO,GACbY,YAAYhC,EAASU,KAAMrF,GAChC5E,QAAQC,IAAI,UAAY2E,KAGK,kBAAtB0E,KAASO,WAChBE,EAA6BT,IAASO,SAASX,UAAU,SAAUtE,GAC/DjD,EAAEhC,GAASgL,QAAO,GACba,SAASjC,EAASU,KAAMrF,UAM5C4B,GAAG,qBAAsB,SAAUiF,EAAOxB,GACvCjK,QAAQC,IAAIgK,EAAM,UAErBzD,GAAG,mBAAoB,SAAU1E,EAAGtB,GACjC,GAAIkK,GAAM/I,EAAEhC,GAASgL,QAAO,GAC3Be,EAAMlL,EAAKyJ,KAAKzJ,KACbmL,EAAYjB,EAAII,SAAStK,EAAKoL,YAC9BC,EAAiBF,EAAUnL,KAAK2J,kBAAoBzB,EAAOyB,iBAC3D7F,EAASoG,EAAII,SAAStK,EAAK8D,QAC3BwH,EAAaxH,EAAO9D,KAAK2J,kBAAoBzB,EAAOyB,gBACxD0B,GAAevG,OAAO,SAAUtB,GAC5B,MAAOjC,IAAGO,OAAOoJ,EAAIvE,SAAWpF,GAAGO,OAAO0B,EAAEmD,SAEhD2E,EAAWC,OAAOvL,EAAKwL,SAAU,EAAGN,KAEvClF,GAAG,qBAAsB,SAAUyF,EAAIhC,GACpC,GAAIiC,GAAKjC,EAAKA,KAAKzJ,IACnB0L,GAAGlF,KAAKiD,EAAKtG,QAEhBgH,QACGwB,MACIC,UAAa,EACbC,eAAkB,SAAUC,EAAWrC,EAAMsC,EAAYC,EAAcC,GACnE,GAAkB,cAAdH,EAA2B,CAC3B,GAAIZ,GAAMzB,EAAKzJ,KACXkK,EAAM/I,EAAEhC,GAASgL,QAAO,GACxB+B,EAAShC,EAAII,SAASyB,EAC1B,OAAKb,IAGAgB,GAGA3K,GAAGwI,aAAamB,EAAIlB,qBACrBH,EAAqCJ,EAAMyB,GAE3C3J,GAAGO,OAAOoJ,EAAIlB,qBACP,EAES,qDAAhBkC,EAAO9C,MACA,GAGJ,IAfI,EAiBf,OAAO,GAEX+C,QAAYC,SAAW,GACvBpM,KAAQgJ,GAEZqD,KACIC,aAAgB,SAAU7C,GACtB,GAAIyB,GAAMzB,EAAKzJ,IACf,OAAIkL,IAAO3J,GAAGO,OAAOoJ,EAAIlB,qBACd,GAEJ,IAGfuC,aACIC,MAAS,SAAUC,GAEf,GAAIvC,GAAM/I,EAAEhC,GAASgL,QAAO,GACxBC,EAAUxK,EAAE6M,EAAMrC,SAASR,IAAI,SAAUS,GAAK,MAAOH,GAAII,SAASD,KAClEE,EAAc3K,EAAEwK,GAAShJ,KAAK,SAAUiJ,GAAK,MAAkB,qDAAXA,EAAEjB,OAClDsD,EAAMxC,EAAIyC,cAClB,IAAIpC,EACA,QAGJ,IAAIqC,IACAC,MAAO,mBACPC,OAAQ,WACJ,GAAIC,GAAQ,GAAIhO,SAAQiO,IAAIC,OAAOC,cAAevG,MAAOiC,EAAOuE,OAAQ9D,SAAU,0BAA2B7C,KAAM,gBAC/G1C,EAAS3C,EAAEhC,GAASgL,OAAO,gBAAgB,GAC3CuB,EAAK5H,EAAO,GAAG9D,KACfoN,GAAYnE,MAAO,OAAQG,KAAM,0BAA2BjG,KAAM,cAAenD,KAAM+M,EAE3F,OAAKL,GAAI1P,QAGT0P,EAAMA,EAAI,GACVA,EAAMxC,EAAImD,YAAYX,EAAKU,GACvBV,GACAxC,EAAIY,KAAK4B,GACLhB,GAAMA,EAAG/B,iBACT+B,EAAG/B,iBAAiB5G,KAAKgK,GAEzB7E,EAAOyB,iBAAiB5G,KAAKgK,IAE1B,IAEJ,IAbI,IAkBfO,GACIT,MAAO,yBACPC,OAAQ,WACJ,GAAIS,GAAW,uDACXR,EAAQ,GAAIhO,SAAQiO,IAAIC,OAAOO,mBAAoB7G,MAAOiC,EAAOuE,OAAQ9D,SAAUkE,EAAU/G,KAAM,gBACnG1C,EAAS3C,EAAEhC,GAASgL,OAAO,gBAAgB,GAC3CuB,EAAK5H,EAAO,GAAG9D,KACfoN,GAAYnE,MAAO,OAAQG,KAAM,mDAAoDjG,KAAM,cAAenD,KAAM+M,EAEpH,OAAKL,GAAI1P,QAGT0P,EAAMA,EAAI,GACVA,EAAMxC,EAAImD,YAAYX,EAAKU,GACvBV,GACAxC,EAAIY,KAAK4B,GACLhB,GAAMA,EAAG/B,iBACT+B,EAAG/B,iBAAiB5G,KAAKgK,GAEzB7E,EAAOyB,iBAAiB5G,KAAKgK,GAEjCA,EAAM1D,SAASX,UAAU,eAIlB,IAEJ,IAjBI,IAsBnB+E,GACIZ,MAAO,oBACPC,OAAQ,WACJ,GAAIC,GAAQ,GAAIhO,SAAQiO,IAAIC,OAAOS,eAAgB/G,MAAOiC,EAAOuE,OAAQ3G,KAAM,gBAC3E1C,EAAS3C,EAAEhC,GAASgL,OAAO,gBAAgB,GAC3CuB,EAAK5H,EAAO,GAAG9D,KACfoN,GAAYnE,MAAO,OAAQG,KAAM,+CAAgDjG,KAAM,cAAenD,KAAM+M,EAEhH,OAAKL,GAAI1P,QAGT0P,EAAMA,EAAI,GACVA,EAAMxC,EAAImD,YAAYX,EAAKU,GACvBV,GACAxC,EAAIY,KAAK4B,GACLhB,GAAMA,EAAG/B,iBACT+B,EAAG/B,iBAAiB5G,KAAKgK,GAEzB7E,EAAOyB,iBAAiB5G,KAAKgK,IAE1B,IAEJ,IAbI,IAkBnBY,GACId,MAAO,SACPC,OAAQ,WAEJ,GAAIzC,GAAIH,EAAIyC,cAAa,GAAM,GAC3BiB,EAAI1D,EAAII,SAASnJ,EAAE,IAAMkJ,EAAEvG,SAC3B+J,EAAeD,EAAE5N,IACrB,IAAI6N,GAAyD,kBAAlCA,GAAalE,iBAAiC,CACrE,GAAIoD,GAAQnN,EAAEiO,EAAalE,oBAAoBvI,KAAK,SAAUoC,GAC1D,MAAOA,GAAEmD,UAAY0D,EAAErK,KAAK2G,SAEhCkH,GAAalE,iBAAiB7E,OAAOiI,OAClC,CACH,GAAIe,GAASlO,EAAEsI,EAAOyB,oBAAoBvI,KAAK,SAAUoC,GACrD,MAAOA,GAAEmD,UAAY0D,EAAErK,KAAK2G,SAEhCuB,GAAOyB,iBAAiB7E,OAAOgJ,GAGnC,MAAKpB,GAAI1P,QAGTkN,EAAI6D,YAAYrB,IAET,IAJI,IASnBF,IAYJ,QAVmB,YAAfC,EAAMrD,MAAqC,iDAAfqD,EAAMrD,QAClCoD,EAAMzJ,KAAK6J,GACXJ,EAAMzJ,KAAKuK,GACXd,EAAMzJ,KAAK0K,IAGfjO,QAAQC,IAAIgN,GACO,YAAfA,EAAMrD,MACNoD,EAAMzJ,KAAK4K,GAERnB,IAGfwB,OAEIC,WACIC,KAAQ,mBAEZC,2BACID,KAAQ,2BACRE,mBAEJC,6BACIH,KAAQ,+BACRE,mBAEJE,0BACIJ,KAAQ,yBACRE,mBAEJG,4BACIL,KAAQ,0BACRE,mBAEJI,4BACIN,KAAQ,yBACRE,mBAEJK,oDACIP,KAAQ,wBAEZQ,gDACIR,KAAQ,uBAGhBS,SAAY,cAAe,MAAO,QAAS,YAG3DnE,IAEA,IAAIoE,IAAK,CACTzN,GAAE0H,GAAWgG,MAAM,WACXD,GACAE,aAAaF,GAEjBA,EAAK/N,WAAW,WACZ,GAAI2C,GAAIrC,EAAE0H,GAAWhF,KACrB1C,GAAEhC,GAASgL,QAAO,GAAM4E,OAAOvL,IAChC,SAMfjC,GAAGC,gBAAgBwN,MACftN,KAAM,SAAUvC,EAASwC,GACrB,GAAIsF,GAAO9F,EAAEhC,GACT8P,EAAO1N,GAAGO,OAAOH,IACrBsF,GAAKiI,MAAM,SAAU5N,GACjBA,EAAEuF,iBACFxK,OAAOyB,KAAK,UAAYmR,MAIpC,IAAIE,kBAAmB,SAAUC,GAC7B,MAAO,UAAqBC,EAAGC,GAC3B,GAAIC,GAASC,CAGbD,MAEAC,EAAiB,GAAIC,QAAOJ,EAAG,KAI/BlO,EAAEoC,KAAK6L,EAAM,SAAUvR,EAAG6R,GAClBF,EAAeG,KAAKD,IAGpBH,EAAQxM,MAAO1B,MAAOqO,MAI9BJ,EAAGC,IAKXhO,IAAGC,gBAAgBoO,cACflO,KAAM,SAAUvC,EAASwC,GACrB,GAAIqM,GAAQzM,GAAGO,OAAOH,KAClBkO,EAAM,IACNC,EAAMvT,OAAOgB,OAAO,6BAA8ByQ,EAAM,GAAI,SAC5D+B,EAAc,GAAI7K,aACdC,eAAgBD,WAAWG,WAAW2K,IAAI1K,WAAW,QACrDE,eAAgBN,WAAWG,WAAWC,WACtC2K,MAAO,GACPC,QACIJ,IAAKA,EACLK,IAAKN,EACLO,OAAQ,SAAU1L,GACd,MAAO9E,GAAE8E,GAAMkF,IAAI,SAAUpG,GACzB,OAASY,KAAMZ,QAOnCuM,GAAYpK,aACZxE,EAAEhC,GAAS4F,UAAU,MAEbX,KAAM,cAAgBjD,EAAEhC,GAAS6E,KAAK,MACtC6B,WAAY,OACZC,OAAQiK,EAAYhK,gBAIpCxE,GAAGC,gBAAgB6O,qBACf3O,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIP,GAAQM,IACRiG,EAAUb,QAAQC,eAAesJ,aACjCC,EAASxJ,QAAQC,eAAeuJ,QAChCxO,EAAcH,IACd4O,EAAWjP,GAAGO,OAAOH,MAAoBtF,OAAOoU,gBAChDzO,EAAQ,SAAU9C,GACd3C,OAAOI,UAAU+T,YAAc,WAC3B,MAAO5T,MAAKM,QAAQ,mBAAoB,SAAUuT,EAAOC,EAAIC,EAAIC,GAC7D,MAAID,GAAWA,EAAGE,cACXH,EAAGI,gBAKlB,IAAI5M,GAAOlF,EAAQkF,MAAQlF,EAEvB+R,GADM/R,EAAQ8F,IAAM9F,EACZkF,EAAKsM,eAEbQ,EAAK3P,GAAG4P,KAAKpS,QAAQwR,EAAOa,gBAAkB,IAAMH,GAAOhE,OAAO7I,MAClEnC,EAAQd,EAAEhC,GACL+C,EAAMf,EAAE,eAAegB,KACnBC,OAAU,QAEvBH,GAAMI,OAAOC,OAAOJ,EAEpB,IAAIK,GAAIC,WAAWN,EAAI,IACnBO,SAAU,OACVC,MAAO,QACPC,WAAY,6CAGhBJ,GAAEK,QAAQrB,GAAGO,OAAOC,EAAYV,OAChC,KAAK,GAAIwB,KAAMqO,GACX,GAAIA,EAAGpO,eAAeD,GAAK,CACvB,GAAW,UAAPA,EAAgB,QACpB,IAAW,iBAAPA,EAAuB,QAC3B,IAAW,oBAAPA,EAA0B,QAC9B,IAAW,UAAPA,EAAgB,QACpB,IAAW,UAAPA,EAAgB,QACpBN,GAAErD,QAAQ6D,KAAK,GAAKF,GAG5BN,EAAErD,QAAQ8D,MAEV,IAAIC,GAAgBiO,CACpB3O,GAAEW,SAAW,SAAUC,GACnB,GAAIA,EAAKC,YAAY,OAASD,EAAKnG,OAAS,EAAG,CAC3CuF,EAAErD,UACF,IAAImE,GAAQF,EAAKG,MAAM,IAEvBL,GAAgBiO,EAChBtR,EAAEyD,GAAOE,KAAK,SAAUC,GACV,KAANA,IACJP,EAAgBA,EAAcO,MAElChE,QAAQC,IAAI,gBAAiBwD,EAC7B,KAAK,GAAIpF,KAAKoF,GACV,GAAIA,EAAcH,eAAejF,GAAI,CACjC,GAAU,UAANA,EAAe,QACnB,IAAU,iBAANA,EAAsB,QAC1B,IAAU,oBAANA,EAAyB,QAC7B,IAAU,UAANA,EAAe,QACnB,IAAU,UAANA,EAAe,QACnB0E,GAAErD,QAAQ6D,KAAK,GAAKlF,GAG5B0E,EAAErD,QAAQ8D,OACVT,EAAEkB,UAAYN,EAAKC,YAAY,KAAO,EAE1Cb,EAAEmB,WAGNnB,EAAEmB,UACFvC,EAAEoB,EAAEN,OACC0B,KAAK,eAAgB,OACrBC,KAAK,WACF7B,EAAYV,MAAMF,EAAErE,MAAM+G,SAC3BC,SAAS1C,KAAK,SAChBe,KAAM4B,QAAW,WAAY3B,OAAU,SAExCjB,EAAEhC,GAAS6E,KAAK,aAChB7C,EAAEoB,EAAEN,OAAO+B,KAAK,YAAY,GAGhCzB,EAAE8O,eAKNb,IACA5I,EAAQ0J,aAAa,mBAAoB,YAAcd,EAAW,eAAiBA,EAAW,IAAK,MAC9FpJ,KAAK,SAAUmK,GACZvP,GAAQoC,KAAMmN,EAAI/K,OAAQxB,GAAIuM,EAAIC,SAMzB,kBAAVnQ,IAAmD,kBAApBA,GAAMqH,WAC5CrH,EAAMqH,UAAU,SAAUR,GACtB/G,EAAEhC,GAAS4F,UAAU,WACrB/C,EAAMkG,OAMtB3G,GAAGC,gBAAgBiQ,cACf/P,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIG,GAAcH,IACd8P,GAAW,KAAM,UAAW,aAC5BC,EAAY,SAAU5J,GAClB,GAAInK,GAAS,WAAWyG,KAAK0D,EAC7B,OAAInK,IAAUA,EAAO,GACVA,EAAO,GAAGT,OACd,IAEXyU,EAAQhS,EAAE8R,GAAS9H,IAAI,SAAUpG,GAC7B,OAASqO,KAAMrO,KAEnByB,EAAU,GAAIC,aACVC,eAAgB,SAAUC,GACtB,MAAOA,GAAEyM,KAAKvO,MAAM,OAExBkC,eAAgB,SAAUsM,GACtB,MAAOA,GAAExO,MAAM,OAEnByO,MAAOH,GAEf3M,GAAQU,aAERxE,EAAEhC,GAAS4F,WACPiN,UAAW,EACXpM,WAAW,EACXqM,QAAS,WACL,MAAOnV,MAAKoV,SAASrO,MAAMzG,QAAQ,SAAU,IAAMoH,KAAO,KAE9D2N,QAAS,SAAU3N,GACf,GAAI4N,GAAST,EAAU7U,KAAKiL,MAC5B,OAAKqK,IACG5N,EAAKwM,cAAcjT,QAAQqU,EAAOpB,gBADtB,KAKpB5M,KAAM,YACNyB,WAAY,OACZC,OAAQb,EAAQc,cAEnBC,GAAG,mBAAoB,WACpBjE,EAAYV,MAAMF,EAAErE,MAAM+G,WAO1CtC,GAAGC,gBAAgB6Q,OACf3Q,KAAM,SAAUvC,EAASwC,GACrB,GAAI0Q,GAAQ9Q,GAAGO,OAAOH,KAClBiG,EAAUb,QAAQ,wBAClBmB,EAASmK,EAAMC,SACfvK,EAAQwK,KAAKC,MAAMH,EAAMI,SACzBrJ,EAAOiJ,EAAMK,OACbC,EAAM,GAAIxR,GAAEyR,SACZxO,EAAOiO,EAAM7L,MAgEjB,OA7DAoB,GAAQiL,YAAY3K,EAAQH,GACvBX,KAAK,SAAUxJ,GAEZ,GAAIkV,GAAUlV,EAAOmV,aAAaC,SAASF,SAAWlV,EAAOmV,aAAaC,SACtEhT,EAAOJ,EAAEkT,GAASlJ,IAAI,SAAUpG,GAC5B,OACIwP,SAAUxP,EAAEyP,eAAiBzP,EAAE0P,IAAIpU,WACnCuC,MAAOmC,EAAE2P,aAGjBC,EAAaxT,EAAEkT,GAASlJ,IAAI,SAAUpG,GAClC,MAAOA,GAAEyP,eAAiBzP,EAAE0P,IAAIpU,aAEpCuU,EAAalS,EAAEhC,GAASkU,YACpBC,MAAO,QACPC,WACIC,WAAY,IAEhBjN,OACIpD,KAAMiB,GAEVqP,QACIjI,SAAU,UAEdkI,gBACIC,QACIC,SAAS,EACTrW,OAAQ,MACRiW,WAAY,cACZK,SAAU,6BAGlBC,SAEQ1K,KAAMA,EACNpJ,KAAMA,IAGd+T,cACIX,WAAYA,EACZY,gBACIJ,SAAS,IAGjBK,SACIL,SAAS,EACTrW,OAAQ,MACRsW,SAAU,+BAEf7T,KAAK,aACZ2S,GAAIuB,SAAQ,GAEZtM,EAAQuM,eAAe,aAAc,UAAY9B,EAAM+B,eAAiB,IAAK,QACxEhN,KAAK,SAAUiN,GACZhB,EAAWnU,QAAQqH,MAAMpD,KAAOiB,EAAO,KAAOiQ,EAAW,IACzDhB,EAAWiB,cAMpB3B,EAAI3K,YAInBzG,GAAGC,gBAAgB+S,YACf7S,KAAM,SAAUvC,EAASwC,GACrB,GAAI6S,GAASrT,EAAEhC,GACXkC,EAAQM,IACR8S,EAAUtT,EAAE,iDAEhBqT,GAAO1Q,SAAS4Q,OAAOD,GACvBA,EAAQvF,MAAM,SAAU5N,GACpBA,EAAEuF,iBACFE,SAAS,yBAA0B,gBAAiB,SAAU4N,EAAQC,GAClEA,EAAKC,WAAWF,GACXvN,KAAK,SAAUxJ,GACG,OAAXA,IACAyD,EAAMsT,EAAOzG,QACbsG,EAAO3Q,IAAI8Q,EAAOzG,gBAU9C,IAAInP,SAAUA,WACdA,SAAQ+V,gBAAkB/V,QAAQ+V,oBAElC/V,QAAQgW,4BAA8B,SAAU7B,GAC5C,MAAInU,SAAQ+V,gBAAgB5B,GACjBnU,QAAQ+V,gBAAgB5B,IAGnCnU,QAAQ+V,gBAAgB5B,GAAO3R,GAAGuT,kBAC3B/V,QAAQ+V,gBAAgB5B,KAInC3R,GAAGC,gBAAgBkG,QACfhG,KAAM,SAAUvC,EAASwC,GACrB,GAAIqT,GAAQ7T,EAAEhC,GACVD,EAAUyC,IACVmH,EAASvH,GAAGO,OAAO5C,EAAQ4J,OAE/BkM,GAAM9F,MAAM,SAAU5N,GAClBA,EAAEuF,iBACFvF,EAAE2T,kBAEFlO,SAAS,kCAAmC,gBAAiB,SAAU4N,EAAQC,GAC3ED,EAAOzV,QAAQA,GACf0V,EAAKC,WAAWF,GACXvN,KAAK,SAAUxJ,GACZ,GAAKA,GACU,OAAXA,EAAiB,CACjB,GAAI4G,GAAOmQ,EAAO5L,UAClB7J,GAAQmC,MAAMmD,EAAKsE,aAS/CvH,GAAG2T,gBAAgBC,gBAAgBC,YAAa,EAChDrW,QAAQqW,WAAa,SAAUjW,EAASwC,GACpC,GAAIzC,GAAUyC,IACVuG,EAAS3G,GAAGO,OAAO5C,EAAQgJ,QAC3BL,EAActG,GAAGO,OAAO5C,EAAQ2I,aAChCC,EAAYvG,GAAGO,OAAO5C,EAAQ4I,WAC9BjE,EAAMtC,GAAGO,OAAO5C,EAAQmC,OACxBuG,EAAUb,QAAQ,wBAClBsO,EAAiB,SAAUC,EAAKC,GAC5B,GAAIlU,GAAQE,GAAGvC,MAAMwW,iBAAiBD,IACvB,OAAVlU,GAA8BoU,SAAVpU,KACrBA,EAAQ,GACZ,IAAIqU,GAAgBnU,GAAG2T,gBAAgBS,WAAWL,IAC7CI,GAA4C,IAA3BA,EAAcE,UAAkBrU,GAAG2T,gBAAgBW,YAAYH,GACjFnU,GAAG2T,gBAAgBY,mBAAmBR,GAAMA,EAAIS,cAAcC,eAAe3U,KAE7EqU,EAAc1V,KAAOqB,EAKjCuG,GAAQuM,eAAejM,EAAQJ,EAAY,QAAUjE,EAAM,IAAKgE,GAC/DT,KAAK,SAAUjE,GACZkS,EAAelW,EAASgE,GACxB3D,QAAQC,IAAI0D,MAGpB5B,GAAGC,gBAAgB4T,YACf1T,KAAM3C,QAAQqW,WACd1U,OAAQ3B,QAAQqW,YAIpB7T,GAAGC,gBAAgByU,UACfvU,KAAM,SAAUvC,EAASwC,GACrB,GAAIM,GAAQd,EAAEhC,GACV+W,EAAK3U,GAAGO,OAAOH,IAEfuU,GACAjU,EAAM+B,KAAK,YAAY,GAGvB/B,EAAM+B,KAAK,YAAY,IAG/BtD,OAAQ,SAAUvB,EAASwC,GACvB,GAAIM,GAAQd,EAAEhC,GACT+W,EAAK3U,GAAGO,OAAOH,IAEhBuU,GACAjU,EAAM+B,KAAK,YAAY,GAGvB/B,EAAM+B,KAAK,YAAY;AC/wBnCzC,GAAGC,gBAAgB2U,aACfzU,KAAM,SAAUvC,EAASwC,GACrB,GAAIyU,GAAUjV,EAAEhC,GACZkC,EAAQM,IACR0U,GAAW,CAEfxV,YAAW,WACP,GAAIyV,GAASF,EAAQD,aACjBxR,OAAQ,WACA0R,IACJA,GAAW,EACXhV,EAAMvE,KAAKuE,SACXR,WAAW,WAAcwV,GAAW,GAAU,SAEnDrW,KAAK,cAERsW,GAAOjV,MAAMA,KAEbA,EAAMqH,UAAU,SAAUjC,GAClB4P,IACJA,GAAW,EACXC,EAAOjV,MAAMoF,GACb5F,WAAW,WAAcwV,GAAW,GAAU,SAGnD,MAEPE,QAAS,SAAUpX,EAASwC,GACxB,GAAIyU,GAAUjV,EAAEhC,GACZkC,EAAQM,IACR6U,EAAKJ,EAAQpW,KAAK,cACjBoW,GAAQpW,KAAK,aACdwW,EAAGnV,MAAMA,OAKrBE,GAAGC,gBAAgBiV,wBACf/U,KAAM,SAAUvC,EAASwC,GACrB,GAAIN,GAAQM,IACR+U,EAAoBnV,GAAGvC,MAAMwW,iBAAiBnU,GAC9CsV,EAAKxV,EAAEhC,GAASa,KAAK,oBACzB2W,GAAGtV,MAAMqV,GAETC,EAAGlW,KAAK,SAAU,WACd,GAAImW,GAAKD,EAAGtV,OACZA,GAAMuV,MAIdlW,OAAQ,SAAUvB,EAASwC,GAEvB,GAAIN,GAAQM,IACRkV,EAAatV,GAAGvC,MAAMwW,iBAAiBnU,EAEvCwV,IACA1V,EAAEhC,GAASa,KAAK,qBAAqBqB,MAAMwV,KAKvDtV,GAAGC,gBAAgBsE,UAEnBvE,GAAGC,gBAAgBsV,eACfpV,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIP,GAAQM,IACRI,EAAcH,IACd8U,EAAoBnV,GAAGvC,MAAMwW,iBAAiBnU,GAC9CsV,EAAKxV,EAAEhC,GAASa,KAAK,kBACjBmB,EAAEhC,GAAS2X,eACPxW,WAAYyB,EAAY+D,WACzB9F,KAAK,gBAEhB2W,GAAGtV,MAAMqV,GACT3U,EAAY+D,OAAO4C,UAAU,SAAUxJ,GAEnCyX,EAAGrW,WAAWN,KAAKd,KAEvByX,EAAGlW,KAAK,SAAU,WACd,GAAImW,GAAKD,EAAGtV,OACZA,GAAMuV,MAIdlW,OAAQ,SAAUvB,EAASwC,GAEvB,GAAIN,GAAQM,IACRkV,EAAatV,GAAGvC,MAAMwW,iBAAiBnU,EAEvCwV,IACA1V,EAAEhC,GAASa,KAAK,iBAAiBqB,MAAMwV,KAMnDtV,GAAGC,gBAAgBuV,WACnBxV,GAAGC,gBAAgBwV,OACftV,KAAM,SAAUvC,EAASwC,EAAeC,GAEpC,GAAIP,GAAQM,IACRI,EAAcH,IACdmV,EAAU,WACN,MAAmC,mBAAxBhV,GAAYgV,QACZ,EAEJvY,SAASuD,EAAYgV,UAEhCE,EAAU9V,EAAEhC,GACZ0E,EAAMqT,WAAW3V,GAAGO,OAAOT,IAAU,KACrC8V,EAAKtT,EAAIuT,QAAQL,KAAW3Z,QAAQ,KAAM,SAAUmF,EAAG1E,EAAGwZ,GACtD,OAAOxZ,GAAW,MAAN0E,IAAgB8U,EAAEra,OAASa,GAAK,EAAe0E,EAAV,IAAMA,GAI/D,OAAsC,SAAlCpD,EAAQmY,QAAQtG,kBAChBiG,GAAQ9T,KAAKgU,IAIjBF,EAAQpT,IAAIsT,OAEZF,GAAQjR,GAAG,OAAQ,WACf,GAAIuR,GAAKpW,EAAErE,MAAM+G,MAAMzG,QAAQ,KAAM,GACrCoC,SAAQC,IAAI8X,GACZlW,EAAM6V,WAAWK,QAIzB7W,OAAQ,SAAUvB,EAASwC,EAAeC,GACtC,GAAIP,GAAQM,IACRI,EAAcH,IACdmV,EAAU,WACN,MAAmC,mBAAxBhV,GAAYgV,QACZ,EAEJvY,SAASuD,EAAYgV,UAE/BE,EAAU9V,EAAEhC,GACZ0E,EAAMqT,WAAW3V,GAAGO,OAAOT,IAAU,KACrC8V,EAAKtT,EAAIuT,QAAQL,KAAW3Z,QAAQ,KAAM,SAAUmF,EAAG1E,EAAGwZ,GACtD,OAAOxZ,GAAW,MAAN0E,IAAgB8U,EAAEra,OAASa,GAAK,EAAe0E,EAAV,IAAMA,GAGhE0U,GAAQpT,IAAIsT,KAMpB5V,GAAGC,gBAAgBgW,MACf9V,KAAM,SAAUvC,EAASwC,GACrB,GAAIN,GAAQE,GAAGvC,MAAMwW,iBAAiB7T,IAEtC,KAAKN,EAGD,MAFAF,GAAEhC,GAASgE,KAAK,QAChBhC,GAAEhC,GAAS0E,IAAI,GAInB,IAAI4T,GAAKlW,GAAGO,OAAOT,EAAMA,OACrBqW,GAAiBD,GAAM,IAAI1Z,QAAQ,KAAO,GAAK,sBAAwB,aACvE4Z,EAAcpW,GAAGO,OAAOT,EAAMsW,cAAgBD,EAC9CF,EAAOI,OAAOH,EAAIE,GAClBE,EAAUtW,GAAGO,OAAOT,EAAMwW,UAAY,eACtCta,EAASgE,GAAGO,OAAOT,EAAM9D,SAAW,YAWxC,IATK8D,EAAM9D,QAAsC,gBAArBgE,IAAGO,OAAOT,KAClCoW,EAAKlW,GAAGO,OAAOT,GACfmW,EAAOI,OAAOH,IAGlBtW,EAAEhC,GAAS6G,GAAG,SAAU,WACpB,GAAI4Q,GAAKzV,EAAErE,MAAM+G,KACjBxC,GAAMA,MAAMuV,MAEXa,EAGD,MAFAtW,GAAEhC,GAASgE,KAAK0U,OAChB1W,GAAEhC,GAAS0E,IAAIgU,EAGnB,KAAKL,EAGD,MAFArW,GAAEhC,GAASgE,KAAK,QAChBhC,GAAEhC,GAAS0E,IAAI,GAGnB,IAAoB,IAAhB2T,EAAKM,OAGL,MAFA3W,GAAEhC,GAASgE,KAAK,QAChBhC,GAAEhC,GAAS0E,IAAI,GAKnB,IAAIkU,GAAaP,EAAKja,OAAOA,GAAQuB,UACjCiZ,GAAWha,QAAQ,OAAS,IAC5BoD,EAAEhC,GAASgE,KAAK4U,GAChB5W,EAAEhC,GAAS0E,IAAIkU,KAMvBrX,OAAQ,SAAUvB,EAASwC,GACvB,GAAIN,GAAQE,GAAGvC,MAAMwW,iBAAiB7T,IAEtC,KAAKN,EAGD,MAFAF,GAAEhC,GAASgE,KAAK,QAChBhC,GAAEhC,GAAS0E,IAAI,GAInB,IAAI4T,GAAKlW,GAAGO,OAAOT,EAAMA,OACrBqW,GAAiBD,GAAM,IAAI1Z,QAAQ,KAAO,GAAK,sBAAwB,aACvE4Z,EAAcpW,GAAGO,OAAOT,EAAMsW,cAAgBD,EAC9CF,EAAOI,OAAOH,EAAIE,GAClBE,EAAUtW,GAAGO,OAAOT,EAAMwW,UAAY,eACtCta,EAASgE,GAAGO,OAAOT,EAAM9D,SAAW,YAWxC,IATK8D,EAAM9D,QAAsC,gBAArBgE,IAAGO,OAAOT,KAClCoW,EAAKlW,GAAGO,OAAOT,GACfmW,EAAOI,OAAOH,IAGlBtW,EAAEhC,GAAS6G,GAAG,SAAU,WACpB,GAAI4Q,GAAKzV,EAAErE,MAAM+G,KACjBxC,GAAMA,MAAMuV,MAEXa,EAGD,MAFAtW,GAAEhC,GAASgE,KAAK0U,OAChB1W,GAAEhC,GAAS0E,IAAIgU,EAGnB,KAAKL,EAGD,MAFArW,GAAEhC,GAASgE,KAAK,QAChBhC,GAAEhC,GAAS0E,IAAI,GAGnB,IAAoB,IAAhB2T,EAAKM,OAGL,MAFA3W,GAAEhC,GAASgE,KAAK,QAChBhC,GAAEhC,GAAS0E,IAAI,GAKnB,IAAIkU,GAAaP,EAAKja,OAAOA,GAAQuB,UACjCiZ,GAAWha,QAAQ,OAAS,IAC5BoD,EAAEhC,GAASgE,KAAK4U,GAChB5W,EAAEhC,GAAS0E,IAAIkU,MAS3BxW,GAAGC,gBAAgBwW,aACftW,KAAM,SAAUvC,EAASwC,GACrB,GAAIiG,GAAUb,QAAQC,eAAesJ,aAChC2H,EAASlR,QAAQC,eAAeiR,QAChC5W,EAAQM,IACRzC,EAAUyC,IACNuW,IACLhZ,IAA8B,gBAAZA,KAClBmC,EAAQnC,EAAQmC,MAChB6W,EAAahZ,EAAQgZ,YAGzB/W,EAAEhC,GAASwE,KAAK,OAAQ,SAASqU,aAC7BG,OACIC,QAAS,sBACTC,UAAW,sBACXC,YAAY,GAEhBC,UAAU,EACVC,MAAO,SAAUlX,GACb2W,EAAOQ,SAASnX,EAAGA,EAAGxE,MAAM,IAEhC4b,OAAQ,SAAUpX,GACY,IAAtB4W,EAAWlb,QAGf4C,EAAE0B,EAAEqX,OAAOpV,KAAK,SAAUC,GAClB0U,EAAWna,QAAQyF,EAAEoV,WAAa,IAClCX,EAAOO,MAAM,QAAUN,EAAWW,KAAK,KAAO,0BAC9CvX,EAAEuF,qBAIdiS,QAAS,SAAUxX,GACf2W,EAAOc,KAAK,sBAAwBzX,EAAEwK,UAEtC,IAAIkN,GAAU1X,EAAE2X,SAASD,QACrBE,EAA2B,WAAhB5X,EAAEwK,UACbqN,EAA0B,WAAhB7X,EAAEwK,UACZsN,EAAU/X,GACV6X,KACA7X,EAAM2X,GACFI,GACAxR,EAAQyR,KAAK9G,KAAK+G,WAAYtU,GAAIoU,IAAY,yBAGlDD,GACA9X,EAAM,KAGdyD,OAAQ,WACJ,GAAI6N,GAAM,GAAIxR,GAAEyR,SACZ5S,EAAOuS,KAAK+G,WAAYtU,GAAI3D,KAKhC,OAJAuG,GAAQyR,KAAKrZ,EAAM,wBACduZ,KAAK,SAAU3b,GACZ+U,EAAIuB,QAAQtW,KAEb+U,EAAI3K,eAO3BzG,GAAGC,gBAAgBgY,WACf9X,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIP,GAAQM,IACR6S,EAASrT,EAAEhC,GACX4C,EAAcH,IACd6X,EAAelY,GAAGO,OAAOT,GACzBmW,EAAOI,OAAO6B,EAAc,cAC5Bla,EAAU,SAAU+B,GAChB9B,QAAQC,IAAI6B,EACZ,IAAIsV,GAAK9Z,KAAKuE,OAEVmW,GADa,gBAANZ,GACAgB,OAAOhB,EAAI,cAEXgB,OAAOhB,GAGlBpC,EAAOxU,KAAK,OAAQ,QACpBqB,EAAMmW,EAAKja,OAAO,eAClBiX,EAAOxU,KAAK,OAAQ,UAGxB0Z,EAASlF,EAAOmF,iBAAkBpc,OAAQ,aAAcoH,OAAQpF,IAAWS,KAAK,kBAapF,OAXkC,iBAAvB+B,GAAY6X,SACd7X,EAAY6X,QACbF,EAAOE,QAAO,IAGY,kBAAvB7X,GAAY6X,QAAiE,kBAAjC7X,GAAY6X,OAAOlR,WACtE3G,EAAY6X,OAAOlR,UAAU,SAAUkR,GACnCF,EAAOE,OAAOA,KAIjBpC,EAKe,IAAhBA,EAAKM,WACL4B,GAAOrY,MAAM,OAIjBqY,EAAOrY,MAAMmW,EAAKqC,eACU,mBAAjBJ,IAAiD,kBAAVpY,IAC9CA,EAAMmW,EAAKja,OAAO,qBAXlBmc,GAAOrY,MAAM,OAcrBX,OAAQ,SAAUvB,EAASwC,EAAeC,GACtC,GAAI4S,GAASrT,EAAEhC,GACX4C,EAAcH,GAClB,IAA4B,SAAxB4S,EAAOxU,KAAK,QAAhB,CAEA,GAAIqB,GAAQM,IACRkV,EAAatV,GAAGvC,MAAMwW,iBAAiBnU,GACvCmW,EAAOI,OAAOf,GACd6C,EAASlF,EAAOxU,KAAK,kBAEzB,KAAKwX,EAED,WADAkC,GAAOrY,MAAM,KAGjB,IAAoB,IAAhBmW,EAAKM,OAEL,WADA4B,GAAOrY,MAAM,KAIiB,kBAAvBU,GAAY6X,SACd7X,EAAY6X,QACbF,EAAOE,QAAO,IAGY,kBAAvB7X,GAAY6X,QAAiE,kBAAjC7X,GAAY6X,OAAOlR,WACtE3G,EAAY6X,OAAOlR,UAAU,SAAUkR,GACnCF,EAAOE,OAAOA,KAGtBF,EAAOrY,MAAMmW,EAAKqC,aAO1BtY,GAAGC,gBAAgBsY,eACfpY,KAAM,SAAUvC,EAASwC,GACrB,GAAIN,GAAQM,IACR6S,EAASrT,EAAEhC,GACXsa,EAAelY,GAAGvC,MAAMwW,iBAAiBnU,GACzCmW,EAAOI,OAAO6B,EAAc,eAC5Bla,EAAU,SAAU+B,GAChB9B,QAAQC,IAAI6B,EACZ,IAAIsV,GAAK9Z,KAAKuE,OAEVmW,GADa,gBAANZ,GACAgB,OAAOhB,EAAI,oBAEXgB,OAAOhB,GAGlBpC,EAAOxU,KAAK,OAAQ,QACpBqB,EAAMmW,EAAKja,UACXiX,EAAOxU,KAAK,OAAQ,UAGxB0Z,EAASlF,EAAOuF,qBAAsBxc,OAAQ,mBAAoBoH,OAAQpF,IAAWS,KAAK,sBAE9F,OAAKwX,GAKe,IAAhBA,EAAKM,WACL4B,GAAOrY,MAAM,UAIjBqY,GAAOrY,MAAMmW,EAAKqC,cATdH,GAAOrY,MAAM,OAWrBX,OAAQ,SAAUvB,EAASwC,GACvB,GAAI6S,GAASrT,EAAEhC,EACf,IAA4B,SAAxBqV,EAAOxU,KAAK,QAAhB,CAEA,GAAIqB,GAAQM,IACRkV,EAAatV,GAAGvC,MAAMwW,iBAAiBnU,GACvCmW,EAAOI,OAAOf,GACd6C,EAASlF,EAAOxU,KAAK,sBAEzB,OAAKwX,GAIe,IAAhBA,EAAKM,WACL4B,GAAOrY,MAAM,UAIjBqY,GAAOrY,MAAMmW,EAAKqC,cARdH,GAAOrY,MAAM,SAazBE,GAAGC,gBAAgBwY,cACftY,KAAM,SAAUvC,EAASwC,GAErB,GAAIN,GAAQM,GACZR,GAAEhC,GAAS8a,OAAO1Y,GAAGvC,MAAMwW,iBAAiBnU,KAEhDX,OAAQ,SAAUvB,EAASwC,GACvB,GAAIN,GAAQM,GACZJ,IAAGvC,MAAMwW,iBAAiBnU,GAASF,EAAEhC,GAAS+a,YAAc/Y,EAAEhC,GAASgb,YAI/E5Y,GAAGC,gBAAgB4Y,aACf1Y,KAAM,SAAUvC,EAASwC,GACrB,GAAIN,GAAQM,IACRiY,EAASrY,GAAGvC,MAAMwW,iBAAiBnU,EACnCuY,GACAzY,EAAEhC,GAASkb,YAAY,oBAEvBlZ,EAAEhC,GAASmF,SAAS,qBAG5B5D,OAAQ,SAAUvB,EAASwC,GACvB,GAAIN,GAAQM,IACRiY,EAASrY,GAAGvC,MAAMwW,iBAAiBnU,EACnCuY,IACAzY,EAAEhC,GAASkb,YAAY,oBACvBlZ,EAAEhC,GAASmb,WAAW,cAEtBnZ,EAAEhC,GAASmF,SAAS,oBACpBnD,EAAEhC,GAASwE,KAAK,WAAY,eAKxCpC,GAAGC,gBAAgB+Y,SACf7Y,KAAM,SAAUvC,EAASwC,EAAeC,EAAqB4Y,GACzD,GAAI1N,GAASnL,IACT8Y,EAAUtZ,EAAEhC,GACZ4C,EAAcH,IACd8Y,EAAaD,EAAQ5W,MACrBoU,EAASlR,QAAQ,kBAErB,IAAIhF,EAAY4Y,UAAW,CACvB,GAAI/G,GAA2C,kBAA1B7R,GAAY4Y,UAA2B5Y,EAAY4Y,YAAc5Y,EAAY4Y,SAC7F/G,GAGD6G,EAAQG,OAFRH,EAAQpY,OAKyB,kBAA1BN,GAAY4Y,WACnB5Y,EAAY4Y,UAAUjS,UAAU,SAAUlF,GAClCA,EACAiX,EAAQG,OAERH,EAAQpY,SAKxB,GAAIwY,GAAW1Z,EAAE,gDAAgDkB,OAC7DyY,EAAW3Z,EAAE,mDAAmDkB,MACpEoY,GAAQ/F,OAAOmG,GACfJ,EAAQ/F,OAAOoG,GAEfL,EAAQvL,MAAM,SAAU5N,GACpBA,EAAEuF,mBACE/J,KAAKie,MACAje,KAAKie,KAAKC,mBAEnBH,EAASD,OACTE,EAASzY,OAETyK,EAAO0N,EAAWlZ,GACb2Z,KAAK,SAAUC,EAAKC,EAAGC,GAQpB,MAPAX,GACIY,OAAO,YACPrX,KAAK,YAAY,GACjBH,IAAI6W,GACJL,YAAY,gBAChBQ,EAASxY,OACTyY,EAASF,OACU,MAAfM,EAAII,QACJrD,EAAOO,MAAM4C,OACbnD,GAAOO,MAAM0C,EAAIK,cAGjBL,EAAIM,eACJvD,EAAOO,MAAM0C,EAAIM,cACjBhc,QAAQgZ,MAAM0C,EAAIM,oBAElBN,EAAIO,eACJxD,EAAOO,MAAMjG,KAAK+G,UAAU4B,EAAIO,eAChCjc,QAAQgZ,MAAM0C,EAAIQ,mBAGzBtU,KAAK,WACFqT,EACKY,OAAO,YACPrX,KAAK,YAAY,GACjBH,IAAI6W,GACJL,YAAY,gBACjBQ,EAASxY,SAEboY,EAAQza,KAAK,iBACbya,EAAQY,OAAO,WAEnBZ,EAAQnW,SAAS,gBAAgBN,KAAK,YAAY,QAM9DzC,GAAGC,gBAAgB4G,OACf1G,KAAM,cAGVH,GAAGC,gBAAgBma,aACfja,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIkL,GAASnL,IACT0Z,EAASla,EAAEhC,GACX4C,EAAcH,GAGlByZ,GAAOnM,MAAM,SAAU5N,GACnBA,EAAEuF,gBACF,IAAI7C,GAAOjC,EAAY6Z,SACnBC,EAAW9Z,EAAY8Z,SACvBzS,EAAOrH,EAAYqG,MACnBF,EAASnG,EAAYmG,MAIrBlE,IAC8B,mBAAnB6X,GAAS7X,IAChBxE,QAAQC,IAAI,sCAEc,gBAAnBoc,GAAS7X,KAChB6X,EAAS7X,GAAQzC,GAAG0I,WAAW4R,EAAS7X,KAEd,kBAAnB6X,GAAS7X,IAChB8I,EAAO+O,EAAS7X,GAAOoF,EAAMlB,IAGjC4E,EAAO+O,EAAUzS,EAAMlB,OAOvC3G,GAAGC,gBAAgBsa,YACfpa,KAAM,SAAUvC,EAASwC,GACrB,GAAIyH,GAAOzH,IACPoa,EAAM5a,EAAEhC,GAER6c,EAAqB,kBAAT5S,GAAsBA,IAASA,CAC/C2S,GAAIpY,KAAK,MAAO,gBAAkBqY,KAO1Cza,GAAGC,gBAAgBya,yBACfva,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIP,GAAQM,IACRI,EAAcH,IACd1C,EAAU6C,EAAY/B,MAE1BmB,GAAEhC,GAASa,KAAK,sBACbmB,EAAEhC,GAAS+c,mBACP5b,WAAYpB,EACZyF,OAAQ,WACJ,GAAI3E,GAAOJ,EAAE9C,KAAKuE,QAAQiC,MAAM,MAAM8M,OAAO,SAAU0B,GACnD,MAAOA,IAEXzQ,GAAMrB,IAEVoQ,OAAQ,aACR+L,YAAa,OACbC,UAAW,MACZvY,IAAIxC,MAEdX,OAAQ,SAAUvB,EAASwC,GACvB,GAAIN,GAAQM,GACZR,GAAEhC,GAASa,KAAK,qBAAqBqB,MAAMA,OAOnDE,GAAGC,gBAAgB6a,kBACf3a,KAAM,SAAUvC,EAASwC,GACrB,GAAI4Y,GAAU5Y,IACVN,EAAQkZ,EAAQlZ,MAChB+H,EAAOmR,EAAQnR,IAEdA,MAELjI,EAAEmb,IAAI,8BAAgClT,KACjChC,KAAK,SAAUmV,GACZ,GAAI5T,GAAO4J,KAAKC,MAAM+J,GAClBvc,EAAOJ,EAAE4c,MAAM7T,GACdiB,IAAI,SAAU6S,GACX,MAAiB,KAAbA,EAAE3Y,OACK2Y,EAAErY,KADb,SAIHgM,OAAO,SAAUqM,GACd,MAAoB,mBAANA,KAEjBpb,OAEL7B,SAAQC,IAAIO,EAEZ,IAAIM,GAAa,GAAIP,OAAMC,KAAKC,YAC5BD,KAAMA,IAENiC,EAAQd,EAAEhC,GAASa,KAAK,sBACzBmB,EAAEhC,GAAS+c,mBACP5b,WAAYqI,EACZ+T,cAAe,OACf/X,OAAQ,WACJ,GAAIkN,GAAO/U,KAAKuE,OAChB7B,SAAQC,IAAI,iBAAkBoS,IAGlCzB,OAAQ,aACR+L,YAAa,iBACbC,UAAW,KACZpc,KAAK,oBAEXmB,GAAEhC,GACOwF,OAAO,WACJtD,EAAMF,EAAErE,MAAM+G,OACdrE,QAAQC,IAAI,YAAa4B,OAE7BwC,IAAIxC,KACP2E,GAAG,WAAY,SAAU1E,GACtB,GAAgB,MAAZA,EAAEqb,OAA6B,MAAZrb,EAAEqb,MAAe,CACpC,GAAI9K,GAAO1Q,EAAErE,MAAM+G,MAAQ,GAC3BrE,SAAQC,IAAI,yBAA0BoS,EACtC,IAAI+K,GAAWhd,EAAE4c,MAAM7T,GAClByH,OAAO,SAAUqM,GACd,MAAOA,GAAE3Y,SAAW+N,IAEvBjI,IAAI,SAAU6S,GACX,MAAOA,GAAErY,OAEZ/C,OACL7B,SAAQC,IAAImd,GAEZtc,EAAWN,KAAK4c,GAChB3a,EAAMqS,iBASlC/S,GAAGC,gBAAgBqb,sBACfnb,KAAM,SAAUvC,EAASwC,GACrB,GAAI4Y,GAAU5Y,IACVmb,EAAWvC,EAAQA,QACnBwC,EAAYxC,EAAQwC,WAAaxC,EAAQyC,iBAEzC3B,EAASla,EAAEhC,GACX8d,EAAe5B,EAAOrb,KAAK,kBAAoBqb,EAAO5U,MAC1D4U,GAAOnM,MAAM,SAAU5N,GACnBA,EAAEuF,iBACFiW,EAASC,GACJxD,KAAK,WACF8B,EAAOA,OAAO,YACgB,WAA1BA,EAAOiB,IAAI,GAAGhF,SAAkD,MAA1B+D,EAAOiB,IAAI,GAAGhF,QACpD+D,EAAO5U,KAAKwW,GAEZ5B,EAAOxX,IAAIoZ,KAInB5B,EAAOrb,KAAK,iBACZqb,EAAOA,OAAO,eAQ9B9Z,GAAGC,gBAAgB4O,QACf1O,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIP,GAAQM,IACRub,EAAkBtb,IAClBiQ,EAAOxQ,EAAMwQ,KACboC,EAAU5S,EAAM4S,SAAW,2EAC3B/B,EAAW/Q,EAAEhC,GACbge,EAAehc,EAAE,uCAA4C8S,EAAU,2FACvEmJ,EAAoBjc,EAAE,4EACtBkc,EAAQlc,EAAE,kMAOVmc,EAAcJ,EAAgBK,YAGlCF,GAAMjc,KAAK,0BAA0BkB,OAAO6a,GACxCG,GACAD,EAAMjc,KAAK,yBAAyBoc,MAAMJ,GAE9ClL,EAAS5P,OAAO+a,GAEhBA,EAAMI,OAAO,SAAUnc,GACnBA,EAAEuF,gBACF,IAAIuJ,GAAS+M,EAAatZ,MAAMmN,cAC5B2B,EAAM,GAAIxR,GAAEyR,QAChB,OAAKxC,IAGDkN,GAA4C,mBAAtBA,GAAYvV,OAAsE,kBAAtCuV,GAAYvV,MAAM2V,gBAC7EJ,EAAYvV,MAAM2V,gBAAgBtN,GAHlCuC,EAAI3K,WAUnB,IAAI2V,GAAW,WACX,GAAIC,GAAQ1L,EAAS9Q,KAAKyQ,GACtBzB,EAAS+M,EAAatZ,MAAMmN,aAChC4M,GAAMra,KAAK,WACP,GAAIsa,GAAM1c,EAAErE,MACRqG,EAAO0a,EAAI1a,OAAO6N,cAAc7T,MAC/BgG,KACDhC,EAAE,QAAS0c,GAAKta,KAAK,SAAU1F,EAAG2F,GAAKL,GAAQ,IAAMhC,EAAEqC,GAAGK,QAC1DV,EAAOA,EAAK6N,cAAc7T,QAE1BgG,EAAKpF,QAAQqS,GAAU,GACvByN,EAAIjD,OAEJiD,EAAIxb,UAMhByb,EAAYle,EAAEme,SAASJ,EAAU,IAEjCR,GAAanX,GAAG,QAAS8X,GAAWE,SAAS,0BACxC9O,MAAM,WACHiO,EAAatZ,IAAI,IACjB8Z,MAGJR,EAAatZ,OACb8Z,IAEJR,EAAalJ,YAKrB1S,GAAGC,gBAAgByc,cACfvc,KAAM,SAAUvC,EAASwC,EAAeC,EAAqB4Y,GACzD,GAAInZ,GAAQM,IACRuG,EAAS7G,EAAM6G,OACfH,EAAQ1G,EAAM0G,MACdrD,EAAOrD,EAAMqD,KACbkF,EAAMvI,EAAMuI,IACZsU,EAAc7c,EAAM6c,cAAe,EACnChM,EAAW/Q,EAAEhC,GACbyI,EAAUb,QAAQ,wBAClBoX,EAAchd,EAAE,eAChB0Z,EAAW1Z,EAAE,8EACbid,EAAY,WACRvD,EAASD,OACT1I,EAASmM,OAAO,OAAQ,MAE5BC,EAAU,WACNzD,EAASxY,OACT6P,EAASmM,OAAO,OAAQ,IAE5BE,EAAiB,SAAU/R,GACnB5C,IACA4C,EAAQ5M,EAAE4M,GAAO5C,IAAIA,IAEL,gBAATlF,IACP8V,EAAU9V,GAAM8H,GAEA,kBAAT9H,IACPA,EAAK8H,IAGbjN,EAAU,SAAUiB,EAAMQ,GACtBod,IACAxW,EAAQ4W,WACJtW,OAAQA,EACR1H,KAAMA,EACNQ,KAAMA,EACNyd,cAAc,GACf1W,GACGwR,KAAK,SAAUmF,GACZH,EAAeG,EAAGC,gBAClBL,MAIjBpM,GAASsL,MAAMW,GAAaX,MAAM3C,GAC7BwD,OAAO,OAAQ,IAEpB,IAAI1L,GAAM,GAAIxR,GAAEyR,QAwBhB,OAvBAhL,GAAQ4W,WACJtW,OAAQA,EACR1H,KAAM,EACNQ,KAAM,GACNyd,cAAc,GACf1W,GACFwR,KAAK,SAAUmF,GAEZ,GAAIxf,IACAC,QAASgf,EACT/e,MAAOsf,EAAG/e,KACVJ,QAASA,EACTY,OAAQ+d,GAER9d,EAAQ,GAAIrB,SAAQC,MAAMC,YAAYC,EAC1CM,SAAQC,IAAIW,GACZS,WAAW,WACP0d,EAAeG,EAAGC,gBAClBhM,EAAIuB,SAAQ,GACZoK,KACD,OAGA3L,EAAI3K,YAQnBzG,GAAGC,gBAAgB+b,cACf7b,KAAM,SAAUvC,EAASwC,EAAeC,EAAqB4Y,GACzD,GAAInZ,GAAQM,IACRuG,EAAS7G,EAAM6G,OACfH,EAAQ1G,EAAM0G,MACd6W,EAAgBvd,EAAM0G,OAAS1G,EAAMwd,iBACrCna,EAAOrD,EAAMqD,KACbkF,EAAMvI,EAAMuI,IACZsU,EAAc7c,EAAM6c,cAAe,EACnCY,EAAezd,EAAMyd,aACrB5M,EAAW/Q,EAAEhC,GACbyI,EAAUb,QAAQ,wBAClBkR,EAASlR,QAAQ,mBACjBgY,EAAWhY,QAAQC,eAAe+X,UAClCZ,EAAchd,EAAE,eAChB0Z,EAAW1Z,EAAE,8EACbid,EAAY,WACRvD,EAASD,OACT1I,EAASmM,OAAO,OAAQ,MAE5BC,EAAU,WACNzD,EAASxY,OACT6P,EAASmM,OAAO,OAAQ,IAE5Bje,EAAQ,KACRme,EAAiB,SAAU/R,GAElB0R,GACDte,EAAE4M,GAAOjJ,KAAK,SAAUC,GACpBA,EAAEpD,OACEI,KAAMJ,EAAMI,OACZQ,KAAMZ,EAAMF,cAKpB0J,IACA4C,EAAQ5M,EAAE4M,GAAO5C,IAAIA,IAEL,gBAATlF,IACP8V,EAAU9V,GAAM8H,GAEA,kBAAT9H,IACPA,EAAK8H,IAGbwS,EAAc,SAAUxe,EAAMQ,GAC1Bod,IACAxW,EAAQiL,aACJ3K,OAAQA,EACR1H,KAAMA,EACNQ,KAAMA,GACP4d,GACGrF,KAAK,SAAUmF,GACZH,EAAeG,EAAGC,gBAClBL,OAGbvP,EAAS,SAAUM,EAAG7O,EAAMQ,GACxB4d,EAAgBvP,CAChB,IAAI4P,GAAO,GAAI9d,GAAEyR,QA4BjB,OA3BAwL,KACAxW,EAAQiL,aACJ3K,OAAQA,EACR1H,KAAMA,GAAQ,EACdQ,KAAMA,GAAQ,IACfqO,GACEkK,KAAK,SAAUmF,GACZ,GAAIte,EACAA,EAAMM,OAAOge,EAAG/e,UACb,CACH,GAAIuf,IACA/f,QAASgf,EACT/e,MAAOsf,EAAG/e,KACVJ,QAASyf,EACT7e,OAAQ+d,EAEZ9d,GAAQ,GAAIrB,SAAQC,MAAMC,YAAYigB,GAI1Cre,WAAW,WACP0d,EAAeG,EAAGC,gBAClBM,EAAK/K,QAAQwK,GACbJ,KACD,OAGJW,EAAKjX,WAEhB0V,EAAkB,SAAUva,GACxB,GAAIkM,GAAIkD,KAAKC,MAAMjR,GAAG4d,OAAO9d,EAAM0G,OAAS1G,EAAMwd,eAC9CO,GACIC,KAAQ,EACRre,KAAQ,GACR+G,SAERsH,GAAEtH,MAAQsH,EAAEtH,UACZsH,EAAEtH,MAAM6U,SAAWvN,EAAEtH,MAAM6U,aAE3BwC,EAAGrX,MAAM6U,SAAWvN,EAAEtH,MAAM6U,SAC5BwC,EAAGrX,MAAM6U,SAAS7U,OACduX,cACIC,cAAiB,OACjBxX,MAAS5E,IAGbkM,EAAEtH,MAAMyX,OACRJ,EAAGhP,OAASgP,EAAGhP,WACfgP,EAAGhP,OAAOoP,KAAOnQ,EAAEtH,MAAMyX,MAE7BJ,EAAGpc,KAAOqM,EAAErM,KACZ5C,EAAMU,UACNV,EAAQ,KACR2O,EAAOqQ,GA8Bf,OA3B+B,kBAApBrX,GAAMW,WACbX,EAAMW,UAAU,SAAS2G,GACrBN,EAAOM,EAAG,EAAG,MAKrBtH,EAAMgH,OAASA,EACfhH,EAAM2V,gBAAkBA,EAExBxL,EAASsL,MAAMW,GAAaX,MAAM3C,GAC7BwD,OAAO,OAAQ,KAEhBS,GACA3d,EAAEyF,UAAUZ,GAAG,QAAS8Y,EAAc,SAAUxd,GAE5C,MADAA,GAAEuF,iBACG1F,EAAErE,MAAMsN,QAAQ,QAAQ,GAAG4Q,oBAIhCjM,GAAOxN,GAAG4P,KAAKpJ,GAAQ,EAAG3H,EAAMF,gBAH5B+X,GAAOO,MAAMuG,EAASU,SAASC,qBAS3C3Q,EAAOxN,GAAG4P,KAAKyN,KAEX7P,OAAQA,EACR2O,gBAAiBA;ACxiC7Bnc,GAAGC,gBAAgBme,mBACfje,KAAM,SAAUvC,EAASygB,GACrB,GAAIzc,GAAO5B,GAAGO,OAAO8d,MAAmB,sBACpCC,EAAS1e,EAAEhC,GACX+J,GAAS,EACT4W,EAAW,SAAUxe,GACjBA,EAAEuF,iBACFvF,EAAE2T,iBACF,IAAIoG,GAASla,EAAErE,KAEXoM,IACAmS,EAAOvX,SAASuW,YAAY,QAC5BnR,GAAS,IAGTmS,EAAOvX,SAASQ,SAAS,QACzB4E,GAAS,EACT/H,EAAEyF,UAAUmZ,IAAI,QAAS,WACrB1E,EAAOvX,SAASuW,YAAY,QAC5BnR,GAAS,KAMzB2W,GAAO3Q,MAAM4Q,GAERD,EAAOpZ,SACgB,oBAApBtD,EAAKrE,aACLqE,EAAO,sBAEX0c,EAAOpZ,KAAKtD,EAAO,wCAK/B5B,GAAGC,gBAAgByS,SACfvS,KAAM,SAAUvC,EAASygB,GACrB,GAAII,GAAeze,GAAGO,OAAO8d,KACzBK,EAAYD,EAAaE,kBAAoB,MAC7C/c,EAAO6c,EAAa/L,SAAW+L,CACnC7e,GAAEhC,GAAS8U,SAAU1N,MAAOpD,EAAM8c,UAAWA,MAIrD1e,GAAGC,gBAAgB2e,kBACfze,KAAM,SAAUvC,EAASygB,GACrB,GAAIzc,GAAO5B,GAAGO,OAAO8d,KAAgBxiB,QAAQ,KAAM,QAAQA,QAAQ,KAAM,OACzE+D,GAAEhC,GAASmH,SAAUI,QAAS,QAAUvD,EAAO,SAAUsD,MAAM,MAGvElF,GAAGC,gBAAgB8E,SACf5E,KAAM,SAAUvC,EAASygB,GACrB,GAAIzc,GAAO5B,GAAGO,OAAO8d,IACrBze,GAAEhC,GAASmH,SAAUI,QAAS,QAAUvD,EAAO,SAAUsD,MAAM,MAGvElF,GAAGC,gBAAgB4e,kBACf1e,KAAM,SAAUvC,EAASygB,GACrB,GAAIzc,GAAO5B,GAAGO,OAAO8d,IACrBze,GAAEhC,GAAS8U,SAAU1N,MAAOpD,MAOpC5B,GAAGC,gBAAgB6e,iBACf3e,KAAM,SAAUvC,EAASwC,GACrB,GAAIN,GAAQM,IACR2e,EAAY1gB,EAAEgH,SAAS2Z,aAAanf,KAAK,SAAU0Q,GAE/C,MAAKA,IACAA,EAAE7C,KAEA6C,EAAE7C,KAAKlR,QAAQ,aAAe,IAHtB,IAKnBiC,GAAQ,MAAO,cAAe,cAAe,WAC7CsgB,KACAtgB,EAAOJ,EAAE4c,MAAM8D,EAAUE,OAAOpQ,OAAO,SAAUqQ,GAC7C,MAAO,OAAO9Q,KAAK8Q,EAAEC,gBACb,KAAK/Q,KAAK8Q,EAAEC,gBACZ,MAAM/Q,KAAK8Q,EAAEC,gBACb,MAAM/Q,KAAK8Q,EAAEC,gBACb,KAAK/Q,KAAK8Q,EAAEC,gBACZ,MAAM/Q,KAAK8Q,EAAEC,gBACtB9W,IAAI,SAAUkI,GACb,MAAOA,GAAE4O,aAAatjB,QAAQ,MAAO,MAEpCiE,SAGTF,EAAEhC,GAAS4F,WACPX,KAAM,YACN6L,MAAO,GACP8B,MAAO/R,IAEVgG,GAAG,mBAAoB,WACpB3E,EAAMF,EAAErE,MAAM+G,WAU1BtC,GAAGC,gBAAgBmf,cACfjf,KAAM,SAAUvC,EAASwC,EAAeC,GACpC,GAAIgf,GAAKrf,GAAGO,OAAOH,KAClBuG,EAAS3G,GAAGO,OAAO8e,EAAG1Y,QACtBE,EAAQ7G,GAAGO,OAAO8e,EAAGxY,OACrBL,EAAQxG,GAAGO,OAAO8e,EAAG7Y,OACrB8H,EAAM+Q,EAAG/Q,KAAO,IAChB9N,EAAcH,IACdkO,EAAMvT,OAAOgB,OAAO,wCAAyC2K,EAAQE,EAAOL,GAC5EgI,EAAc,GAAI7K,aACdC,eAAgBD,WAAWG,WAAW2K,IAAI1K,WAAW,QACrDE,eAAgBN,WAAWG,WAAWC,WACtCI,UACIoK,IAAKA,EACLK,IAAKN,EACLO,OAAQ,SAAU1L,GACd,MAAO9E,GAAE8E,GAAMkF,IAAI,SAAUpG,GACzB,OAASY,KAAMZ,QAOhCuM,GAAYpK,aACZxE,EAAEhC,GAAS4F,UAAU,MACjBX,KAAM,gBAAkBjD,EAAEhC,GAAS6E,KAAK,MACxC6B,WAAY,OACZC,OAAQiK,EAAYhK,cAEpBC,GAAG,mBAAoB,WACpBjE,EAAYV,MAAMF,EAAErE,MAAM+G,WAOzCtC,GAAGC,gBAAgBqf,QACfnf,KAAM,SAAUvC,EAASwC,GACVJ,GAAGO,OAAOH;CCzJ7B,WACImf,SAASnkB,UAAUokB,QAAU,WACzB,GAAIC,GAAKlkB,KAAMU,EAAOyjB,MAAMtkB,UAAUsB,MAAMijB,KAAKxjB,UACjD,OAAO,YAEH,IAAK,GADDiB,GAAM,EACDd,EAAI,EAAGA,EAAIL,EAAKR,QAAU2B,EAAMjB,UAAUV,OAAQa,IACvC4X,SAAZjY,EAAKK,KACLL,EAAKK,GAAKH,UAAUiB,KAG5B,OAAOqiB,GAAGG,MAAMrkB,KAAMU;CCVlC,SAAWnB,GACPA,EAAO0C,QAAU1C,EAAO0C,YACxB1C,EAAO0C,QAAQqiB,uBACXC,GAAI,KACJC,MAAQ,SAGZjlB,EAAO0C,QAAQwiB,cACXC,aAAe,6BAGpBnlB;ACDH,GAAIolB,UAAW,WACX,GAAI/f,GAAO,SAAUggB,IAErB,QACIhgB,KAAMA;CCdd,SAAWrF,EAAQ8E,GACf9E,EAAO0C,QAAU1C,EAAO0C,YACxBA,QAAQC,MAAQD,QAAQC,UACxBD,QAAQC,MAAM+b,KAAOhc,QAAQC,MAAM+b,SACnChc,QAAQC,MAAM+b,KAAKC,cAAgB,SAAUK,GACzC,GAAIA,EAAON,KACP,MAAOM,GAAON,KAAKC,eACvB,IAAID,GAAO5Z,EAAEka,GAAQ1X,KAAK,OAC1B,IAAIoX,EACD,MAAOnU,UAAS+a,eAAe5G,GAAMC,eAExC,MAAM,uCAIV3e,EAAOmD,QAAUnD,EAAOmD,YACxBnD,EAAOmD,QAAQoiB,IAAMvlB,EAAOmD,QAAQoiB,KAAO,cAG5CvlB,OAAQwlB;CCnBX,SAAWxlB,EAAQ8E,GACf9E,EAAOylB,KAAOzlB,EAAOylB,SACrBzlB,EAAOylB,KAAKC,WAAa,SAAUC,EAAaC,GAC5C,GAAItP,GAAM,GAAIxR,GAAEyR,SACZxN,EAAI6c,GAAS,GAKjB,OAHAphB,YAAW,WACP8R,EAAIuB,QAAQ8N,IACb5c,GACIuN,EAAI3K,YAIhB3L,OAAQwlB;ACZXtgB,GAAGC,gBAAgB8R,OACf5R,KAAM,SAAUvC,EAASwC,EAAeC,EAAqB4Y,EAAW0H,GAEpE,GAAI7gB,GAAQM,IAAiBI,EAAcH,IACvCugB,EAAiB5gB,GAAGO,OAAOT,EAC/B,IAAGtC,QAAQiO,IAAIoV,MAAO,CAClB,GAAI9O,GAAQ,GAAIvU,SAAQiO,IAAIoV,KACxB9O,GAAM6O,IACN7O,EAAM6O,GAAgBhjB,EAASqb,EAAWzY,EAAamgB;ACTvE","file":"__core.min.js","sourcesContent":["// String.js - liberated from MicrosoftAjax.js on 03/28/10 by Sky Sanders \r\n\r\n/*\r\n    Copyright (c) 2009, CodePlex Foundation\r\n    All rights reserved.\r\n\r\n    Redistribution and use in source and binary forms, with or without modification, are permitted \r\n    provided that the following conditions are met:\r\n\r\n    *   Redistributions of source code must retain the above copyright notice, this list of conditions \r\n        and the following disclaimer.\r\n\r\n    *   Redistributions in binary form must reproduce the above copyright notice, this list of conditions \r\n        and the following disclaimer in the documentation and/or other materials provided with the distribution.\r\n\r\n    *   Neither the name of CodePlex Foundation nor the names of its contributors may be used to endorse or \r\n        promote products derived from this software without specific prior written permission.\r\n\r\n    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED \r\n    WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR \r\n    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE \r\n    FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT \r\n    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS \r\n    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, \r\n    OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN \r\n    IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</textarea>\r\n*/\r\n\r\n(function (window) {\r\n\r\n    $type = String;\r\n    $type.__typeName = 'String';\r\n    $type.__class = true;\r\n\r\n    $prototype = $type.prototype;\r\n    $prototype.endsWith = function String$endsWith(suffix) {\r\n        /// <summary>Determines whether the end of this instance matches the specified string.</summary>\r\n        /// <param name=\"suffix\" type=\"String\">A string to compare to.</param>\r\n        /// <returns type=\"Boolean\">true if suffix matches the end of this instance; otherwise, false.</returns>\r\n        return (this.substr(this.length - suffix.length) === suffix);\r\n    };\r\n\r\n    $prototype.startsWith = function String$startsWith(prefix) {\r\n        /// <summary >Determines whether the beginning of this instance matches the specified string.</summary>\r\n        /// <param name=\"prefix\" type=\"String\">The String to compare.</param>\r\n        /// <returns type=\"Boolean\">true if prefix matches the beginning of this string; otherwise, false.</returns>\r\n        return (this.substr(0, prefix.length) === prefix);\r\n    };\r\n\r\n    $prototype.trim = function String$trim() {\r\n        /// <summary >Removes all leading and trailing white-space characters from the current String object.</summary>\r\n        /// <returns type=\"String\">The string that remains after all white-space characters are removed from the start and end of the current String object.</returns>\r\n        return this.replace(/^\\s+|\\s+$/g, '');\r\n    };\r\n\r\n    $prototype.trimEnd = function String$trimEnd() {\r\n        /// <summary >Removes all trailing white spaces from the current String object.</summary>\r\n        /// <returns type=\"String\">The string that remains after all white-space characters are removed from the end of the current String object.</returns>\r\n        return this.replace(/\\s+$/, '');\r\n    };\r\n\r\n    $prototype.trimStart = function String$trimStart() {\r\n        /// <summary >Removes all leading white spaces from the current String object.</summary>\r\n        /// <returns type=\"String\">The string that remains after all white-space characters are removed from the start of the current String object.</returns>\r\n        return this.replace(/^\\s+/, '');\r\n    }\r\n\r\n    $type.format = function String$format(format, args) {\r\n        /// <summary>Replaces the format items in a specified String with the text equivalents of the values of   corresponding object instances. The invariant culture will be used to format dates and numbers.</summary>\r\n        /// <param name=\"format\" type=\"String\">A format string.</param>\r\n        /// <param name=\"args\" parameterArray=\"true\" mayBeNull=\"true\">The objects to format.</param>\r\n        /// <returns type=\"String\">A copy of format in which the format items have been replaced by the   string equivalent of the corresponding instances of object arguments.</returns>\r\n        return String._toFormattedString(false, arguments);\r\n    };\r\n\r\n    $type._toFormattedString = function String$_toFormattedString(useLocale, args) {\r\n        var result = '';\r\n        var format = args[0];\r\n\r\n        for (var i = 0;;) {\r\n            // Find the next opening or closing brace\r\n            var open = format.indexOf('{', i);\r\n            var close = format.indexOf('}', i);\r\n            if ((open < 0) && (close < 0)) {\r\n                // Not found: copy the end of the string and break\r\n                result += format.slice(i);\r\n                break;\r\n            }\r\n            if ((close > 0) && ((close < open) || (open < 0))) {\r\n\r\n                if (format.charAt(close + 1) !== '}') {\r\n                    throw new Error('format stringFormatBraceMismatch');\r\n                }\r\n\r\n                result += format.slice(i, close + 1);\r\n                i = close + 2;\r\n                continue;\r\n            }\r\n\r\n            // Copy the string before the brace\r\n            result += format.slice(i, open);\r\n            i = open + 1;\r\n\r\n            // Check for double braces (which display as one and are not arguments)\r\n            if (format.charAt(i) === '{') {\r\n                result += '{';\r\n                i++;\r\n                continue;\r\n            }\r\n\r\n            if (close < 0) throw new Error('format stringFormatBraceMismatch');\r\n\r\n\r\n            // Find the closing brace\r\n\r\n            // Get the string between the braces, and split it around the ':' (if any)\r\n            var brace = format.substring(i, close);\r\n            var colonIndex = brace.indexOf(':');\r\n            var argNumber = parseInt((colonIndex < 0) ? brace : brace.substring(0, colonIndex), 10) + 1;\r\n\r\n            if (isNaN(argNumber)) throw new Error('format stringFormatInvalid');\r\n\r\n            var argFormat = (colonIndex < 0) ? '' : brace.substring(colonIndex + 1);\r\n\r\n            var arg = args[argNumber];\r\n            if (typeof(arg) === \"undefined\" || arg === null) {\r\n                arg = '';\r\n            }\r\n\r\n            // If it has a toFormattedString method, call it.  Otherwise, call toString()\r\n            if (arg.toFormattedString) {\r\n                result += arg.toFormattedString(argFormat);\r\n            } else if (useLocale && arg.localeFormat) {\r\n                result += arg.localeFormat(argFormat);\r\n            } else if (arg.format) {\r\n                result += arg.format(argFormat);\r\n            } else\r\n                result += arg.toString();\r\n\r\n            i = close + 1;\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n})(window);","/// <reference path=\"toastr.js\" />\r\n/// <reference path=\"_ko.kendo.js\" />\r\n/// <reference path=\"../kendo/js/kendo.pager.js\" />\r\n/// <reference path=\"../kendo/js/kendo.all.js\" />\r\n\r\n\r\n\r\n\r\nvar bespoke = bespoke || {};\r\nbespoke.utils = {};\r\n\r\nbespoke.utils.ServerPager = function (options) {\r\n    options = options || {};\r\n    var element = options.element,\r\n        count = options.count || 0,\r\n        sizes = options.sizes || [10, 20, 50],\r\n        defaultSize = options.defaultSize || 20,\r\n        changed = options.changed || function () {\r\n            console.log(\"no change event\");\r\n        },\r\n        self2 = this,\r\n        rows = _.range(count),\r\n        pagerDataSource = new kendo.data.DataSource({\r\n            data: rows,\r\n            pageSize: defaultSize\r\n        });\r\n    if (options.hidden) {\r\n        return self2;\r\n    }\r\n\r\n    var pager = element.kendoPager({\r\n        dataSource: pagerDataSource,\r\n        pageSizes: sizes\r\n    }).data(\"kendoPager\");\r\n    pager.page(1);\r\n    pager.bind(\"change\", function () {\r\n        if (changed) {\r\n            changed(pager.page(), pager.pageSize());\r\n        }\r\n    });\r\n\r\n    self2.update = function (count2) {\r\n        rows = [];\r\n        for (var j = 0; j < count2 ; j++) {\r\n            rows[j] = j;\r\n        }\r\n        setTimeout(function () {\r\n            pagerDataSource.data(rows);\r\n        }, 500);\r\n    };\r\n    self2.destroy = function () {\r\n        pager.destroy();\r\n        element.empty();\r\n    };\r\n\r\n    self2.pageSize = function (size) {\r\n        if (size) {\r\n            pager.pageSize(size);\r\n        }\r\n        return pager.pageSize();\r\n    };\r\n    self2.page = function (pg) {\r\n        if (pg) {\r\n            pager.page(pg);\r\n        }\r\n        return pager.page();\r\n    };\r\n\r\n    var dropdownlist = $(element).find(\"select\").data(\"kendoDropDownList\");\r\n    dropdownlist.bind(\"change\", function () {\r\n        try {\r\n            changed(1, parseInt(this.value()));\r\n        } catch (e) {\r\n\r\n        }\r\n    });\r\n\r\n\r\n\r\n    return self2;\r\n\r\n};","/// <reference path=\"jstree.min.js\" />\r\n/// <reference path=\"typeahead.bundle.js\" />\r\n/// <reference path=\"knockout-3.4.0.debug.js\" />\r\n/// <reference path=\"knockout.mapping-latest.debug.js\" />\r\n/// <reference path=\"../App/services/datacontext.js\" />\r\n/// <reference path=\"../SphApp/objectbuilders.js\" />\r\n/// <reference path=\"../SphApp/schemas/trigger.workflow.g.js\" />\r\n/// <reference path=\"../SphApp/partial/WorkflowDefinition.js\" />\r\n/// <reference path=\"../App/durandal/amd/text.js\" />\r\n/// <reference path=\"jquery-2.2.0.intellisense.js\" />\r\n/// <reference path=\"underscore.js\" />\r\n/// <reference path=\"require.js\" />\r\n/// <reference path=\"complete.ly.1.0.1.js\" />\r\n\r\n\r\nko.bindingHandlers.workflowFormPathIntellisense = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var value = valueAccessor(),\r\n            schema = ko.unwrap(value.schema),\r\n            allBindings = allBindingsAccessor(),\r\n            setup = function () {\r\n                var input = $(element),\r\n                         div = $(\"<div></div>\").css({\r\n                             'height': \"28px\"\r\n                         });\r\n                input.hide().before(div);\r\n\r\n                var c = completely(div[0], {\r\n                    fontSize: \"12px\",\r\n                    color: \"#555;\",\r\n                    fontFamily: \"\\\"Open Sans\\\", Arial, Helvetica, sans-serif\"\r\n                });\r\n\r\n                c.setText(ko.unwrap(allBindings.value));\r\n                for (var ix in schema) {\r\n                    if (schema.hasOwnProperty(ix)) {\r\n                        if (ix === \"$type\") continue;\r\n                        if (ix === \"addChildItem\") continue;\r\n                        if (ix === \"removeChildItem\") continue;\r\n                        if (ix === \"Empty\") continue;\r\n                        if (ix === \"WebId\") continue;\r\n                        c.options.push(\"\" + ix);\r\n                    }\r\n                }\r\n                c.options.sort();\r\n\r\n                var currentObject = schema;\r\n                c.onChange = function (text) {\r\n                    if (text.lastIndexOf(\".\") === text.length - 1) {\r\n                        c.options = [];\r\n                        var props = text.split(\".\");\r\n\r\n                        currentObject = schema;\r\n                        _(props).each(function (v) {\r\n                            if (v === \"\") { return; }\r\n                            currentObject = currentObject[v];\r\n                        });\r\n                        console.log(\"currentObject\", currentObject);\r\n                        for (var i in currentObject) {\r\n                            if (currentObject.hasOwnProperty(i)) {\r\n                                if (i === \"$type\") continue;\r\n                                if (i === \"addChildItem\") continue;\r\n                                if (i === \"removeChildItem\") continue;\r\n                                if (i === \"Empty\") continue;\r\n                                if (i === \"WebId\") continue;\r\n                                c.options.push(\"\" + i);\r\n                            }\r\n                        }\r\n                        c.options.sort();\r\n                        c.startFrom = text.lastIndexOf(\".\") + 1;\r\n                    }\r\n                    c.repaint();\r\n                };\r\n\r\n                c.repaint();\r\n                $(c.input)\r\n                    .attr(\"autocomplete\", \"off\")\r\n                    .blur(function () {\r\n                        allBindings.value($(this).val());\r\n                    }).parent().find(\"input\")\r\n                    .css({ \"padding\": \"6px 12px\", \"height\": \"28px\" });\r\n\r\n                if ($(element).prop(\"required\")) {\r\n                    $(c.input).prop(\"required\", true);\r\n                }\r\n\r\n\r\n            };\r\n\r\n\r\n        setup();\r\n    }\r\n};\r\n\r\n\r\nko.bindingHandlers.activityClass = {\r\n    init: function (element, valueAccessor) {\r\n\r\n        var div = $(element),\r\n            act = ko.unwrap(valueAccessor()),\r\n        fullName = typeof act.$type === \"function\" ? act.$type() : act.$type,\r\n        name = /Bespoke\\.Sph\\.Domain\\.(.*?),/.exec(fullName)[1];\r\n\r\n        div.addClass(\"activity32\").addClass(\"activity32-\" + name);\r\n    }\r\n};\r\n\r\nko.bindingHandlers.checkedItems = {\r\n    init: function (element, valueAccessor) {\r\n        var item = ko.dataFor(element),\r\n            list = valueAccessor();\r\n\r\n        $(element).change(function () {\r\n            var checked = $(this).is(':checked');\r\n            if (checked) {\r\n                list.push(item);\r\n            } else {\r\n                list.remove(item);\r\n            }\r\n        });\r\n\r\n    }\r\n};\r\n\r\nko.bindingHandlers.typeahead = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var id = ko.unwrap(valueAccessor()),\r\n            allBindings = allBindingsAccessor();\r\n\r\n        if (typeof id === \"undefined\") {\r\n            return;\r\n        }\r\n        var members = new Bloodhound({\r\n            datumTokenizer: function (d) { return Bloodhound.tokenizers.whitespace(d.Path); },\r\n            queryTokenizer: Bloodhound.tokenizers.nonword,\r\n            prefetch: \"/api/workflow-definitions/\" + id + \"/variable-path\"\r\n\r\n        });\r\n        members.initialize();\r\n        $(element).typeahead({ highlight: true }, {\r\n            name: \"schema_paths\" + id,\r\n            displayKey: \"Path\",\r\n            source: members.ttAdapter()\r\n        })\r\n            .on(\"typeahead:closed\", function () {\r\n                allBindings.value($(this).val());\r\n            });\r\n    }\r\n};\r\nko.bindingHandlers.typeaheadExceptions = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n\r\n\r\n        var allBindings = allBindingsAccessor();\r\n\r\n        var exceptions = new Bloodhound({\r\n            datumTokenizer: Bloodhound.tokenizers.whitespace,\r\n            queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n            prefetch: \"/api/assemblies/types/exceptions\"\r\n        });\r\n        \r\n        $(element).typeahead(null, {\r\n            name: \"exceptions\",\r\n            source: exceptions\r\n        }).on(\"typeahead:closed\", function () {\r\n            allBindings.value($(this).val());\r\n        });\r\n\r\n    }\r\n};\r\n\r\n\r\nko.bindingHandlers.activityPopover = {\r\n    init: function (element, valueAccessor) {\r\n\r\n        var div = $(element),\r\n            act = ko.unwrap(valueAccessor()),\r\n            fullName = typeof act.$type === \"function\" ? act.$type() : act.$type,\r\n            name = /Bespoke\\.Sph\\.Domain\\.(.*?),/.exec(fullName)[1],\r\n            wd = ko.dataFor(div.parent()[0]).wd(),\r\n            pop = div.popover({\r\n                title: name + ' : ' + act.Name(),\r\n                html: true,\r\n                content: function () {\r\n                    $(\"a.edit-activity\").popover(\"hide\");\r\n                    div.find(\"a.edit-activity\").addClass(act.WebId());\r\n                    div.find(\"a.delete-activity\").addClass(act.WebId());\r\n                    div.find(\"a.start-activity\").addClass(act.WebId());\r\n                    return div.find(\"div.context-menu\").html();\r\n                }\r\n            });\r\n\r\n        // just display it for 5 seconds\r\n        pop.on(\"shown.bs.popover\", function () {\r\n            setTimeout(function () { pop.popover('hide'); }, 5000);\r\n        });\r\n\r\n        $(document).on(\"click\", \"a.\" + act.WebId(), function (e) {\r\n            e.preventDefault();\r\n            var app = require(objectbuilders.app),\r\n                link = $(this);\r\n            if (link.hasClass(\"delete-activity\")) {\r\n                app.showMessage(\"Are you sure you want to remove this Activity\", \"Remove activity\", [\"Yes\", \"No\"])\r\n                    .done(function (result) {\r\n                        if (result === \"Yes\") {\r\n                            wd.removeActivity(act)();\r\n                        }\r\n                    });\r\n            }\r\n            if (link.hasClass(\"edit-activity\")) {\r\n                wd.editActivity(act)();\r\n            }\r\n            if (link.hasClass(\"start-activity\")) {\r\n                wd.setStartActivity(act)();\r\n            }\r\n        });\r\n    }\r\n};\r\n\r\nko.bindingHandlers.comboBoxLookupOptions = {\r\n    init: function (element, valueAccessor) {\r\n        var $select = $(element),\r\n            lookup = ko.unwrap(valueAccessor()),\r\n            value = lookup.value,\r\n            caption = lookup.caption,\r\n            context = require(\"services/datacontext\"),\r\n            displayPath = ko.unwrap(lookup.displayPath),\r\n            valuePath = ko.unwrap(lookup.valuePath);\r\n\r\n        var setup = function (query) {\r\n\r\n            //getListAsync\r\n            var promise = ko.unwrap(lookup.valuePath) === ko.unwrap(lookup.displayPath) ?\r\n                context.getListAsync(ko.unwrap(lookup.entity), query, ko.unwrap(lookup.valuePath)) :\r\n                context.getTuplesAsync({\r\n                    entity: ko.unwrap(lookup.entity),\r\n                    query: query,\r\n                    field: valuePath,\r\n                    field2: displayPath\r\n                });\r\n\r\n\r\n            promise.done(function (list) {\r\n                element.options.length = 0;\r\n                if (caption) {\r\n                    element.add(new Option(caption, \"\"));\r\n                }\r\n                _(list).each(function (v) {\r\n                    if (typeof v === \"string\") {\r\n                        element.add(new Option(v, v));\r\n                        return;\r\n                    }\r\n                    if (typeof v.Item1 === \"string\" && typeof v.Item2 === \"string\") {\r\n                        element.add(new Option(v.Item2, v.Item1));\r\n                        return;\r\n                    }\r\n                    if (typeof v[valuePath] === \"string\" && typeof v[displayPath] === \"string\") {\r\n                        element.add(new Option(v[valuePath], v[displayPath]));\r\n                        return;\r\n                    }\r\n                });\r\n\r\n                $select.val(ko.unwrap(value))\r\n                    .on(\"change\", function () {\r\n                        value($select.val());\r\n                    });\r\n\r\n            });\r\n        };\r\n        setup(ko.unwrap(lookup.query));\r\n\r\n        if (typeof lookup.query === \"function\") {\r\n            if (typeof lookup.query.subscribe === \"function\") {\r\n                lookup.query.subscribe(function (v) {\r\n                    setup(ko.unwrap(v));\r\n                });\r\n            }\r\n        }\r\n    },\r\n    update: function (element, valueAccessor) {\r\n        var lookup = ko.unwrap(valueAccessor()),\r\n            value = lookup.value;\r\n        $(element).val(ko.unwrap(value));\r\n    }\r\n};\r\n\r\n","/// <reference path=\"~/Scripts/underscore.js\" />\r\n/// <reference path=\"~/Scripts/jstree.min.js\" />\r\n/// <reference path=\"require.js\" />\r\n/// <reference path=\"jquery-2.2.0.intellisense.js\" />\r\n/// <reference path=\"complete.ly.1.0.1.js\" />\r\n/// <reference path=\"../SphApp/objectbuilders.js\" />\r\n/// <reference path=\"../SphApp/schemas/form.designer.g.js\" />\r\n/// <reference path=\"knockout-3.4.0.debug.js\" />\r\n\r\nko.bindingHandlers.tree = {\r\n    init: function (element, valueAccessor) {\r\n        var system = require(objectbuilders.system),\r\n            value = valueAccessor(),\r\n            entity = ko.unwrap(value.entity),\r\n            searchbox = ko.unwrap(value.searchbox),\r\n            member = value.selected,\r\n            jsTreeData = {\r\n                text: entity.Name(),\r\n                state: {\r\n                    opened: true,\r\n                    selected: true\r\n                }\r\n            },\r\n            getNodeMemberType = function (v) {\r\n                var type = ko.unwrap(v.TypeName) || ko.unwrap(v.$type);\r\n                if (type.indexOf(\",\") < 0) {\r\n                    type = ko.unwrap(v.$type);\r\n                }\r\n                return type;\r\n            },\r\n            memberNameSubscription = null,\r\n            memberTypeNameSubscription = null,\r\n            recurseChildMember = function (node) {\r\n                node.children = _(node.data.MemberCollection()).map(function (v) {\r\n\r\n                    var type = getNodeMemberType(v);\r\n                    return {\r\n                        text: v.Name(),\r\n                        state: \"open\",\r\n                        type: type,\r\n                        data: v\r\n                    };\r\n                });\r\n                _(node.children).each(recurseChildMember);\r\n            },\r\n            setNodePropertyForChildOfValueObject = function (node, tag) {\r\n                if (!ko.isObservable(tag.childOfValueMember)) {\r\n                    tag.childOfValueMember = ko.observable(true);\r\n                }\r\n                var ref = $(element).jstree(true),\r\n                       parents = _(node.parents).map(function (n) { return ref.get_node(n); }),\r\n                       valueMember = _(parents).find(function (n) { return n.type === \"Bespoke.Sph.Domain.ValueObjectMember, domain.sph\"; });\r\n                tag.childOfValueMember(valueMember || false);\r\n            },\r\n            loadJsTree = function () {\r\n                jsTreeData.children = _(entity.MemberCollection()).map(function (v) {\r\n\r\n                    return {\r\n                        text: ko.unwrap(v.Name),\r\n                        state: \"open\",\r\n                        type: getNodeMemberType(v),\r\n                        data: v\r\n                    };\r\n                });\r\n                _(jsTreeData.children).each(recurseChildMember);\r\n                $(element)\r\n                    .on(\"select_node.jstree\", function (node, selected) {\r\n                        if (typeof member !== \"function\") {\r\n                            return;\r\n                        }\r\n                        if (memberNameSubscription) {\r\n                            memberNameSubscription.dispose();\r\n                            memberNameSubscription = null;\r\n                        }\r\n\r\n                        if (memberTypeNameSubscription) {\r\n                            memberTypeNameSubscription.dispose();\r\n                            memberTypeNameSubscription = null;\r\n                        }\r\n\r\n                        var tag = selected.node.data;\r\n                        if (tag) {\r\n                            if (selected.node.type === \"default\") {\r\n                                return;\r\n                            }\r\n\r\n                            if (!ko.isObservable(tag.childOfValueMember)) {\r\n                                tag.childOfValueMember = ko.observable(true);\r\n                            }\r\n                            if (!ko.isObservable(tag.allowFilter)) {\r\n                                tag.allowFilter = ko.observable(true);\r\n                            }\r\n\r\n                            var ref = $(element).jstree(true),\r\n                                   parents = _(selected.node.parents).map(function (n) { return ref.get_node(n); }),\r\n                                   valueMember = _(parents).find(function (n) { return n.type === \"Bespoke.Sph.Domain.ValueObjectMember, domain.sph\"; });\r\n                            tag.childOfValueMember(valueMember || false);\r\n                            // we also need to disable for collection member\r\n                            if (!valueMember) {\r\n\r\n                                var cm = _(parents).find(function (n) {\r\n                                    var mb1 = n.data;\r\n                                    return n.type === \"Bespoke.Sph.Domain.ComplexMember, domain.sph\" && ko.unwrap(mb1.AllowMultiple);\r\n                                });\r\n                                if (cm) {\r\n                                    tag.allowFilter(false);\r\n                                }\r\n                            }\r\n\r\n\r\n                            if (!tag.childOfValueMember()) {\r\n                                ref.edit(selected.node);\r\n                            }\r\n                            member(tag);\r\n                            // subscribe to Name change\r\n                            memberNameSubscription = member().Name.subscribe(function (name) {\r\n                                $(element).jstree(true)\r\n                                    .rename_node(selected.node, name);\r\n                                console.log(\"rename \" + name);\r\n                            });\r\n                            // type\r\n                            if (typeof member().TypeName === \"function\") {\r\n                                memberTypeNameSubscription = member().TypeName.subscribe(function (name) {\r\n                                    $(element).jstree(true)\r\n                                        .set_type(selected.node, name);\r\n                                });\r\n\r\n                            }\r\n                        }\r\n                    })\r\n                    .on(\"create_node.jstree\", function (event, node) {\r\n                        console.log(node, \"node\");\r\n                    })\r\n                    .on(\"move_node.jstree\", function (e, data) {\r\n                        var ref = $(element).jstree(true),\r\n                        \tmbr = data.node.data,\r\n                            oldParent = ref.get_node(data.old_parent),\r\n                            oldCollections = oldParent.data.MemberCollection || entity.MemberCollection,\r\n                            parent = ref.get_node(data.parent),\r\n                            collection = parent.data.MemberCollection || entity.MemberCollection;\r\n                        oldCollections.remove(function (v) {\r\n                            return ko.unwrap(mbr.WebId) === ko.unwrap(v.WebId);\r\n                        });\r\n                        collection.splice(data.position, 0, mbr);\r\n                    })\r\n                    .on(\"rename_node.jstree\", function (ev, node) {\r\n                        var mb = node.node.data;\r\n                        mb.Name(node.text);\r\n                    })\r\n                    .jstree({\r\n                        \"core\": {\r\n                            \"animation\": 0,\r\n                            \"check_callback\": function (operation, node, nodeParent, nodePosition, more) {\r\n                                if (operation === \"move_node\") {\r\n                                    var mbr = node.data,\r\n                                        ref = $(element).jstree(true),\r\n                                        target = ref.get_node(nodeParent);\r\n                                    if (!mbr) {\r\n                                        return false;\r\n                                    }\r\n                                    if (!target) {\r\n                                        return false;\r\n                                    }\r\n                                    if (!ko.isObservable(mbr.childOfValueMember)) {\r\n                                        setNodePropertyForChildOfValueObject(node, mbr);\r\n                                    }\r\n                                    if (ko.unwrap(mbr.childOfValueMember)) {\r\n                                        return false;\r\n                                    }\r\n                                    if (target.type === \"Bespoke.Sph.Domain.ValueObjectMember, domain.sph\") {\r\n                                        return false;\r\n                                    }\r\n\r\n                                    return true;\r\n                                }\r\n                                return true;\r\n                            },\r\n                            \"themes\": { \"stripes\": true },\r\n                            'data': jsTreeData\r\n                        },\r\n                        \"dnd\": {\r\n                            \"is_draggable\": function (node) {\r\n                                var mbr = node.data;\r\n                                if (mbr && ko.unwrap(mbr.childOfValueMember)) {\r\n                                    return false;\r\n                                }\r\n                                return true;\r\n                            }\r\n                        },\r\n                        \"contextmenu\": {\r\n                            \"items\": function ($node) {\r\n\r\n                                var ref = $(element).jstree(true),\r\n                                    parents = _($node.parents).map(function (n) { return ref.get_node(n); }),\r\n                                    valueMember = _(parents).find(function (n) { return n.type === \"Bespoke.Sph.Domain.ValueObjectMember, domain.sph\"; }),\r\n                                        sel = ref.get_selected();\r\n                                if (valueMember) {\r\n                                    return [];\r\n                                }\r\n\r\n                                var simpleMenu = {\r\n                                    label: \"Add Simple Child\",\r\n                                    action: function () {\r\n                                        var child = new bespoke.sph.domain.SimpleMember({ WebId: system.guid(), TypeName: \"System.String, mscorlib\", Name: \"Member_Name\" }),\r\n                                            parent = $(element).jstree(\"get_selected\", true),\r\n                                            mb = parent[0].data,\r\n                                            newNode = { state: \"open\", type: \"System.String, mscorlib\", text: \"Member_Name\", data: child };\r\n\r\n                                        if (!sel.length) {\r\n                                            return false;\r\n                                        }\r\n                                        sel = sel[0];\r\n                                        sel = ref.create_node(sel, newNode);\r\n                                        if (sel) {\r\n                                            ref.edit(sel);\r\n                                            if (mb && mb.MemberCollection) {\r\n                                                mb.MemberCollection.push(child);\r\n                                            } else {\r\n                                                entity.MemberCollection.push(child);\r\n                                            }\r\n                                            return true;\r\n                                        }\r\n                                        return false;\r\n\r\n\r\n                                    }\r\n                                },\r\n                                    valueObjectMenu = {\r\n                                        label: \"Add Value Object Child\",\r\n                                        action: function () {\r\n                                            var typeName = \"Bespoke.Sph.Domain.ValueObjectDefinition, domain.sph\",\r\n                                                child = new bespoke.sph.domain.ValueObjectMember({ WebId: system.guid(), TypeName: typeName, Name: \"Member_Name\" }),\r\n                                                parent = $(element).jstree(\"get_selected\", true),\r\n                                                mb = parent[0].data,\r\n                                                newNode = { state: \"open\", type: \"Bespoke.Sph.Domain.ValueObjectMember, domain.sph\", text: \"Member_Name\", data: child };\r\n\r\n                                            if (!sel.length) {\r\n                                                return false;\r\n                                            }\r\n                                            sel = sel[0];\r\n                                            sel = ref.create_node(sel, newNode);\r\n                                            if (sel) {\r\n                                                ref.edit(sel);\r\n                                                if (mb && mb.MemberCollection) {\r\n                                                    mb.MemberCollection.push(child);\r\n                                                } else {\r\n                                                    entity.MemberCollection.push(child);\r\n                                                }\r\n                                                child.TypeName.subscribe(function () {\r\n                                                    // TODO : clear the node children and populate the node according to the value object definition members\r\n\r\n                                                });\r\n                                                return true;\r\n                                            }\r\n                                            return false;\r\n\r\n\r\n                                        }\r\n                                    },\r\n                                    complexChildMenu = {\r\n                                        label: \"Add Complex Child\",\r\n                                        action: function () {\r\n                                            var child = new bespoke.sph.domain.ComplexMember({ WebId: system.guid(), Name: \"Member_Name\" }),\r\n                                                parent = $(element).jstree(\"get_selected\", true),\r\n                                                mb = parent[0].data,\r\n                                                newNode = { state: \"open\", type: \"Bespoke.Sph.Domain.ComplexMember, domain.sph\", text: \"Member_Name\", data: child };\r\n\r\n                                            if (!sel.length) {\r\n                                                return false;\r\n                                            }\r\n                                            sel = sel[0];\r\n                                            sel = ref.create_node(sel, newNode);\r\n                                            if (sel) {\r\n                                                ref.edit(sel);\r\n                                                if (mb && mb.MemberCollection) {\r\n                                                    mb.MemberCollection.push(child);\r\n                                                } else {\r\n                                                    entity.MemberCollection.push(child);\r\n                                                }\r\n                                                return true;\r\n                                            }\r\n                                            return false;\r\n\r\n\r\n                                        }\r\n                                    },\r\n                                    removeMenu = {\r\n                                        label: \"Remove\",\r\n                                        action: function () {\r\n                                            // now delete the member\r\n                                            var n = ref.get_selected(true)[0],\r\n                                                p = ref.get_node($(\"#\" + n.parent)),\r\n                                                parentMember = p.data;\r\n                                            if (parentMember && typeof parentMember.MemberCollection === \"function\") {\r\n                                                var child = _(parentMember.MemberCollection()).find(function (v) {\r\n                                                    return v.WebId() === n.data.WebId();\r\n                                                });\r\n                                                parentMember.MemberCollection.remove(child);\r\n                                            } else {\r\n                                                var child2 = _(entity.MemberCollection()).find(function (v) {\r\n                                                    return v.WebId() === n.data.WebId();\r\n                                                });\r\n                                                entity.MemberCollection.remove(child2);\r\n                                            }\r\n\r\n                                            if (!sel.length) {\r\n                                                return false;\r\n                                            }\r\n                                            ref.delete_node(sel);\r\n\r\n                                            return true;\r\n\r\n                                        }\r\n                                    };\r\n\r\n                                var items = [];\r\n\r\n                                if ($node.type === \"default\" || $node.type === \"Bespoke.Sph.Domain.ComplexMember, domain.sph\") {\r\n                                    items.push(simpleMenu);\r\n                                    items.push(valueObjectMenu);\r\n                                    items.push(complexChildMenu);\r\n                                }\r\n\r\n                                console.log($node);\r\n                                if ($node.type !== \"default\") {\r\n                                    items.push(removeMenu);\r\n                                }\r\n                                return items;\r\n                            }\r\n                        },\r\n                        \"types\": {\r\n\r\n                            \"default\": {\r\n                                \"icon\": \"fa fa-clipboard\"\r\n                            },\r\n                            \"System.String, mscorlib\": {\r\n                                \"icon\": \"glyphicon glyphicon-bold\",\r\n                                \"valid_children\": []\r\n                            },\r\n                            \"System.DateTime, mscorlib\": {\r\n                                \"icon\": \"glyphicon glyphicon-calendar\",\r\n                                \"valid_children\": []\r\n                            },\r\n                            \"System.Int32, mscorlib\": {\r\n                                \"icon\": \"fa fa-sort-numeric-asc\",\r\n                                \"valid_children\": []\r\n                            },\r\n                            \"System.Decimal, mscorlib\": {\r\n                                \"icon\": \"glyphicon glyphicon-usd\",\r\n                                \"valid_children\": []\r\n                            },\r\n                            \"System.Boolean, mscorlib\": {\r\n                                \"icon\": \"glyphicon glyphicon-ok\",\r\n                                \"valid_children\": []\r\n                            },\r\n                            \"Bespoke.Sph.Domain.ValueObjectMember, domain.sph\": {\r\n                                \"icon\": \"fa fa-object-ungroup\"\r\n                            },\r\n                            \"Bespoke.Sph.Domain.ComplexMember, domain.sph\": {\r\n                                \"icon\": \"fa fa-object-group\"\r\n                            }\r\n                        },\r\n                        \"plugins\": [\"contextmenu\", \"dnd\", \"types\", \"search\"]\r\n                    });\r\n            };\r\n        loadJsTree();\r\n\r\n        var to = false;\r\n        $(searchbox).keyup(function () {\r\n            if (to) {\r\n                clearTimeout(to);\r\n            }\r\n            to = setTimeout(function () {\r\n                var v = $(searchbox).val();\r\n                $(element).jstree(true).search(v);\r\n            }, 250);\r\n        });\r\n\r\n    }\r\n};\r\n\r\nko.bindingHandlers.help = {\r\n    init: function (element, valueAccessor) {\r\n        var link = $(element),\r\n            href = ko.unwrap(valueAccessor());\r\n        link.click(function (e) {\r\n            e.preventDefault();\r\n            window.open(\"/docs/#\" + href);\r\n        });\r\n    }\r\n};\r\nvar substringMatcher = function (strs) {\r\n    return function findMatches(q, cb) {\r\n        var matches, substringRegex;\r\n\r\n        // an array that will be populated with substring matches\r\n        matches = [];\r\n        // regex used to determine if a string contains the substring `q`\r\n        substringRegex = new RegExp(q, \"i\");\r\n\r\n        // iterate through the pool of strings and for any string that\r\n        // contains the substring `q`, add it to the `matches` array\r\n        $.each(strs, function (i, str) {\r\n            if (substringRegex.test(str)) {\r\n                // the typeahead jQuery plugin expects suggestions to a\r\n                // JavaScript object, refer to typeahead docs for more info\r\n                matches.push({ value: str });\r\n            }\r\n        });\r\n\r\n        cb(matches);\r\n    };\r\n};\r\n\r\n\r\nko.bindingHandlers.typeaheadUrl = {\r\n    init: function (element, valueAccessor) {\r\n        var types = ko.unwrap(valueAccessor()),\r\n            ttl = 300000,\r\n            url = String.format(\"/list?table={0}&column={1}\", types[0], \"Route\"),\r\n            suggestions = new Bloodhound({\r\n                datumTokenizer: Bloodhound.tokenizers.obj.whitespace(\"name\"),\r\n                queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n                limit: 10,\r\n                remote: {\r\n                    url: url,\r\n                    tt1: ttl,\r\n                    filter: function (list) {\r\n                        return _(list).map(function (v) {\r\n                            return { name: v };\r\n                        });\r\n                    }\r\n                }\r\n\r\n            });\r\n\r\n        suggestions.initialize();\r\n        $(element).typeahead(null,\r\n            {\r\n                name: \"EntityView_\" + $(element).prop(\"id\"),\r\n                displayKey: \"name\",\r\n                source: suggestions.ttAdapter()\r\n            });\r\n    }\r\n};\r\nko.bindingHandlers.entityTypeaheadPath = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var value = valueAccessor(),\r\n            context = require(objectbuilders.datacontext),\r\n            config = require(objectbuilders.config),\r\n            allBindings = allBindingsAccessor(),\r\n            idOrName = ko.unwrap(valueAccessor()) || window.typeaheadEntity,\r\n            setup = function (options) {\r\n                String.prototype.toCamelCase = function () {\r\n                    return this.replace(/^([A-Z])|\\s(\\w)/g, function (match, p1, p2, offset) {\r\n                        if (p2) return p2.toUpperCase();\r\n                        return p1.toLowerCase();\r\n                    });\r\n                };\r\n\r\n\r\n                var name = options.name || options,\r\n                    eid = options.id || options,\r\n                    camel = name.toCamelCase();\r\n\r\n                var ed = ko.toJS(bespoke[config.applicationName + \"_\" + camel].domain[name]());\r\n                var input = $(element),\r\n                         div = $(\"<div></div>\").css({\r\n                             'height': \"28px\"\r\n                         });\r\n                input.hide().before(div);\r\n\r\n                var c = completely(div[0], {\r\n                    fontSize: \"12px\",\r\n                    color: \"#555;\",\r\n                    fontFamily: \"\\\"Open Sans\\\", Arial, Helvetica, sans-serif\"\r\n                });\r\n\r\n                c.setText(ko.unwrap(allBindings.value));\r\n                for (var ix in ed) {\r\n                    if (ed.hasOwnProperty(ix)) {\r\n                        if (ix === \"$type\") continue;\r\n                        if (ix === \"addChildItem\") continue;\r\n                        if (ix === \"removeChildItem\") continue;\r\n                        if (ix === \"Empty\") continue;\r\n                        if (ix === \"WebId\") continue;\r\n                        c.options.push(\"\" + ix);\r\n                    }\r\n                }\r\n                c.options.sort();\r\n\r\n                var currentObject = ed;\r\n                c.onChange = function (text) {\r\n                    if (text.lastIndexOf(\".\") === text.length - 1) {\r\n                        c.options = [];\r\n                        var props = text.split(\".\");\r\n\r\n                        currentObject = ed;\r\n                        _(props).each(function (v) {\r\n                            if (v === \"\") { return; }\r\n                            currentObject = currentObject[v];\r\n                        });\r\n                        console.log(\"currentObject\", currentObject);\r\n                        for (var i in currentObject) {\r\n                            if (currentObject.hasOwnProperty(i)) {\r\n                                if (i === \"$type\") continue;\r\n                                if (i === \"addChildItem\") continue;\r\n                                if (i === \"removeChildItem\") continue;\r\n                                if (i === \"Empty\") continue;\r\n                                if (i === \"WebId\") continue;\r\n                                c.options.push(\"\" + i);\r\n                            }\r\n                        }\r\n                        c.options.sort();\r\n                        c.startFrom = text.lastIndexOf(\".\") + 1;\r\n                    }\r\n                    c.repaint();\r\n                };\r\n\r\n                c.repaint();\r\n                $(c.input)\r\n                    .attr(\"autocomplete\", \"off\")\r\n                    .blur(function () {\r\n                        allBindings.value($(this).val());\r\n                    }).parent().find(\"input\")\r\n                    .css({ \"padding\": \"6px 12px\", \"height\": \"28px\" });\r\n\r\n                if ($(element).prop(\"required\")) {\r\n                    $(c.input).prop(\"required\", true);\r\n                }\r\n\r\n                c.hideDropDown();\r\n\r\n            };\r\n\r\n\r\n        if (idOrName) {\r\n            context.loadOneAsync(\"EntityDefinition\", \"Name eq '\" + idOrName + \"' OR id eq '\" + idOrName + \"'\", \"Id\")\r\n                .done(function (edf) {\r\n                    setup({ name: edf.Name(), id: edf.Id() });\r\n                });\r\n\r\n        }\r\n\r\n\r\n        if (typeof value === \"function\" && typeof value.subscribe === \"function\") {\r\n            value.subscribe(function (entity) {\r\n                $(element).typeahead(\"destroy\");\r\n                setup(entity);\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\nko.bindingHandlers.cssTypeahead = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var allBindings = allBindingsAccessor(),\r\n            results = [\"fa\", \"fa-user\", \"fa-user-o\"],\r\n            extractor = function (query) {\r\n                var result = /([^,]+)$/.exec(query);\r\n                if (result && result[1])\r\n                    return result[1].trim();\r\n                return \"\";\r\n            },\r\n            paths = _(results).map(function (v) {\r\n                return { path: v };\r\n            }),\r\n            members = new Bloodhound({\r\n                datumTokenizer: function (d) {\r\n                    return d.path.split(/s+/);\r\n                },\r\n                queryTokenizer: function (s) {\r\n                    return s.split(/\\./);\r\n                },\r\n                local: paths\r\n            });\r\n        members.initialize();\r\n\r\n        $(element).typeahead({\r\n            minLength: 0,\r\n            highlight: true,\r\n            updater: function () {\r\n                return this.$element.val().replace(/[^,]*$/, \"\") + item + \",\";\r\n            },\r\n            matcher: function (item) {\r\n                var tquery = extractor(this.query);\r\n                if (!tquery) return false;\r\n                return ~item.toLowerCase().indexOf(tquery.toLowerCase());\r\n            }\r\n        },\r\n            {\r\n                name: \"css-class\",\r\n                displayKey: \"path\",\r\n                source: members.ttAdapter()\r\n            })\r\n            .on(\"typeahead:closed\", function () {\r\n                allBindings.value($(this).val());\r\n            });\r\n\r\n    }\r\n};\r\n\r\n\r\nko.bindingHandlers.chart = {\r\n    init: function (element, valueAccessor) {\r\n        var chart = ko.unwrap(valueAccessor()),\r\n            context = require(\"services/datacontext\"),\r\n            entity = chart.Entity(),\r\n            query = JSON.parse(chart.Query()),\r\n            type = chart.Type(),\r\n            tcs = new $.Deferred(),\r\n            name = chart.Name();\r\n\r\n\r\n        context.searchAsync(entity, query)\r\n            .done(function (result) {\r\n\r\n                var buckets = result.aggregations.category.buckets || result.aggregations.category,\r\n                    data = _(buckets).map(function (v) {\r\n                        return {\r\n                            category: v.key_as_string || v.key.toString(),\r\n                            value: v.doc_count\r\n                        };\r\n                    }),\r\n                    categories = _(buckets).map(function (v) {\r\n                        return v.key_as_string || v.key.toString();\r\n                    }),\r\n                    kendoChart = $(element).kendoChart({\r\n                        theme: \"metro\",\r\n                        chartArea: {\r\n                            background: \"\"\r\n                        },\r\n                        title: {\r\n                            text: name\r\n                        },\r\n                        legend: {\r\n                            position: \"bottom\"\r\n                        },\r\n                        seriesDefaults: {\r\n                            labels: {\r\n                                visible: true,\r\n                                format: \"{0}\",\r\n                                background: \"transparent\",\r\n                                template: \"#= category #: #= value#\"\r\n                            }\r\n                        },\r\n                        series: [\r\n                            {\r\n                                type: type,\r\n                                data: data\r\n                            }\r\n                        ],\r\n                        categoryAxis: {\r\n                            categories: categories,\r\n                            majorGridLines: {\r\n                                visible: false\r\n                            }\r\n                        },\r\n                        tooltip: {\r\n                            visible: true,\r\n                            format: \"{0}\",\r\n                            template: \"#= category #: #= value #\"\r\n                        }\r\n                    }).data(\"kendoChart\");\r\n                tcs.resolve(true);\r\n\r\n                context.getScalarAsync(\"EntityView\", \"Id eq '\" + chart.EntityViewId() + \"'\", \"Name\")\r\n                    .done(function (viewName) {\r\n                        kendoChart.options.title.text = name + \" (\" + viewName + \")\";\r\n                        kendoChart.refresh();\r\n                    });\r\n\r\n            });\r\n\r\n\r\n        return tcs.promise();\r\n    }\r\n};\r\n\r\nko.bindingHandlers.iconPicker = {\r\n    init: function (element, valueAccessor) {\r\n        var $input = $(element),\r\n            value = valueAccessor(),\r\n            $picker = $(\"<a href=\\\"#\\\" class=\\\"btn btn-link\\\">Pick Icon</a>\");\r\n\r\n        $input.parent().append($picker);\r\n        $picker.click(function (e) {\r\n            e.preventDefault();\r\n            require([\"viewmodels/icon.picker\", \"durandal/app\"], function (dialog, app2) {\r\n                app2.showDialog(dialog)\r\n                    .done(function (result) {\r\n                        if (result === \"OK\") {\r\n                            value(dialog.icon());\r\n                            $input.val(dialog.icon());\r\n                        }\r\n                    });\r\n\r\n            });\r\n        });\r\n\r\n    }\r\n};\r\n\r\nvar bespoke = bespoke || {};\r\nbespoke.observableArray = bespoke.observableArray || {};\r\n\r\nbespoke.getSingletonObservableArray = function (key) {\r\n    if (bespoke.observableArray[key]) {\r\n        return bespoke.observableArray[key];\r\n    }\r\n\r\n    bespoke.observableArray[key] = ko.observableArray();\r\n    return bespoke.observableArray[key];\r\n};\r\n\r\n\r\nko.bindingHandlers.lookup = {\r\n    init: function (element, valueAccessor) {\r\n        var $link = $(element),\r\n            options = valueAccessor(),\r\n            member = ko.unwrap(options.member);\r\n\r\n        $link.click(function (e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            require([\"viewmodels/entity.lookup.dialog\", \"durandal/app\"], function (dialog, app2) {\r\n                dialog.options(options);\r\n                app2.showDialog(dialog)\r\n                    .done(function (result) {\r\n                        if (!result) return;\r\n                        if (result === \"OK\") {\r\n                            var item = dialog.selected();\r\n                            options.value(item[member]);\r\n                        }\r\n                    });\r\n\r\n            });\r\n\r\n        });\r\n    }\r\n};\r\nko.virtualElements.allowedBindings.lookupText = true;\r\nbespoke.lookupText = function (element, valueAccessor) {\r\n    var options = valueAccessor(),\r\n        entity = ko.unwrap(options.entity),\r\n        displayPath = ko.unwrap(options.displayPath),\r\n        valuePath = ko.unwrap(options.valuePath),\r\n        val = ko.unwrap(options.value),\r\n        context = require(\"services/datacontext\"),\r\n        setTextContent = function (ele, textContent) {\r\n            var value = ko.utils.unwrapObservable(textContent);\r\n            if ((value === null) || (value === undefined))\r\n                value = \"\";\r\n            var innerTextNode = ko.virtualElements.firstChild(ele);\r\n            if (!innerTextNode || innerTextNode.nodeType !== 3 || ko.virtualElements.nextSibling(innerTextNode)) {\r\n                ko.virtualElements.setDomNodeChildren(ele, [ele.ownerDocument.createTextNode(value)]);\r\n            } else {\r\n                innerTextNode.data = value;\r\n            }\r\n\r\n        };\r\n\r\n    context.getScalarAsync(entity, valuePath + \" eq '\" + val + \"'\", displayPath)\r\n    .done(function (text) {\r\n        setTextContent(element, text);\r\n        console.log(text);\r\n    });\r\n};\r\nko.bindingHandlers.lookupText = {\r\n    init: bespoke.lookupText,\r\n    update: bespoke.lookupText\r\n};\r\n\r\n\r\nko.bindingHandlers.readonly = {\r\n    init: function (element, valueAccessor) {\r\n        var input = $(element),\r\n            ro = ko.unwrap(valueAccessor());\r\n\r\n        if (ro) {\r\n            input.prop(\"readonly\", true);\r\n        } else {\r\n\r\n            input.prop(\"readonly\", false);\r\n        }\r\n    },\r\n    update: function (element, valueAccessor) {\r\n        var input = $(element),\r\n             ro = ko.unwrap(valueAccessor());\r\n\r\n        if (ro) {\r\n            input.prop(\"readonly\", true);\r\n        } else {\r\n\r\n            input.prop(\"readonly\", false);\r\n        }\r\n    }\r\n};","/// <reference path=\"knockout-3.4.0.debug.js\" />\r\n/// <reference path=\"underscore.js\" />\r\n/// <reference path=\"moment.js\" />\r\n/// <reference path=\"~/Scripts/jquery-2.2.0.intellisense.js\" />\r\n/// <reference path=\"~/Scripts/require.js\" />\r\n/// <reference path=\"~/kendo/js/kendo.all.js\" />\r\n/// <reference path=\"_pager.js\" />\r\n/// <reference path=\"/SphApp/services/datacontext.js\" />\r\n/// <reference path=\"/SphApp/objectbuilders.js\" />\r\n\r\n\r\n\r\nko.bindingHandlers.kendoEditor = {\r\n    init: function (element, valueAccessor) {\r\n        var $editor = $(element),\r\n            value = valueAccessor(),\r\n            updating = false;\r\n\r\n        setTimeout(function () {\r\n            var editor = $editor.kendoEditor({\r\n                change: function () {\r\n                    if (updating) return;\r\n                    updating = true;\r\n                    value(this.value());\r\n                    setTimeout(function () { updating = false; }, 500);\r\n                }\r\n            }).data(\"kendoEditor\");\r\n\r\n            editor.value(value());\r\n\r\n            value.subscribe(function (html) {\r\n                if (updating) return;\r\n                updating = true;\r\n                editor.value(html);\r\n                setTimeout(function () { updating = false; }, 500);\r\n            });\r\n\r\n        }, 500);\r\n    },\r\n    update2: function (element, valueAccessor) {\r\n        var $editor = $(element),\r\n            value = valueAccessor(),\r\n            ke = $editor.data(\"kendoEditor\");\r\n        if (!$editor.data(\"updating\")) {\r\n            ke.value(value());\r\n        }\r\n    }\r\n};\r\n\r\nko.bindingHandlers.kendoDropDownListValue = {\r\n    init: function (element, valueAccessor) {\r\n        var value = valueAccessor();\r\n        var currentModelValue = ko.utils.unwrapObservable(value);\r\n        var dd = $(element).data(\"kendoDropDownList\");\r\n        dd.value(currentModelValue);\r\n\r\n        dd.bind(\"change\", function () {\r\n            var nv = dd.value();\r\n            value(nv);\r\n        });\r\n    },\r\n\r\n    update: function (element, valueAccessor) {\r\n        //update value based on a model change\r\n        var value = valueAccessor();\r\n        var modelValue = ko.utils.unwrapObservable(value);\r\n\r\n        if (modelValue) {\r\n            $(element).data(\"kendoDropDownList\").value(modelValue);\r\n        }\r\n    }\r\n};\r\n\r\nko.bindingHandlers.source = {\r\n};\r\nko.bindingHandlers.kendoComboBox = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var value = valueAccessor(),\r\n            allBindings = allBindingsAccessor(),\r\n            currentModelValue = ko.utils.unwrapObservable(value),\r\n            dd = $(element).data(\"kendoComboBox\") ||\r\n                $(element).kendoComboBox({\r\n                    dataSource: allBindings.source()\r\n                }).data(\"kendoComboBox\");\r\n\r\n        dd.value(currentModelValue);\r\n        allBindings.source.subscribe(function (options) {\r\n            // console.log(options, dd);\r\n            dd.dataSource.data(options);\r\n        });\r\n        dd.bind(\"change\", function () {\r\n            var nv = dd.value();\r\n            value(nv);\r\n        });\r\n    },\r\n\r\n    update: function (element, valueAccessor) {\r\n        //update value based on a model change\r\n        var value = valueAccessor();\r\n        var modelValue = ko.utils.unwrapObservable(value);\r\n\r\n        if (modelValue) {\r\n            $(element).data(\"kendoComboBox\").value(modelValue);\r\n        }\r\n    }\r\n};\r\n\r\n\r\nko.bindingHandlers.decimal = {};\r\nko.bindingHandlers.money = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n\r\n        var value = valueAccessor(),\r\n            allBindings = allBindingsAccessor(),\r\n            decimal = function () {\r\n                if (typeof allBindings.decimal === \"undefined\") {\r\n                    return 2;\r\n                }\r\n                return parseInt(allBindings.decimal);\r\n            },\r\n            textbox = $(element),\r\n            val = parseFloat(ko.unwrap(value) || \"0\"),\r\n            fm = val.toFixed(decimal()).replace(/./g, function (c, i, a) {\r\n                return i && c !== \".\" && !((a.length - i) % 3) ? \",\" + c : c;\r\n            });\r\n\r\n\r\n        if (element.tagName.toLowerCase() === \"span\") {\r\n            textbox.text(fm);\r\n            return;\r\n        }\r\n\r\n        textbox.val(fm);\r\n\r\n        textbox.on(\"blur\", function () {\r\n            var tv = $(this).val().replace(/,/g, \"\");\r\n            console.log(tv);\r\n            value(parseFloat(tv));\r\n        });\r\n\r\n    },\r\n    update: function (element, valueAccessor, allBindingsAccessor) {\r\n        var value = valueAccessor(),\r\n            allBindings = allBindingsAccessor(),\r\n            decimal = function () {\r\n                if (typeof allBindings.decimal === \"undefined\") {\r\n                    return 2;\r\n                }\r\n                return parseInt(allBindings.decimal);\r\n            },\r\n             textbox = $(element),\r\n             val = parseFloat(ko.unwrap(value) || \"0\"),\r\n             fm = val.toFixed(decimal()).replace(/./g, function (c, i, a) {\r\n                 return i && c !== \".\" && !((a.length - i) % 3) ? \",\" + c : c;\r\n             });\r\n\r\n        textbox.val(fm);\r\n\r\n    }\r\n};\r\n\r\n///user moment format\r\nko.bindingHandlers.date = {\r\n    init: function (element, valueAccessor) {\r\n        var value = ko.utils.unwrapObservable(valueAccessor());\r\n\r\n        if (!value) {\r\n            $(element).text(\"\");\r\n            $(element).val(\"\");\r\n            return;\r\n        }\r\n\r\n        var dv = ko.unwrap(value.value),\r\n            defaultFormat = (dv || \"\").indexOf(\"T\") > -1 ? \"YYYY-MM-DDTHH:mm:ss\" : \"YYYY-MM-DD\",\r\n            inputFormat = ko.unwrap(value.inputFormat) || defaultFormat,\r\n            date = moment(dv, inputFormat),\r\n            invalid = ko.unwrap(value.invalid) || \"invalid date\",\r\n            format = ko.unwrap(value.format) || \"DD/MM/YYYY\";\r\n\r\n        if (!value.format && typeof ko.unwrap(value) === \"string\") {\r\n            dv = ko.unwrap(value);\r\n            date = moment(dv);\r\n        }\r\n\r\n        $(element).on(\"change\", function () {\r\n            var nv = $(this).val();\r\n            value.value(nv);\r\n        });\r\n        if (!dv) {\r\n            $(element).text(invalid);\r\n            $(element).val(invalid);\r\n            return;\r\n        }\r\n        if (!date) {\r\n            $(element).text(\"\");\r\n            $(element).val(\"\");\r\n            return;\r\n        }\r\n        if (date.year() === 1) { // DateTime.Min\r\n            $(element).text(\"\");\r\n            $(element).val(\"\");\r\n            return;\r\n        }\r\n\r\n\r\n        var dateString = date.format(format).toString();\r\n        if (dateString.indexOf(\"NaN\") < 0) {\r\n            $(element).text(dateString);\r\n            $(element).val(dateString);\r\n        }\r\n\r\n\r\n\r\n    },\r\n    update: function (element, valueAccessor) {\r\n        var value = ko.utils.unwrapObservable(valueAccessor());\r\n\r\n        if (!value) {\r\n            $(element).text(\"\");\r\n            $(element).val(\"\");\r\n            return;\r\n        }\r\n\r\n        var dv = ko.unwrap(value.value),\r\n            defaultFormat = (dv || \"\").indexOf(\"T\") > -1 ? \"YYYY-MM-DDTHH:mm:ss\" : \"YYYY-MM-DD\",\r\n            inputFormat = ko.unwrap(value.inputFormat) || defaultFormat,\r\n            date = moment(dv, inputFormat),\r\n            invalid = ko.unwrap(value.invalid) || \"invalid date\",\r\n            format = ko.unwrap(value.format) || \"DD/MM/YYYY\";\r\n\r\n        if (!value.format && typeof ko.unwrap(value) === \"string\") {\r\n            dv = ko.unwrap(value);\r\n            date = moment(dv);\r\n        }\r\n\r\n        $(element).on(\"change\", function () {\r\n            var nv = $(this).val();\r\n            value.value(nv);\r\n        });\r\n        if (!dv) {\r\n            $(element).text(invalid);\r\n            $(element).val(invalid);\r\n            return;\r\n        }\r\n        if (!date) {\r\n            $(element).text(\"\");\r\n            $(element).val(\"\");\r\n            return;\r\n        }\r\n        if (date.year() === 1) { // DateTime.Min\r\n            $(element).text(\"\");\r\n            $(element).val(\"\");\r\n            return;\r\n        }\r\n\r\n\r\n        var dateString = date.format(format).toString();\r\n        if (dateString.indexOf(\"NaN\") < 0) {\r\n            $(element).text(dateString);\r\n            $(element).val(dateString);\r\n        }\r\n\r\n\r\n\r\n    }\r\n};\r\n\r\n\r\nko.bindingHandlers.kendoUpload = {\r\n    init: function (element, valueAccessor) {\r\n        var context = require(objectbuilders.datacontext),\r\n             logger = require(objectbuilders.logger),\r\n             value = valueAccessor(),\r\n             options = valueAccessor(),\r\n                 extensions = [];\r\n        if (options && typeof options === \"object\") {\r\n            value = options.value;\r\n            extensions = options.extensions;\r\n        }\r\n\r\n        $(element).attr(\"name\", \"files\").kendoUpload({\r\n            async: {\r\n                saveUrl: \"/BinaryStore/Upload\",\r\n                removeUrl: \"/BinaryStore/Remove\",\r\n                autoUpload: true\r\n            },\r\n            multiple: false,\r\n            error: function (e) {\r\n                logger.logError(e, e, this, true);\r\n            },\r\n            select: function (e) {\r\n                if (extensions.length === 0) {\r\n                    return;\r\n                }\r\n                _(e.files).each(function (v) {\r\n                    if (extensions.indexOf(v.extension) < 0) {\r\n                        logger.error(\"Only \" + extensions.join(\",\") + \" files can be uploaded\");\r\n                        e.preventDefault();\r\n                    }\r\n                });\r\n            },\r\n            success: function (e) {\r\n                logger.info(\"Your file has been \" + e.operation);\r\n\r\n                var storeId = e.response.storeId,\r\n                    uploaded = e.operation === \"upload\",\r\n                    removed = e.operation !== \"upload\",\r\n                    oldFile = value();\r\n                if (uploaded) {\r\n                    value(storeId);\r\n                    if (oldFile) {\r\n                        context.post(JSON.stringify({ id: oldFile }), \"/BinaryStore/Remove/\");\r\n                    }\r\n                }\r\n                if (removed) {\r\n                    value(\"\");\r\n                }\r\n            },\r\n            remove: function () {\r\n                var tcs = new $.Deferred(),\r\n                    data = JSON.stringify({ id: value() });\r\n                context.post(data, \"/BinaryStore/Remove/\")\r\n                    .then(function (result) {\r\n                        tcs.resolve(result);\r\n                    });\r\n                return tcs.promise();\r\n            }\r\n        });\r\n    }\r\n};\r\n\r\n///user moment format\r\nko.bindingHandlers.kendoDate = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var value = valueAccessor(),\r\n            $input = $(element),\r\n            allBindings = allBindingsAccessor(),\r\n            currentValue = ko.unwrap(value),\r\n            date = moment(currentValue, \"DD/MM/YYYY\"),\r\n            changed = function (e) {\r\n                console.log(e);\r\n                var nv = this.value();\r\n                if (typeof nv == \"string\") {\r\n                    date = moment(nv, \"DD/MM/YYYY\");\r\n                } else {\r\n                    date = moment(nv);\r\n                }\r\n                // DO NOT fire update\r\n                $input.data(\"stop\", \"true\");\r\n                value(date.format(\"YYYY-MM-DD\"));\r\n                $input.data(\"stop\", \"false\");\r\n\r\n            },\r\n            picker = $input.kendoDatePicker({ format: \"dd/MM/yyyy\", change: changed }).data(\"kendoDatePicker\");\r\n\r\n        if (typeof allBindings.enable === \"boolean\") {\r\n            if (!allBindings.enable) {\r\n                picker.enable(false);\r\n            }\r\n        }\r\n        if (typeof allBindings.enable === \"function\" && typeof allBindings.enable.subscribe === \"function\") {\r\n            allBindings.enable.subscribe(function (enable) {\r\n                picker.enable(enable);\r\n            });\r\n        }\r\n\r\n        if (!date) {\r\n            picker.value(null);\r\n            return;\r\n        }\r\n\r\n        if (date.year() === 1) { // DateTime.Min\r\n            picker.value(null);\r\n            return;\r\n        }\r\n\r\n        picker.value(date.toDate());\r\n        if (typeof currentValue === \"undefined\" && typeof value === \"function\") {\r\n            value(date.format(\"YYYY-MM-DD\"));\r\n        }\r\n    },\r\n    update: function (element, valueAccessor, allBindingsAccessor) {\r\n        var $input = $(element),\r\n            allBindings = allBindingsAccessor();\r\n        if ($input.data(\"stop\") === \"true\") return;\r\n\r\n        var value = valueAccessor(),\r\n            modelValue = ko.utils.unwrapObservable(value),\r\n            date = moment(modelValue),\r\n            picker = $input.data(\"kendoDatePicker\");\r\n\r\n        if (!date) {\r\n            picker.value(null);\r\n            return;\r\n        }\r\n        if (date.year() === 1) { // DateTime.Min\r\n            picker.value(null);\r\n            return;\r\n        }\r\n\r\n        if (typeof allBindings.enable === \"boolean\") {\r\n            if (!allBindings.enable) {\r\n                picker.enable(false);\r\n            }\r\n        }\r\n        if (typeof allBindings.enable === \"function\" && typeof allBindings.enable.subscribe === \"function\") {\r\n            allBindings.enable.subscribe(function (enable) {\r\n                picker.enable(enable);\r\n            });\r\n        }\r\n        picker.value(date.toDate());\r\n\r\n    }\r\n};\r\n\r\n\r\n///user moment format\r\nko.bindingHandlers.kendoDateTime = {\r\n    init: function (element, valueAccessor) {\r\n        var value = valueAccessor(),\r\n            $input = $(element),\r\n            currentValue = ko.utils.unwrapObservable(value),\r\n            date = moment(currentValue, \"DD/MM/YYYY \"),\r\n            changed = function (e) {\r\n                console.log(e);\r\n                var nv = this.value();\r\n                if (typeof nv == \"string\") {\r\n                    date = moment(nv, \"DD/MM/YYYY hh:mm\");\r\n                } else {\r\n                    date = moment(nv);\r\n                }\r\n                // DO NOT fire update\r\n                $input.data(\"stop\", \"true\");\r\n                value(date.format());\r\n                $input.data(\"stop\", \"false\");\r\n\r\n            },\r\n            picker = $input.kendoDateTimePicker({ format: \"dd/MM/yyyy HH:mm\", change: changed }).data(\"kendoDateTimePicker\");\r\n\r\n        if (!date) {\r\n            picker.value(null);\r\n            return;\r\n        }\r\n\r\n        if (date.year() === 1) { // DateTime.Min\r\n            picker.value(null);\r\n            return;\r\n        }\r\n\r\n        picker.value(date.toDate());\r\n    },\r\n    update: function (element, valueAccessor) {\r\n        var $input = $(element);\r\n        if ($input.data(\"stop\") === \"true\") return;\r\n\r\n        var value = valueAccessor(),\r\n            modelValue = ko.utils.unwrapObservable(value),\r\n            date = moment(modelValue),\r\n            picker = $input.data(\"kendoDateTimePicker\");\r\n\r\n        if (!date) {\r\n            picker.value(null);\r\n            return;\r\n        }\r\n        if (date.year() === 1) { // DateTime.Min\r\n            picker.value(null);\r\n            return;\r\n        }\r\n\r\n        picker.value(date.toDate());\r\n\r\n    }\r\n};\r\n\r\nko.bindingHandlers.slideVisible = {\r\n    init: function (element, valueAccessor) {\r\n        // Initially set the element to be instantly visible/hidden depending on the value\r\n        var value = valueAccessor();\r\n        $(element).toggle(ko.utils.unwrapObservable(value));\r\n    },\r\n    update: function (element, valueAccessor) {\r\n        var value = valueAccessor();\r\n        ko.utils.unwrapObservable(value) ? $(element).slideDown() : $(element).slideUp();\r\n    }\r\n};\r\n\r\nko.bindingHandlers.kendoEnable = {\r\n    init: function (element, valueAccessor) {\r\n        var value = valueAccessor();\r\n        var enable = ko.utils.unwrapObservable(value);\r\n        if (enable) {\r\n            $(element).removeClass(\"k-state-disabled\");\r\n        } else {\r\n            $(element).addClass(\"k-state-disabled\");\r\n        }\r\n    },\r\n    update: function (element, valueAccessor) {\r\n        var value = valueAccessor();\r\n        var enable = ko.utils.unwrapObservable(value);\r\n        if (enable) {\r\n            $(element).removeClass(\"k-state-disabled\");\r\n            $(element).removeAttr(\"disabled\");\r\n        } else {\r\n            $(element).addClass(\"k-state-disabled\");\r\n            $(element).attr(\"disabled\", \"disabled\");\r\n        }\r\n    }\r\n};\r\n\r\nko.bindingHandlers.command = {\r\n    init: function (element, valueAccessor, allBindingsAccessor, viewModel) {\r\n        var action = valueAccessor(),\r\n            $button = $(element),\r\n            allBindings = allBindingsAccessor(),\r\n            inputValue = $button.val(),\r\n            logger = require(\"services/logger\");\r\n\r\n        if (allBindings.isvisible) {\r\n            var visible = typeof allBindings.isvisible === \"function\" ? allBindings.isvisible() : allBindings.isvisible;\r\n            if (!visible) {\r\n                $button.hide();\r\n            } else {\r\n                $button.show();\r\n            }\r\n\r\n            if (typeof allBindings.isvisible === \"function\") {\r\n                allBindings.isvisible.subscribe(function (v) {\r\n                    if (v)\r\n                        $button.show();\r\n                    else\r\n                        $button.hide();\r\n                });\r\n            }\r\n        }\r\n\r\n        var $spinner = $(\"<i class='fa fa-spin fa-circle-o-notch'></i>\").hide(),\r\n            $warning = $(\"<i class='fa fa-warning' style='color:red'></i>\").hide();\r\n        $button.append($spinner);\r\n        $button.append($warning);\r\n\r\n        $button.click(function (e) {\r\n            e.preventDefault();\r\n            if (this.form) {\r\n                if (!this.form.checkValidity()) return;\r\n            }\r\n            $spinner.show();\r\n            $warning.hide();\r\n\r\n            action(viewModel, e)\r\n                .fail(function (err, o, message) {\r\n                    $button\r\n                       .button(\"complete\")\r\n                       .prop(\"disabled\", false)\r\n                       .val(inputValue)\r\n                       .removeClass(\"btn-disabled\");\r\n                    $spinner.hide();\r\n                    $warning.show();\r\n                    if (err.status === 404) {\r\n                        logger.error(message);\r\n                        logger.error(err.statusText);\r\n                        return;\r\n                    }\r\n                    if (err.responseText) {\r\n                        logger.error(err.responseText);\r\n                        console.error(err.responseText);\r\n                    }\r\n                    if (err.responseJSON) {\r\n                        logger.error(JSON.stringify(err.responseJSON));\r\n                        console.error(err.responseJson);\r\n                    }\r\n                })\r\n                .done(function () {\r\n                    $button\r\n                        .button(\"complete\")\r\n                        .prop(\"disabled\", false)\r\n                        .val(inputValue)\r\n                        .removeClass(\"btn-disabled\");\r\n                    $spinner.hide();\r\n                });\r\n            if ($button.data(\"loading-text\")) {\r\n                $button.button(\"loading\");\r\n            }\r\n            $button.addClass(\"btn-disabled\").prop(\"disabled\", true);\r\n\r\n        });\r\n    }\r\n};\r\n\r\nko.bindingHandlers.field = {\r\n    init: function () {\r\n    }\r\n};\r\nko.bindingHandlers.unwrapClick = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var action = valueAccessor(),\r\n            button = $(element),\r\n            allBindings = allBindingsAccessor();\r\n\r\n\r\n        button.click(function (e) {\r\n            e.preventDefault();\r\n            var prop = allBindings.property,\r\n                accessor = allBindings.accessor,\r\n                type = allBindings.field,\r\n                entity = allBindings.entity;\r\n            /* if we can't get to the function , i.e. it's still object not ko.observable\r\n            \r\n            */\r\n            if (prop) {\r\n                if (typeof accessor[prop] === \"undefined\") {\r\n                    console.log(\"Can't figure out the accessor.prop\");\r\n                }\r\n                if (typeof accessor[prop] === \"object\") {\r\n                    accessor[prop] = ko.observable(accessor[prop]);\r\n                }\r\n                if (typeof accessor[prop] === \"function\") {\r\n                    action(accessor[prop], type, entity);\r\n                }\r\n            } else {\r\n                action(accessor, type, entity);\r\n            }\r\n\r\n        });\r\n    }\r\n};\r\n\r\nko.bindingHandlers.fieldImage = {\r\n    init: function (element, valueAccessor) {\r\n        var type = valueAccessor(),\r\n            img = $(element);\r\n\r\n        var ft = typeof type === \"function\" ? type() : type;\r\n        img.attr(\"src\", \"/image/index/\" + ft);\r\n\r\n\r\n    }\r\n};\r\n\r\n\r\nko.bindingHandlers.stringArrayAutoComplete = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var value = valueAccessor(),\r\n            allBindings = allBindingsAccessor(),\r\n            options = allBindings.data();\r\n\r\n        $(element).data(\"kendoAutoComplete\") ||\r\n           $(element).kendoAutoComplete({\r\n               dataSource: options,\r\n               change: function () {\r\n                   var data = _(this.value().split(\",\")).filter(function (s) {\r\n                       return s;\r\n                   });\r\n                   value(data);\r\n               },\r\n               filter: \"startswith\",\r\n               placeholder: \"....\",\r\n               separator: \",\"\r\n           }).val(value());\r\n    },\r\n    update: function (element, valueAccessor) {\r\n        var value = valueAccessor();\r\n        $(element).data(\"kendoAutoComplete\").value(value());\r\n    }\r\n\r\n};\r\n\r\n\r\n\r\nko.bindingHandlers.pathAutoComplete = {\r\n    init: function (element, valueAccessor) {\r\n        var command = valueAccessor();\r\n        var value = command.value;\r\n        var type = command.type;\r\n\r\n        if (!type()) return;\r\n\r\n        $.get(\"/App/TriggerPathPickerJson/\" + type())\r\n            .done(function (json) {\r\n                var tree = JSON.parse(json);\r\n                var data = _.chain(tree)\r\n                    .map(function (t) {\r\n                        if (t.parent === \"\")\r\n                            return t.name;\r\n                        return undefined;\r\n                    })\r\n                    .filter(function (t) {\r\n                        return typeof t !== \"undefined\";\r\n                    })\r\n                    .value();\r\n\r\n                console.log(data);\r\n\r\n                var dataSource = new kendo.data.DataSource({\r\n                    data: data\r\n                });\r\n                var input = $(element).data(\"kendoAutoComplete\") ||\r\n                   $(element).kendoAutoComplete({\r\n                       dataSource: tree,\r\n                       dataTextField: \"path\",\r\n                       change: function () {\r\n                           var path = this.value();\r\n                           console.log(\"selected path \", path);\r\n\r\n                       },\r\n                       filter: \"startswith\",\r\n                       placeholder: \"Select path...\",\r\n                       separator: \"\"\r\n                   }).data(\"kendoAutoComplete\");\r\n\r\n                $(element)\r\n                        .change(function () {\r\n                            value($(this).val());\r\n                            console.log(\"new value\", value());\r\n                        })\r\n                       .val(value())\r\n                    .on(\"keydown3\", function (e) {\r\n                        if (e.which === 110 || e.which === 190) {\r\n                            var path = $(this).val() + \".\";\r\n                            console.log(\"show the auto complete\", path);\r\n                            var filtered = _.chain(tree)\r\n                                .filter(function (t) {\r\n                                    return t.parent === path;\r\n                                })\r\n                                .map(function (t) {\r\n                                    return t.name;\r\n                                })\r\n                                .value();\r\n                            console.log(filtered);\r\n                            //input.setDataSource(dataSource);\r\n                            dataSource.data(filtered);\r\n                            input.refresh();\r\n                        }\r\n                    });\r\n            });\r\n\r\n    }\r\n\r\n};\r\n\r\nko.bindingHandlers.commandWithParameter = {\r\n    init: function (element, valueAccessor) {\r\n        var command = valueAccessor();\r\n        var callback = command.command;\r\n        var parameter = command.parameter || command.commandParameter;\r\n\r\n        var button = $(element);\r\n        var completeText = button.data(\"complete-text\") || button.html();\r\n        button.click(function (e) {\r\n            e.preventDefault();\r\n            callback(parameter)\r\n                .then(function () {\r\n                    button.button(\"complete\");\r\n                    if (button.get(0).tagName === \"BUTTON\" || button.get(0).tagName === \"A\") {\r\n                        button.html(completeText);\r\n                    } else {\r\n                        button.val(completeText);\r\n                    }\r\n\r\n                });\r\n            if (button.data(\"loading-text\")) {\r\n                button.button(\"loading\");\r\n            }\r\n        });\r\n    }\r\n\r\n};\r\n\r\n\r\nko.bindingHandlers.filter = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var value = valueAccessor(),\r\n            bindingAccessor = allBindingsAccessor(),\r\n            path = value.path,\r\n            tooltip = value.tooltip || \"Type to filter current page or type and [ENTER] to search the whole view\",\r\n            $element = $(element),\r\n            $filterInput = $(\"<input data-toggle=\\\"tooltip\\\" title=\\\"\" + tooltip + \"\\\" type=\\\"search\\\" class=\\\"search-query input-medium form-control\\\" placeholder=\\\"Filter.. \\\">\"),\r\n            $serverLoadButton = $(\"<a href='/#' title='Carian server'><i class='add-on icon-search'></i><a>\"),\r\n            $form = $(\"<form class='form-search row'>\" +\r\n                \" <div class='input-group pull-right' style='width:300px'>\" +\r\n                \"<span class='input-group-addon'>\" +\r\n                \" <span class='glyphicon glyphicon-remove'></span>\" +\r\n                \"</span> \" +\r\n                \"</div>\" +\r\n                \" </form>\"),\r\n            pagedSearch = bindingAccessor.searchPaging;\r\n\r\n\r\n        $form.find(\"span.input-group-addon\").before($filterInput);\r\n        if (pagedSearch) {\r\n            $form.find(\"span.glyphicon-remove\").after($serverLoadButton);\r\n        }\r\n        $element.before($form);\r\n\r\n        $form.submit(function (e) {\r\n            e.preventDefault();\r\n            var filter = $filterInput.val().toLowerCase(),\r\n                tcs = new $.Deferred();\r\n            if (!filter) {\r\n                return tcs.promise();\r\n            }\r\n            if (pagedSearch && typeof pagedSearch.query !== \"undefined\" && typeof pagedSearch.query.filterAndSearch === \"function\") {\r\n                return pagedSearch.query.filterAndSearch(filter);\r\n            }\r\n            return tcs.promise();\r\n        });\r\n\r\n\r\n\r\n        var dofilter = function () {\r\n            var $rows = $element.find(path),\r\n                filter = $filterInput.val().toLowerCase();\r\n            $rows.each(function () {\r\n                var $tr = $(this),\r\n                    text = $tr.text().toLowerCase().trim();\r\n                if (!text) {\r\n                    $(\"input\", $tr).each(function (i, v) { text += \" \" + $(v).val() });\r\n                    text = text.toLowerCase().trim();\r\n                }\r\n                if (text.indexOf(filter) > -1) {\r\n                    $tr.show();\r\n                } else {\r\n                    $tr.hide();\r\n                }\r\n            });\r\n\r\n\r\n        },\r\n        throttled = _.throttle(dofilter, 800);\r\n\r\n        $filterInput.on(\"keyup\", throttled).siblings(\"span.input-group-addon\")\r\n            .click(function () {\r\n                $filterInput.val(\"\");\r\n                dofilter();\r\n            });\r\n\r\n        if ($filterInput.val()) {\r\n            dofilter();\r\n        }\r\n        $filterInput.tooltip();\r\n\r\n    }\r\n};\r\n\r\nko.bindingHandlers.serverPaging = {\r\n    init: function (element, valueAccessor, allBindingsAccessor, viewModel) {\r\n        var value = valueAccessor(),\r\n            entity = value.entity,\r\n            query = value.query,\r\n            list = value.list,\r\n            map = value.map,\r\n            pagerHidden = value.pagerHidden || false,\r\n            $element = $(element),\r\n            context = require(\"services/datacontext\"),\r\n            $pagerPanel = $(\"<div></div>\"),\r\n            $spinner = $(\"<img src=\\\"/Images/spinner-md.gif\\\" alt=\\\"loading\\\" class=\\\"absolute-center\\\" />\"),\r\n            startLoad = function () {\r\n                $spinner.show();\r\n                $element.fadeTo(\"fast\", 0.33);\r\n            },\r\n            endLoad = function () {\r\n                $spinner.hide();\r\n                $element.fadeTo(\"fast\", 1);\r\n            },\r\n            setItemsSource = function (items) {\r\n                if (map) {\r\n                    items = _(items).map(map);\r\n                }\r\n                if (typeof list === \"string\") {\r\n                    viewModel[list](items);\r\n                }\r\n                if (typeof list === \"function\") {\r\n                    list(items);\r\n                }\r\n            },\r\n            changed = function (page, size) {\r\n                startLoad();\r\n                context.loadAsync({\r\n                    entity: entity,\r\n                    page: page,\r\n                    size: size,\r\n                    includeTotal: true\r\n                }, query)\r\n                     .then(function (lo) {\r\n                         setItemsSource(lo.itemCollection);\r\n                         endLoad();\r\n                     });\r\n            };\r\n\r\n        $element.after($pagerPanel).after($spinner)\r\n            .fadeTo(\"slow\", 0.33);\r\n\r\n        var tcs = new $.Deferred();\r\n        context.loadAsync({\r\n            entity: entity,\r\n            page: 1,\r\n            size: 20,\r\n            includeTotal: true\r\n        }, query)\r\n        .then(function (lo) {\r\n\r\n            var options = {\r\n                element: $pagerPanel,\r\n                count: lo.rows,\r\n                changed: changed,\r\n                hidden: pagerHidden\r\n            },\r\n                pager = new bespoke.utils.ServerPager(options);\r\n            console.log(pager);\r\n            setTimeout(function () {\r\n                setItemsSource(lo.itemCollection);\r\n                tcs.resolve(true);\r\n                endLoad();\r\n            }, 500);\r\n\r\n        });\r\n        return tcs.promise();\r\n\r\n\r\n\r\n    }\r\n};\r\n\r\n\r\nko.bindingHandlers.searchPaging = {\r\n    init: function (element, valueAccessor, allBindingsAccessor, viewModel) {\r\n        var value = valueAccessor(),\r\n            entity = value.entity,\r\n            query = value.query,\r\n            executedQuery = value.query || value.initialQuery || {},\r\n            list = value.list,\r\n            map = value.map,\r\n            pagerHidden = value.pagerHidden || false,\r\n            searchButton = value.searchButton,\r\n            $element = $(element),\r\n            context = require(\"services/datacontext\"),\r\n            logger = require(\"services/logger\"),\r\n            cultures = require(objectbuilders.cultures),\r\n            $pagerPanel = $(\"<div></div>\"),\r\n            $spinner = $(\"<img src=\\\"/Images/spinner-md.gif\\\" alt=\\\"loading\\\" class=\\\"absolute-center\\\" />\"),\r\n            startLoad = function () {\r\n                $spinner.show();\r\n                $element.fadeTo(\"fast\", 0.33);\r\n            },\r\n            endLoad = function () {\r\n                $spinner.hide();\r\n                $element.fadeTo(\"fast\", 1);\r\n            },\r\n            pager = null,\r\n            setItemsSource = function (items) {\r\n\r\n                if (!pagerHidden) {\r\n                    _(items).each(function (v) {\r\n                        v.pager = {\r\n                            page: pager.page(),\r\n                            size: pager.pageSize()\r\n                        };\r\n                    });\r\n                }\r\n\r\n                if (map) {\r\n                    items = _(items).map(map);\r\n                }\r\n                if (typeof list === \"string\") {\r\n                    viewModel[list](items);\r\n                }\r\n                if (typeof list === \"function\") {\r\n                    list(items);\r\n                }\r\n            },\r\n            pageChanged = function (page, size) {\r\n                startLoad();\r\n                context.searchAsync({\r\n                    entity: entity,\r\n                    page: page,\r\n                    size: size\r\n                }, executedQuery)\r\n                     .then(function (lo) {\r\n                         setItemsSource(lo.itemCollection);\r\n                         endLoad();\r\n                     });\r\n            },\r\n            search = function (q, page, size) {\r\n                executedQuery = q;\r\n                var tcs1 = new $.Deferred();\r\n                startLoad();\r\n                context.searchAsync({\r\n                    entity: entity,\r\n                    page: page || 1,\r\n                    size: size || 20\r\n                }, q)\r\n                    .then(function (lo) {\r\n                        if (pager) {\r\n                            pager.update(lo.rows);\r\n                        } else {\r\n                            var pagerOptions = {\r\n                                element: $pagerPanel,\r\n                                count: lo.rows,\r\n                                changed: pageChanged,\r\n                                hidden: pagerHidden\r\n                            };\r\n                            pager = new bespoke.utils.ServerPager(pagerOptions);\r\n\r\n                        }\r\n\r\n                        setTimeout(function () {\r\n                            setItemsSource(lo.itemCollection);\r\n                            tcs1.resolve(lo);\r\n                            endLoad();\r\n                        }, 500);\r\n\r\n                    });\r\n                return tcs1.promise();\r\n            },\r\n            filterAndSearch = function (text) {\r\n                var q = JSON.parse(ko.toJSON(value.query || value.initialQuery)),\r\n                    q2 = {\r\n                        \"from\": 0,\r\n                        \"size\": 20,\r\n                        \"query\": {}\r\n                    };\r\n                q.query = q.query || {};\r\n                q.query.filtered = q.query.filtered || {};\r\n\r\n                q2.query.filtered = q.query.filtered;\r\n                q2.query.filtered.query = {\r\n                    \"query_string\": {\r\n                        \"default_field\": \"_all\",\r\n                        \"query\": text\r\n                    }\r\n                };\r\n                if (q.query.bool) {\r\n                    q2.filter = q2.filter || {};\r\n                    q2.filter.bool = q.query.bool;\r\n                }\r\n                q2.sort = q.sort;\r\n                pager.destroy();\r\n                pager = null;\r\n                search(q2);\r\n            };\r\n\r\n        if (typeof query.subscribe === \"function\") {\r\n            query.subscribe(function(q) {\r\n                search(q, 1, 20);\r\n            });\r\n        }\r\n\r\n        //exposed the search function\r\n        query.search = search;\r\n        query.filterAndSearch = filterAndSearch;\r\n\r\n        $element.after($pagerPanel).after($spinner)\r\n            .fadeTo(\"slow\", 0.33);\r\n\r\n        if (searchButton) {\r\n            $(document).on(\"click\", searchButton, function (e) {\r\n                e.preventDefault();\r\n                if (!$(this).parents(\"form\")[0].checkValidity()) {\r\n                    logger.error(cultures.messages.FORM_IS_NOT_VALID);\r\n                    return;\r\n                }\r\n                search(ko.toJS(query), 1, pager.pageSize());\r\n            });\r\n\r\n        }\r\n\r\n\r\n        search(ko.toJS(executedQuery));\r\n        return {\r\n            search: search,\r\n            filterAndSearch: filterAndSearch\r\n        };\r\n\r\n    }\r\n};","/// <reference path=\"typeahead.bundle.js\" />\r\n/// <reference path=\"knockout-3.4.0.debug.js\" />\r\n/// <reference path=\"underscore.js\" />\r\n/// <reference path=\"jquery-2.1.1.intellisense.js\" />\r\n\r\nko.bindingHandlers.bootstrapDropDown = {\r\n    init: function (element, valueAccesor) {\r\n        var text = ko.unwrap(valueAccesor()) || '[Select your value]',\r\n            anchor = $(element),\r\n            opened = false,\r\n            dropDown = function (e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                var button = $(this);\r\n\r\n                if (opened) {\r\n                    button.parent().removeClass(\"open\");\r\n                    opened = false;\r\n\r\n                } else {\r\n                    button.parent().addClass(\"open\");\r\n                    opened = true;\r\n                    $(document).one('click', function () {\r\n                        button.parent().removeClass(\"open\");\r\n                        opened = false;\r\n                    });\r\n                }\r\n\r\n\r\n            };\r\n        anchor.click(dropDown);\r\n\r\n        if (!anchor.html()) {\r\n            if (text.toString() === \"[object Object]\") {\r\n                text = \"[Select you value]\";\r\n            }\r\n            anchor.html(text + ' <i class=\"fa fa-caret-down\"></i>');\r\n        }\r\n    }\r\n};\r\n\r\nko.bindingHandlers.tooltip = {\r\n    init: function (element, valueAccesor) {\r\n        var optionOrText = ko.unwrap(valueAccesor()),\r\n            placement = optionOrText.tooltipPlacement || \"top\",\r\n            text = optionOrText.tooltip || optionOrText;\r\n        $(element).tooltip({ title: text, placement: placement });\r\n    }\r\n};\r\n\r\nko.bindingHandlers.bootstrapPopover = {\r\n    init: function (element, valueAccesor) {\r\n        var text = ko.unwrap(valueAccesor()).replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n        $(element).popover({ content: \"<pre>\" + text + \"</pre>\", html: true });\r\n    }\r\n};\r\nko.bindingHandlers.popover = {\r\n    init: function (element, valueAccesor) {\r\n        var text = ko.unwrap(valueAccesor());\r\n        $(element).popover({ content: '<pre>' + text + '</pre>', html: true });\r\n    }\r\n};\r\nko.bindingHandlers.bootstrapTooltip = {\r\n    init: function (element, valueAccesor) {\r\n        var text = ko.unwrap(valueAccesor());\r\n        $(element).tooltip({ title: text });\r\n    }\r\n};\r\n\r\n\r\n\r\n\r\nko.bindingHandlers.cssAutoComplete = {\r\n    init: function (element, valueAccessor) {\r\n        var value = valueAccessor(),\r\n            bootstrap = _(document.styleSheets).find(function (s) {\r\n                // TODO : what happend if were to combine the css with Bundle\r\n                if (!s) return false;\r\n                if (!s.href) return false;\r\n\r\n                return s.href.indexOf(\"bootstrap\") > -1;\r\n            });\r\n        var data = ['btn', 'btn-warning', 'btn-success', 'btn-link'];\r\n        if (bootstrap) {\r\n            data = _.chain(bootstrap.rules).filter(function (r) {\r\n                return /^\\./g.test(r.selectorText)\r\n                    && !/:/g.test(r.selectorText)\r\n                    && !/\\s/g.test(r.selectorText)\r\n                    && !/\\+/g.test(r.selectorText)\r\n                    && !/>/g.test(r.selectorText)\r\n                    && !/\\[/g.test(r.selectorText);\r\n            }).map(function (s) {\r\n                return s.selectorText.replace(/\\./g, \"\");\r\n            })\r\n                .value();\r\n        }\r\n\r\n        $(element).typeahead({\r\n            name: 'css_class',\r\n            limit: 10,\r\n            local: data\r\n        })\r\n        .on('typeahead:closed', function () {\r\n            value($(this).val());\r\n        });\r\n\r\n\r\n    }\r\n\r\n};\r\n\r\n\r\n\r\nko.bindingHandlers.autocomplete = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var va = ko.unwrap(valueAccessor()),\r\n         entity = ko.unwrap(va.entity),\r\n         field = ko.unwrap(va.field),\r\n         query = ko.unwrap(va.query),\r\n         ttl = va.ttl || 300000,\r\n         allBindings = allBindingsAccessor(),\r\n         url = String.format(\"/list?table={0}&column={1}&filter={2}\", entity, field, query),\r\n         suggestions = new Bloodhound({\r\n             datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),\r\n             queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n             prefetch: {\r\n                 url: url,\r\n                 tt1: ttl,\r\n                 filter: function (list) {\r\n                     return _(list).map(function (v) {\r\n                         return { name: v };\r\n                     });\r\n                 }\r\n             }\r\n\r\n         });\r\n\r\n        suggestions.initialize();\r\n        $(element).typeahead(null, {\r\n            name: 'autocomplete_' + $(element).prop(\"id\"),\r\n            displayKey: \"name\",\r\n            source: suggestions.ttAdapter()\r\n        })\r\n           .on('typeahead:closed', function () {\r\n               allBindings.value($(this).val());\r\n           });\r\n\r\n    }\r\n};\r\n\r\n\r\nko.bindingHandlers.scroll = {\r\n    init: function (element, valueAccessor) {\r\n        var rows = ko.unwrap(valueAccessor()),\r\n            done = false;\r\n        // wait for attached\r\n        //setTimeout(function () {\r\n        //    // TODO : just do it this once rows is more than certail values\r\n        //    $(element).tableScroll({ height: height });\r\n        //    done = true;\r\n        //}, 500);\r\n    }\r\n};\r\n","(function () {\r\n    Function.prototype.partial = function () {\r\n        var fn = this, args = Array.prototype.slice.call(arguments);\r\n        return function () {\r\n            var arg = 0;\r\n            for (var i = 0; i < args.length && arg < arguments.length; i++) {\r\n                if (args[i] === undefined) {\r\n                    args[i] = arguments[arg++];\r\n                }\r\n            }\r\n            return fn.apply(this, args);\r\n        };\r\n    };\r\n\r\n})();","(function (window) {\r\n    window.bespoke = window.bespoke || {};\r\n    window.bespoke.ServerOperationStatus = {        \r\n        OK: \"OK\",\r\n        ERROR : \"ERROR\"\r\n    };\r\n\r\n    window.bespoke.messagesText = {\r\n        SAVE_SUCCESS : \"Your item has been saved\"\r\n    };\r\n\r\n})(window);\r\n","/// <reference path=\"bootstrap.js\" />\r\n/// <reference path=\"google-maps-3-vs-1-0-vsdoc.js\" />\r\n/// <reference path=\"bootstrap-datepicker.js\" />\r\n/// <reference path=\"jquery.validate-vsdoc.js\" />\r\n/// <reference path=\"jquery-1.9.1.intellisense.js\" />\r\n/// <reference path=\"moment.js\" />\r\n/// <reference path=\"underscore.js\" />\r\n/// <reference path=\"modernizr-2.6.2.js\" />\r\n\r\n\r\nvar _uiready = function () {\r\n    var init = function (view) {\r\n    };\r\n    return {\r\n        init: init\r\n    };\r\n\r\n}();\r\n","(function (window, $) {\r\n    window.bespoke = window.bespoke || {};\r\n    bespoke.utils = bespoke.utils || {};\r\n    bespoke.utils.form = bespoke.utils.form || {};\r\n    bespoke.utils.form.checkValidity = function (button) {\r\n        if (button.form)\r\n            return button.form.checkValidity();\r\n        var form = $(button).attr('form');\r\n        if (form) {\r\n           return document.getElementById(form).checkValidity();\r\n        }\r\n        throw \"cannot find the form for the button\";\r\n    };\r\n\r\n\r\n    window.console = window.console || {};\r\n    window.console.dir = window.console.dir || function (){};\r\n\r\n\r\n})(window, jQuery);","(function (window, $) {\r\n    window.Task = window.Task || {};\r\n    window.Task.fromResult = function (returnValue, delay) {\r\n        var tcs = new $.Deferred(),\r\n            d = delay || 100;\r\n\r\n        setTimeout(function () {\r\n            tcs.resolve(returnValue);\r\n        }, d);\r\n        return tcs.promise();\r\n\r\n    };\r\n\r\n})(window, jQuery);\r\n","\r\nko.bindingHandlers.theme = {\r\n    init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {\r\n        // First get the latest data that we're bound to\r\n        var value = valueAccessor(), allBindings = allBindingsAccessor();\r\n        var valueUnwrapped = ko.unwrap(value);\r\n        if(bespoke.sph.Theme) {\r\n            var theme = new bespoke.sph.Theme();\r\n            if (theme[valueUnwrapped]) {\r\n                theme[valueUnwrapped](element, viewModel, allBindings, bindingContext);\r\n            }\r\n            \r\n        }\r\n\r\n    }\r\n};","/// <reference path=\"jquery-2.2.0.js\" />\r\n/// <reference path=\"jquery-ui-1.11.1.js\" />\r\n/// <reference path=\"modernizr-2.8.3.js\" />\r\n/// <reference path=\"bootstrap.js\" />\r\n/// <reference path=\"breeze.debug.js\" />\r\n/// <reference path=\"knockout-2.2.1.debug.js\" />\r\n/// <reference path=\"moment.js\" />\r\n/// <reference path=\"q.js\" />\r\n/// <reference path=\"toastr-1.1.5.js\" />\r\n"],"sourceRoot":"/source/"}