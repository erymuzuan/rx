!function(t){$type=String,$type.__typeName="String",$type.__class=!0,$prototype=$type.prototype,$prototype.endsWith=function(t){return this.substr(this.length-t.length)===t},$prototype.startsWith=function(t){return this.substr(0,t.length)===t},$prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},$prototype.trimEnd=function(){return this.replace(/\s+$/,"")},$prototype.trimStart=function(){return this.replace(/^\s+/,"")},$type.format=function(t,r){return String._toFormattedString(!1,arguments)},$type._toFormattedString=function(t,r){for(var e="",n=r[0],o=0;;){var i=n.indexOf("{",o),a=n.indexOf("}",o);if(0>i&&0>a){e+=n.slice(o);break}if(a>0&&(i>a||0>i)){if("}"!==n.charAt(a+1))throw new Error("format stringFormatBraceMismatch");e+=n.slice(o,a+1),o=a+2}else if(e+=n.slice(o,i),o=i+1,"{"!==n.charAt(o)){if(0>a)throw new Error("format stringFormatBraceMismatch");var s=n.substring(o,a),f=s.indexOf(":"),p=parseInt(0>f?s:s.substring(0,f),10)+1;if(isNaN(p))throw new Error("format stringFormatInvalid");var c=0>f?"":s.substring(f+1),u=r[p];("undefined"==typeof u||null===u)&&(u=""),e+=u.toFormattedString?u.toFormattedString(c):t&&u.localeFormat?u.localeFormat(c):u.format?u.format(c):u.toString(),o=a+1}else e+="{",o++}return e}}(window);
var bespoke=bespoke||{};bespoke.utils={},bespoke.utils.ServerPager=function(e){e=e||{};var a=e.element,n=e.count||0,t=e.sizes||[10,20,50],o=e.defaultSize||20,i=e.changed||function(){console.log("no change event")},r=this,u=_.range(n),c=new kendo.data.DataSource({data:u,pageSize:o});if(e.hidden)return r;var d=a.kendoPager({dataSource:c,pageSizes:t}).data("kendoPager");d.page(1),d.bind("change",function(){i&&i(d.page(),d.pageSize())}),r.update=function(e){u=[];for(var a=0;e>a;a++)u[a]=a;setTimeout(function(){c.data(u)},500)},r.destroy=function(){d.destroy(),a.empty()},r.pageSize=function(e){return e&&d.pageSize(e),d.pageSize()},r.page=function(e){return e&&d.page(e),d.page()};var g=$(a).find("select").data("kendoDropDownList");return g.bind("change",function(){try{i(1,parseInt(this.value()))}catch(e){}}),r};
ko.bindingHandlers.activityClass={init:function(t,e){var n=$(t),i=ko.unwrap(e()),o="function"==typeof i.$type?i.$type():i.$type,a=/Bespoke\.Sph\.Domain\.(.*?),/.exec(o)[1];n.addClass("activity32").addClass("activity32-"+a)}},ko.bindingHandlers.checkedItems={init:function(t,e){var n=ko.dataFor(t),i=e();$(t).change(function(){var t=$(this).is(":checked");t?i.push(n):i.remove(n)})}},ko.bindingHandlers.typeahead={init:function(t,e,n){var i=ko.unwrap(e()),o=n();if("undefined"!=typeof i){var a=new Bloodhound({datumTokenizer:function(t){return Bloodhound.tokenizers.whitespace(t.Path)},queryTokenizer:Bloodhound.tokenizers.nonword,prefetch:"/api/workflow-definitions/"+i+"/variable-path"});a.initialize(),$(t).typeahead({highlight:!0},{name:"schema_paths"+i,displayKey:"Path",source:a.ttAdapter()}).on("typeahead:closed",function(){o.value($(this).val())})}}},ko.bindingHandlers.activityPopover={init:function(t,e){var n=$(t),i=ko.unwrap(e()),o="function"==typeof i.$type?i.$type():i.$type,a=/Bespoke\.Sph\.Domain\.(.*?),/.exec(o)[1],r=ko.dataFor(n.parent()[0]).wd(),d=n.popover({title:a+" : "+i.Name(),html:!0,content:function(){return $("a.edit-activity").popover("hide"),n.find("a.edit-activity").addClass(i.WebId()),n.find("a.delete-activity").addClass(i.WebId()),n.find("a.start-activity").addClass(i.WebId()),n.find("div.context-menu").html()}});d.on("shown.bs.popover",function(){setTimeout(function(){d.popover("hide")},5e3)}),$(document).on("click","a."+i.WebId(),function(t){t.preventDefault();var e=require(objectbuilders.app),n=$(this);n.hasClass("delete-activity")&&e.showMessage("Are you sure you want to remove this Activity","Remove activity",["Yes","No"]).done(function(t){"Yes"===t&&r.removeActivity(i)()}),n.hasClass("edit-activity")&&r.editActivity(i)(),n.hasClass("start-activity")&&r.setStartActivity(i)()})}},ko.bindingHandlers.comboBoxLookupOptions={init:function(t,e){var n=$(t),i=ko.unwrap(e()),o=i.value,a=i.caption,r=require("services/datacontext"),d=ko.unwrap(i.displayPath),s=ko.unwrap(i.valuePath),u=function(e){var u=ko.unwrap(i.valuePath)===ko.unwrap(i.displayPath)?r.getListAsync(ko.unwrap(i.entity),e,ko.unwrap(i.valuePath)):r.getTuplesAsync({entity:ko.unwrap(i.entity),query:e,field:s,field2:d});u.done(function(e){t.options.length=0,a&&t.add(new Option(a,"")),_(e).each(function(e){return"string"==typeof e?void t.add(new Option(e,e)):"string"==typeof e.Item1&&"string"==typeof e.Item2?void t.add(new Option(e.Item2,e.Item1)):"string"==typeof e[s]&&"string"==typeof e[d]?void t.add(new Option(e[s],e[d])):void 0}),n.val(ko.unwrap(o)).on("change",function(){o(n.val())})})};u(ko.unwrap(i.query)),"function"==typeof i.query&&"function"==typeof i.query.subscribe&&i.query.subscribe(function(t){u(ko.unwrap(t))})},update:function(t,e){var n=ko.unwrap(e()),i=n.value;$(t).val(ko.unwrap(i))}};
ko.bindingHandlers.tree={init:function(e,n){var t=require(objectbuilders.system),o=n(),i=ko.unwrap(o.entity),a=ko.unwrap(o.searchbox),r=o.selected,l={text:i.Name(),state:{opened:!0,selected:!0}},c=function(e){var n=ko.unwrap(e.TypeName)||ko.unwrap(e.$type);return n.indexOf(",")<0&&(n=ko.unwrap(e.$type)),n},s=null,u=null,p=function(e){e.children=_(e.data.MemberCollection()).map(function(e){var n=c(e);return{text:e.Name(),state:"open",type:n,data:e}}),_(e.children).each(p)},d=function(){l.children=_(i.MemberCollection()).map(function(e){return{text:ko.unwrap(e.Name),state:"open",type:c(e),data:e}}),_(l.children).each(p),$(e).on("select_node.jstree",function(n,t){if("function"==typeof r){s&&(s.dispose(),s=null),u&&(u.dispose(),u=null);var o=t.node.data;if(o){if("default"===t.node.type)return;"function"!=typeof o.childOfValueMember&&(o.childOfValueMember=ko.observable(!0));var i=$(e).jstree(!0),a=_(t.node.parents).map(function(e){return i.get_node(e)}),l=_(a).find(function(e){return"Bespoke.Sph.Domain.ValueObjectMember, domain.sph"===e.type});o.childOfValueMember(l||!1),o.childOfValueMember()||i.edit(t.node),r(o),s=r().Name.subscribe(function(n){$(e).jstree(!0).rename_node(t.node,n),console.log("rename "+n)}),"function"==typeof r().TypeName&&(u=r().TypeName.subscribe(function(n){$(e).jstree(!0).set_type(t.node,n)}))}}}).on("create_node.jstree",function(e,n){console.log(n,"node")}).on("rename_node.jstree",function(e,n){var t=n.node.data;t.Name(n.text)}).jstree({core:{animation:0,check_callback:!0,themes:{stripes:!0},data:l},contextmenu:{items:function(n){var o=$(e).jstree(!0),a=_(n.parents).map(function(e){return o.get_node(e)}),r=_(a).find(function(e){return"Bespoke.Sph.Domain.ValueObjectMember, domain.sph"===e.type}),l=o.get_selected();if(r)return[];var c={label:"Add Simple Child",action:function(){var n=new bespoke.sph.domain.SimpleMember({WebId:t.guid(),TypeName:"System.String, mscorlib",Name:"Member_Name"}),a=$(e).jstree("get_selected",!0),r=a[0].data,c={state:"open",type:"System.String, mscorlib",text:"Member_Name",data:n};return l.length?(l=l[0],l=o.create_node(l,c),l?(o.edit(l),r&&r.MemberCollection?r.MemberCollection.push(n):i.MemberCollection.push(n),!0):!1):!1}},s={label:"Add Value Object Child",action:function(){var n="Bespoke.Sph.Domain.ValueObjectDefinition, domain.sph",a=new bespoke.sph.domain.ValueObjectMember({WebId:t.guid(),TypeName:n,Name:"Member_Name"}),r=$(e).jstree("get_selected",!0),c=r[0].data,s={state:"open",type:"Bespoke.Sph.Domain.ValueObjectMember, domain.sph",text:"Member_Name",data:a};return l.length?(l=l[0],l=o.create_node(l,s),l?(o.edit(l),c&&c.MemberCollection?c.MemberCollection.push(a):i.MemberCollection.push(a),!0):!1):!1}},u={label:"Add Complex Child",action:function(){var n=new bespoke.sph.domain.ComplexMember({WebId:t.guid(),Name:"Member_Name"}),a=$(e).jstree("get_selected",!0),r=a[0].data,c={state:"open",type:"Bespoke.Sph.Domain.ComplexMember, domain.sph",text:"Member_Name",data:n};return l.length?(l=l[0],l=o.create_node(l,c),l?(o.edit(l),r&&r.MemberCollection?r.MemberCollection.push(n):i.MemberCollection.push(n),!0):!1):!1}},p={label:"Remove",action:function(){var e=o.get_selected(!0)[0],n=o.get_node($("#"+e.parent)),t=n.data;if(t&&"function"==typeof t.MemberCollection){var a=_(t.MemberCollection()).find(function(n){return n.WebId()===e.data.WebId()});t.MemberCollection.remove(a)}else{var r=_(i.MemberCollection()).find(function(n){return n.WebId()===e.data.WebId()});i.MemberCollection.remove(r)}return l.length?(o.delete_node(l),!0):!1}},d=[];return("default"===n.type||"Bespoke.Sph.Domain.ComplexMember, domain.sph"===n.type)&&(d.push(c),d.push(s),d.push(u)),console.log(n),"default"!==n.type&&d.push(p),d}},types:{"default":{icon:"fa fa-clipboard"},"System.String, mscorlib":{icon:"glyphicon glyphicon-bold",valid_children:[]},"System.DateTime, mscorlib":{icon:"glyphicon glyphicon-calendar",valid_children:[]},"System.Int32, mscorlib":{icon:"fa fa-sort-numeric-asc",valid_children:[]},"System.Decimal, mscorlib":{icon:"glyphicon glyphicon-usd",valid_children:[]},"System.Boolean, mscorlib":{icon:"glyphicon glyphicon-ok",valid_children:[]},"Bespoke.Sph.Domain.ValueObjectMember, domain.sph":{icon:"fa fa-object-ungroup"},"Bespoke.Sph.Domain.ComplexMember, domain.sph":{icon:"fa fa-building-o"}},plugins:["contextmenu","dnd","types","search"]})};d();var m=!1;$(a).keyup(function(){m&&clearTimeout(m),m=setTimeout(function(){var n=$(a).val();$(e).jstree(!0).search(n)},250)})}},ko.bindingHandlers.help={init:function(e,n){var t=$(e),o=ko.unwrap(n());t.click(function(e){e.preventDefault(),window.open("/docs/#"+o)})}};var substringMatcher=function(e){return function(n,t){var o,i;o=[],i=new RegExp(n,"i"),$.each(e,function(e,n){i.test(n)&&o.push({value:n})}),t(o)}};ko.bindingHandlers.typeaheadUrl={init:function(e,n){var t=ko.unwrap(n()),o=3e5,i=String.format("/list?table={0}&column={1}",t[0],"Route"),a=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,remote:{url:i,tt1:o,filter:function(e){return _(e).map(function(e){return{name:e}})}}});a.initialize(),$(e).typeahead(null,{name:"EntityView_"+$(e).prop("id"),displayKey:"name",source:a.ttAdapter()})}},ko.bindingHandlers.entityTypeaheadPath={init:function(e,n,t){var o=n(),i=require(objectbuilders.datacontext),a=require(objectbuilders.config),r=t(),l=ko.unwrap(n())||window.typeaheadEntity,c=function(n){var t=n.name||n,o=n.id||n,i=ko.toJS(bespoke[a.applicationName+"_"+o.toLowerCase()].domain[t]()),l=$(e),c=$("<div></div>").css({height:"28px"});l.hide().before(c);var s=completely(c[0],{fontSize:"12px",color:"#555;",fontFamily:'"Open Sans", Arial, Helvetica, sans-serif'});s.setText(ko.unwrap(r.value));for(var u in i)if(i.hasOwnProperty(u)){if("$type"===u)continue;if("addChildItem"===u)continue;if("removeChildItem"===u)continue;if("Empty"===u)continue;if("WebId"===u)continue;s.options.push(""+u)}s.options.sort();var p=i;s.onChange=function(e){if(e.lastIndexOf(".")===e.length-1){s.options=[];var n=e.split(".");p=i,_(n).each(function(e){""!==e&&(p=p[e])}),console.log("currentObject",p);for(var t in p)if(p.hasOwnProperty(t)){if("$type"===t)continue;if("addChildItem"===t)continue;if("removeChildItem"===t)continue;if("Empty"===t)continue;if("WebId"===t)continue;s.options.push(""+t)}s.options.sort(),s.startFrom=e.lastIndexOf(".")+1}s.repaint()},s.repaint(),$(s.input).attr("autocomplete","off").blur(function(){r.value($(this).val())}).parent().find("input").css({padding:"6px 12px",height:"28px"}),$(e).prop("required")&&$(s.input).prop("required",!0)};l&&i.loadOneAsync("EntityDefinition","Name eq '"+l+"' OR id eq '"+l+"'","Id").done(function(e){c({name:e.Name(),id:e.Id()})}),"function"==typeof o&&"function"==typeof o.subscribe&&o.subscribe(function(n){$(e).typeahead("destroy"),c(n)})}},ko.bindingHandlers.cssTypeahead={init:function(e,n,t){var o=t(),i=["fa","fa-user","fa-user-o"],a=function(e){var n=/([^,]+)$/.exec(e);return n&&n[1]?n[1].trim():""},r=_(i).map(function(e){return{path:e}}),l=new Bloodhound({datumTokenizer:function(e){return e.path.split(/s+/)},queryTokenizer:function(e){return e.split(/\./)},local:r});l.initialize(),$(e).typeahead({minLength:0,highlight:!0,updater:function(){return this.$element.val().replace(/[^,]*$/,"")+item+","},matcher:function(e){var n=a(this.query);return n?~e.toLowerCase().indexOf(n.toLowerCase()):!1}},{name:"css-class",displayKey:"path",source:l.ttAdapter()}).on("typeahead:closed",function(){o.value($(this).val())})}},ko.bindingHandlers.chart={init:function(e,n){var t=ko.unwrap(n()),o=require("services/datacontext"),i=t.Entity(),a=JSON.parse(t.Query()),r=t.Type(),l=new $.Deferred,c=t.Name();return o.searchAsync(i,a).done(function(n){var i=n.aggregations.category.buckets||n.aggregations.category,a=_(i).map(function(e){return{category:e.key_as_string||e.key.toString(),value:e.doc_count}}),s=_(i).map(function(e){return e.key_as_string||e.key.toString()}),u=$(e).kendoChart({theme:"metro",chartArea:{background:""},title:{text:c},legend:{position:"bottom"},seriesDefaults:{labels:{visible:!0,format:"{0}",background:"transparent",template:"#= category #: #= value#"}},series:[{type:r,data:a}],categoryAxis:{categories:s,majorGridLines:{visible:!1}},tooltip:{visible:!0,format:"{0}",template:"#= category #: #= value #"}}).data("kendoChart");l.resolve(!0),o.getScalarAsync("EntityView","Id eq '"+t.EntityViewId()+"'","Name").done(function(e){u.options.title.text=c+" ("+e+")",u.refresh()})}),l.promise()}},ko.bindingHandlers.iconPicker={init:function(e,n){var t=$(e),o=n(),i=$('<a href="#" class="btn btn-link">Pick Icon</a>');t.parent().append(i),i.click(function(e){e.preventDefault(),require(["viewmodels/icon.picker","durandal/app"],function(e,n){n.showDialog(e).done(function(n){"OK"===n&&(o(e.icon()),t.val(e.icon()))})})})}};var bespoke=bespoke||{};bespoke.observableArray=bespoke.observableArray||{},bespoke.getSingletonObservableArray=function(e){return bespoke.observableArray[e]?bespoke.observableArray[e]:(bespoke.observableArray[e]=ko.observableArray(),bespoke.observableArray[e])},ko.bindingHandlers.lookup={init:function(e,n){var t=$(e),o=n(),i=ko.unwrap(o.member);t.click(function(e){e.preventDefault(),e.stopPropagation(),require(["viewmodels/entity.lookup.dialog","durandal/app"],function(e,n){e.options(o),n.showDialog(e).done(function(n){if(n&&"OK"===n){var t=e.selected();o.value(t[i])}})})})}},ko.virtualElements.allowedBindings.lookupText=!0,bespoke.lookupText=function(e,n){var t=n(),o=ko.unwrap(t.entity),i=ko.unwrap(t.displayPath),a=ko.unwrap(t.valuePath),r=ko.unwrap(t.value),l=require("services/datacontext"),c=function(e,n){var t=ko.utils.unwrapObservable(n);(null===t||void 0===t)&&(t="");var o=ko.virtualElements.firstChild(e);!o||3!==o.nodeType||ko.virtualElements.nextSibling(o)?ko.virtualElements.setDomNodeChildren(e,[e.ownerDocument.createTextNode(t)]):o.data=t};l.getScalarAsync(o,a+" eq '"+r+"'",i).done(function(n){c(e,n),console.log(n)})},ko.bindingHandlers.lookupText={init:bespoke.lookupText,update:bespoke.lookupText},ko.bindingHandlers.readonly={init:function(e,n){var t=$(e),o=ko.unwrap(n());o?t.prop("readonly",!0):t.prop("readonly",!1)},update:function(e,n){var t=$(e),o=ko.unwrap(n());o?t.prop("readonly",!0):t.prop("readonly",!1)}};
ko.bindingHandlers.kendoEditor={init:function(e,n){var t=$(e),o=n(),a=!1;setTimeout(function(){var e=t.kendoEditor({change:function(){a||(a=!0,o(this.value()),setTimeout(function(){a=!1},500))}}).data("kendoEditor");e.value(o()),o.subscribe(function(n){a||(a=!0,e.value(n),setTimeout(function(){a=!1},500))})},500)},update2:function(e,n){var t=$(e),o=n(),a=t.data("kendoEditor");t.data("updating")||a.value(o())}},ko.bindingHandlers.kendoDropDownListValue={init:function(e,n){var t=n(),o=ko.utils.unwrapObservable(t),a=$(e).data("kendoDropDownList");a.value(o),a.bind("change",function(){var e=a.value();t(e)})},update:function(e,n){var t=n(),o=ko.utils.unwrapObservable(t);o&&$(e).data("kendoDropDownList").value(o)}},ko.bindingHandlers.source={},ko.bindingHandlers.kendoComboBox={init:function(e,n,t){var o=n(),a=t(),i=ko.utils.unwrapObservable(o),r=$(e).data("kendoComboBox")||$(e).kendoComboBox({dataSource:a.source()}).data("kendoComboBox");r.value(i),a.source.subscribe(function(e){r.dataSource.data(e)}),r.bind("change",function(){var e=r.value();o(e)})},update:function(e,n){var t=n(),o=ko.utils.unwrapObservable(t);o&&$(e).data("kendoComboBox").value(o)}},ko.bindingHandlers.decimal={},ko.bindingHandlers.money={init:function(e,n,t){var o=n(),a=t(),i=function(){return"undefined"==typeof a.decimal?2:parseInt(a.decimal)},r=$(e),l=parseFloat(ko.unwrap(o)||"0"),u=l.toFixed(i()).replace(/./g,function(e,n,t){return!n||"."===e||(t.length-n)%3?e:","+e});return"span"===e.tagName.toLowerCase()?void r.text(u):(r.val(u),void r.on("blur",function(){var e=$(this).val().replace(/,/g,"");console.log(e),o(parseFloat(e))}))},update:function(e,n,t){var o=n(),a=t(),i=function(){return"undefined"==typeof a.decimal?2:parseInt(a.decimal)},r=$(e),l=parseFloat(ko.unwrap(o)||"0"),u=l.toFixed(i()).replace(/./g,function(e,n,t){return!n||"."===e||(t.length-n)%3?e:","+e});r.val(u)}},ko.bindingHandlers.date={init:function(e,n){var t=ko.utils.unwrapObservable(n());if(!t)return $(e).text(""),void $(e).val("");var o=ko.unwrap(t.value),a=(o||"").indexOf("T")>-1?"YYYY-MM-DDTHH:mm:ss":"YYYY-MM-DD",i=ko.unwrap(t.inputFormat)||a,r=moment(o,i),l=ko.unwrap(t.invalid)||"invalid date",u=ko.unwrap(t.format)||"DD/MM/YYYY";if(t.format||"string"!=typeof ko.unwrap(t)||(o=ko.unwrap(t),r=moment(o)),$(e).on("change",function(){var e=$(this).val();t.value(e)}),!o)return $(e).text(l),void $(e).val(l);if(!r)return $(e).text(""),void $(e).val("");if(1===r.year())return $(e).text(""),void $(e).val("");var s=r.format(u).toString();s.indexOf("NaN")<0&&($(e).text(s),$(e).val(s))},update:function(e,n){var t=ko.utils.unwrapObservable(n());if(!t)return $(e).text(""),void $(e).val("");var o=ko.unwrap(t.value),a=(o||"").indexOf("T")>-1?"YYYY-MM-DDTHH:mm:ss":"YYYY-MM-DD",i=ko.unwrap(t.inputFormat)||a,r=moment(o,i),l=ko.unwrap(t.invalid)||"invalid date",u=ko.unwrap(t.format)||"DD/MM/YYYY";if(t.format||"string"!=typeof ko.unwrap(t)||(o=ko.unwrap(t),r=moment(o)),$(e).on("change",function(){var e=$(this).val();t.value(e)}),!o)return $(e).text(l),void $(e).val(l);if(!r)return $(e).text(""),void $(e).val("");if(1===r.year())return $(e).text(""),void $(e).val("");var s=r.format(u).toString();s.indexOf("NaN")<0&&($(e).text(s),$(e).val(s))}},ko.bindingHandlers.kendoUpload={init:function(e,n){var t=require(objectbuilders.datacontext),o=require(objectbuilders.logger),a=n(),i=n(),r=[];i&&"object"==typeof i&&(a=i.value,r=i.extensions),$(e).attr("name","files").kendoUpload({async:{saveUrl:"/BinaryStore/Upload",removeUrl:"/BinaryStore/Remove",autoUpload:!0},multiple:!1,error:function(e){o.logError(e,e,this,!0)},select:function(e){0!==r.length&&_(e.files).each(function(n){r.indexOf(n.extension)<0&&(o.error("Only "+r.join(",")+" files can be uploaded"),e.preventDefault())})},success:function(e){o.info("Your file has been "+e.operation);var n=e.response.storeId,i="upload"===e.operation,r="upload"!==e.operation,l=a();i&&(a(n),l&&t.post(JSON.stringify({id:l}),"/BinaryStore/Remove/")),r&&a("")},remove:function(){var e=new $.Deferred,n=JSON.stringify({id:a()});return t.post(n,"/BinaryStore/Remove/").then(function(n){e.resolve(n)}),e.promise()}})}},ko.bindingHandlers.kendoDate={init:function(e,n,t){var o=n(),a=$(e),i=t(),r=ko.unwrap(o),l=moment(r,"DD/MM/YYYY"),u=function(e){console.log(e);var n=this.value();l="string"==typeof n?moment(n,"DD/MM/YYYY"):moment(n),a.data("stop","true"),o(l.format("YYYY-MM-DD")),a.data("stop","false")},s=a.kendoDatePicker({format:"dd/MM/yyyy",change:u}).data("kendoDatePicker");return"boolean"==typeof i.enable&&(i.enable||s.enable(!1)),"function"==typeof i.enable&&"function"==typeof i.enable.subscribe&&i.enable.subscribe(function(e){s.enable(e)}),l?1===l.year()?void s.value(null):(s.value(l.toDate()),void("undefined"==typeof r&&"function"==typeof o&&o(l.format("YYYY-MM-DD")))):void s.value(null)},update:function(e,n,t){var o=$(e),a=t();if("true"!==o.data("stop")){var i=n(),r=ko.utils.unwrapObservable(i),l=moment(r),u=o.data("kendoDatePicker");if(!l)return void u.value(null);if(1===l.year())return void u.value(null);"boolean"==typeof a.enable&&(a.enable||u.enable(!1)),"function"==typeof a.enable&&"function"==typeof a.enable.subscribe&&a.enable.subscribe(function(e){u.enable(e)}),u.value(l.toDate())}}},ko.bindingHandlers.kendoDateTime={init:function(e,n){var t=n(),o=$(e),a=ko.utils.unwrapObservable(t),i=moment(a,"DD/MM/YYYY "),r=function(e){console.log(e);var n=this.value();i="string"==typeof n?moment(n,"DD/MM/YYYY hh:mm"):moment(n),o.data("stop","true"),t(i.format()),o.data("stop","false")},l=o.kendoDateTimePicker({format:"dd/MM/yyyy HH:mm",change:r}).data("kendoDateTimePicker");return i?1===i.year()?void l.value(null):void l.value(i.toDate()):void l.value(null)},update:function(e,n){var t=$(e);if("true"!==t.data("stop")){var o=n(),a=ko.utils.unwrapObservable(o),i=moment(a),r=t.data("kendoDateTimePicker");return i?1===i.year()?void r.value(null):void r.value(i.toDate()):void r.value(null)}}},ko.bindingHandlers.slideVisible={init:function(e,n){var t=n();$(e).toggle(ko.utils.unwrapObservable(t))},update:function(e,n){var t=n();ko.utils.unwrapObservable(t)?$(e).slideDown():$(e).slideUp()}},ko.bindingHandlers.kendoEnable={init:function(e,n){var t=n(),o=ko.utils.unwrapObservable(t);o?$(e).removeClass("k-state-disabled"):$(e).addClass("k-state-disabled")},update:function(e,n){var t=n(),o=ko.utils.unwrapObservable(t);o?($(e).removeClass("k-state-disabled"),$(e).removeAttr("disabled")):($(e).addClass("k-state-disabled"),$(e).attr("disabled","disabled"))}},ko.bindingHandlers.command={init:function(e,n,t,o){var a=n(),i=$(e),r=t(),l=i.val(),u=require("services/logger");if(r.isvisible){var s="function"==typeof r.isvisible?r.isvisible():r.isvisible;s?i.show():i.hide(),"function"==typeof r.isvisible&&r.isvisible.subscribe(function(e){e?i.show():i.hide()})}var d=$("<i class='fa fa-spin fa-circle-o-notch'></i>").hide(),c=$("<i class='fa fa-warning' style='color:red'></i>").hide();i.append(d),i.append(c),i.click(function(e){e.preventDefault(),(!this.form||this.form.checkValidity())&&(d.show(),c.hide(),a(o,e).fail(function(e,n,t){return i.button("complete").prop("disabled",!1).val(l).removeClass("btn-disabled"),d.hide(),c.show(),404===e.status?(u.error(t),void u.error(e.statusText)):(e.responseText&&(u.error(e.responseText),console.error(e.responseText)),void(e.responseJSON&&(u.error(JSON.stringify(e.responseJSON)),console.error(e.responseJson))))}).done(function(){i.button("complete").prop("disabled",!1).val(l).removeClass("btn-disabled"),d.hide()}),i.data("loading-text")&&i.button("loading"),i.addClass("btn-disabled").prop("disabled",!0))})}},ko.bindingHandlers.field={init:function(){}},ko.bindingHandlers.unwrapClick={init:function(e,n,t){var o=n(),a=$(e),i=t();a.click(function(e){e.preventDefault();var n=i.property,t=i.accessor,a=i.field,r=i.entity;n?("undefined"==typeof t[n]&&console.log("Can't figure out the accessor.prop"),"object"==typeof t[n]&&(t[n]=ko.observable(t[n])),"function"==typeof t[n]&&o(t[n],a,r)):o(t,a,r)})}},ko.bindingHandlers.fieldImage={init:function(e,n){var t=n(),o=$(e),a="function"==typeof t?t():t;o.attr("src","/image/index/"+a)}},ko.bindingHandlers.stringArrayAutoComplete={init:function(e,n,t){var o=n(),a=t(),i=a.data();$(e).data("kendoAutoComplete")||$(e).kendoAutoComplete({dataSource:i,change:function(){var e=_(this.value().split(",")).filter(function(e){return e});o(e)},filter:"startswith",placeholder:"....",separator:","}).val(o())},update:function(e,n){var t=n();$(e).data("kendoAutoComplete").value(t())}},ko.bindingHandlers.pathAutoComplete={init:function(e,n){var t=n(),o=t.value,a=t.type;a()&&$.get("/App/TriggerPathPickerJson/"+a()).done(function(n){var t=JSON.parse(n),a=_.chain(t).map(function(e){return""===e.parent?e.name:void 0}).filter(function(e){return"undefined"!=typeof e}).value();console.log(a);var i=new kendo.data.DataSource({data:a}),r=$(e).data("kendoAutoComplete")||$(e).kendoAutoComplete({dataSource:t,dataTextField:"path",change:function(){var e=this.value();console.log("selected path ",e)},filter:"startswith",placeholder:"Select path...",separator:""}).data("kendoAutoComplete");$(e).change(function(){o($(this).val()),console.log("new value",o())}).val(o()).on("keydown3",function(e){if(110===e.which||190===e.which){var n=$(this).val()+".";console.log("show the auto complete",n);var o=_.chain(t).filter(function(e){return e.parent===n}).map(function(e){return e.name}).value();console.log(o),i.data(o),r.refresh()}})})}},ko.bindingHandlers.commandWithParameter={init:function(e,n){var t=n(),o=t.command,a=t.parameter||t.commandParameter,i=$(e),r=i.data("complete-text")||i.html();i.click(function(e){e.preventDefault(),o(a).then(function(){i.button("complete"),"BUTTON"===i.get(0).tagName||"A"===i.get(0).tagName?i.html(r):i.val(r)}),i.data("loading-text")&&i.button("loading")})}},ko.bindingHandlers.filter={init:function(e,n,t){var o=n(),a=t(),i=o.path,r=o.tooltip||"Type to filter current page or type and [ENTER] to search the whole view",l=$(e),u=$('<input data-toggle="tooltip" title="'+r+'" type="search" class="search-query input-medium form-control" placeholder="Filter.. ">'),s=$("<a href='/#' title='Carian server'><i class='add-on icon-search'></i><a>"),d=$("<form class='form-search row'> <div class='input-group pull-right' style='width:300px'><span class='input-group-addon'> <span class='glyphicon glyphicon-remove'></span></span> </div> </form>"),c=a.searchPaging;d.find("span.input-group-addon").before(u),c&&d.find("span.glyphicon-remove").after(s),l.before(d),d.submit(function(e){e.preventDefault();var n=u.val().toLowerCase(),t=new $.Deferred;return n&&c&&"undefined"!=typeof c.query&&"function"==typeof c.query.filterAndSearch?c.query.filterAndSearch(n):t.promise()});var f=function(){var e=l.find(i),n=u.val().toLowerCase();e.each(function(){var e=$(this),t=e.text().toLowerCase().trim();t||($("input",e).each(function(e,n){t+=" "+$(n).val()}),t=t.toLowerCase().trim()),t.indexOf(n)>-1?e.show():e.hide()})},p=_.throttle(f,800);u.on("keyup",p).siblings("span.input-group-addon").click(function(){u.val(""),f()}),u.val()&&f(),u.tooltip()}},ko.bindingHandlers.serverPaging={init:function(e,n,t,o){var a=n(),i=a.entity,r=a.query,l=a.list,u=a.map,s=a.pagerHidden||!1,d=$(e),c=require("services/datacontext"),f=$("<div></div>"),p=$('<img src="/Images/spinner-md.gif" alt="loading" class="absolute-center" />'),v=function(){p.show(),d.fadeTo("fast",.33)},m=function(){p.hide(),d.fadeTo("fast",1)},b=function(e){u&&(e=_(e).map(u)),"string"==typeof l&&o[l](e),"function"==typeof l&&l(e)},g=function(e,n){v(),c.loadAsync({entity:i,page:e,size:n,includeTotal:!0},r).then(function(e){b(e.itemCollection),m()})};d.after(f).after(p).fadeTo("slow",.33);var h=new $.Deferred;return c.loadAsync({entity:i,page:1,size:20,includeTotal:!0},r).then(function(e){var n={element:f,count:e.rows,changed:g,hidden:s},t=new bespoke.utils.ServerPager(n);console.log(t),setTimeout(function(){b(e.itemCollection),h.resolve(!0),m()},500)}),h.promise()}},ko.bindingHandlers.searchPaging={init:function(e,n,t,o){var a=n(),i=a.entity,r=a.query,l=a.query||a.initialQuery||{},u=a.list,s=a.map,d=a.pagerHidden||!1,c=a.searchButton,f=$(e),p=require("services/datacontext"),v=require("services/logger"),m=require(objectbuilders.cultures),b=$("<div></div>"),g=$('<img src="/Images/spinner-md.gif" alt="loading" class="absolute-center" />'),h=function(){g.show(),f.fadeTo("fast",.33)},k=function(){g.hide(),f.fadeTo("fast",1)},y=null,w=function(e){d||_(e).each(function(e){e.pager={page:y.page(),size:y.pageSize()}}),s&&(e=_(e).map(s)),"string"==typeof u&&o[u](e),"function"==typeof u&&u(e)},D=function(e,n){h(),p.searchAsync({entity:i,page:e,size:n},l).then(function(e){w(e.itemCollection),k()})},Y=function(e,n,t){l=e;var o=new $.Deferred;return h(),p.searchAsync({entity:i,page:n||1,size:t||20},e).then(function(e){if(y)y.update(e.rows);else{var n={element:b,count:e.rows,changed:D,hidden:d};y=new bespoke.utils.ServerPager(n)}setTimeout(function(){w(e.itemCollection),o.resolve(e),k()},500)}),o.promise()},x=function(e){var n=JSON.parse(ko.toJSON(a.query||a.initialQuery)),t={from:0,size:20,query:{}};n.query=n.query||{},n.query.filtered=n.query.filtered||{},t.query.filtered=n.query.filtered,t.query.filtered.query={query_string:{default_field:"_all",query:e}},n.query.bool&&(t.filter=t.filter||{},t.filter.bool=n.query.bool),t.sort=n.sort,y.destroy(),y=null,Y(t)};return"function"==typeof r.subscribe&&r.subscribe(function(e){Y(e,1,20)}),r.search=Y,r.filterAndSearch=x,f.after(b).after(g).fadeTo("slow",.33),c&&$(document).on("click",c,function(e){return e.preventDefault(),$(this).parents("form")[0].checkValidity()?void Y(ko.toJS(r),1,y.pageSize()):void v.error(m.messages.FORM_IS_NOT_VALID)}),Y(ko.toJS(l)),{search:Y,filterAndSearch:x}}};
ko.bindingHandlers.bootstrapDropDown={init:function(t,e){var n=ko.unwrap(e())||"[Select your value]",o=$(t),i=!1,r=function(t){t.preventDefault(),t.stopPropagation();var e=$(this);i?(e.parent().removeClass("open"),i=!1):(e.parent().addClass("open"),i=!0,$(document).one("click",function(){e.parent().removeClass("open"),i=!1}))};o.click(r),o.html()||("[object Object]"===n.toString()&&(n="[Select you value]"),o.html(n+' <i class="fa fa-caret-down"></i>'))}},ko.bindingHandlers.tooltip={init:function(t,e){var n=ko.unwrap(e());$(t).tooltip({title:n})}},ko.bindingHandlers.bootstrapPopover={init:function(t,e){var n=ko.unwrap(e());$(t).popover({content:"<pre>"+n+"</pre>",html:!0})}},ko.bindingHandlers.popover={init:function(t,e){var n=ko.unwrap(e());$(t).popover({content:"<pre>"+n+"</pre>",html:!0})}},ko.bindingHandlers.bootstrapTooltip={init:function(t,e){var n=ko.unwrap(e());$(t).tooltip({title:n})}},ko.bindingHandlers.cssAutoComplete={init:function(t,e){var n=e(),o=_(document.styleSheets).find(function(t){return t&&t.href?t.href.indexOf("bootstrap")>-1:!1}),i=["btn","btn-warning","btn-success","btn-link"];o&&(i=_.chain(o.rules).filter(function(t){return/^\./g.test(t.selectorText)&&!/:/g.test(t.selectorText)&&!/\s/g.test(t.selectorText)&&!/\+/g.test(t.selectorText)&&!/>/g.test(t.selectorText)&&!/\[/g.test(t.selectorText)}).map(function(t){return t.selectorText.replace(/\./g,"")}).value()),$(t).typeahead({name:"css_class",limit:10,local:i}).on("typeahead:closed",function(){n($(this).val())})}},ko.bindingHandlers.autocomplete={init:function(t,e,n){var o=ko.unwrap(e()),i=ko.unwrap(o.entity),r=ko.unwrap(o.field),a=ko.unwrap(o.query),l=o.ttl||3e5,s=n(),c=String.format("/list?table={0}&column={1}&filter={2}",i,r,a),p=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:c,tt1:l,filter:function(t){return _(t).map(function(t){return{name:t}})}}});p.initialize(),$(t).typeahead(null,{name:"autocomplete_"+$(t).prop("id"),displayKey:"name",source:p.ttAdapter()}).on("typeahead:closed",function(){s.value($(this).val())})}},ko.bindingHandlers.scroll={init:function(t,e){ko.unwrap(e())}};
!function(){Function.prototype.partial=function(){var t=this,n=Array.prototype.slice.call(arguments);return function(){for(var r=0,a=0;a<n.length&&r<arguments.length;a++)void 0===n[a]&&(n[a]=arguments[r++]);return t.apply(this,n)}}}();
!function(e){e.bespoke=e.bespoke||{},e.bespoke.ServerOperationStatus={OK:"OK",ERROR:"ERROR"},e.bespoke.messagesText={SAVE_SUCCESS:"Your item has been saved"}}(window);
var _uiready=function(){var n=function(n){};return{init:n}}();
!function(o,e){o.bespoke=o.bespoke||{},bespoke.utils=bespoke.utils||{},bespoke.utils.form=bespoke.utils.form||{},bespoke.utils.form.checkValidity=function(o){if(o.form)return o.form.checkValidity();var t=e(o).attr("form");if(t)return document.getElementById(t).checkValidity();throw"cannot find the form for the button"},o.console=o.console||{},o.console.dir=o.console.dir||function(){}}(window,jQuery);
!function(e,n){e.Task=e.Task||{},e.Task.fromResult=function(e,r){var o=new n.Deferred,s=r||100;return setTimeout(function(){o.resolve(e)},s),o.promise()}}(window,jQuery);
ko.bindingHandlers.theme={init:function(e,n,i,h,o){var p=n(),s=i(),a=ko.unwrap(p);if(bespoke.sph.Theme){var k=new bespoke.sph.Theme;k[a]&&k[a](e,h,s,o)}}};

//# sourceMappingURL=__core.min.js.map
