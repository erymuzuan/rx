!function(){$type=String,$type.__typeName="String",$type.__class=!0,$prototype=$type.prototype,$prototype.moment=function(t){return t?moment(this,t):moment(this)},$prototype.endsWith=function(t){return this.substr(this.length-t.length)===t},$prototype.startsWith=function(t){return this.substr(0,t.length)===t},$prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},$prototype.isNullOrWhiteSpace=function(t){var r=String.trim(t);return r?!1:!0},$prototype.isNullOrEmpty=function(t){return t?!1:!0},$prototype.trimEnd=function(){return this.replace(/\s+$/,"")},$prototype.trimStart=function(){return this.replace(/^\s+/,"")},$type.format=function(){return String._toFormattedString(!1,arguments)},$type._toFormattedString=function(t,r){for(var e="",n=r[0],o=0;;){var i=n.indexOf("{",o),s=n.indexOf("}",o);if(0>i&&0>s){e+=n.slice(o);break}if(s>0&&(i>s||0>i)){if("}"!==n.charAt(s+1))throw new Error("format stringFormatBraceMismatch");e+=n.slice(o,s+1),o=s+2}else if(e+=n.slice(o,i),o=i+1,"{"!==n.charAt(o)){if(0>s)throw new Error("format stringFormatBraceMismatch");var a=n.substring(o,s),p=a.indexOf(":"),u=parseInt(0>p?a:a.substring(0,p),10)+1;if(isNaN(u))throw new Error("format stringFormatInvalid");var m=0>p?"":a.substring(p+1),f=r[u];("undefined"==typeof f||null===f)&&(f=""),e+=f.toFormattedString?f.toFormattedString(m):t&&f.localeFormat?f.localeFormat(m):f.format?f.format(m):f.toString(),o=s+1}else e+="{",o++}return e}}(window);
var bespoke=bespoke||{};bespoke.utils={},bespoke.utils.ServerPager=function(e){e=e||{};var n=e.element,a=e.count||0,t=e.changed||function(){console.log("no change event")},o=this,r=_.range(a),i=new kendo.data.DataSource({data:r,pageSize:20});if(e.hidden)return o;var u=n.kendoPager({dataSource:i,pageSizes:[10,20,50]}).data("kendoPager");u.page(1),u.bind("change",function(){t&&t(u.page(),u.pageSize())}),o.update=function(e){r=[];for(var n=0;e>n;n++)r[n]=n;setTimeout(function(){i.data(r)},500)},o.destroy=function(){u.destroy(),n.empty()},o.pageSize=function(e){return e&&u.pageSize(e),u.pageSize()},o.page=function(e){return e&&u.page(e),u.page()};var c=$(n).find("select").data("kendoDropDownList");return c.bind("change",function(){try{t(1,parseInt(this.value()))}catch(e){}}),o};
ko.bindingHandlers.activityClass={init:function(t,e){var i=$(t),n=ko.unwrap(e()),o="function"==typeof n.$type?n.$type():n.$type,a=/Bespoke\.Sph\.Domain\.(.*?),/.exec(o)[1];i.addClass("activity32").addClass("activity32-"+a)}},ko.bindingHandlers.checkedItems={init:function(t,e){var i=ko.dataFor(t),n=e();$(t).change(function(){var t=$(this).is(":checked");t?n.push(i):n.remove(i)})}},ko.bindingHandlers.wdTypeaheadPath={init:function(t,e,i){var n=e(),o=i(),a=ko.unwrap(e()),r=function(){var e=ko.mapping.toJS(a),i=$(t),n=$("<div></div>").css({height:"28px"});i.hide().before(n);var r=completely(n[0],{fontSize:"12px",color:"#555;",fontFamily:'"Open Sans", Arial, Helvetica, sans-serif'});r.setText(ko.unwrap(o.value));for(var s in e)"$type"!==s&&"addChildItem"!==s&&"removeChildItem"!==s&&r.options.push(""+s);r.options.sort();var p=e;r.onChange=function(t){if(t.lastIndexOf(".")===t.length-1){r.options=[];var i=t.split(".");p=e,_(i).each(function(t){""!==t&&(p=p[t])}),console.log("currentObject",p);for(var n in p)"$type"!==n&&"addChildItem"!==n&&"removeChildItem"!==n&&r.options.push(""+n);r.options.sort(),r.startFrom=t.lastIndexOf(".")+1}r.repaint()},r.repaint(),$(r.input).attr("autocomplete","off").blur(function(){o.value($(this).val())}).parent().find("input").css({padding:"6px 12px",height:"28px"}),$(t).prop("required")&&$(r.input).prop("required",!0)};"function"==typeof n&&"function"==typeof n.subscribe&&n.subscribe(function(){$(t).typeahead("destroy"),r()}),r()}},ko.bindingHandlers.activityPopover={init:function(t,e){var i=$(t),n=ko.unwrap(e()),o="function"==typeof n.$type?n.$type():n.$type,a=/Bespoke\.Sph\.Domain\.(.*?),/.exec(o)[1],r=ko.dataFor(i.parent()[0]).wd(),s=i.popover({title:a+" : "+n.Name(),html:!0,content:function(){return $("a.edit-activity").popover("hide"),i.find("a.edit-activity").addClass(n.WebId()),i.find("a.delete-activity").addClass(n.WebId()),i.find("a.start-activity").addClass(n.WebId()),i.find("div.context-menu").html()}});s.on("shown.bs.popover",function(){setTimeout(function(){s.popover("hide")},5e3)}),$(document).on("click","a."+n.WebId(),function(t){t.preventDefault();var e=require(objectbuilders.app),i=$(this);i.hasClass("delete-activity")&&e.showMessage("Are you sure you want to remove this Activity","Remove activity",["Yes","No"]).done(function(t){"Yes"===t&&r.removeActivity(n)()}),i.hasClass("edit-activity")&&r.editActivity(n)(),i.hasClass("start-activity")&&r.setStartActivity(n)()})}},ko.bindingHandlers.comboBoxLookupOptions={init:function(t,e){var i=$(t),n=ko.unwrap(e()),o=n.value,a=n.caption,r=require("services/datacontext"),s=function(e){r.getTuplesAsync({entity:ko.unwrap(n.entity),query:e,field:ko.unwrap(n.valuePath),field2:ko.unwrap(n.displayPath)}).done(function(e){t.options.length=0,a&&t.add(new Option(a,"")),_(e).each(function(e){t.add(new Option(e.Item2,e.Item1))}),i.val(ko.unwrap(o)).on("change",function(){o(i.val())})})};s(ko.unwrap(n.query)),"function"==typeof n.query&&"function"==typeof n.query.subscribe&&n.query.subscribe(function(t){s(ko.unwrap(t))})},update:function(t,e){var i=ko.unwrap(e()),n=i.value;$(t).val(ko.unwrap(n))}};
ko.bindingHandlers.solutiontree={init:function(e,n){var t=n(),i=ko.unwrap(t.solution),o=t.click,a=t.addEntityDefinition,r=t.addForm,l=[],d=[{id:"EntityDefinition",parent:"#",text:"Entity Definitions",icon:"fa fa-file",data:{TypeName:"#"}},{id:"WorkflowDefinition",parent:"#",text:"Workflow Definitions",icon:"fa fa-file",data:{TypeName:"#"}},{id:"TransformDefinition",parent:"#",text:"Transform Definitions",icon:"fa fa-file",data:{TypeName:"#"}},{id:"Adapter",parent:"#",text:"Adapters",icon:"fa fa-file",data:{TypeName:"#"}},{id:"Trigger",parent:"#",text:"Triggers",icon:"fa fa-file",data:{TypeName:"#"}}];_.each(i.ProjectMetadataCollection(),function(e){l.push({id:ko.unwrap(e.Id),text:ko.unwrap(e.Name),parent:"EntityDefinition",icon:"fa fa-clipboard"}),_.each(e.ChildItemCollection(),function(n){var t="";switch(ko.unwrap(n.TypeName)){case"EntityForm":t="fa fa-edit";break;case"EntityOperation":t="fa fa-gavel";break;case"EntityView":t="fa fa-table";break;case"BusinessRule":t="fa fa-bold"}l.push({id:ko.unwrap(n.Id),parentId:ko.unwrap(n.ParentId),text:ko.unwrap(n.Name),parent:ko.unwrap(e.Id),icon:ko.unwrap(t),data:n})})}),$("#jstree_demo_div").jstree({core:{data:d.concat(l)},plugins:["contextmenu","search"],contextmenu:{items:function(e){return"EntityDefinition"===e.id?{Create:{label:"Add New Entity",action:function(){a()}}}:"WorkflowDefinition"===e.id?{Create:{label:"Add New Workflow Definition",action:function(){addWorkflowDefinition()}}}:"TransformDefinition"===e.id?{Create:{label:"Add New Transform Definition",action:function(){addTransformDefinition()}}}:"Adapter"===e.id?{Create:{label:"Add New Adapter",action:function(){addAdapter()}}}:"Trigger"===e.id?{Create:{label:"Add New Trigger",action:function(){addTrigger()}}}:"EntityDefinition"===e.parent?{"Create Form":{label:"Add New Form",action:function(){r(e.id)}},"Create Views":{label:"Add New View",action:function(){addView(e.id)}},"Create Operation":{label:"Add New Operation",action:function(){addOperation(e.id)}}}:void 0}}}),$("#jstree_demo_div").on("select_node.jstree",o)}},ko.bindingHandlers.tree={init:function(e,n){var t=require(objectbuilders.system),i=n(),o=ko.unwrap(i.entity),a=ko.unwrap(i.searchbox),r=i.selected,l={text:o.Name(),state:{opened:!0,selected:!0}},d=function(e){e.children=_(e.data.MemberCollection()).map(function(e){return{text:e.Name(),state:"open",type:e.TypeName(),data:e}}),_(e.children).each(d)},c=function(){l.children=_(o.MemberCollection()).map(function(e){return{text:e.Name(),state:"open",type:e.TypeName(),data:e}}),_(l.children).each(d),$(e).on("select_node.jstree",function(n,t){t.node.data&&(r(t.node.data),r().Name.subscribe(function(n){$(e).jstree(!0).rename_node(t.node,n)}),r().TypeName.subscribe(function(n){$(e).jstree(!0).set_type(t.node,n)}))}).on("create_node.jstree",function(e,n){console.log(n,"node")}).on("rename_node.jstree",function(e,n){var t=n.node.data;t.Name(n.text)}).jstree({core:{animation:0,check_callback:!0,themes:{stripes:!0},data:l},contextmenu:{items:[{label:"Add Child",action:function(){var n=new bespoke.sph.domain.Member({WebId:t.guid(),TypeName:"System.String, mscorlib",Name:"Member_Name"}),i=$(e).jstree("get_selected",!0),a=i[0].data,r={state:"open",type:"System.String, mscorlib",text:"Member_Name",data:n},l=$(e).jstree(!0),d=l.get_selected();return d.length?(d=d[0],d=l.create_node(d,r),d?(l.edit(d),a&&a.MemberCollection?a.MemberCollection.push(n):o.MemberCollection.push(n),!0):!1):!1}},{label:"Remove",action:function(){var n=$(e).jstree(!0),t=n.get_selected(),i=n.get_selected(!0)[0],a=n.get_node($("#"+i.parent)),r=a.data;if(r&&"function"==typeof r.MemberCollection){var l=_(r.MemberCollection()).find(function(e){return e.WebId()===i.data.WebId()});r.MemberCollection.remove(l)}else{var d=_(o.MemberCollection()).find(function(e){return e.WebId()===i.data.WebId()});o.MemberCollection.remove(d)}return t.length?(n.delete_node(t),!0):!1}}]},types:{"System.String, mscorlib":{icon:"glyphicon glyphicon-bold",valid_children:[]},"System.DateTime, mscorlib":{icon:"glyphicon glyphicon-calendar",valid_children:[]},"System.Int32, mscorlib":{icon:"fa fa-sort-numeric-asc",valid_children:[]},"System.Decimal, mscorlib":{icon:"glyphicon glyphicon-usd",valid_children:[]},"System.Boolean, mscorlib":{icon:"glyphicon glyphicon-ok",valid_children:[]},"System.Object, mscorlib":{icon:"fa fa-building-o"},"System.Array, mscorlib":{icon:"glyphicon glyphicon-list"}},plugins:["contextmenu","dnd","types","search"]})};c();var s=!1;$(a).keyup(function(){s&&clearTimeout(s),s=setTimeout(function(){var n=$(a).val();$(e).jstree(!0).search(n)},250)})}},ko.bindingHandlers.help={init:function(e,n){var t=$(e),i=ko.unwrap(n());t.click(function(e){e.preventDefault(),window.open("/docs/#"+i)})}};var substringMatcher=function(e){return function(n,t){var i,o;i=[],o=new RegExp(n,"i"),$.each(e,function(e,n){o.test(n)&&i.push({value:n})}),t(i)}};ko.bindingHandlers.typeaheadUrl={init:function(e,n){var t=ko.unwrap(n()),i=3e5,o=String.format("/list?table={0}&column={1}",t[0],"Route"),a=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,remote:{url:o,tt1:i,filter:function(e){return _(e).map(function(e){return{name:e}})}}});a.initialize(),$(e).typeahead(null,{name:"EntityView_"+$(e).prop("id"),displayKey:"name",source:a.ttAdapter()})}},ko.bindingHandlers.entityTypeaheadPath={init:function(e,n,t){var i=n(),o=require(objectbuilders.datacontext),a=require(objectbuilders.config),r=t(),l=ko.unwrap(n())||window.typeaheadEntity,d=function(n){var t=n.name||n,i=n.id||n,o=ko.toJS(bespoke[a.applicationName+"_"+i.toLowerCase()].domain[t]()),l=$(e),d=$("<div></div>").css({height:"28px"});l.hide().before(d);var c=completely(d[0],{fontSize:"12px",color:"#555;",fontFamily:'"Open Sans", Arial, Helvetica, sans-serif'});c.setText(ko.unwrap(r.value));for(var s in o)"$type"!==s&&"addChildItem"!==s&&"removeChildItem"!==s&&c.options.push(""+s);c.options.sort();var u=o;c.onChange=function(e){if(e.lastIndexOf(".")===e.length-1){c.options=[];var n=e.split(".");u=o,_(n).each(function(e){""!==e&&(u=u[e])}),console.log("currentObject",u);for(var t in u)"$type"!==t&&"addChildItem"!==t&&"removeChildItem"!==t&&c.options.push(""+t);c.options.sort(),c.startFrom=e.lastIndexOf(".")+1}c.repaint()},c.repaint(),$(c.input).attr("autocomplete","off").blur(function(){r.value($(this).val())}).parent().find("input").css({padding:"6px 12px",height:"28px"}),$(e).prop("required")&&$(c.input).prop("required",!0)};l&&o.loadOneAsync("EntityDefinition","Name eq '"+l+"' OR id eq '"+l+"'","Id").done(function(e){d({name:e.Name(),id:e.Id()})}),"function"==typeof i&&"function"==typeof i.subscribe&&i.subscribe(function(n){$(e).typeahead("destroy"),d(n)})}},ko.bindingHandlers.cssTypeahead={init:function(e,n,t){var i=t(),o=["fa","fa-user","fa-user-o"],a=function(e){var n=/([^,]+)$/.exec(e);return n&&n[1]?n[1].trim():""},r=_(o).map(function(e){return{path:e}}),l=new Bloodhound({datumTokenizer:function(e){return e.path.split(/s+/)},queryTokenizer:function(e){return e.split(/\./)},local:r});l.initialize(),$(e).typeahead({minLength:0,highlight:!0,updater:function(){return this.$element.val().replace(/[^,]*$/,"")+item+","},matcher:function(e){var n=a(this.query);return n?~e.toLowerCase().indexOf(n.toLowerCase()):!1}},{name:"css-class",displayKey:"path",source:l.ttAdapter()}).on("typeahead:closed",function(){i.value($(this).val())})}},ko.bindingHandlers.chart={init:function(e,n){var t=ko.unwrap(n()),i=require("services/datacontext"),o=t.Entity(),a=JSON.parse(t.Query()),r=t.Type(),l=new $.Deferred,d=t.Name();return i.searchAsync(o,a).done(function(n){var o=n.aggregations.category.buckets||n.aggregations.category,a=_(o).map(function(e){return{category:e.key_as_string||e.key.toString(),value:e.doc_count}}),c=_(o).map(function(e){return e.key_as_string||e.key.toString()}),s=$(e).kendoChart({theme:"metro",chartArea:{background:""},title:{text:d},legend:{position:"bottom"},seriesDefaults:{labels:{visible:!0,format:"{0}",background:"transparent",template:"#= category #: #= value#"}},series:[{type:r,data:a}],categoryAxis:{categories:c,majorGridLines:{visible:!1}},tooltip:{visible:!0,format:"{0}",template:"#= category #: #= value #"}}).data("kendoChart");l.resolve(!0),i.getScalarAsync("EntityView","Id eq '"+t.EntityViewId()+"'","Name").done(function(e){s.options.title.text=d+" ("+e+")",s.refresh()})}),l.promise()}},ko.bindingHandlers.iconPicker={init:function(e,n){var t=$(e),i=n(),o=$('<a href="#" class="btn btn-link">Pick Icon</a>');t.parent().append(o),o.click(function(e){e.preventDefault(),require(["viewmodels/icon.picker","durandal/app"],function(e,n){n.showDialog(e).done(function(n){"OK"===n&&(i(e.icon()),t.val(e.icon()))})})})}};var bespoke=bespoke||{};bespoke.observableArray=bespoke.observableArray||{},bespoke.getSingletonObservableArray=function(e){return bespoke.observableArray[e]?bespoke.observableArray[e]:(bespoke.observableArray[e]=ko.observableArray(),bespoke.observableArray[e])},ko.bindingHandlers.lookup={init:function(e,n){var t=$(e),i=n(),o=ko.unwrap(i.member);t.click(function(e){e.preventDefault(),e.stopPropagation(),require(["viewmodels/entity.lookup.dialog","durandal/app"],function(e,n){e.options(i),n.showDialog(e).done(function(n){if(n&&"OK"===n){var t=e.selected();i.value(t[o])}})})})}},ko.virtualElements.allowedBindings.lookupText=!0,bespoke.lookupText=function(e,n){var t=n(),i=ko.unwrap(t.entity),o=ko.unwrap(t.displayPath),a=ko.unwrap(t.valuePath),r=ko.unwrap(t.value),l=require("services/datacontext"),d=function(e,n){var t=ko.utils.unwrapObservable(n);(null===t||void 0===t)&&(t="");var i=ko.virtualElements.firstChild(e);!i||3!==i.nodeType||ko.virtualElements.nextSibling(i)?ko.virtualElements.setDomNodeChildren(e,[e.ownerDocument.createTextNode(t)]):i.data=t};l.getScalarAsync(i,a+" eq '"+r+"'",o).done(function(n){d(e,n),console.log(n)})},ko.bindingHandlers.lookupText={init:bespoke.lookupText,update:bespoke.lookupText},ko.bindingHandlers.readonly={init:function(e,n){var t=$(e),i=ko.unwrap(n());i?t.prop("readonly",!0):t.prop("readonly",!1)},update:function(e,n){var t=$(e),i=ko.unwrap(n());i?t.prop("readonly",!0):t.prop("readonly",!1)}};
ko.bindingHandlers.kendoEditor={init:function(e,n){var t=$(e),a=n(),o=!1;setTimeout(function(){var e=t.kendoEditor({change:function(){o||(o=!0,a(this.value()),setTimeout(function(){o=!1},500))}}).data("kendoEditor");e.value(a()),a.subscribe(function(n){o||(o=!0,e.value(n),setTimeout(function(){o=!1},500))})},500)},update2:function(e,n){var t=$(e),a=n(),o=t.data("kendoEditor");t.data("updating")||o.value(a())}},ko.bindingHandlers.kendoDropDownListValue={init:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t),o=$(e).data("kendoDropDownList");o.value(a),o.bind("change",function(){var e=o.value();t(e)})},update:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t);a&&$(e).data("kendoDropDownList").value(a)}},ko.bindingHandlers.source={},ko.bindingHandlers.kendoComboBox={init:function(e,n,t){var a=n(),o=t(),i=ko.utils.unwrapObservable(a),r=$(e).data("kendoComboBox")||$(e).kendoComboBox({dataSource:o.source()}).data("kendoComboBox");r.value(i),o.source.subscribe(function(e){r.dataSource.data(e)}),r.bind("change",function(){var e=r.value();a(e)})},update:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t);a&&$(e).data("kendoComboBox").value(a)}},ko.bindingHandlers.decimal={},ko.bindingHandlers.money={init:function(e,n,t){var a=n(),o=t(),i=function(){return"undefined"==typeof o.decimal?2:parseInt(o.decimal)},r=$(e),l=parseFloat(ko.unwrap(a)||"0"),u=l.toFixed(i()).replace(/./g,function(e,n,t){return!n||"."===e||(t.length-n)%3?e:","+e});return"span"===e.tagName.toLowerCase()?void r.text(u):(r.val(u),void r.on("blur",function(){var e=$(this).val().replace(/,/g,"");console.log(e),a(parseFloat(e))}))},update:function(e,n,t){var a=n(),o=t(),i=function(){return"undefined"==typeof o.decimal?2:parseInt(o.decimal)},r=$(e),l=parseFloat(ko.unwrap(a)||"0"),u=l.toFixed(i()).replace(/./g,function(e,n,t){return!n||"."===e||(t.length-n)%3?e:","+e});r.val(u)}},ko.bindingHandlers.date={init:function(e,n){var t=ko.utils.unwrapObservable(n()),a=ko.unwrap(t.value),o=ko.unwrap(t.inputFormat)||"YYYY-MM-DD",i=moment(a,o),r=ko.unwrap(t.invalid)||"invalid date",l=ko.unwrap(t.format)||"DD/MM/YYYY";if(t.format||"string"!=typeof ko.unwrap(t)||(a=ko.unwrap(t),i=moment(a)),$(e).on("change",function(){var e=$(this).val();t.value(e)}),!a)return $(e).text(r),void $(e).val(r);if(!i)return $(e).text(""),void $(e).val("");if(1==i.year())return $(e).text(""),void $(e).val("");var u=i.format(l).toString();u.indexOf("NaN")<0&&($(e).text(u),$(e).val(u))},update:function(e,n){var t=ko.utils.unwrapObservable(n()),a=ko.unwrap(t.value),o=ko.unwrap(t.inputFormat)||"YYYY-MM-DD",i=moment(a,o),r=ko.unwrap(t.invalid)||"invalid date",l=ko.unwrap(t.format)||"DD/MM/YYYY";if(t.format||"string"!=typeof ko.unwrap(t)||(a=ko.unwrap(t),i=moment(a)),$(e).on("change",function(){var e=$(this).val();t.value(e)}),!a)return $(e).text(r),void $(e).val(r);if(!i)return $(e).text(""),void $(e).val("");if(1==i.year())return $(e).text(""),void $(e).val("");var u=i.format(l).toString();u.indexOf("NaN")<0&&($(e).text(u),$(e).val(u))}},ko.bindingHandlers.kendoUpload={init:function(e,n){var t=require(objectbuilders.datacontext),a=require(objectbuilders.logger),o=n(),i=n(),r=[];"object"==typeof i&&(o=i.value,r=i.extensions),$(e).attr("name","files").kendoUpload({async:{saveUrl:"/BinaryStore/Upload",removeUrl:"/BinaryStore/Remove",autoUpload:!0},multiple:!1,error:function(e){a.logError(e,e,this,!0)},select:function(e){0!==r.length&&_(e.files).each(function(n){r.indexOf(n.extension)<0&&(a.error("Only "+r.join(",")+" files can be uploaded"),e.preventDefault())})},success:function(e){a.info("Your file has been "+e.operation);var n=e.response.storeId,i="upload"===e.operation,r="upload"!=e.operation,l=o();i&&(o(n),l&&t.post(JSON.stringify({id:l}),"/BinaryStore/Remove/")),r&&o("")},remove:function(){var e=new $.Deferred,n=JSON.stringify({id:o()});return t.post(n,"/BinaryStore/Remove/").then(function(n){e.resolve(n)}),e.promise()}})}},ko.bindingHandlers.kendoDate={init:function(e,n,t){var a=n(),o=$(e),i=t(),r=ko.unwrap(a),l=moment(r,"DD/MM/YYYY"),u=function(e){console.log(e);var n=this.value();l="string"==typeof n?moment(n,"DD/MM/YYYY"):moment(n),o.data("stop","true"),a(l.format("YYYY-MM-DD")),o.data("stop","false")},d=o.kendoDatePicker({format:"dd/MM/yyyy",change:u}).data("kendoDatePicker");return"boolean"==typeof i.enable&&(i.enable||d.enable(!1)),"function"==typeof i.enable&&"function"==typeof i.enable.subscribe&&i.enable.subscribe(function(e){d.enable(e)}),l?1===l.year()?void d.value(null):(d.value(l.toDate()),void("undefined"==typeof r&&"function"==typeof a&&a(l.format("YYYY-MM-DD")))):void d.value(null)},update:function(e,n,t){var a=$(e),o=t();if("true"!=a.data("stop")){var i=n(),r=ko.utils.unwrapObservable(i),l=moment(r),u=a.data("kendoDatePicker");if(!l)return void u.value(null);if(1==l.year())return void u.value(null);"boolean"==typeof o.enable&&(o.enable||u.enable(!1)),"function"==typeof o.enable&&"function"==typeof o.enable.subscribe&&o.enable.subscribe(function(e){u.enable(e)}),u.value(l.toDate())}}},ko.bindingHandlers.kendoDateTime={init:function(e,n){var t=n(),a=$(e),o=ko.utils.unwrapObservable(t),i=moment(o,"DD/MM/YYYY "),r=function(e){console.log(e);var n=this.value();i="string"==typeof n?moment(n,"DD/MM/YYYY hh:mm"):moment(n),a.data("stop","true"),t(i.format()),a.data("stop","false")},l=a.kendoDateTimePicker({format:"dd/MM/yyyy HH:mm",change:r}).data("kendoDateTimePicker");return i?1===i.year()?void l.value(null):void l.value(i.toDate()):void l.value(null)},update:function(e,n){var t=$(e);if("true"!=t.data("stop")){var a=n(),o=ko.utils.unwrapObservable(a),i=moment(o),r=t.data("kendoDateTimePicker");return i?1==i.year()?void r.value(null):void r.value(i.toDate()):void r.value(null)}}},ko.bindingHandlers.slideVisible={init:function(e,n){var t=n();$(e).toggle(ko.utils.unwrapObservable(t))},update:function(e,n){var t=n();ko.utils.unwrapObservable(t)?$(e).slideDown():$(e).slideUp()}},ko.bindingHandlers.kendoEnable={init:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t);a?$(e).removeClass("k-state-disabled"):$(e).addClass("k-state-disabled")},update:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t);a?($(e).removeClass("k-state-disabled"),$(e).removeAttr("disabled")):($(e).addClass("k-state-disabled"),$(e).attr("disabled","disabled"))}},ko.bindingHandlers.command={init:function(e,n,t){var a=n(),o=$(e),i=t(),r=o.val();if(i.isvisible){var l="function"==typeof i.isvisible?i.isvisible():i.isvisible;l?o.show():o.hide(),"function"==typeof i.isvisible&&i.isvisible.subscribe(function(e){e?o.show():o.hide()})}var u=$("<i class='fa fa-spin fa-spinner'></i>").hide();o.append(u),o.click(function(e){e.preventDefault(),(!this.form||this.form.checkValidity())&&(u.show(),a().then(function(){o.button("complete").prop("disabled",!1).val(r).removeClass("btn-disabled"),u.hide()}),o.data("loading-text")&&o.button("loading"),o.addClass("btn-disabled").prop("disabled",!0))})}},ko.bindingHandlers.field={init:function(){}},ko.bindingHandlers.unwrapClick={init:function(e,n,t){var a=n(),o=$(e),i=t();o.click(function(e){e.preventDefault();var n=i.property,t=i.accessor,o=i.field,r=i.entity;n?("undefined"==typeof t[n]&&console.log("Can't figure out the accessor.prop"),"object"==typeof t[n]&&(t[n]=ko.observable(t[n])),"function"==typeof t[n]&&a(t[n],o,r)):a(t,o,r)})}},ko.bindingHandlers.fieldImage={init:function(e,n){var t=n(),a=$(e),o="function"==typeof t?t():t;a.attr("src","/image/index/"+o)}},ko.bindingHandlers.stringArrayAutoComplete={init:function(e,n,t){var a=n(),o=t(),i=o.data();$(e).data("kendoAutoComplete")||$(e).kendoAutoComplete({dataSource:i,change:function(){var e=_(this.value().split(",")).filter(function(e){return e});a(e)},filter:"startswith",placeholder:"....",separator:","}).val(a())},update:function(e,n){var t=n();$(e).data("kendoAutoComplete").value(t())}},ko.bindingHandlers.pathAutoComplete={init:function(e,n){var t=n(),a=t.value,o=t.type;o()&&$.get("/App/TriggerPathPickerJson/"+o()).done(function(n){var t=JSON.parse(n),o=_.chain(t).map(function(e){return""===e.parent?e.name:void 0}).filter(function(e){return"undefined"!=typeof e}).value();console.log(o);var i=new kendo.data.DataSource({data:o}),r=$(e).data("kendoAutoComplete")||$(e).kendoAutoComplete({dataSource:t,dataTextField:"path",change:function(){var e=this.value();console.log("selected path ",e)},filter:"startswith",placeholder:"Select path...",separator:""}).data("kendoAutoComplete");$(e).change(function(){a($(this).val()),console.log("new value",a())}).val(a()).on("keydown3",function(e){if(110===e.which||190===e.which){var n=$(this).val()+".";console.log("show the auto complete",n);var a=_.chain(t).filter(function(e){return e.parent===n}).map(function(e){return e.name}).value();console.log(a),i.data(a),r.refresh()}})})}},ko.bindingHandlers.commandWithParameter={init:function(e,n){var t=n(),a=t.command,o=t.commandParameter,i=$(e),r=i.data("complete-text")||i.html();i.click(function(e){e.preventDefault(),a(o).then(function(){i.button("complete"),"BUTTON"==i.get(0).tagName||"A"==i.get(0).tagName?i.html(r):i.val(r)}),i.data("loading-text")&&i.button("loading")})}},ko.bindingHandlers.filter={init:function(e,n,t){var a=n(),o=t(),i=a.path,r=a.tooltip||"Type to filter current page or type and [ENTER] to search the whole view",l="undefined"==typeof a.offset?8:parseInt(a.offset),u="col-md-"+(12-l),d="col-md-offset-"+l,s=$(e),c=$("<input data-toggle='tooltip' title='"+r+"' type='search' class='search-query input-medium form-control' placeholder='Filter.. '>"),f=$("<a href='/#' title='Carian server'><i class='add-on icon-search'></i><a>"),p=$("<form class='form-search "+u+" "+d+"'> <div class='input-group pull-right'><span class='input-group-addon'> <span class='glyphicon glyphicon-remove'></span></span> </div> </form>"),v=o.searchPaging;p.find("span.input-group-addon").before(c),v&&p.find("span.glyphicon-remove").after(f),s.before(p),p.submit(function(e){e.preventDefault();var n=c.val().toLowerCase(),t=new $.Deferred;return n&&v&&"undefined"!=typeof v.query&&"function"==typeof v.query.filterAndSearch?v.query.filterAndSearch(n):t.promise()});var m=function(){var e=s.find(i),n=c.val().toLowerCase();e.each(function(){var e=$(this);e.text().toLowerCase().indexOf(n)>-1?e.show():e.hide()})},b=_.throttle(m,800);c.on("keyup",b).siblings("span.input-group-addon").click(function(){c.val(""),m()}),c.val()&&m(),c.tooltip()}},ko.bindingHandlers.serverPaging={init:function(e,n,t,a){var o=n(),i=o.entity,r=o.query,l=o.list,u=o.map,d=o.pagerHidden||!1,s=$(e),c=require("services/datacontext"),f=$("<div></div>"),p=$('<img src="/Images/spinner-md.gif" alt="loading" class="absolute-center" />'),v=function(){p.show(),s.fadeTo("fast",.33)},m=function(){p.hide(),s.fadeTo("fast",1)},b=function(e){u&&(e=_(e).map(u)),"string"==typeof l&&a[l](e),"function"==typeof l&&l(e)},g=function(e,n){v(),c.loadAsync({entity:i,page:e,size:n,includeTotal:!0},r).then(function(e){b(e.itemCollection),m()})};s.after(f).after(p).fadeTo("slow",.33);var h=new $.Deferred;return c.loadAsync({entity:i,page:1,size:20,includeTotal:!0},r).then(function(e){var n={element:f,count:e.rows,changed:g,hidden:d},t=new bespoke.utils.ServerPager(n);console.log(t),setTimeout(function(){b(e.itemCollection),h.resolve(!0),m()},500)}),h.promise()}},ko.bindingHandlers.searchPaging={init:function(e,n,t,a){var o=n(),i=o.entity,r=o.query,l=o.query||o.initialQuery||{},u=o.list,d=o.map,s=o.pagerHidden||!1,c=o.searchButton,f=$(e),p=require("services/datacontext"),v=require("services/logger"),m=require(objectbuilders.cultures),b=$("<div></div>"),g=$('<img src="/Images/spinner-md.gif" alt="loading" class="absolute-center" />'),h=function(){g.show(),f.fadeTo("fast",.33)},k=function(){g.hide(),f.fadeTo("fast",1)},y=function(e){s||_(e).each(function(e){e.pager={page:w.page(),size:w.pageSize()}}),d&&(e=_(e).map(d)),"string"==typeof u&&a[u](e),"function"==typeof u&&u(e)},w=null,D=function(e,n){h(),p.searchAsync({entity:i,page:e,size:n},l).then(function(e){y(e.itemCollection),k()})},Y=function(e,n,t){l=e;var a=new $.Deferred;return h(),p.searchAsync({entity:i,page:n||1,size:t||20},e).then(function(e){if(w)w.update(e.rows);else{var n={element:b,count:e.rows,changed:D,hidden:s};w=new bespoke.utils.ServerPager(n)}setTimeout(function(){y(e.itemCollection),a.resolve(e),k()},500)}),a.promise()},x=function(e){var n=JSON.parse(ko.toJSON(o.query||o.initialQuery)),t={from:0,size:20,query:{}};t.query.filtered=n.query.filtered,t.query.filtered.query={query_string:{default_field:"_all",query:e}},t.sort=n.sort,w.destroy(),w=null,Y(t)};return r.search=Y,r.filterAndSearch=x,f.after(b).after(g).fadeTo("slow",.33),c&&$(document).on("click",c,function(e){return e.preventDefault(),$(this).parents("form")[0].checkValidity()?void Y(ko.toJS(r),1,w.pageSize()):void v.error(m.messages.FORM_IS_NOT_VALID)}),Y(ko.toJS(l)),{search:Y,filterAndSearch:x}}};
ko.bindingHandlers.bootstrapDropDown={init:function(t,e){var n=ko.unwrap(e())||"[Select your value]",o=$(t),i=!1,r=function(t){t.preventDefault(),t.stopPropagation();var e=$(this);i?(e.parent().removeClass("open"),i=!1):(e.parent().addClass("open"),i=!0,$(document).one("click",function(){e.parent().removeClass("open"),i=!1}))};o.click(r),o.html()||("[object Object]"===n.toString()&&(n="[Select you value]"),o.html(n+' <i class="fa fa-caret-down"></i>'))}},ko.bindingHandlers.tooltip={init:function(t,e){var n=ko.unwrap(e());$(t).tooltip({title:n})}},ko.bindingHandlers.bootstrapPopover={init:function(t,e){var n=ko.unwrap(e());$(t).popover({content:"<pre>"+n+"</pre>",html:!0})}},ko.bindingHandlers.popover={init:function(t,e){var n=ko.unwrap(e());$(t).popover({content:"<pre>"+n+"</pre>",html:!0})}},ko.bindingHandlers.bootstrapTooltip={init:function(t,e){var n=ko.unwrap(e());$(t).tooltip({title:n})}},ko.bindingHandlers.cssAutoComplete={init:function(t,e){var n=e(),o=_(document.styleSheets).find(function(t){return t&&t.href?t.href.indexOf("bootstrap")>-1:!1}),i=["btn","btn-warning","btn-success","btn-link"];o&&(i=_.chain(o.rules).filter(function(t){return!(!/^\./g.test(t.selectorText)||/:/g.test(t.selectorText)||/\s/g.test(t.selectorText)||/\+/g.test(t.selectorText)||/>/g.test(t.selectorText)||/\[/g.test(t.selectorText))}).map(function(t){return t.selectorText.replace(/\./g,"")}).value()),$(t).typeahead({name:"css_class",limit:10,local:i}).on("typeahead:closed",function(){n($(this).val())})}},ko.bindingHandlers.autocomplete={init:function(t,e,n){var o=ko.unwrap(e()),i=ko.unwrap(o.entity),r=ko.unwrap(o.field),a=ko.unwrap(o.query),l=o.ttl||3e5,s=n(),c=String.format("/list?table={0}&column={1}&filter={2}",i,r,a),p=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:c,tt1:l,filter:function(t){return _(t).map(function(t){return{name:t}})}}});p.initialize(),$(t).typeahead(null,{name:"autocomplete_"+$(t).prop("id"),displayKey:"name",source:p.ttAdapter()}).on("typeahead:closed",function(){s.value($(this).val())})}},ko.bindingHandlers.scroll={init:function(t,e){ko.unwrap(e())}};
!function(){Function.prototype.partial=function(){var t=this,n=Array.prototype.slice.call(arguments);return function(){for(var r=0,a=0;a<n.length&&r<arguments.length;a++)void 0===n[a]&&(n[a]=arguments[r++]);return t.apply(this,n)}}}();
!function(e){e.bespoke=e.bespoke||{},e.bespoke.ServerOperationStatus={OK:"OK",ERROR:"ERROR"},e.bespoke.messagesText={SAVE_SUCCESS:"Your item has been saved"}}(window);
var _uiready=function(){var n=function(){};return{init:n}}();
!function(o,e){o.bespoke=o.bespoke||{},bespoke.utils=bespoke.utils||{},bespoke.utils.form=bespoke.utils.form||{},bespoke.utils.form.checkValidity=function(o){if(o.form)return o.form.checkValidity();var t=e(o).attr("form");if(t)return document.getElementById(t).checkValidity();throw"cannot find the form for the button"},o.console=o.console||{},o.console.dir=o.console.dir||function(){}}(window,jQuery);
!function(e,n){e.Task=e.Task||{},e.Task.fromResult=function(e,r){var o=new n.Deferred,s=e||!0,t=r||100;return setTimeout(function(){o.resolve(s)},t),o.promise()}}(window,jQuery);
ko.bindingHandlers.theme={init:function(e,n,i,h,o){var p=n(),s=i(),a=ko.unwrap(p);if(bespoke.sph.Theme){var k=new bespoke.sph.Theme;k[a]&&k[a](e,h,s,o)}}};

//# sourceMappingURL=__core.min.js.map