!function(t){$type=String,$type.__typeName="String",$type.__class=!0,$prototype=$type.prototype,$prototype.endsWith=function(t){return this.substr(this.length-t.length)===t},$prototype.startsWith=function(t){return this.substr(0,t.length)===t},$prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},$prototype.trimEnd=function(){return this.replace(/\s+$/,"")},$prototype.trimStart=function(){return this.replace(/^\s+/,"")},$type.format=function(t,r){return String._toFormattedString(!1,arguments)},$type._toFormattedString=function(t,r){for(var e="",n=r[0],o=0;;){var i=n.indexOf("{",o),a=n.indexOf("}",o);if(0>i&&0>a){e+=n.slice(o);break}if(a>0&&(i>a||0>i)){if("}"!==n.charAt(a+1))throw new Error("format stringFormatBraceMismatch");e+=n.slice(o,a+1),o=a+2}else if(e+=n.slice(o,i),o=i+1,"{"!==n.charAt(o)){if(0>a)throw new Error("format stringFormatBraceMismatch");var s=n.substring(o,a),f=s.indexOf(":"),p=parseInt(0>f?s:s.substring(0,f),10)+1;if(isNaN(p))throw new Error("format stringFormatInvalid");var c=0>f?"":s.substring(f+1),u=r[p];("undefined"==typeof u||null===u)&&(u=""),e+=u.toFormattedString?u.toFormattedString(c):t&&u.localeFormat?u.localeFormat(c):u.format?u.format(c):u.toString(),o=a+1}else e+="{",o++}return e}}(window);
var bespoke=bespoke||{};bespoke.utils={},bespoke.utils.ServerPager=function(e){e=e||{};var a=e.element,n=e.count||0,t=e.sizes||[10,20,50],o=e.defaultSize||20,i=e.changed||function(){console.log("no change event")},r=this,u=_.range(n),c=new kendo.data.DataSource({data:u,pageSize:o});if(e.hidden)return r;var d=a.kendoPager({dataSource:c,pageSizes:t}).data("kendoPager");d.page(1),d.bind("change",function(){i&&i(d.page(),d.pageSize())}),r.update=function(e){u=[];for(var a=0;e>a;a++)u[a]=a;setTimeout(function(){c.data(u)},500)},r.destroy=function(){d.destroy(),a.empty()},r.pageSize=function(e){return e&&d.pageSize(e),d.pageSize()},r.page=function(e){return e&&d.page(e),d.page()};var g=$(a).find("select").data("kendoDropDownList");return g.bind("change",function(){try{i(1,parseInt(this.value()))}catch(e){}}),r};
ko.bindingHandlers.activityClass={init:function(t,e){var n=$(t),i=ko.unwrap(e()),o="function"==typeof i.$type?i.$type():i.$type,a=/Bespoke\.Sph\.Domain\.(.*?),/.exec(o)[1];n.addClass("activity32").addClass("activity32-"+a)}},ko.bindingHandlers.checkedItems={init:function(t,e){var n=ko.dataFor(t),i=e();$(t).change(function(){var t=$(this).is(":checked");t?i.push(n):i.remove(n)})}},ko.bindingHandlers.typeahead={init:function(t,e,n){var i=ko.unwrap(e()),o=n();if("undefined"!=typeof i){var a=new Bloodhound({datumTokenizer:function(t){return Bloodhound.tokenizers.whitespace(t.Path)},queryTokenizer:Bloodhound.tokenizers.nonword,prefetch:"/WorkflowDefinition/GetVariablePath/"+i});a.initialize(),$(t).typeahead({highlight:!0},{name:"schema_paths"+i,displayKey:"Path",source:a.ttAdapter()}).on("typeahead:closed",function(){o.value($(this).val())})}}},ko.bindingHandlers.activityPopover={init:function(t,e){var n=$(t),i=ko.unwrap(e()),o="function"==typeof i.$type?i.$type():i.$type,a=/Bespoke\.Sph\.Domain\.(.*?),/.exec(o)[1],r=ko.dataFor(n.parent()[0]).wd(),d=n.popover({title:a+" : "+i.Name(),html:!0,content:function(){return $("a.edit-activity").popover("hide"),n.find("a.edit-activity").addClass(i.WebId()),n.find("a.delete-activity").addClass(i.WebId()),n.find("a.start-activity").addClass(i.WebId()),n.find("div.context-menu").html()}});d.on("shown.bs.popover",function(){setTimeout(function(){d.popover("hide")},5e3)}),$(document).on("click","a."+i.WebId(),function(t){t.preventDefault();var e=require(objectbuilders.app),n=$(this);n.hasClass("delete-activity")&&e.showMessage("Are you sure you want to remove this Activity","Remove activity",["Yes","No"]).done(function(t){"Yes"===t&&r.removeActivity(i)()}),n.hasClass("edit-activity")&&r.editActivity(i)(),n.hasClass("start-activity")&&r.setStartActivity(i)()})}},ko.bindingHandlers.comboBoxLookupOptions={init:function(t,e){var n=$(t),i=ko.unwrap(e()),o=i.value,a=i.caption,r=require("services/datacontext"),d=ko.unwrap(i.displayPath),u=ko.unwrap(i.valuePath),s=function(e){var s=ko.unwrap(i.valuePath)===ko.unwrap(i.displayPath)?r.getListAsync(ko.unwrap(i.entity),e,ko.unwrap(i.valuePath)):r.getTuplesAsync({entity:ko.unwrap(i.entity),query:e,field:u,field2:d});s.done(function(e){t.options.length=0,a&&t.add(new Option(a,"")),_(e).each(function(e){return"string"==typeof e?void t.add(new Option(e,e)):"string"==typeof e.Item1&&"string"==typeof e.Item2?void t.add(new Option(e.Item2,e.Item1)):"string"==typeof e[u]&&"string"==typeof e[d]?void t.add(new Option(e[u],e[d])):void 0}),n.val(ko.unwrap(o)).on("change",function(){o(n.val())})})};s(ko.unwrap(i.query)),"function"==typeof i.query&&"function"==typeof i.query.subscribe&&i.query.subscribe(function(t){s(ko.unwrap(t))})},update:function(t,e){var n=ko.unwrap(e()),i=n.value;$(t).val(ko.unwrap(i))}};
ko.bindingHandlers.tree={init:function(e,n){var t=require(objectbuilders.system),o=n(),i=ko.unwrap(o.entity),r=ko.unwrap(o.searchbox),a=o.selected,l={text:i.Name(),state:{opened:!0,selected:!0}},c=function(e){e.children=_(e.data.MemberCollection()).map(function(e){return{text:e.Name(),state:"open",type:e.TypeName(),data:e}}),_(e.children).each(c)},s=function(){l.children=_(i.MemberCollection()).map(function(e){return{text:e.Name(),state:"open",type:e.TypeName(),data:e}}),_(l.children).each(c),$(e).on("select_node.jstree",function(n,t){t.node.data&&(a(t.node.data),a().Name.subscribe(function(n){$(e).jstree(!0).rename_node(t.node,n)}),a().TypeName.subscribe(function(n){$(e).jstree(!0).set_type(t.node,n)}))}).on("create_node.jstree",function(e,n){console.log(n,"node")}).on("rename_node.jstree",function(e,n){var t=n.node.data;t.Name(n.text)}).jstree({core:{animation:0,check_callback:!0,themes:{stripes:!0},data:l},contextmenu:{items:[{label:"Add Child",action:function(){var n=new bespoke.sph.domain.Member({WebId:t.guid(),TypeName:"System.String, mscorlib",Name:"Member_Name"}),o=$(e).jstree("get_selected",!0),r=o[0].data,a={state:"open",type:"System.String, mscorlib",text:"Member_Name",data:n},l=$(e).jstree(!0),c=l.get_selected();return c.length?(c=c[0],c=l.create_node(c,a),c?(l.edit(c),r&&r.MemberCollection?r.MemberCollection.push(n):i.MemberCollection.push(n),!0):!1):!1}},{label:"Remove",action:function(){var n=$(e).jstree(!0),t=n.get_selected(),o=n.get_selected(!0)[0],r=n.get_node($("#"+o.parent)),a=r.data;if(a&&"function"==typeof a.MemberCollection){var l=_(a.MemberCollection()).find(function(e){return e.WebId()===o.data.WebId()});a.MemberCollection.remove(l)}else{var c=_(i.MemberCollection()).find(function(e){return e.WebId()===o.data.WebId()});i.MemberCollection.remove(c)}return t.length?(n.delete_node(t),!0):!1}}]},types:{"System.String, mscorlib":{icon:"glyphicon glyphicon-bold",valid_children:[]},"System.DateTime, mscorlib":{icon:"glyphicon glyphicon-calendar",valid_children:[]},"System.Int32, mscorlib":{icon:"fa fa-sort-numeric-asc",valid_children:[]},"System.Decimal, mscorlib":{icon:"glyphicon glyphicon-usd",valid_children:[]},"System.Boolean, mscorlib":{icon:"glyphicon glyphicon-ok",valid_children:[]},"System.Object, mscorlib":{icon:"fa fa-building-o"},"System.Array, mscorlib":{icon:"glyphicon glyphicon-list"}},plugins:["contextmenu","types","search"]})};s();var u=!1;$(r).keyup(function(){u&&clearTimeout(u),u=setTimeout(function(){var n=$(r).val();$(e).jstree(!0).search(n)},250)})}},ko.bindingHandlers.help={init:function(e,n){var t=$(e),o=ko.unwrap(n());t.click(function(e){e.preventDefault(),window.open("/docs/#"+o)})}};var substringMatcher=function(e){return function(n,t){var o,i;o=[],i=new RegExp(n,"i"),$.each(e,function(e,n){i.test(n)&&o.push({value:n})}),t(o)}};ko.bindingHandlers.typeaheadUrl={init:function(e,n){var t=ko.unwrap(n()),o=3e5,i=String.format("/list?table={0}&column={1}",t[0],"Route"),r=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,remote:{url:i,tt1:o,filter:function(e){return _(e).map(function(e){return{name:e}})}}});r.initialize(),$(e).typeahead(null,{name:"EntityView_"+$(e).prop("id"),displayKey:"name",source:r.ttAdapter()})}},ko.bindingHandlers.entityTypeaheadPath={init:function(e,n,t){var o=n(),i=require(objectbuilders.datacontext),r=require(objectbuilders.config),a=t(),l=ko.unwrap(n())||window.typeaheadEntity,c=function(n){var t=n.name||n,o=n.id||n,i=ko.toJS(bespoke[r.applicationName+"_"+o.toLowerCase()].domain[t]()),l=$(e),c=$("<div></div>").css({height:"28px"});l.hide().before(c);var s=completely(c[0],{fontSize:"12px",color:"#555;",fontFamily:'"Open Sans", Arial, Helvetica, sans-serif'});s.setText(ko.unwrap(a.value));for(var u in i)if(i.hasOwnProperty(u)){if("$type"===u)continue;if("addChildItem"===u)continue;if("removeChildItem"===u)continue;s.options.push(""+u)}s.options.sort();var d=i;s.onChange=function(e){if(e.lastIndexOf(".")===e.length-1){s.options=[];var n=e.split(".");d=i,_(n).each(function(e){""!==e&&(d=d[e])}),console.log("currentObject",d);for(var t in d)if(d.hasOwnProperty(t)){if("$type"===t)continue;if("addChildItem"===t)continue;if("removeChildItem"===t)continue;s.options.push(""+t)}s.options.sort(),s.startFrom=e.lastIndexOf(".")+1}s.repaint()},s.repaint(),$(s.input).attr("autocomplete","off").blur(function(){a.value($(this).val())}).parent().find("input").css({padding:"6px 12px",height:"28px"}),$(e).prop("required")&&$(s.input).prop("required",!0)};l&&i.loadOneAsync("EntityDefinition","Name eq '"+l+"' OR id eq '"+l+"'","Id").done(function(e){c({name:e.Name(),id:e.Id()})}),"function"==typeof o&&"function"==typeof o.subscribe&&o.subscribe(function(n){$(e).typeahead("destroy"),c(n)})}},ko.bindingHandlers.cssTypeahead={init:function(e,n,t){var o=t(),i=["fa","fa-user","fa-user-o"],r=function(e){var n=/([^,]+)$/.exec(e);return n&&n[1]?n[1].trim():""},a=_(i).map(function(e){return{path:e}}),l=new Bloodhound({datumTokenizer:function(e){return e.path.split(/s+/)},queryTokenizer:function(e){return e.split(/\./)},local:a});l.initialize(),$(e).typeahead({minLength:0,highlight:!0,updater:function(){return this.$element.val().replace(/[^,]*$/,"")+item+","},matcher:function(e){var n=r(this.query);return n?~e.toLowerCase().indexOf(n.toLowerCase()):!1}},{name:"css-class",displayKey:"path",source:l.ttAdapter()}).on("typeahead:closed",function(){o.value($(this).val())})}},ko.bindingHandlers.chart={init:function(e,n){var t=ko.unwrap(n()),o=require("services/datacontext"),i=t.Entity(),r=JSON.parse(t.Query()),a=t.Type(),l=new $.Deferred,c=t.Name();return o.searchAsync(i,r).done(function(n){var i=n.aggregations.category.buckets||n.aggregations.category,r=_(i).map(function(e){return{category:e.key_as_string||e.key.toString(),value:e.doc_count}}),s=_(i).map(function(e){return e.key_as_string||e.key.toString()}),u=$(e).kendoChart({theme:"metro",chartArea:{background:""},title:{text:c},legend:{position:"bottom"},seriesDefaults:{labels:{visible:!0,format:"{0}",background:"transparent",template:"#= category #: #= value#"}},series:[{type:a,data:r}],categoryAxis:{categories:s,majorGridLines:{visible:!1}},tooltip:{visible:!0,format:"{0}",template:"#= category #: #= value #"}}).data("kendoChart");l.resolve(!0),o.getScalarAsync("EntityView","Id eq '"+t.EntityViewId()+"'","Name").done(function(e){u.options.title.text=c+" ("+e+")",u.refresh()})}),l.promise()}},ko.bindingHandlers.iconPicker={init:function(e,n){var t=$(e),o=n(),i=$('<a href="#" class="btn btn-link">Pick Icon</a>');t.parent().append(i),i.click(function(e){e.preventDefault(),require(["viewmodels/icon.picker","durandal/app"],function(e,n){n.showDialog(e).done(function(n){"OK"===n&&(o(e.icon()),t.val(e.icon()))})})})}};var bespoke=bespoke||{};bespoke.observableArray=bespoke.observableArray||{},bespoke.getSingletonObservableArray=function(e){return bespoke.observableArray[e]?bespoke.observableArray[e]:(bespoke.observableArray[e]=ko.observableArray(),bespoke.observableArray[e])},ko.bindingHandlers.lookup={init:function(e,n){var t=$(e),o=n(),i=ko.unwrap(o.member);t.click(function(e){e.preventDefault(),e.stopPropagation(),require(["viewmodels/entity.lookup.dialog","durandal/app"],function(e,n){e.options(o),n.showDialog(e).done(function(n){if(n&&"OK"===n){var t=e.selected();o.value(t[i])}})})})}},ko.virtualElements.allowedBindings.lookupText=!0,bespoke.lookupText=function(e,n){var t=n(),o=ko.unwrap(t.entity),i=ko.unwrap(t.displayPath),r=ko.unwrap(t.valuePath),a=ko.unwrap(t.value),l=require("services/datacontext"),c=function(e,n){var t=ko.utils.unwrapObservable(n);(null===t||void 0===t)&&(t="");var o=ko.virtualElements.firstChild(e);!o||3!==o.nodeType||ko.virtualElements.nextSibling(o)?ko.virtualElements.setDomNodeChildren(e,[e.ownerDocument.createTextNode(t)]):o.data=t};l.getScalarAsync(o,r+" eq '"+a+"'",i).done(function(n){c(e,n),console.log(n)})},ko.bindingHandlers.lookupText={init:bespoke.lookupText,update:bespoke.lookupText},ko.bindingHandlers.readonly={init:function(e,n){var t=$(e),o=ko.unwrap(n());o?t.prop("readonly",!0):t.prop("readonly",!1)},update:function(e,n){var t=$(e),o=ko.unwrap(n());o?t.prop("readonly",!0):t.prop("readonly",!1)}};
ko.bindingHandlers.kendoEditor={init:function(e,n){var t=$(e),a=n(),o=!1;setTimeout(function(){var e=t.kendoEditor({change:function(){o||(o=!0,a(this.value()),setTimeout(function(){o=!1},500))}}).data("kendoEditor");e.value(a()),a.subscribe(function(n){o||(o=!0,e.value(n),setTimeout(function(){o=!1},500))})},500)},update2:function(e,n){var t=$(e),a=n(),o=t.data("kendoEditor");t.data("updating")||o.value(a())}},ko.bindingHandlers.kendoDropDownListValue={init:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t),o=$(e).data("kendoDropDownList");o.value(a),o.bind("change",function(){var e=o.value();t(e)})},update:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t);a&&$(e).data("kendoDropDownList").value(a)}},ko.bindingHandlers.source={},ko.bindingHandlers.kendoComboBox={init:function(e,n,t){var a=n(),o=t(),i=ko.utils.unwrapObservable(a),r=$(e).data("kendoComboBox")||$(e).kendoComboBox({dataSource:o.source()}).data("kendoComboBox");r.value(i),o.source.subscribe(function(e){r.dataSource.data(e)}),r.bind("change",function(){var e=r.value();a(e)})},update:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t);a&&$(e).data("kendoComboBox").value(a)}},ko.bindingHandlers.decimal={},ko.bindingHandlers.money={init:function(e,n,t){var a=n(),o=t(),i=function(){return"undefined"==typeof o.decimal?2:parseInt(o.decimal)},r=$(e),l=parseFloat(ko.unwrap(a)||"0"),u=l.toFixed(i()).replace(/./g,function(e,n,t){return!n||"."===e||(t.length-n)%3?e:","+e});return"span"===e.tagName.toLowerCase()?void r.text(u):(r.val(u),void r.on("blur",function(){var e=$(this).val().replace(/,/g,"");console.log(e),a(parseFloat(e))}))},update:function(e,n,t){var a=n(),o=t(),i=function(){return"undefined"==typeof o.decimal?2:parseInt(o.decimal)},r=$(e),l=parseFloat(ko.unwrap(a)||"0"),u=l.toFixed(i()).replace(/./g,function(e,n,t){return!n||"."===e||(t.length-n)%3?e:","+e});r.val(u)}},ko.bindingHandlers.date={init:function(e,n){var t=ko.utils.unwrapObservable(n());if(!t)return $(e).text(""),void $(e).val("");var a=ko.unwrap(t.value),o=(a||"").indexOf("T")>-1?"YYYY-MM-DDTHH:mm:ss":"YYYY-MM-DD",i=ko.unwrap(t.inputFormat)||o,r=moment(a,i),l=ko.unwrap(t.invalid)||"invalid date",u=ko.unwrap(t.format)||"DD/MM/YYYY";if(t.format||"string"!=typeof ko.unwrap(t)||(a=ko.unwrap(t),r=moment(a)),$(e).on("change",function(){var e=$(this).val();t.value(e)}),!a)return $(e).text(l),void $(e).val(l);if(!r)return $(e).text(""),void $(e).val("");if(1===r.year())return $(e).text(""),void $(e).val("");var s=r.format(u).toString();s.indexOf("NaN")<0&&($(e).text(s),$(e).val(s))},update:function(e,n){var t=ko.utils.unwrapObservable(n());if(!t)return $(e).text(""),void $(e).val("");var a=ko.unwrap(t.value),o=(a||"").indexOf("T")>-1?"YYYY-MM-DDTHH:mm:ss":"YYYY-MM-DD",i=ko.unwrap(t.inputFormat)||o,r=moment(a,i),l=ko.unwrap(t.invalid)||"invalid date",u=ko.unwrap(t.format)||"DD/MM/YYYY";if(t.format||"string"!=typeof ko.unwrap(t)||(a=ko.unwrap(t),r=moment(a)),$(e).on("change",function(){var e=$(this).val();t.value(e)}),!a)return $(e).text(l),void $(e).val(l);if(!r)return $(e).text(""),void $(e).val("");if(1===r.year())return $(e).text(""),void $(e).val("");var s=r.format(u).toString();s.indexOf("NaN")<0&&($(e).text(s),$(e).val(s))}},ko.bindingHandlers.kendoUpload={init:function(e,n){var t=require(objectbuilders.datacontext),a=require(objectbuilders.logger),o=n(),i=n(),r=[];i&&"object"==typeof i&&(o=i.value,r=i.extensions),$(e).attr("name","files").kendoUpload({async:{saveUrl:"/BinaryStore/Upload",removeUrl:"/BinaryStore/Remove",autoUpload:!0},multiple:!1,error:function(e){a.logError(e,e,this,!0)},select:function(e){0!==r.length&&_(e.files).each(function(n){r.indexOf(n.extension)<0&&(a.error("Only "+r.join(",")+" files can be uploaded"),e.preventDefault())})},success:function(e){a.info("Your file has been "+e.operation);var n=e.response.storeId,i="upload"===e.operation,r="upload"!==e.operation,l=o();i&&(o(n),l&&t.post(JSON.stringify({id:l}),"/BinaryStore/Remove/")),r&&o("")},remove:function(){var e=new $.Deferred,n=JSON.stringify({id:o()});return t.post(n,"/BinaryStore/Remove/").then(function(n){e.resolve(n)}),e.promise()}})}},ko.bindingHandlers.kendoDate={init:function(e,n,t){var a=n(),o=$(e),i=t(),r=ko.unwrap(a),l=moment(r,"DD/MM/YYYY"),u=function(e){console.log(e);var n=this.value();l="string"==typeof n?moment(n,"DD/MM/YYYY"):moment(n),o.data("stop","true"),a(l.format("YYYY-MM-DD")),o.data("stop","false")},s=o.kendoDatePicker({format:"dd/MM/yyyy",change:u}).data("kendoDatePicker");return"boolean"==typeof i.enable&&(i.enable||s.enable(!1)),"function"==typeof i.enable&&"function"==typeof i.enable.subscribe&&i.enable.subscribe(function(e){s.enable(e)}),l?1===l.year()?void s.value(null):(s.value(l.toDate()),void("undefined"==typeof r&&"function"==typeof a&&a(l.format("YYYY-MM-DD")))):void s.value(null)},update:function(e,n,t){var a=$(e),o=t();if("true"!==a.data("stop")){var i=n(),r=ko.utils.unwrapObservable(i),l=moment(r),u=a.data("kendoDatePicker");if(!l)return void u.value(null);if(1===l.year())return void u.value(null);"boolean"==typeof o.enable&&(o.enable||u.enable(!1)),"function"==typeof o.enable&&"function"==typeof o.enable.subscribe&&o.enable.subscribe(function(e){u.enable(e)}),u.value(l.toDate())}}},ko.bindingHandlers.kendoDateTime={init:function(e,n){var t=n(),a=$(e),o=ko.utils.unwrapObservable(t),i=moment(o,"DD/MM/YYYY "),r=function(e){console.log(e);var n=this.value();i="string"==typeof n?moment(n,"DD/MM/YYYY hh:mm"):moment(n),a.data("stop","true"),t(i.format()),a.data("stop","false")},l=a.kendoDateTimePicker({format:"dd/MM/yyyy HH:mm",change:r}).data("kendoDateTimePicker");return i?1===i.year()?void l.value(null):void l.value(i.toDate()):void l.value(null)},update:function(e,n){var t=$(e);if("true"!==t.data("stop")){var a=n(),o=ko.utils.unwrapObservable(a),i=moment(o),r=t.data("kendoDateTimePicker");return i?1===i.year()?void r.value(null):void r.value(i.toDate()):void r.value(null)}}},ko.bindingHandlers.slideVisible={init:function(e,n){var t=n();$(e).toggle(ko.utils.unwrapObservable(t))},update:function(e,n){var t=n();ko.utils.unwrapObservable(t)?$(e).slideDown():$(e).slideUp()}},ko.bindingHandlers.kendoEnable={init:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t);a?$(e).removeClass("k-state-disabled"):$(e).addClass("k-state-disabled")},update:function(e,n){var t=n(),a=ko.utils.unwrapObservable(t);a?($(e).removeClass("k-state-disabled"),$(e).removeAttr("disabled")):($(e).addClass("k-state-disabled"),$(e).attr("disabled","disabled"))}},ko.bindingHandlers.command={init:function(e,n,t,a){var o=n(),i=$(e),r=t(),l=i.val(),u=require("services/logger");if(r.isvisible){var s="function"==typeof r.isvisible?r.isvisible():r.isvisible;s?i.show():i.hide(),"function"==typeof r.isvisible&&r.isvisible.subscribe(function(e){e?i.show():i.hide()})}var d=$("<i class='fa fa-spin fa-spinner'></i>").hide(),c=$("<i class='fa fa-warning' style='color:red'></i>").hide();i.append(d),i.append(c),i.click(function(e){e.preventDefault(),(!this.form||this.form.checkValidity())&&(d.show(),c.hide(),o(a,e).fail(function(e,n,t){return i.button("complete").prop("disabled",!1).val(l).removeClass("btn-disabled"),d.hide(),c.show(),404===e.status?(u.error(t),void u.error(e.statusText)):(e.responseText&&(u.error(e.responseText),console.error(e.responseText)),void(e.responseJSON&&(u.error(JSON.stringify(e.responseJSON)),console.error(e.responseJson))))}).done(function(){i.button("complete").prop("disabled",!1).val(l).removeClass("btn-disabled"),d.hide()}),i.data("loading-text")&&i.button("loading"),i.addClass("btn-disabled").prop("disabled",!0))})}},ko.bindingHandlers.field={init:function(){}},ko.bindingHandlers.unwrapClick={init:function(e,n,t){var a=n(),o=$(e),i=t();o.click(function(e){e.preventDefault();var n=i.property,t=i.accessor,o=i.field,r=i.entity;n?("undefined"==typeof t[n]&&console.log("Can't figure out the accessor.prop"),"object"==typeof t[n]&&(t[n]=ko.observable(t[n])),"function"==typeof t[n]&&a(t[n],o,r)):a(t,o,r)})}},ko.bindingHandlers.fieldImage={init:function(e,n){var t=n(),a=$(e),o="function"==typeof t?t():t;a.attr("src","/image/index/"+o)}},ko.bindingHandlers.stringArrayAutoComplete={init:function(e,n,t){var a=n(),o=t(),i=o.data();$(e).data("kendoAutoComplete")||$(e).kendoAutoComplete({dataSource:i,change:function(){var e=_(this.value().split(",")).filter(function(e){return e});a(e)},filter:"startswith",placeholder:"....",separator:","}).val(a())},update:function(e,n){var t=n();$(e).data("kendoAutoComplete").value(t())}},ko.bindingHandlers.pathAutoComplete={init:function(e,n){var t=n(),a=t.value,o=t.type;o()&&$.get("/App/TriggerPathPickerJson/"+o()).done(function(n){var t=JSON.parse(n),o=_.chain(t).map(function(e){return""===e.parent?e.name:void 0}).filter(function(e){return"undefined"!=typeof e}).value();console.log(o);var i=new kendo.data.DataSource({data:o}),r=$(e).data("kendoAutoComplete")||$(e).kendoAutoComplete({dataSource:t,dataTextField:"path",change:function(){var e=this.value();console.log("selected path ",e)},filter:"startswith",placeholder:"Select path...",separator:""}).data("kendoAutoComplete");$(e).change(function(){a($(this).val()),console.log("new value",a())}).val(a()).on("keydown3",function(e){if(110===e.which||190===e.which){var n=$(this).val()+".";console.log("show the auto complete",n);var a=_.chain(t).filter(function(e){return e.parent===n}).map(function(e){return e.name}).value();console.log(a),i.data(a),r.refresh()}})})}},ko.bindingHandlers.commandWithParameter={init:function(e,n){var t=n(),a=t.command,o=t.commandParameter,i=$(e),r=i.data("complete-text")||i.html();i.click(function(e){e.preventDefault(),a(o).then(function(){i.button("complete"),"BUTTON"===i.get(0).tagName||"A"===i.get(0).tagName?i.html(r):i.val(r)}),i.data("loading-text")&&i.button("loading")})}},ko.bindingHandlers.filter={init:function(e,n,t){var a=n(),o=t(),i=a.path,r=a.tooltip||"Type to filter current page or type and [ENTER] to search the whole view",l=$(e),u=$('<input data-toggle="tooltip" title="'+r+'" type="search" class="search-query input-medium form-control" placeholder="Filter.. ">'),s=$("<a href='/#' title='Carian server'><i class='add-on icon-search'></i><a>"),d=$("<form class='form-search row'> <div class='input-group pull-right' style='width:300px'><span class='input-group-addon'> <span class='glyphicon glyphicon-remove'></span></span> </div> </form>"),c=o.searchPaging;d.find("span.input-group-addon").before(u),c&&d.find("span.glyphicon-remove").after(s),l.before(d),d.submit(function(e){e.preventDefault();var n=u.val().toLowerCase(),t=new $.Deferred;return n&&c&&"undefined"!=typeof c.query&&"function"==typeof c.query.filterAndSearch?c.query.filterAndSearch(n):t.promise()});var f=function(){var e=l.find(i),n=u.val().toLowerCase();e.each(function(){var e=$(this),t=e.text().toLowerCase().trim();t||($("input",e).each(function(e,n){t+=" "+$(n).val()}),t=t.toLowerCase().trim()),t.indexOf(n)>-1?e.show():e.hide()})},p=_.throttle(f,800);u.on("keyup",p).siblings("span.input-group-addon").click(function(){u.val(""),f()}),u.val()&&f(),u.tooltip()}},ko.bindingHandlers.serverPaging={init:function(e,n,t,a){var o=n(),i=o.entity,r=o.query,l=o.list,u=o.map,s=o.pagerHidden||!1,d=$(e),c=require("services/datacontext"),f=$("<div></div>"),p=$('<img src="/Images/spinner-md.gif" alt="loading" class="absolute-center" />'),v=function(){p.show(),d.fadeTo("fast",.33)},m=function(){p.hide(),d.fadeTo("fast",1)},b=function(e){u&&(e=_(e).map(u)),"string"==typeof l&&a[l](e),"function"==typeof l&&l(e)},g=function(e,n){v(),c.loadAsync({entity:i,page:e,size:n,includeTotal:!0},r).then(function(e){b(e.itemCollection),m()})};d.after(f).after(p).fadeTo("slow",.33);var h=new $.Deferred;return c.loadAsync({entity:i,page:1,size:20,includeTotal:!0},r).then(function(e){var n={element:f,count:e.rows,changed:g,hidden:s},t=new bespoke.utils.ServerPager(n);console.log(t),setTimeout(function(){b(e.itemCollection),h.resolve(!0),m()},500)}),h.promise()}},ko.bindingHandlers.searchPaging={init:function(e,n,t,a){var o=n(),i=o.entity,r=o.query,l=o.query||o.initialQuery||{},u=o.list,s=o.map,d=o.pagerHidden||!1,c=o.searchButton,f=$(e),p=require("services/datacontext"),v=require("services/logger"),m=require(objectbuilders.cultures),b=$("<div></div>"),g=$('<img src="/Images/spinner-md.gif" alt="loading" class="absolute-center" />'),h=function(){g.show(),f.fadeTo("fast",.33)},k=function(){g.hide(),f.fadeTo("fast",1)},y=null,w=function(e){d||_(e).each(function(e){e.pager={page:y.page(),size:y.pageSize()}}),s&&(e=_(e).map(s)),"string"==typeof u&&a[u](e),"function"==typeof u&&u(e)},D=function(e,n){h(),p.searchAsync({entity:i,page:e,size:n},l).then(function(e){w(e.itemCollection),k()})},Y=function(e,n,t){l=e;var a=new $.Deferred;return h(),p.searchAsync({entity:i,page:n||1,size:t||20},e).then(function(e){if(y)y.update(e.rows);else{var n={element:b,count:e.rows,changed:D,hidden:d};y=new bespoke.utils.ServerPager(n)}setTimeout(function(){w(e.itemCollection),a.resolve(e),k()},500)}),a.promise()},x=function(e){var n=JSON.parse(ko.toJSON(o.query||o.initialQuery)),t={from:0,size:20,query:{}};n.query=n.query||{},n.query.filtered=n.query.filtered||{},t.query.filtered=n.query.filtered,t.query.filtered.query={query_string:{default_field:"_all",query:e}},t.sort=n.sort,y.destroy(),y=null,Y(t)};return r.search=Y,r.filterAndSearch=x,f.after(b).after(g).fadeTo("slow",.33),c&&$(document).on("click",c,function(e){return e.preventDefault(),$(this).parents("form")[0].checkValidity()?void Y(ko.toJS(r),1,y.pageSize()):void v.error(m.messages.FORM_IS_NOT_VALID)}),Y(ko.toJS(l)),{search:Y,filterAndSearch:x}}};
ko.bindingHandlers.bootstrapDropDown={init:function(t,e){var n=ko.unwrap(e())||"[Select your value]",o=$(t),i=!1,r=function(t){t.preventDefault(),t.stopPropagation();var e=$(this);i?(e.parent().removeClass("open"),i=!1):(e.parent().addClass("open"),i=!0,$(document).one("click",function(){e.parent().removeClass("open"),i=!1}))};o.click(r),o.html()||("[object Object]"===n.toString()&&(n="[Select you value]"),o.html(n+' <i class="fa fa-caret-down"></i>'))}},ko.bindingHandlers.tooltip={init:function(t,e){var n=ko.unwrap(e());$(t).tooltip({title:n})}},ko.bindingHandlers.bootstrapPopover={init:function(t,e){var n=ko.unwrap(e());$(t).popover({content:"<pre>"+n+"</pre>",html:!0})}},ko.bindingHandlers.popover={init:function(t,e){var n=ko.unwrap(e());$(t).popover({content:"<pre>"+n+"</pre>",html:!0})}},ko.bindingHandlers.bootstrapTooltip={init:function(t,e){var n=ko.unwrap(e());$(t).tooltip({title:n})}},ko.bindingHandlers.cssAutoComplete={init:function(t,e){var n=e(),o=_(document.styleSheets).find(function(t){return t&&t.href?t.href.indexOf("bootstrap")>-1:!1}),i=["btn","btn-warning","btn-success","btn-link"];o&&(i=_.chain(o.rules).filter(function(t){return/^\./g.test(t.selectorText)&&!/:/g.test(t.selectorText)&&!/\s/g.test(t.selectorText)&&!/\+/g.test(t.selectorText)&&!/>/g.test(t.selectorText)&&!/\[/g.test(t.selectorText)}).map(function(t){return t.selectorText.replace(/\./g,"")}).value()),$(t).typeahead({name:"css_class",limit:10,local:i}).on("typeahead:closed",function(){n($(this).val())})}},ko.bindingHandlers.autocomplete={init:function(t,e,n){var o=ko.unwrap(e()),i=ko.unwrap(o.entity),r=ko.unwrap(o.field),a=ko.unwrap(o.query),l=o.ttl||3e5,s=n(),c=String.format("/list?table={0}&column={1}&filter={2}",i,r,a),p=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:c,tt1:l,filter:function(t){return _(t).map(function(t){return{name:t}})}}});p.initialize(),$(t).typeahead(null,{name:"autocomplete_"+$(t).prop("id"),displayKey:"name",source:p.ttAdapter()}).on("typeahead:closed",function(){s.value($(this).val())})}},ko.bindingHandlers.scroll={init:function(t,e){ko.unwrap(e())}};
!function(){Function.prototype.partial=function(){var t=this,n=Array.prototype.slice.call(arguments);return function(){for(var r=0,a=0;a<n.length&&r<arguments.length;a++)void 0===n[a]&&(n[a]=arguments[r++]);return t.apply(this,n)}}}();
!function(e){e.bespoke=e.bespoke||{},e.bespoke.ServerOperationStatus={OK:"OK",ERROR:"ERROR"},e.bespoke.messagesText={SAVE_SUCCESS:"Your item has been saved"}}(window);
var _uiready=function(){var n=function(n){};return{init:n}}();
!function(o,e){o.bespoke=o.bespoke||{},bespoke.utils=bespoke.utils||{},bespoke.utils.form=bespoke.utils.form||{},bespoke.utils.form.checkValidity=function(o){if(o.form)return o.form.checkValidity();var t=e(o).attr("form");if(t)return document.getElementById(t).checkValidity();throw"cannot find the form for the button"},o.console=o.console||{},o.console.dir=o.console.dir||function(){}}(window,jQuery);
!function(e,n){e.Task=e.Task||{},e.Task.fromResult=function(e,r){var o=new n.Deferred,s=r||100;return setTimeout(function(){o.resolve(e)},s),o.promise()}}(window,jQuery);
ko.bindingHandlers.theme={init:function(e,n,i,h,o){var p=n(),s=i(),a=ko.unwrap(p);if(bespoke.sph.Theme){var k=new bespoke.sph.Theme;k[a]&&k[a](e,h,s,o)}}};

//# sourceMappingURL=__core.min.js.map
