(function(a){$type=String,$type.__typeName='String',$type.__class=!0,$prototype=$type.prototype,$prototype.endsWith=function(c){/// <summary>Determines whether the end of this instance matches the specified string.</summary>
/// <param name="suffix" type="String">A string to compare to.</param>
/// <returns type="Boolean">true if suffix matches the end of this instance; otherwise, false.</returns>
return this.substr(this.length-c.length)===c},$prototype.startsWith=function(c){/// <summary >Determines whether the beginning of this instance matches the specified string.</summary>
/// <param name="prefix" type="String">The String to compare.</param>
/// <returns type="Boolean">true if prefix matches the beginning of this string; otherwise, false.</returns>
return this.substr(0,c.length)===c},$prototype.trim=function(){/// <summary >Removes all leading and trailing white-space characters from the current String object.</summary>
/// <returns type="String">The string that remains after all white-space characters are removed from the start and end of the current String object.</returns>
return this.replace(/^\s+|\s+$/g,'')},$prototype.trimEnd=function(){/// <summary >Removes all trailing white spaces from the current String object.</summary>
/// <returns type="String">The string that remains after all white-space characters are removed from the end of the current String object.</returns>
return this.replace(/\s+$/,'')},$prototype.trimStart=function(){/// <summary >Removes all leading white spaces from the current String object.</summary>
/// <returns type="String">The string that remains after all white-space characters are removed from the start of the current String object.</returns>
return this.replace(/^\s+/,'')},$type.format=function(c,d){/// <summary>Replaces the format items in a specified String with the text equivalents of the values of   corresponding object instances. The invariant culture will be used to format dates and numbers.</summary>
/// <param name="format" type="String">A format string.</param>
/// <param name="args" parameterArray="true" mayBeNull="true">The objects to format.</param>
/// <returns type="String">A copy of format in which the format items have been replaced by the   string equivalent of the corresponding instances of object arguments.</returns>
return String._toFormattedString(!1,arguments)},$type._toFormattedString=function(c,d){var e='',f=d[0];for(var g=0;;){// Find the next opening or closing brace
var h=f.indexOf('{',g),j=f.indexOf('}',g);if(0>h&&0>j){e+=f.slice(g);break}if(0<j&&(j<h||0>h)){if('}'!==f.charAt(j+1))throw new Error('format stringFormatBraceMismatch');e+=f.slice(g,j+1),g=j+2;continue}// Copy the string before the brace
// Check for double braces (which display as one and are not arguments)
if(e+=f.slice(g,h),g=h+1,'{'===f.charAt(g)){e+='{',g++;continue}if(0>j)throw new Error('format stringFormatBraceMismatch');// Find the closing brace
// Get the string between the braces, and split it around the ':' (if any)
var k=f.substring(g,j),l=k.indexOf(':'),m=parseInt(0>l?k:k.substring(0,l),10)+1;if(isNaN(m))throw new Error('format stringFormatInvalid');var n=0>l?'':k.substring(l+1),o=d[m];('undefined'==typeof o||null===o)&&(o=''),e+=o.toFormattedString?o.toFormattedString(n):c&&o.localeFormat?o.localeFormat(n):o.format?o.format(n):o.toString(),g=j+1}return e}})(window);
/// <reference path="toastr.js" />
/// <reference path="_ko.kendo.js" />
/// <reference path="../kendo/js/kendo.pager.js" />
/// <reference path="../kendo/js/kendo.all.js" />
var bespoke=bespoke||{};bespoke.utils={},bespoke.utils.ServerPager=function(a){a=a||{};var b=a.element,c=a.count||0,d=a.sizes||[10,20,50],f=a.defaultSize||20,g=a.changed||function(){console.log("no change event")},h=this,i=_.range(c),k=new kendo.data.DataSource({data:i,pageSize:f});if(a.hidden)return h;var l=b.kendoPager({dataSource:k,pageSizes:d}).data("kendoPager");l.page(1),l.bind("change",function(){g&&g(l.page(),l.pageSize())}),h.update=function(n){i=[];for(var o=0;o<n;o++)i[o]=o;setTimeout(function(){k.data(i)},500)},h.destroy=function(){l.destroy(),b.empty()},h.pageSize=function(n){return n&&l.pageSize(n),l.pageSize()},h.page=function(n){return n&&l.page(n),l.page()};var m=$(b).find("select").data("kendoDropDownList");return m&&m.bind("change",function(){try{g(1,parseInt(this.value()))}catch(n){}}),h};
ko.bindingHandlers.workflowFormPathIntellisense={init:function(a,b,f){var g=b(),h=ko.unwrap(g.schema),j=f();(function(){var k=$(a),l=$("<div></div>").css({height:"28px"});k.hide().before(l);var m=completely(l[0],{fontSize:"12px",color:"#555;",fontFamily:"\"Open Sans\", Arial, Helvetica, sans-serif"});for(var n in m.setText(ko.unwrap(j.value)),h)if(h.hasOwnProperty(n)){if("$type"===n)continue;if("addChildItem"===n)continue;if("removeChildItem"===n)continue;if("Empty"===n)continue;if("WebId"===n)continue;m.options.push(""+n)}m.options.sort();var o=h;m.onChange=function(p){if(p.lastIndexOf(".")===p.length-1){m.options=[];var q=p.split(".");for(var r in o=h,_(q).each(function(s){""===s||(o=o[s])}),console.log("currentObject",o),o)if(o.hasOwnProperty(r)){if("$type"===r)continue;if("addChildItem"===r)continue;if("removeChildItem"===r)continue;if("Empty"===r)continue;if("WebId"===r)continue;m.options.push(""+r)}m.options.sort(),m.startFrom=p.lastIndexOf(".")+1}m.repaint()},m.repaint(),$(m.input).attr("autocomplete","off").blur(function(){j.value($(this).val())}).parent().find("input").css({padding:"6px 12px",height:"28px"}),$(a).prop("required")&&$(m.input).prop("required",!0)})()}},ko.bindingHandlers.activityClass={init:function(a,b){var f=$(a),g=ko.unwrap(b()),h="function"==typeof g.$type?g.$type():g.$type,j=/Bespoke\.Sph\.Domain\.(.*?),/.exec(h)[1];f.addClass("activity32").addClass("activity32-"+j)}},ko.bindingHandlers.checkedItems={init:function(a,b){var f=ko.dataFor(a),g=b();$(a).change(function(){var h=$(this).is(":checked");h?g.push(f):g.remove(f)})}},ko.bindingHandlers.typeahead={init:function(a,b,f){var g=ko.unwrap(b()),h=f();if("undefined"!=typeof g){var j=new Bloodhound({datumTokenizer:function(k){return Bloodhound.tokenizers.whitespace(k.Path)},queryTokenizer:Bloodhound.tokenizers.nonword,prefetch:"/api/workflow-definitions/"+g+"/variable-path"});j.initialize(),$(a).typeahead({highlight:!0},{name:"schema_paths"+g,displayKey:"Path",source:j.ttAdapter()}).on("typeahead:closed",function(){h.value($(this).val())})}}},ko.bindingHandlers.typeaheadExceptions={init:function(a,b,f){var g=f(),h=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"/api/assemblies/types/exceptions"});$(a).typeahead(null,{name:"exceptions",source:h}).on("typeahead:closed",function(){g.value($(this).val())})}},ko.bindingHandlers.activityPopover={init:function(a,b){var f=$(a),g=ko.unwrap(b()),h="function"==typeof g.$type?g.$type():g.$type,j=/Bespoke\.Sph\.Domain\.(.*?),/.exec(h)[1],k=ko.dataFor(f.parent()[0]).wd(),l=f.popover({title:j+" : "+g.Name(),html:!0,content:function(){return $("a.edit-activity").popover("hide"),f.find("a.edit-activity").addClass(g.WebId()),f.find("a.delete-activity").addClass(g.WebId()),f.find("a.start-activity").addClass(g.WebId()),f.find("div.context-menu").html()}});// just display it for 5 seconds
l.on("shown.bs.popover",function(){setTimeout(function(){l.popover("hide")},5000)}),$(document).on("click","a."+g.WebId(),function(m){m.preventDefault();var n=require(objectbuilders.app),o=$(this);o.hasClass("delete-activity")&&n.showMessage("Are you sure you want to remove this Activity","Remove activity",["Yes","No"]).done(function(p){"Yes"===p&&k.removeActivity(g)()}),o.hasClass("edit-activity")&&k.editActivity(g)(),o.hasClass("start-activity")&&k.setStartActivity(g)()})}},ko.bindingHandlers.comboBoxLookupOptions={init:function(a,b){var f=$(a),g=ko.unwrap(b()),h=g.value,j=g.caption,k=require("services/datacontext"),l=ko.unwrap(g.displayPath),m=ko.unwrap(g.valuePath),n=function(o){//getListAsync
var p=ko.unwrap(g.valuePath)===ko.unwrap(g.displayPath)?k.getListAsync(ko.unwrap(g.entity),o,ko.unwrap(g.valuePath)):k.getTuplesAsync({entity:ko.unwrap(g.entity),query:o,field:m,field2:l});p.done(function(q){a.options.length=0,j&&a.add(new Option(j,"")),_(q).each(function(r){return"string"==typeof r?void a.add(new Option(r,r)):"string"==typeof r.Item1&&"string"==typeof r.Item2?void a.add(new Option(r.Item2,r.Item1)):void("string"==typeof r[m]&&"string"==typeof r[l]&&a.add(new Option(r[m],r[l])))}),f.val(ko.unwrap(h)).on("change",function(){h(f.val())})})};n(ko.unwrap(g.query)),"function"==typeof g.query&&"function"==typeof g.query.subscribe&&g.query.subscribe(function(o){n(ko.unwrap(o))})},update:function(a,b){var f=ko.unwrap(b()),g=f.value;$(a).val(ko.unwrap(g))}};
ko.bindingHandlers.tree={init:function(a,b){var f=require(objectbuilders.system),g=b(),h=ko.unwrap(g.entity),j=ko.unwrap(g.searchbox),k=g.selected,l={text:h.Name(),state:{opened:!0,selected:!0}},m=function(x){var y=ko.unwrap(x.TypeName)||ko.unwrap(x.$type);return 0>y.indexOf(",")&&(y=ko.unwrap(x.$type)),y},o=null,r=null,t=function(x){x.children=_(x.data.MemberCollection()).map(function(y){const z=m(y);return{text:y.Name(),state:"open",type:z,data:y}}),_(x.children).each(t)},u=function(x,y){ko.isObservable(y.childOfValueMember)||(y.childOfValueMember=ko.observable(!0));var z=$(a).jstree(!0),A=_(x.parents).map(function(C){return z.get_node(C)}),B=_(A).find(function(C){return"Bespoke.Sph.Domain.ValueObjectMember, domain.sph"===C.type});y.childOfValueMember(B||!1)};(function(){l.children=_(h.MemberCollection()).map(function(x){return{text:ko.unwrap(x.Name),state:"open",type:m(x),data:x}}),_(l.children).each(t),$(a).on("select_node.jstree",function(x,y){if("function"==typeof k){o&&(o.dispose(),o=null),r&&(r.dispose(),r=null);var z=y.node.data;if(z){if("default"===y.node.type)return;ko.isObservable(z.childOfValueMember)||(z.childOfValueMember=ko.observable(!0)),ko.isObservable(z.allowFilter)||(z.allowFilter=ko.observable(!0));var A=$(a).jstree(!0),B=_(y.node.parents).map(function(E){return A.get_node(E)}),C=_(B).find(function(E){return"Bespoke.Sph.Domain.ValueObjectMember, domain.sph"===E.type});// we also need to disable for collection member
if(z.childOfValueMember(C||!1),!C){var D=_(B).find(function(E){var F=E.data;return"Bespoke.Sph.Domain.ComplexMember, domain.sph"===E.type&&ko.unwrap(F.AllowMultiple)});D&&z.allowFilter(!1)}z.childOfValueMember()||A.edit(y.node),k(z),o=k().Name.subscribe(function(E){$(a).jstree(!0).rename_node(y.node,E),console.log("rename "+E)}),"function"==typeof k().TypeName&&(r=k().TypeName.subscribe(function(E){$(a).jstree(!0).set_type(y.node,E)}))}}}).on("create_node.jstree",function(x,y){console.log(y,"node")}).on("move_node.jstree",function(x,y){var z=$(a).jstree(!0),A=y.node.data,B=z.get_node(y.old_parent),C=B.data.MemberCollection||h.MemberCollection,D=z.get_node(y.parent),E=D.data.MemberCollection||h.MemberCollection;C.remove(function(F){return ko.unwrap(A.WebId)===ko.unwrap(F.WebId)}),E.splice(y.position,0,A)}).on("rename_node.jstree",function(x,y){var z=y.node.data;z.Name(y.text)}).jstree({core:{animation:0,check_callback:function(x,y,z,A,B){if("move_node"===x){var C=y.data,D=$(a).jstree(!0),E=D.get_node(z);return!!C&&!!E&&(ko.isObservable(C.childOfValueMember)||u(y,C),!ko.unwrap(C.childOfValueMember)&&"Bespoke.Sph.Domain.ValueObjectMember, domain.sph"!==E.type)}return!0},themes:{stripes:!0},data:l},dnd:{is_draggable:function(x){var y=x.data;return y&&ko.unwrap(y.childOfValueMember)?!1:!0}},contextmenu:{items:function(x){var y=$(a).jstree(!0),z=_(x.parents).map(function(H){return y.get_node(H)}),A=_(z).find(function(H){return"Bespoke.Sph.Domain.ValueObjectMember, domain.sph"===H.type}),B=y.get_selected();if(A)return[];var C={label:"Add Simple Child",action:function(){const H=new bespoke.sph.domain.SimpleMember({WebId:f.guid(),TypeName:"System.String, mscorlib",Name:"Member_Name"}),I=$(a).jstree("get_selected",!0),J=I[0].data;return!!B.length&&(B=B[0],B=y.create_node(B,{state:"open",type:"System.String, mscorlib",text:"Member_Name",data:H}),!!B&&(y.edit(B),J&&J.MemberCollection?J.MemberCollection.push(H):h.MemberCollection.push(H),!0))}},D={label:"Add Value Object Child",action:function(){var H=new bespoke.sph.domain.ValueObjectMember({WebId:f.guid(),TypeName:"Bespoke.Sph.Domain.ValueObjectDefinition, domain.sph",Name:"Member_Name"}),I=$(a).jstree("get_selected",!0),J=I[0].data;return!!B.length&&(B=B[0],B=y.create_node(B,{state:"open",type:"Bespoke.Sph.Domain.ValueObjectMember, domain.sph",text:"Member_Name",data:H}),!!B&&(y.edit(B),J&&J.MemberCollection?J.MemberCollection.push(H):h.MemberCollection.push(H),H.TypeName.subscribe(function(){// TODO : clear the node children and populate the node according to the value object definition members
}),!0))}},E={label:"Add Complex Child",action:function(){var H=new bespoke.sph.domain.ComplexMember({WebId:f.guid(),Name:"Member_Name"}),I=$(a).jstree("get_selected",!0),J=I[0].data;return!!B.length&&(B=B[0],B=y.create_node(B,{state:"open",type:"Bespoke.Sph.Domain.ComplexMember, domain.sph",text:"Member_Name",data:H}),!!B&&(y.edit(B),J&&J.MemberCollection?J.MemberCollection.push(H):h.MemberCollection.push(H),!0))}},F={label:"Remove",action:function(){// now delete the member
var H=y.get_selected(!0)[0],I=y.get_node($("#"+H.parent)),J=I.data;if(J&&"function"==typeof J.MemberCollection){var K=_(J.MemberCollection()).find(function(M){return M.WebId()===H.data.WebId()});J.MemberCollection.remove(K)}else{var L=_(h.MemberCollection()).find(function(M){return M.WebId()===H.data.WebId()});h.MemberCollection.remove(L)}return!!B.length&&(y.delete_node(B),!0)}},G=[];return("default"===x.type||"Bespoke.Sph.Domain.ComplexMember, domain.sph"===x.type)&&(G.push(C),G.push(D),G.push(E)),console.log(x),"default"!==x.type&&G.push(F),G}},types:{"default":{icon:"fa fa-clipboard"},"System.String, mscorlib":{icon:"glyphicon glyphicon-bold",valid_children:[]},"System.DateTime, mscorlib":{icon:"glyphicon glyphicon-calendar",valid_children:[]},"System.Int32, mscorlib":{icon:"fa fa-sort-numeric-asc",valid_children:[]},"System.Decimal, mscorlib":{icon:"glyphicon glyphicon-usd",valid_children:[]},"System.Boolean, mscorlib":{icon:"glyphicon glyphicon-ok",valid_children:[]},"Bespoke.Sph.Domain.ValueObjectMember, domain.sph":{icon:"fa fa-object-ungroup"},"Bespoke.Sph.Domain.ComplexMember, domain.sph":{icon:"fa fa-object-group"}},plugins:["contextmenu","dnd","types","search"]})})();var w=!1;$(j).keyup(function(){w&&clearTimeout(w),w=setTimeout(function(){var x=$(j).val();$(a).jstree(!0).search(x)},250)})}},ko.bindingHandlers.help={init:function(a,b){var f=$(a),g=ko.unwrap(b());f.click(function(h){h.preventDefault(),window.open("/docs/#"+g)})}};var substringMatcher=function(a){return function(f,g){var h,j;// an array that will be populated with substring matches
h=[],j=new RegExp(f,"i"),$.each(a,function(k,l){j.test(l)&&h.push({value:l})}),g(h)}};ko.bindingHandlers.typeaheadUrl={init:function(a,b){var f=ko.unwrap(b()),g=String.format("/list?table={0}&column={1}",f[0],"Route"),h=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,remote:{url:g,tt1:300000,filter:function(j){return _(j).map(function(k){return{name:k}})}}});h.initialize(),$(a).typeahead(null,{name:"EntityView_"+$(a).prop("id"),displayKey:"name",source:h.ttAdapter()})}},ko.bindingHandlers.entityTypeaheadPath={init:function(a,b,f){const g=b(),h=require(objectbuilders.datacontext),j=require(objectbuilders.config),k=f(),l=ko.unwrap(b())||window.typeaheadEntity,m=function(o){const r=o.name||o,t=o.id||o,u=function(B){return B.replace(/^([A-Z])|\s(\w)/g,function(C,D,E,F){return E?E.toUpperCase():D.toLowerCase()})}(r);var w=ko.toJS(bespoke[j.applicationName+"_"+u].domain[r]());const x=$(a),y=$("<div></div>").css({height:"28px"});x.hide().before(y);var z=completely(y[0],{fontSize:"12px",color:"#555;",fontFamily:"\"Open Sans\", Arial, Helvetica, sans-serif"});for(let B in z.setText(ko.unwrap(k.value)),w)if(w.hasOwnProperty(B)){if("$type"===B)continue;if("addChildItem"===B)continue;if("removeChildItem"===B)continue;if("Empty"===B)continue;if("WebId"===B)continue;z.options.push(`${B}`)}z.options.sort();var A=w;z.onChange=function(B){if(B.lastIndexOf(".")===B.length-1){z.options=[];const D=B.split(".");for(var C in A=w,_(D).each(function(E){""===E||(A=A[E])}),console.log("currentObject",A),A)if(A.hasOwnProperty(C)){if("$type"===C)continue;if("addChildItem"===C)continue;if("removeChildItem"===C)continue;if("Empty"===C)continue;if("WebId"===C)continue;z.options.push(""+C)}z.options.sort(),z.startFrom=B.lastIndexOf(".")+1}z.repaint()},z.repaint(),$(z.input).attr("autocomplete","off").blur(function(){k.value($(this).val())}).parent().find("input").css({padding:"6px 12px",height:"28px"}),$(a).prop("required")&&$(z.input).prop("required",!0),z.hideDropDown()};l&&h.loadOneAsync("EntityDefinition",`Name eq '${l}' OR id eq '${l}'`,"Id").done(function(o){m({name:o.Name(),id:o.Id()})}),"function"==typeof g&&"function"==typeof g.subscribe&&g.subscribe(function(o){$(a).typeahead("destroy"),m(o)})}},ko.bindingHandlers.cssTypeahead={init:function(a,b,f){var g=f(),h=function(l){var m=/([^,]+)$/.exec(l);return m&&m[1]?m[1].trim():""},j=_(["fa","fa-user","fa-user-o"]).map(function(l){return{path:l}}),k=new Bloodhound({datumTokenizer:function(l){return l.path.split(/s+/)},queryTokenizer:function(l){return l.split(/\./)},local:j});k.initialize(),$(a).typeahead({minLength:0,highlight:!0,updater:function(){return this.$element.val().replace(/[^,]*$/,"")+item+","},matcher:function(l){var m=h(this.query);return!!m&&~l.toLowerCase().indexOf(m.toLowerCase())}},{name:"css-class",displayKey:"path",source:k.ttAdapter()}).on("typeahead:closed",function(){g.value($(this).val())})}},ko.bindingHandlers.chart={init:function(a,b){var f=ko.unwrap(b()),g=require("services/datacontext"),h=f.Entity(),j=JSON.parse(f.Query()),k=f.Type(),l=new $.Deferred,m=f.Name();return g.searchAsync(h,j).done(function(o){var r=o.aggregations.category.buckets||o.aggregations.category,t=_(r).map(function(x){return{category:x.key_as_string||x.key.toString(),value:x.doc_count}}),u=_(r).map(function(x){return x.key_as_string||x.key.toString()}),w=$(a).kendoChart({theme:"metro",chartArea:{background:""},title:{text:m},legend:{position:"bottom"},seriesDefaults:{labels:{visible:!0,format:"{0}",background:"transparent",template:"#= category #: #= value#"}},series:[{type:k,data:t}],categoryAxis:{categories:u,majorGridLines:{visible:!1}},tooltip:{visible:!0,format:"{0}",template:"#= category #: #= value #"}}).data("kendoChart");l.resolve(!0),g.getScalarAsync("EntityView","Id eq '"+f.EntityViewId()+"'","Name").done(function(x){w.options.title.text=m+" ("+x+")",w.refresh()})}),l.promise()}},ko.bindingHandlers.iconPicker={init:function(a,b){var f=$(a),g=b(),h=$("<a href=\"#\" class=\"btn btn-link\">Pick Icon</a>");f.parent().append(h),h.click(function(j){j.preventDefault(),require(["viewmodels/icon.picker","durandal/app"],function(k,l){l.showDialog(k).done(function(m){"OK"===m&&(g(k.icon()),f.val(k.icon()))})})})}};var bespoke=bespoke||{};bespoke.observableArray=bespoke.observableArray||{},bespoke.getSingletonObservableArray=function(a){return bespoke.observableArray[a]?bespoke.observableArray[a]:(bespoke.observableArray[a]=ko.observableArray(),bespoke.observableArray[a])},ko.bindingHandlers.lookup={init:function(a,b){var f=$(a),g=b(),h=ko.unwrap(g.member);f.click(function(j){j.preventDefault(),j.stopPropagation(),require(["viewmodels/entity.lookup.dialog","durandal/app"],function(k,l){k.options(g),l.showDialog(k).done(function(m){if(m&&"OK"===m){var o=k.selected();g.value(o[h])}})})})}},ko.virtualElements.allowedBindings.lookupText=!0,bespoke.lookupText=function(a,b){var f=b(),g=ko.unwrap(f.entity),h=ko.unwrap(f.displayPath),j=ko.unwrap(f.valuePath),k=ko.unwrap(f.value),l=require("services/datacontext"),m=function(o,r){var t=ko.utils.unwrapObservable(r);(null===t||t===void 0)&&(t="");var u=ko.virtualElements.firstChild(o);!u||3!==u.nodeType||ko.virtualElements.nextSibling(u)?ko.virtualElements.setDomNodeChildren(o,[o.ownerDocument.createTextNode(t)]):u.data=t};l.getScalarAsync(g,j+" eq '"+k+"'",h).done(function(o){m(a,o),console.log(o)})},ko.bindingHandlers.lookupText={init:bespoke.lookupText,update:bespoke.lookupText},ko.bindingHandlers.readonly={init:function(a,b){var f=$(a),g=ko.unwrap(b());g?f.prop("readonly",!0):f.prop("readonly",!1)},update:function(a,b){var f=$(a),g=ko.unwrap(b());g?f.prop("readonly",!0):f.prop("readonly",!1)}};
ko.bindingHandlers.kendoEditor={init:function(b,d){var f=$(b),g=d(),h=!1;setTimeout(function(){var j=f.kendoEditor({change:function(){h||(h=!0,g(this.value()),setTimeout(function(){h=!1},500))}}).data("kendoEditor");j.value(g()),g.subscribe(function(k){h||(h=!0,j.value(k),setTimeout(function(){h=!1},500))})},500)},update2:function(b,d){var f=$(b),g=d(),h=f.data("kendoEditor");f.data("updating")||h.value(g())}},ko.bindingHandlers.kendoDropDownListValue={init:function(b,d){var f=d(),g=ko.utils.unwrapObservable(f),h=$(b).data("kendoDropDownList");h.value(g),h.bind("change",function(){var j=h.value();f(j)})},update:function(b,d){//update value based on a model change
var f=d(),g=ko.utils.unwrapObservable(f);g&&$(b).data("kendoDropDownList").value(g)}},ko.bindingHandlers.source={},ko.bindingHandlers.kendoComboBox={init:function(b,d,f){var g=d(),h=f(),j=ko.utils.unwrapObservable(g),k=$(b).data("kendoComboBox")||$(b).kendoComboBox({dataSource:h.source()}).data("kendoComboBox");k.value(j),h.source.subscribe(function(l){k.dataSource.data(l)}),k.bind("change",function(){var l=k.value();g(l)})},update:function(b,d){//update value based on a model change
var f=d(),g=ko.utils.unwrapObservable(f);g&&$(b).data("kendoComboBox").value(g)}},ko.bindingHandlers.decimal={},ko.bindingHandlers.money={init:function(b,d,f){var g=d(),h=f(),j=function(){return"undefined"==typeof h.decimal?2:parseInt(h.decimal)},k=$(b),l=function(){var m=parseFloat(ko.unwrap(g)||"0"),n=m.toFixed(j()).replace(/./g,function(p,r,u){return r&&"."!==p&&!((u.length-r)%3)?","+p:p});return"span"===b.tagName.toLowerCase()?void k.text(n):void(k.val(n),k.on("blur",function(){var p=$(this).val().replace(/,/g,"");console.log(p),g(parseFloat(p))}))};l(),ko.isObservable(g)&&g.subscribe(l)},update:function(b,d,f){var g=d(),h=f(),j=$(b),k=parseFloat(ko.unwrap(g)||"0"),l=k.toFixed(function(){return"undefined"==typeof h.decimal?2:parseInt(h.decimal)}()).replace(/./g,function(m,n,p){return n&&"."!==m&&!((p.length-n)%3)?","+m:m});j.val(l)}},ko.bindingHandlers.date={init:function(b,d){var f=ko.utils.unwrapObservable(d());if(!f)return $(b).text(""),void $(b).val("");var g=ko.unwrap(f.value),h=-1<(g||"").indexOf("T")?"YYYY-MM-DDTHH:mm:ss":"YYYY-MM-DD",j=ko.unwrap(f.inputFormat)||h,k=moment(g,j),l=ko.unwrap(f.invalid)||"invalid date",m=ko.unwrap(f.format)||"DD/MM/YYYY";if(f.format||"string"!=typeof ko.unwrap(f)||(g=ko.unwrap(f),k=moment(g)),$(b).on("change",function(){var p=$(this).val();f.value(p)}),!g)return $(b).text(l),void $(b).val(l);if(!k)return $(b).text(""),void $(b).val("");if(1===k.year())return $(b).text(""),void $(b).val("");var n=k.format(m).toString();0>n.indexOf("NaN")&&($(b).text(n),$(b).val(n))},update:function(b,d){var f=ko.utils.unwrapObservable(d());if(!f)return $(b).text(""),void $(b).val("");var g=ko.unwrap(f.value),h=-1<(g||"").indexOf("T")?"YYYY-MM-DDTHH:mm:ss":"YYYY-MM-DD",j=ko.unwrap(f.inputFormat)||h,k=moment(g,j),l=ko.unwrap(f.invalid)||"invalid date",m=ko.unwrap(f.format)||"DD/MM/YYYY";if(f.format||"string"!=typeof ko.unwrap(f)||(g=ko.unwrap(f),k=moment(g)),$(b).on("change",function(){var p=$(this).val();f.value(p)}),!g)return $(b).text(l),void $(b).val(l);if(!k)return $(b).text(""),void $(b).val("");if(1===k.year())return $(b).text(""),void $(b).val("");var n=k.format(m).toString();0>n.indexOf("NaN")&&($(b).text(n),$(b).val(n))}},ko.bindingHandlers.kendoUpload={init:function(b,d){var f=require(objectbuilders.datacontext),g=require(objectbuilders.logger),h=d(),j=d(),k=[];j&&"object"==typeof j&&(h=j.value,k=j.extensions),$(b).attr("name","files").kendoUpload({async:{saveUrl:"/BinaryStore/Upload",removeUrl:"/BinaryStore/Remove",autoUpload:!0},multiple:!1,error:function(l){g.logError(l,l,this,!0)},select:function(l){0===k.length||_(l.files).each(function(m){0>k.indexOf(m.extension)&&(g.error("Only "+k.join(",")+" files can be uploaded"),l.preventDefault())})},success:function(l){g.info("Your file has been "+l.operation);var m=l.response.storeId,n="upload"===l.operation,p="upload"!==l.operation,r=h();n&&(h(m),r&&f.post(JSON.stringify({id:r}),"/BinaryStore/Remove/")),p&&h("")},remove:function(){var l=new $.Deferred,m=JSON.stringify({id:h()});return f.post(m,"/BinaryStore/Remove/").then(function(n){l.resolve(n)}),l.promise()}})}},ko.bindingHandlers.kendoDate={init:function(b,d,f){var g=d(),h=$(b),j=f(),k=ko.unwrap(g),l=moment(k,"DD/MM/YYYY"),m=h.kendoDatePicker({format:"dd/MM/yyyy",change:function(n){console.log(n);var p=this.value();l="string"==typeof p?moment(p,"DD/MM/YYYY"):moment(p),h.data("stop","true"),g(l.format("YYYY-MM-DD")),h.data("stop","false")}}).data("kendoDatePicker");return"boolean"!=typeof j.enable||j.enable||m.enable(!1),"function"==typeof j.enable&&"function"==typeof j.enable.subscribe&&j.enable.subscribe(function(n){m.enable(n)}),l?1===l.year()?void m.value(null):void(m.value(l.toDate()),"undefined"==typeof k&&"function"==typeof g&&g(l.format("YYYY-MM-DD"))):void m.value(null)},update:function(b,d,f){var g=$(b),h=f();if("true"!==g.data("stop")){var j=d(),k=ko.utils.unwrapObservable(j),l=moment(k),m=g.data("kendoDatePicker");if(!l)return void m.value(null);if(1===l.year())return void m.value(null);"boolean"!=typeof h.enable||h.enable||m.enable(!1),"function"==typeof h.enable&&"function"==typeof h.enable.subscribe&&h.enable.subscribe(function(p){m.enable(p)}),m.value(l.toDate())}}},ko.bindingHandlers.kendoDateTime={init:function(b,d){var f=d(),g=$(b),h=ko.utils.unwrapObservable(f),j=moment(h,"DD/MM/YYYY "),k=g.kendoDateTimePicker({format:"dd/MM/yyyy HH:mm",change:function(l){console.log(l);var m=this.value();j="string"==typeof m?moment(m,"DD/MM/YYYY hh:mm"):moment(m),g.data("stop","true"),f(j.format()),g.data("stop","false")}}).data("kendoDateTimePicker");return j?1===j.year()?void k.value(null):void k.value(j.toDate()):void k.value(null)},update:function(b,d){var f=$(b);if("true"!==f.data("stop")){var g=d(),h=ko.utils.unwrapObservable(g),j=moment(h),k=f.data("kendoDateTimePicker");if(!j)return void k.value(null);if(1===j.year())return void k.value(null);k.value(j.toDate())}}},ko.bindingHandlers.slideVisible={init:function(b,d){// Initially set the element to be instantly visible/hidden depending on the value
var f=d();$(b).toggle(ko.utils.unwrapObservable(f))},update:function(b,d){var f=d();ko.utils.unwrapObservable(f)?$(b).slideDown():$(b).slideUp()}},ko.bindingHandlers.kendoEnable={init:function(b,d){var f=d(),g=ko.utils.unwrapObservable(f);g?$(b).removeClass("k-state-disabled"):$(b).addClass("k-state-disabled")},update:function(b,d){var f=d(),g=ko.utils.unwrapObservable(f);g?($(b).removeClass("k-state-disabled"),$(b).removeAttr("disabled")):($(b).addClass("k-state-disabled"),$(b).attr("disabled","disabled"))}},ko.bindingHandlers.command={init:function(b,d,f,g){var h=d(),j=$(b),k=f(),l=j.val(),m=require("services/logger");if(k.isvisible){var n="function"==typeof k.isvisible?k.isvisible():k.isvisible;n?j.show():j.hide(),"function"==typeof k.isvisible&&k.isvisible.subscribe(function(u){u?j.show():j.hide()})}var p=$("<i class='fa fa-spin fa-circle-o-notch'></i>").hide(),r=$("<i class='fa fa-warning' style='color:red'></i>").hide();j.append(p),j.append(r),j.click(function(u){u.preventDefault();this.form&&!this.form.checkValidity()||(p.show(),r.hide(),h(g,u).fail(function(w,y,z){if(j.button("complete").prop("disabled",!1).val(l).removeClass("btn-disabled"),p.hide(),r.show(),404===w.status)return m.error(z),void m.error(w.statusText);if(w.responseJSON){const A=w.responseJSON.Message||"",B=w.responseJSON.Details||JSON.stringify(w.responseJSON);m.error(A),console.error(A,B)}else w.responseText&&(m.error(w.responseText),console.error(w.responseText))}).done(function(){j.button("complete").prop("disabled",!1).val(l).removeClass("btn-disabled"),p.hide()}),j.data("loading-text")&&j.button("loading"),j.addClass("btn-disabled").prop("disabled",!0))})}},ko.bindingHandlers.field={init:function(){}},ko.bindingHandlers.unwrapClick={init:function(b,d,f){var g=d(),h=$(b),j=f();h.click(function(k){k.preventDefault();var l=j.property,m=j.accessor,n=j.field,p=j.entity;/* if we can't get to the function , i.e. it's still object not ko.observable
            
            */l?("undefined"==typeof m[l]&&console.log("Can't figure out the accessor.prop"),"object"==typeof m[l]&&(m[l]=ko.observable(m[l])),"function"==typeof m[l]&&g(m[l],n,p)):g(m,n,p)})}},ko.bindingHandlers.fieldImage={init:function(b,d){var f=d(),g=$(b),h="function"==typeof f?f():f;g.attr("src","/image/index/"+h)}},ko.bindingHandlers.stringArrayAutoComplete={init:function(b,d,f){var g=d(),h=f(),j=h.data();$(b).data("kendoAutoComplete")||$(b).kendoAutoComplete({dataSource:j,change:function(){var k=_(this.value().split(",")).filter(function(l){return l});g(k)},filter:"startswith",placeholder:"....",separator:","}).val(g())},update:function(b,d){var f=d();$(b).data("kendoAutoComplete").value(f())}},ko.bindingHandlers.pathAutoComplete={init:function(b,d){var f=d(),g=f.value,h=f.type;h()&&$.get("/App/TriggerPathPickerJson/"+h()).done(function(j){var k=JSON.parse(j),l=_.chain(k).map(function(p){return""===p.parent?p.name:void 0}).filter(function(p){return"undefined"!=typeof p}).value();console.log(l);var m=new kendo.data.DataSource({data:l}),n=$(b).data("kendoAutoComplete")||$(b).kendoAutoComplete({dataSource:k,dataTextField:"path",change:function(){var p=this.value();console.log("selected path ",p)},filter:"startswith",placeholder:"Select path...",separator:""}).data("kendoAutoComplete");$(b).change(function(){g($(this).val()),console.log("new value",g())}).val(g()).on("keydown3",function(p){if(110===p.which||190===p.which){var r=$(this).val()+".";console.log("show the auto complete",r);var u=_.chain(k).filter(function(w){return w.parent===r}).map(function(w){return w.name}).value();console.log(u),m.data(u),n.refresh()}})})}},ko.bindingHandlers.commandWithParameter={init:function(b,d){var f=d(),g=f.command,h=f.parameter||f.commandParameter,j=$(b),k=j.val(),l=$("<i class='fa fa-spin fa-circle-o-notch'></i>").hide(),m=$("<i class='fa fa-warning' style='color:red'></i>").hide();j.append(l),j.append(m),j.click(function(n){n.preventDefault();this.form&&!this.form.checkValidity()||(l.show(),m.hide(),g(h).fail(function(p,r,u){return j.button("complete").prop("disabled",!1).val(k).removeClass("btn-disabled"),l.hide(),m.show(),404===p.status?(logger.error(u),void logger.error(p.statusText)):void(p.responseText&&(logger.error(p.responseText),console.error(p.responseText)),p.responseJSON&&(logger.error(JSON.stringify(p.responseJSON)),console.error(p.responseJson)))}).done(function(){j.button("complete").prop("disabled",!1).val(k).removeClass("btn-disabled"),l.hide()}),j.data("loading-text")&&j.button("loading"),j.addClass("btn-disabled").prop("disabled",!0))})}},ko.bindingHandlers.filter={init:function(b,d,f){var g=d(),h=f(),j=g.path,k=g.tooltip||"Type to filter current page or type and [ENTER] to search the whole view",l=$(b),m=$("<input data-toggle=\"tooltip\" title=\""+k+"\" type=\"search\" class=\"search-query input-medium form-control\" placeholder=\"Filter.. \">"),n=$("<a href='/#' title='Carian server'><i class='add-on icon-search'></i><a>"),p=$("<form class='form-search row'> <div class='input-group pull-right' style='width:300px'><span class='input-group-addon'> <span class='glyphicon glyphicon-remove'></span></span> </div> </form>"),r=h.searchPaging,u=g.customSearch;p.find("span.input-group-addon").before(m),r&&p.find("span.glyphicon-remove").after(n),l.before(p),p.submit(function(A){A.preventDefault();var B=m.val().toLowerCase(),C=new $.Deferred;return B?"function"==typeof u?u(B):r&&"undefined"!=typeof r.query&&"function"==typeof r.query.filterAndSearch?r.query.filterAndSearch(B):C.promise():C.promise()});var w="",y=function(){var A=l.find(j),B=m.val().toLowerCase();w===B||(w=B,A.each(function(){var C=$(this),D=C.text().toLowerCase().trim();D||($("input",C).each(function(E,F){D+=" "+$(F).val()}),D=D.toLowerCase().trim()),-1<D.indexOf(B)?C.show():C.hide()}))},z=_.throttle(y,800);m.on("keyup",z).siblings("span.input-group-addon").click(function(){m.val(""),y()}),m.val()&&y(),m.tooltip()}},ko.bindingHandlers.serverPaging={init:function(b,d,f,g){var h=d(),j=h.entity,k=h.enableReload,l=ko.isObservable((g.toolbar||{}).commands),m=h.query,n=h.list,p=h.map,r=h.pagerHidden||!1,u=$(b),w=require("services/datacontext"),y=$("<div></div>"),z=$("<img src=\"/Images/spinner-md.gif\" alt=\"loading\" class=\"absolute-center\" />"),A=function(){z.show(),u.fadeTo("fast",0.33)},B=function(){z.hide(),u.fadeTo("fast",1)},C=function(F){p&&(F=_(F).map(p)),"string"==typeof n&&g[n](F),"function"==typeof n&&n(F)},D=function(F,G){return A(),w.loadAsync({entity:j,page:F,size:G,includeTotal:!0},m).then(function(H){C(H.itemCollection),B()})};if(k&&l){const F="server-paging-reload",G=g.toolbar.commands().find(H=>H.id===F);G||g.toolbar.commands.push({command:function(){return D(1,20)},caption:"Reload",icon:"bowtie-icon bowtie-navigate-refresh",id:F})}k&&!l&&console.error("Please provide a toolbar with commands : ko.observableArray(), in your viewModel"),u.after(y).after(z).fadeTo("slow",0.33);var E=new $.Deferred;return w.loadAsync({entity:j,page:1,size:20,includeTotal:!0},m).then(function(F){var G={element:y,count:F.rows,changed:D,hidden:r},H=new bespoke.utils.ServerPager(G);console.log(H),setTimeout(function(){C(F.itemCollection),E.resolve(!0),B()},500)}),E.promise()}},ko.bindingHandlers.searchPaging={init:function(b,d,f,g){var h=d(),j=h.entity,k=h.enableReload,l=ko.isObservable((g.toolbar||{}).commands),m=h.query,n=h.query||h.initialQuery||{},p=h.list,r=h.map,u=h.pagerHidden||!1,w=h.searchButton,y=$(b),z=require("services/datacontext"),A=require("services/logger"),B=require(objectbuilders.cultures),C=$("<div></div>"),D=$("<img src=\"/Images/spinner-md.gif\" alt=\"loading\" class=\"absolute-center\" />"),E=function(){D.show(),y.fadeTo("fast",0.33)},F=function(){D.hide(),y.fadeTo("fast",1)},G=null,H=function(L){u||_(L).each(function(M){M.pager={page:G.page(),size:G.pageSize()}}),r&&(L=_(L).map(r)),"string"==typeof p&&g[p](L),"function"==typeof p&&p(L)},I=function(L,M){E(),z.searchAsync({entity:j,page:L,size:M},n).then(function(N){H(N.itemCollection),F()})},J=function(L,M,N){n=L;var O=new $.Deferred;return E(),z.searchAsync({entity:j,page:M||1,size:N||20},L).then(function(P){if(G)G.update(P.rows);else{var Q={element:C,count:P.rows,changed:I,hidden:u};G=new bespoke.utils.ServerPager(Q)}setTimeout(function(){H(P.itemCollection),O.resolve(P),F()},500)}),O.promise()},K=function(L){var M=JSON.parse(ko.toJSON(h.query||h.initialQuery)),N={from:0,size:20,query:{}};M.query=M.query||{},M.query.filtered=M.query.filtered||{},N.query.filtered=M.query.filtered,N.query.filtered.query={query_string:{default_field:"_all",query:L}},M.query.bool&&(N.filter=N.filter||{},N.filter.bool=M.query.bool),N.sort=M.sort,G.destroy(),G=null,J(N)};if("function"==typeof m.subscribe&&m.subscribe(function(L){J(L,1,20)}),k&&l){const L="search-paging-reload",M=g.toolbar.commands().find(N=>N.id===L);M||g.toolbar.commands.push({command:function(){return changed(1,20)},caption:"Reload",icon:"bowtie-icon bowtie-navigate-refresh",id:L})}return k&&!l&&console.error("Please provide a toolbar with commands : ko.observableArray(), in your viewModel"),m.search=J,m.filterAndSearch=K,y.after(C).after(D).fadeTo("slow",0.33),w&&$(document).on("click",w,function(L){return L.preventDefault(),$(this).parents("form")[0].checkValidity()?void J(ko.toJS(m),1,G.pageSize()):void A.error(B.messages.FORM_IS_NOT_VALID)}),J(ko.toJS(n)),{search:J,filterAndSearch:K}}};
ko.bindingHandlers.bootstrapDropDown={init:function(a,b){var c=ko.unwrap(b())||"[Select your value]",d=$(a),f=!1;d.click(function(g){g.preventDefault(),g.stopPropagation();var h=$(this);f?(h.parent().removeClass("open"),f=!1):(h.parent().addClass("open"),f=!0,$(document).one("click",function(){h.parent().removeClass("open"),f=!1}))}),d.html()||("[object Object]"===c.toString()&&(c="[Select you value]"),d.html(c+" <i class=\"fa fa-caret-down\"></i>"))}},ko.bindingHandlers.tooltip={init:function(a,b){var c=ko.unwrap(b()),d=c.tooltipPlacement||c.placement||"top",f=c.text||c.tooltip||c;"string"!=typeof f&&(f=(c.text||{}).tooltip),"string"==typeof f&&$(a).tooltip({title:f,placement:d})}},ko.bindingHandlers.bootstrapPopover={init:function(a,b){var c=ko.unwrap(b()).replace(/</g,"&lt;").replace(/>/g,"&gt;");$(a).popover({content:"<pre>"+c+"</pre>",html:!0,placement:"bottom"})}},ko.bindingHandlers.popover={init:function(a,b){var c=ko.unwrap(b());$(a).popover({content:"<pre>"+c+"</pre>",html:!0})}},ko.bindingHandlers.bootstrapTooltip={init:function(a,b){var c=ko.unwrap(b());$(a).tooltip({title:c})}},ko.bindingHandlers.cssAutoComplete={init:function(a,b){var c=b(),d=_(document.styleSheets).find(function(g){// TODO : what happend if were to combine the css with Bundle
return!!g&&!!g.href&&-1<g.href.indexOf("bootstrap")}),f=["btn","btn-warning","btn-success","btn-link"];d&&(f=_.chain(d.rules).filter(function(g){return /^\./g.test(g.selectorText)&&!/:/g.test(g.selectorText)&&!/\s/g.test(g.selectorText)&&!/\+/g.test(g.selectorText)&&!/>/g.test(g.selectorText)&&!/\[/g.test(g.selectorText)}).map(function(g){return g.selectorText.replace(/\./g,"")}).value()),$(a).typeahead({name:"css_class",limit:10,local:f}).on("typeahead:closed",function(){c($(this).val())})}},ko.bindingHandlers.autocomplete={init:function(a,b,c){var d=ko.unwrap(b()),f=ko.unwrap(d.entity),g=ko.unwrap(d.field),h=ko.unwrap(d.query),i=d.ttl||300000,j=c(),k=String.format("/api/list?table={0}&column={1}&filter={2}",f,g,h),l=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:k,tt1:i,filter:function(m){return _(m).map(function(n){return{name:n}})}}});l.initialize(),$(a).typeahead(null,{name:"autocomplete_"+$(a).prop("id"),displayKey:"name",source:l.ttAdapter()}).on("typeahead:closed",function(){j.value($(this).val())})}},ko.bindingHandlers.scroll={init:function(a,b){var c=ko.unwrap(b());// wait for attached
//setTimeout(function () {
//    // TODO : just do it this once rows is more than certail values
//    $(element).tableScroll({ height: height });
//    done = true;
//}, 500);
}};
(function(){Function.prototype.partial=function(){var a=this,b=Array.prototype.slice.call(arguments);return function(){var c=0;for(var d=0;d<b.length&&c<arguments.length;d++)void 0===b[d]&&(b[d]=arguments[c++]);return a.apply(this,b)}}})();
(function(a){a.bespoke=a.bespoke||{},a.bespoke.ServerOperationStatus={OK:"OK",ERROR:"ERROR"},a.bespoke.messagesText={SAVE_SUCCESS:"Your item has been saved"}})(window);
/// <reference path="bootstrap.js" />
/// <reference path="google-maps-3-vs-1-0-vsdoc.js" />
/// <reference path="bootstrap-datepicker.js" />
/// <reference path="jquery.validate-vsdoc.js" />
/// <reference path="jquery-1.9.1.intellisense.js" />
/// <reference path="moment.js" />
/// <reference path="underscore.js" />
/// <reference path="modernizr-2.6.2.js" />
var _uiready=function(){return{init:function(a){}}}();
(function(a,b){a.bespoke=a.bespoke||{},bespoke.utils=bespoke.utils||{},bespoke.utils.form=bespoke.utils.form||{},bespoke.utils.form.checkValidity=function(c){if(c.form)return c.form.checkValidity();var d=b(c).attr("form");if(d)return document.getElementById(d).checkValidity();throw"cannot find the form for the button"},a.console=a.console||{},a.console.dir=a.console.dir||function(){}})(window,jQuery);
(function(a,b){a.Task=a.Task||{},a.Task.fromResult=function(c,e){var f=new b.Deferred;return setTimeout(function(){f.resolve(c)},e||100),f.promise()}})(window,jQuery);
ko.bindingHandlers.theme={init:function(a,b,c,d,e){// First get the latest data that we're bound to
var f=b(),g=c(),h=ko.unwrap(f);if(bespoke.sph.Theme){var i=new bespoke.sph.Theme;i[h]&&i[h](a,d,g,e)}}};
/// <reference path="jquery-2.2.0.js" />
/// <reference path="jquery-ui-1.11.1.js" />
/// <reference path="modernizr-2.8.3.js" />
/// <reference path="bootstrap.js" />
/// <reference path="breeze.debug.js" />
/// <reference path="knockout-2.2.1.debug.js" />
/// <reference path="moment.js" />
/// <reference path="q.js" />
/// <reference path="toastr-1.1.5.js" />
//# sourceMappingURL=__core.min.js.map
