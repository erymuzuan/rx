var bespoke,_uiready;(function(){$type=String;$type.__typeName="String";$type.__class=!0;$prototype=$type.prototype;$prototype.endsWith=function(n){return this.substr(this.length-n.length)===n};$prototype.startsWith=function(n){return this.substr(0,n.length)===n};$prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};$prototype.trimEnd=function(){return this.replace(/\s+$/,"")};$prototype.trimStart=function(){return this.replace(/^\s+/,"")};$type.format=function(){return String._toFormattedString(!1,arguments)};$type._toFormattedString=function(n,t){for(var o,u,c,r,e="",f=t[0],i=0;;){if(o=f.indexOf("{",i),u=f.indexOf("}",i),o<0&&u<0){e+=f.slice(i);break}if(u>0&&(u<o||o<0)){if(f.charAt(u+1)!=="}")throw new Error("format stringFormatBraceMismatch");e+=f.slice(i,u+1);i=u+2;continue}if(e+=f.slice(i,o),i=o+1,f.charAt(i)==="{"){e+="{";i++;continue}if(u<0)throw new Error("format stringFormatBraceMismatch");var s=f.substring(i,u),h=s.indexOf(":"),l=parseInt(h<0?s:s.substring(0,h),10)+1;if(isNaN(l))throw new Error("format stringFormatInvalid");c=h<0?"":s.substring(h+1);r=t[l];(typeof r=="undefined"||r===null)&&(r="");e+=r.toFormattedString?r.toFormattedString(c):n&&r.localeFormat?r.localeFormat(c):r.format?r.format(c):r.toString();i=u+1}return e}})(window);bespoke=bespoke||{};bespoke.utils={};bespoke.utils.ServerPager=function(n){var o;n=n||{};var f=n.element,s=n.count||0,u=n.changed||function(){console.log("no change event")},i=this,r=_.range(s),e=new kendo.data.DataSource({data:r,pageSize:20}),t=f.kendoPager({dataSource:e,messages:{display:"{0} - {1} of {2} rekod",empty:"Tiada rekod",page:"Muka",of:"dari {0}",itemsPerPage:"rekod setiap mukasurat",first:"Pergi mukasurat pertama",previous:"Pergi ke mukasurat belakang",next:"Sergi mukasurat depan",last:"Pergi mukasurat terakhir",refresh:"Muat"},pageSizes:[10,20,50]}).data("kendoPager");return t.page(1),t.bind("change",function(){u&&u(t.page(),t.pageSize())}),i.update=function(n){r=[];for(var t=0;t<n;t++)r[t]=t;setTimeout(function(){e.data(r)},500)},i.pageSize=function(n){return n&&t.pageSize(n),t.pageSize()},i.page=function(n){return n&&t.page(n),t.page()},o=$(f).find("select").data("kendoDropDownList"),o.bind("change",function(){try{u(1,parseInt(this.value()))}catch(n){}}),i};ko.bindingHandlers.activityClass={init:function(n,t){var r=$(n),i=ko.unwrap(t()),u=typeof i.$type=="function"?i.$type():i.$type,f=/Bespoke\.Sph\.Domain\.(.*?),/.exec(u)[1];r.addClass("activity32").addClass("activity32-"+f)}};ko.bindingHandlers.checkedItems={init:function(n,t){var i=ko.dataFor(n),r=t();$(n).change(function(){var n=$(this).is(":checked");n?r.push(i):r.remove(i)})}};ko.bindingHandlers.typeahead={init:function(n,t,i){var r=ko.unwrap(t()),u=i();$(n).typeahead({name:"schema_paths"+r,limit:10,prefetch:{url:"/WorkflowDefinition/GetVariablePath/"+r,ttl:6e4}}).on("typeahead:closed",function(){u.value($(this).val())})}};ko.bindingHandlers.activityPopover={init:function(n,t){var r=$(n),i=ko.unwrap(t()),e=typeof i.$type=="function"?i.$type():i.$type,o=/Bespoke\.Sph\.Domain\.(.*?),/.exec(e)[1],u=ko.dataFor(r.parent()[0]).wd(),f=r.popover({title:o+" : "+i.Name(),html:!0,content:function(){return $("a.edit-activity").popover("hide"),r.find("a.edit-activity").addClass(i.WebId()),r.find("a.delete-activity").addClass(i.WebId()),r.find("a.start-activity").addClass(i.WebId()),r.find("div.context-menu").html()}});f.on("shown.bs.popover",function(){setTimeout(function(){f.popover("hide")},5e3)});$(document).on("click","a."+i.WebId(),function(n){n.preventDefault();var r=require(objectbuilders.app),t=$(this);t.hasClass("delete-activity")&&r.showMessage("Are you sure you want to remove this Activity","Remove activity",["Yes","No"]).done(function(n){n==="Yes"&&u.removeActivity(i)()});t.hasClass("edit-activity")&&u.editActivity(i)();t.hasClass("start-activity")&&u.setStartActivity(i)()})}};ko.bindingHandlers.comboBoxLookupOptions={init:function(n,t){var i=ko.unwrap(t()),r=i.value,u=require("services/datacontext");u.getTuplesAsync({entity:ko.unwrap(i.entity),query:ko.unwrap(i.query),field:ko.unwrap(i.valuePath),field2:ko.unwrap(i.displayPath)}).done(function(t){n.options.length=0;_(t).each(function(t){n.add(new Option(t.Item2,t.Item1))});$(n).val(ko.unwrap(r)).on("change",function(){r($(this).val())})})},update:function(n,t){var i=ko.unwrap(t()),r=i.value;$(n).val(ko.unwrap(r))}};ko.bindingHandlers.tree={init:function(n,t){var i=t(),r=ko.unwrap(i.entity),f=i.selected,u={text:r.Name(),state:{opened:!0,selected:!0}},e=function(){u.children=_(r.MemberCollection()).map(function(n){return{text:n.Name(),data:n}});$(n).on("select_node.jstree",function(n,t){console.log(n);console.log(t);t.node.data&&f(t.node.data)}).jstree({core:{animation:0,check_callback:!0,themes:{stripes:!0},data:u},types:{"#":{max_children:1,max_depth:4,valid_children:["root"]},root:{icon:"/static/3.0.0-beta3/assets/images/tree_icon.png",valid_children:["default"]},"default":{valid_children:["default","file"]},file:{icon:"glyphicon glyphicon-file",valid_children:[]}},plugins:["contextmenu","dnd","search","state","types","wholerow"]})};e()}};ko.bindingHandlers.kendoEditor={init:function(n,t){var u=$(n),r=t(),i=!1;setTimeout(function(){var n=u.kendoEditor({change:function(){i||(i=!0,r(this.value()),setTimeout(function(){i=!1},500))}}).data("kendoEditor");n.value(r());r.subscribe(function(t){i||(i=!0,n.value(t),setTimeout(function(){i=!1},500))})},500)},update2:function(n,t){var i=$(n),r=t(),u=i.data("kendoEditor");i.data("updating")||u.value(r())}};ko.bindingHandlers.kendoDropDownListValue={init:function(n,t){var r=t(),u=ko.utils.unwrapObservable(r),i=$(n).data("kendoDropDownList");i.value(u);i.bind("change",function(){var n=i.value();r(n)})},update:function(n,t){var r=t(),i=ko.utils.unwrapObservable(r);i&&$(n).data("kendoDropDownList").value(i)}};ko.bindingHandlers.source={};ko.bindingHandlers.kendoComboBox={init:function(n,t,i){var u=t(),f=i(),e=ko.utils.unwrapObservable(u),r=$(n).data("kendoComboBox")||$(n).kendoComboBox({dataSource:f.source()}).data("kendoComboBox");r.value(e);f.source.subscribe(function(n){r.dataSource.data(n)});r.bind("change",function(){var n=r.value();u(n)})},update:function(n,t){var r=t(),i=ko.utils.unwrapObservable(r);i&&$(n).data("kendoComboBox").value(i)}};ko.bindingHandlers.money={init:function(n,t){var i=ko.utils.unwrapObservable(t()),r=parseFloat(i).toFixed(2);$(n).text(r);$(n).val(r);$(n).on("change",function(){var n=$(this).val();i.text(n)})},update:function(n,t){var r=ko.utils.unwrapObservable(t()),i=parseFloat(r).toFixed(2);$(n).text(i);$(n).val(i)}};ko.bindingHandlers.date={init:function(n,t){var i=ko.utils.unwrapObservable(t()),f=ko.unwrap(i.value),u=moment(f),e=ko.unwrap(i.invalid)||"invalid date",r;$(n).on("change",function(){var n=$(this).val();i.value(n)});if(!f){$(n).text(e);$(n).val(e);return}if(!u){$(n).text("");$(n).val("");return}if(u.year()==1){$(n).text("");$(n).val("");return}r=u.format(i.format).toString();r.indexOf("NaN")<0&&($(n).text(r),$(n).val(r))}};ko.bindingHandlers.kendoUpload={init:function(n,t){var r=require(objectbuilders.datacontext),u=require(objectbuilders.logger),i=t();$(n).attr("name","files").kendoUpload({async:{saveUrl:"/BinaryStore/Upload",removeUrl:"/BinaryStore/Remove",autoUpload:!0},multiple:!1,error:function(n){u.logError(n,n,this,!0)},success:function(n){u.info("Your file has been "+n.operation);var f=n.response.storeId,e=n.operation==="upload",o=n.operation!="upload",t=i();e&&(i(f),t&&r.post(JSON.stringify({id:t}),"/BinaryStore/Remove/"));o&&i("")},remove:function(){var n=new $.Deferred,t=JSON.stringify({id:i()});return r.post(t,"/BinaryStore/Remove/").then(function(t){n.resolve(t)}),n.promise()}})}};ko.bindingHandlers.kendoDate={init:function(n,t){var f=t(),r=$(n),e=ko.utils.unwrapObservable(f),i=moment(e),o=function(n){console.log(n);var t=this.value();i=typeof t=="string"?moment(t,"DD/MM/YYYY"):moment(t);r.data("stop","true");f(i.format("YYYY-MM-DD"));r.data("stop","false")},u=r.kendoDatePicker({format:"dd/MM/yyyy",change:o}).data("kendoDatePicker");if(!i){u.value(null);return}if(i.year()===1){u.value(null);return}u.value(i.toDate())},update:function(n,t){var u=$(n);if(u.data("stop")!="true"){var f=t(),e=ko.utils.unwrapObservable(f),i=moment(e),r=u.data("kendoDatePicker");if(!i){r.value(null);return}if(i.year()==1){r.value(null);return}r.value(i.toDate())}}};ko.bindingHandlers.kendoDateTime={init:function(n,t){var f=t(),r=$(n),e=ko.utils.unwrapObservable(f),i=moment(e),o=function(n){console.log(n);var t=this.value();i=typeof t=="string"?moment(t,"DD/MM/YYYY hh:mm"):moment(t);r.data("stop","true");f(i.format());r.data("stop","false")},u=r.kendoDateTimePicker({format:"dd/MM/yyyy HH:mm",change:o}).data("kendoDateTimePicker");if(!i){u.value(null);return}if(i.year()===1){u.value(null);return}u.value(i.toDate())},update:function(n,t){var u=$(n);if(u.data("stop")!="true"){var f=t(),e=ko.utils.unwrapObservable(f),i=moment(e),r=u.data("kendoDateTimePicker");if(!i){r.value(null);return}if(i.year()==1){r.value(null);return}r.value(i.toDate())}}};ko.bindingHandlers.slideVisible={init:function(n,t){var i=t();$(n).toggle(ko.utils.unwrapObservable(i))},update:function(n,t){var i=t();ko.utils.unwrapObservable(i)?$(n).slideDown():$(n).slideUp()}};ko.bindingHandlers.kendoEnable={init:function(n,t){var i=t(),r=ko.utils.unwrapObservable(i);r?$(n).removeClass("k-state-disabled"):$(n).addClass("k-state-disabled")},update:function(n,t){var i=t(),r=ko.utils.unwrapObservable(i);r?($(n).removeClass("k-state-disabled"),$(n).removeAttr("disabled")):($(n).addClass("k-state-disabled"),$(n).attr("disabled","disabled"))}};ko.bindingHandlers.command={init:function(n,t,i){var e=t(),r=$(n),u=i(),o=r.val(),f;u.isvisible&&(f=typeof u.isvisible=="function"?u.isvisible():u.isvisible,f?r.show():r.hide(),typeof u.isvisible=="function"&&u.isvisible.subscribe(function(n){n?r.show():r.hide()}));r.click(function(n){if(n.preventDefault(),!this.form||this.form.checkValidity()){var t=$("<i class='icon-spin icon-spinner icon-large'><\/i>");t.css({"margin-left":-(r.width()/2)-16,position:"fixed","margin-top":"10px"});r.after(t).show();e().then(function(){r.button("complete").prop("disabled",!0).val(o).removeClass("btn-disabled");t.hide()});r.data("loading-text")&&r.button("loading");r.addClass("btn-disabled").prop("disabled",!0)}})}};ko.bindingHandlers.field={init:function(){}};ko.bindingHandlers.unwrapClick={init:function(n,t,i){var u=t(),f=$(n),r=i();f.click(function(n){n.preventDefault();var t=r.property,i=r.accessor,f=r.field;t?(typeof i[t]=="undefined"&&console.log("Can't figure out the accessor.prop"),typeof i[t]=="object"&&(i[t]=ko.observable(i[t])),typeof i[t]=="function"&&u(i[t],f)):u(i,f)})}};ko.bindingHandlers.fieldImage={init:function(n,t){var i=t(),r=$(n),u=typeof i=="function"?i():i;r.attr("src","/image/index/"+u)}};ko.bindingHandlers.stringArrayAutoComplete={init:function(n,t,i){var r=t(),u=i(),f=u.data();$(n).data("kendoAutoComplete")||$(n).kendoAutoComplete({dataSource:f,change:function(){var n=_(this.value().split(",")).filter(function(n){return n});r(n)},filter:"startswith",placeholder:"....",separator:","}).val(r())},update:function(n,t){var i=t();$(n).data("kendoAutoComplete").value(i())}};ko.bindingHandlers.pathAutoComplete={init:function(n,t){var r=t(),i=r.value,u=r.type;u()&&$.get("/App/TriggerPathPickerJson/"+u()).done(function(t){var r=JSON.parse(t),u=_.chain(r).map(function(n){return n.parent===""?n.name:undefined}).filter(function(n){return typeof n!="undefined"}).value(),f,e;console.log(u);f=new kendo.data.DataSource({data:u});e=$(n).data("kendoAutoComplete")||$(n).kendoAutoComplete({dataSource:r,dataTextField:"path",change:function(){var n=this.value();console.log("selected path ",n)},filter:"startswith",placeholder:"Select path...",separator:""}).data("kendoAutoComplete");$(n).change(function(){i($(this).val());console.log("new value",i())}).val(i()).on("keydown3",function(n){var t,i;(n.which===110||n.which===190)&&(t=$(this).val()+".",console.log("show the auto complete",t),i=_.chain(r).filter(function(n){return n.parent===t}).map(function(n){return n.name}).value(),console.log(i),f.data(i),e.refresh())})})}};ko.bindingHandlers.commandWithParameter={init:function(n,t){var r=t(),f=r.command,e=r.commandParameter,i=$(n),u=i.data("complete-text")||i.html();i.click(function(n){n.preventDefault();f(e).then(function(){i.button("complete");i.get(0).tagName=="BUTTON"||i.get(0).tagName=="A"?i.html(u):i.val(u)});i.data("loading-text")&&i.button("loading")})}};ko.bindingHandlers.filter={init:function(n,t,i){var c=t(),l=i(),a=c.path,o=$(n),r=$("<input type='search' class='search-query input-medium form-control' placeholder='Tapis..'>"),s=$("<a href='/#' title='Carian server'><i class='add-on icon-search'><\/i><a>"),e=$("<form class='form-search col-lg-4 col-lg-offset-8'> <div class='input-group pull-right'><span class='input-group-addon'> <span class='glyphicon glyphicon-remove'><\/span><\/span> <\/div> <\/form>"),u=l.searchPaging,f,h;e.find("span.input-group-addon").before(r);u&&e.find("span.glyphicon-remove").after(s);o.before(e);s.click(function(n){var i,t,f;return(n.preventDefault(),i=r.val().toLowerCase(),t=new $.Deferred,!i)?(t.promise(),t.promise()):u?(f={query:{bool:{must:[{query_string:{query:i}}]}}},u.query=f,u.search(f)):t.promise()});f=function(){var n=o.find(a),t=r.val().toLowerCase();n.each(function(){var n=$(this);n.text().toLowerCase().indexOf(t)>-1?n.show():n.hide()})};h=_.throttle(f,800);r.on("keyup",h).siblings("span.input-group-addon").click(function(){r.val("");f()});r.val()&&f()}};ko.bindingHandlers.serverPaging={init:function(n,t,i,r){var u=t(),h=u.entity,c=u.query,f=u.list,l=u.map,e=$(n),a=require("services/datacontext"),v=$("<div><\/div>"),o=$('<img src="/Images/spinner-md.gif" alt="loading" class="absolute-center" />'),w=function(){o.show();e.fadeTo("fast",.33)},y=function(){o.hide();e.fadeTo("fast",1)},p=function(n){l&&(n=_(n).map(l));typeof f=="string"&&r[f](n);typeof f=="function"&&f(n)},b=function(n,t){w();a.loadAsync({entity:h,page:n,size:t,includeTotal:!0},c).then(function(n){p(n.itemCollection);y()})},s;return e.after(v).after(o).fadeTo("slow",.33),s=new $.Deferred,a.loadAsync({entity:h,page:1,size:20,includeTotal:!0},c).then(function(n){var t={element:v,count:n.rows,changed:b},i=new bespoke.utils.ServerPager(t);console.log(i);setTimeout(function(){p(n.itemCollection);s.resolve(!0);y()},500)}),s.promise()}};ko.bindingHandlers.searchPaging={init:function(n,t,i,r){var u=t(),l=u.entity,d=u.query,s=u.initialQuery||{},e=u.list,a=u.map,v=u.searchButton,h=$(n),y=require("services/datacontext"),g=require("services/logger"),nt=require(objectbuilders.cultures),p=$("<div><\/div>"),c=$('<img src="/Images/spinner-md.gif" alt="loading" class="absolute-center" />'),w=function(){c.show();h.fadeTo("fast",.33)},b=function(){c.hide();h.fadeTo("fast",1)},k=function(n){_(n).each(function(n){n.pager={page:f.page(),size:f.pageSize()}});a&&(n=_(n).map(a));typeof e=="string"&&r[e](n);typeof e=="function"&&e(n)},f=null,tt=function(n,t){w();y.searchAsync({entity:l,page:n,size:t},s).then(function(n){k(n.itemCollection);b()})},o=function(n,t,i){s=n;var r=new $.Deferred;return w(),y.searchAsync({entity:l,page:t||1,size:i||20},n).then(function(n){if(f)f.update(n.rows);else{var t={element:p,count:n.rows,changed:tt};f=new bespoke.utils.ServerPager(t)}setTimeout(function(){k(n.itemCollection);r.resolve(n);b()},500)}),r.promise()};if(u.search=o,h.after(p).after(c).fadeTo("slow",.33),v)$(document).on("click",v,function(n){if(n.preventDefault(),!$(this).parents("form")[0].checkValidity()){g.error(nt.messages.FORM_IS_NOT_VALID);return}o(ko.toJS(d),1,f.pageSize())});return o(ko.toJS(s)),{search:o}}};ko.bindingHandlers.bootstrapDropDown={init:function(n){var t=!1,i=function(n){n.preventDefault();n.stopPropagation();var i=$(this);if(t)i.parent().removeClass("open"),t=!1;else{i.parent().addClass("open");t=!0;$(document).one("click",function(){i.parent().removeClass("open");t=!1})}};$(n).click(i)}};ko.bindingHandlers.bootstrapPopover={init:function(n,t){var i=ko.unwrap(t());$(n).popover({content:"<pre>"+i+"<\/pre>",html:!0})}};ko.bindingHandlers.bootstrapTooltip={init:function(n,t){var i=ko.unwrap(t());$(n).tooltip({title:i})}};ko.bindingHandlers.cssAutoComplete={init:function(n,t){var u=t(),i=_(document.styleSheets).find(function(n){return n?n.href?n.href.indexOf("bootstrap")>-1:!1:!1}),r=["btn","btn-warning","btn-success","btn-link"];i&&(r=_.chain(i.rules).filter(function(n){return/^\./g.test(n.selectorText)&&!/:/g.test(n.selectorText)&&!/\s/g.test(n.selectorText)&&!/\+/g.test(n.selectorText)&&!/>/g.test(n.selectorText)&&!/\[/g.test(n.selectorText)}).map(function(n){return n.selectorText.replace(/\./g,"")}).value());$(n).typeahead({name:"css_class",limit:10,local:r}).on("typeahead:closed",function(){u($(this).val())})}};ko.bindingHandlers.autocomplete={init:function(n,t,i){var r=ko.unwrap(t()),u=ko.unwrap(r.entity),f=ko.unwrap(r.field),e=ko.unwrap(r.query),o=i();$(n).typeahead({name:"autocomplete_"+$(n).prop("id"),limit:5,prefetch:{url:String.format("/list?table={0}&column={1}&filter={2}",u,f,e),ttl:6e4}}).on("typeahead:closed",function(){o.value($(this).val())})}},function(){Function.prototype.partial=function(){var t=this,n=Array.prototype.slice.call(arguments);return function(){for(var r=0,i=0;i<n.length&&r<arguments.length;i++)n[i]===undefined&&(n[i]=arguments[r++]);return t.apply(this,n)}}}(),function(n){n.bespoke=n.bespoke||{};n.bespoke.ServerOperationStatus={OK:"OK",ERROR:"ERROR"};n.bespoke.messagesText={SAVE_SUCCESS:"Your item has been saved"}}(window);_uiready=function(){var n=function(){};return{init:n}}(),function(n,t){n.bespoke=n.bespoke||{};bespoke.utils=bespoke.utils||{};bespoke.utils.form=bespoke.utils.form||{};bespoke.utils.form.checkValidity=function(n){if(n.form)return n.form.checkValidity();var i=t(n).attr("form");if(i)return document.getElementById(i).checkValidity();throw"cannot find the form for the button";};n.console=n.console||{};n.console.dir=n.console.dir||function(){}}(window,jQuery),function(n,t){n.Task=n.Task||{};n.Task.fromResult=function(n,i){var r=new t.Deferred,u=n||!0,f=i||100;return setTimeout(function(){r.resolve(u)},f),r.promise()}}(window,jQuery);ko.bindingHandlers.theme={init:function(n,t,i,r,u){var o=t(),s=i(),e=ko.unwrap(o),f;bespoke.sph.Theme&&(f=new bespoke.sph.Theme,f[e]&&f[e](n,r,s,u))}};
/*
//# sourceMappingURL=core.min.js.map
*/