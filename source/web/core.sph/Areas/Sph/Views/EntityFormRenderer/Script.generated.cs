#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.34014
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace Bespoke.Sph.Web.Areas.Sph.Views.EntityFormRenderer
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    
    #line 1 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
    using Bespoke.Sph.Domain;
    
    #line default
    #line hidden
    
    #line 3 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
    using Humanizer;
    
    #line default
    #line hidden
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Areas/Sph/Views/EntityFormRenderer/Script.cshtml")]
    public partial class Script : System.Web.Mvc.WebViewPage<Bespoke.Sph.Web.ViewModels.FormRendererViewModel>
    {
        public Script()
        {
        }
        public override void Execute()
        {



WriteLiteral("\n\n");


            
            #line 6 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
  
    ViewBag.Title = "title";
    Layout = null;
    var ns = ConfigurationManager.ApplicationName.ToCamelCase() + "_" + this.Model.EntityDefinition.EntityDefinitionId;
    var typeCtor = string.Format("bespoke.{0}.domain.{1}({{WebId:system.guid()}})", ns, Model.EntityDefinition.Name);
    var typeName = string.Format("bespoke.{0}.domain.{1}", ns, Model.EntityDefinition.Name);
    var saveUrl = string.Format("/{0}/Save", @Model.EntityDefinition.Name);
    var validateUrl = string.Format("/Sph/BusinessRule/Validate?{0};{1}", @Model.EntityDefinition.Name, string.Join(";", Model.Form.Rules.Select(r => r.Dehumanize())));
    var codeNamespace = ConfigurationManager.ApplicationName + "_" + Model.EntityDefinition.EntityDefinitionId;
    var buttonOperations = Model.Form.FormDesign.FormElementCollection.OfType<Button>()
        .Where(b => b.IsToolbarItem)
        .Where(b => !string.IsNullOrWhiteSpace(b.Operation))
        .Select(b => string.Format("{{ caption :\"{0}\", command : {1}, icon:\"{2}\" }}", b.Label, b.Operation.ToCamelCase(), b.IconClass));

    var commands = Model.Form.FormDesign.FormElementCollection.OfType<Button>()
        .Where(b => b.IsToolbarItem)
        .Where(b => !string.IsNullOrWhiteSpace(b.CommandName))
        .Select(b => string.Format("{{ caption :\"{0}\", command : {1}, icon:\"{2}\" }}", b.Label, b.CommandName, b.IconClass));
    var commandsJs = string.Format("[{0}]", string.Join(",", commands.Concat(buttonOperations)));


    var formId = @Model.Form.Route + "-form";
    var saveOperation = Model.Form.Operation;


            
            #line default
            #line hidden
WriteLiteral(@"
<h2>title</h2>
<script type=""text/javascript"" src=""~/Scripts/knockout-3.1.0.debug.js""></script>
<script type=""text/javascript"" data-script=""true"">
    define([objectbuilders.datacontext, objectbuilders.logger, objectbuilders.router, objectbuilders.system, objectbuilders.validation, objectbuilders.eximp, objectbuilders.dialog, objectbuilders.watcher, objectbuilders.config, objectbuilders.app],
        function (context, logger, router, system, validation, eximp, dialog, watcher,config,app) {

            var entity = ko.observable(new ");


            
            #line 37 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                      Write(Html.Raw(typeCtor));

            
            #line default
            #line hidden
WriteLiteral(@"),
                errors = ko.observableArray(),
                form = ko.observable(new bespoke.sph.domain.EntityForm()),
                watching = ko.observable(false),
                id = ko.observable(),
                activate = function (entityId) {
                    id(parseInt(entityId));

                    var query = String.format(""");


            
            #line 45 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                           Write(Model.EntityDefinition.Name + "Id");

            
            #line default
            #line hidden
WriteLiteral(" eq {0}\", entityId),\n                        tcs = new $.Deferred(),\n            " +
"            itemTask = context.loadOneAsync(\"");


            
            #line 47 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                    Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("\", query),\n                        formTask = context.loadOneAsync(\"EntityForm\", " +
"\"Route eq \'");


            
            #line 48 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                                            Write(Model.Form.Route);

            
            #line default
            #line hidden
WriteLiteral("\'\"),\n                        watcherTask = watcher.getIsWatchingAsync(\"");


            
            #line 49 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                             Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral(@""", entityId);

                    $.when(itemTask, formTask, watcherTask).done(function(b,f,w) {
                        if (b) {
                            var item = context.toObservable(b);
                            entity(item);
                        }
                        else {
                            entity(new ");


            
            #line 57 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                  Write(Html.Raw(typeCtor));

            
            #line default
            #line hidden
WriteLiteral(");\n                        }\n                        form(f);\n                   " +
"     watching(w);\n\n                        tcs.resolve(true);\n                  " +
"  });\n\n                    return tcs.promise();\n                },\n");


            
            #line 67 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                  foreach (var operation in Model.EntityDefinition.EntityOperationCollection)
            {
                var opFunc = operation.Name.ToCamelCase();

            
            #line default
            #line hidden
WriteLiteral("                ");


            
            #line 70 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                 Write(opFunc);

            
            #line default
            #line hidden
WriteLiteral(@" = function(){

                     if (!validation.valid()) {
                         return Task.fromResult(false);
                     }

                     var tcs = new $.Deferred(),
                         data = ko.mapping.toJSON(entity);

                     context.post(data, ""/");


            
            #line 79 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                     Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("/");


            
            #line 79 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                                  Write(operation.Name);

            
            #line default
            #line hidden
WriteLiteral("\" )\n                         .then(function (result) {\n                          " +
"   if (result.success) {\n                                 logger.info(result.mes" +
"sage);\n                                 entity().");


            
            #line 83 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                      Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("Id(result.id);\n                                 errors.removeAll();\n\n            " +
"                     ");


            
            #line 86 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                             Write(Html.Raw(operation.GetConfirmationMessage()));

            
            #line default
            #line hidden
WriteLiteral(@"
                             } else {
                                 errors.removeAll();
                                 _(result.rules).each(function(v){
                                     errors(v.ValidationErrors);
                                 });
                                 logger.error(""There are errors in your entity, !!!"");
                             }
                             tcs.resolve(result);
                         });
                     return tcs.promise();
                 },");

WriteLiteral("\n");


            
            #line 98 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
            }

            
            #line default
            #line hidden
WriteLiteral("                attached = function (view) {\n                    // validation\n  " +
"                  validation.init($(\'#");


            
            #line 101 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                   Write(formId);

            
            #line default
            #line hidden
WriteLiteral("\'), form());\n\n                },\n\n");


            
            #line 105 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                 foreach (var rule in Model.Form.Rules)
                {
                    var function = rule.Dehumanize().ToCamelCase();

            
            #line default
            #line hidden
WriteLiteral("                  ");


            
            #line 108 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                   Write(function);

            
            #line default
            #line hidden
WriteLiteral(" = function(){\n\n                    var tcs = new $.Deferred(),\n                 " +
"       data = ko.mapping.toJSON(entity);\n\n                    context.post(data," +
" \"/Sph/BusinessRule/Validate?");


            
            #line 113 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                              Write(function);

            
            #line default
            #line hidden
WriteLiteral("\" )\n                        .then(function (result) {\n                           " +
" tcs.resolve(result);\n                        });\n                    return tcs" +
".promise();\n                },");

WriteLiteral("\n");


            
            #line 119 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                }

            
            #line default
            #line hidden

            
            #line 120 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                 foreach (var btn in Model.Form.FormDesign.FormElementCollection.OfType<Button>())
                {
                    if (string.IsNullOrWhiteSpace(btn.CommandName))
                    {
                        continue;
                    }
                    var function = btn.CommandName;

            
            #line default
            #line hidden
WriteLiteral("                  ");


            
            #line 127 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                   Write(function);

            
            #line default
            #line hidden
WriteLiteral(" = function(){\n                    ");


            
            #line 128 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
               Write(Html.Raw(btn.Command));

            
            #line default
            #line hidden
WriteLiteral("\n                },");

WriteLiteral("\n");


            
            #line 130 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                }

            
            #line default
            #line hidden
WriteLiteral(@"                save = function() {
                    if (!validation.valid()) {
                        return Task.fromResult(false);
                    }

                    var tcs = new $.Deferred(),
                        data = ko.mapping.toJSON(entity);

");


            
            #line 139 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                     if (Model.Form.Rules.Any())
                    {


            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("\n\n                    context.post(data, \"");


            
            #line 144 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                   Write(validateUrl);

            
            #line default
            #line hidden
WriteLiteral("\")\n                        .then(function(result) {\n                            i" +
"f(result.success){\n                                context.post(data, \"");


            
            #line 147 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                               Write(saveUrl);

            
            #line default
            #line hidden
WriteLiteral("\")\n                                   .then(function(result) {\n                  " +
"                     tcs.resolve(result);\n                                      " +
" entity().");


            
            #line 150 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                            Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("Id(result.id);\n                                       app.showMessage(\"Your ");


            
            #line 151 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                        Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral(" has been successfully saved\", \"");


            
            #line 151 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                                                                                    Write(ConfigurationManager.ApplicationFullName);

            
            #line default
            #line hidden
WriteLiteral("\", [\"ok\"]);\n                                   });\n                            }e" +
"lse{\n                                tcs.resolve(result);\n                      " +
"      }\n                        });\n                    ");

WriteLiteral("\n");


            
            #line 158 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                    }
                    else
                    {

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("\n\n                    context.post(data, \"");


            
            #line 163 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                   Write(saveUrl);

            
            #line default
            #line hidden
WriteLiteral("\")\n                        .then(function(result) {\n                            t" +
"cs.resolve(result);\n                            entity().");


            
            #line 166 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                 Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("Id(result.id);\n                            app.showMessage(\"Your ");


            
            #line 167 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                             Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral(" has been successfully saved\", \"");


            
            #line 167 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                                                                         Write(ConfigurationManager.ApplicationFullName);

            
            #line default
            #line hidden
WriteLiteral("\", [\"ok\"]);\n\n                        });\n                    ");

WriteLiteral("\n");


            
            #line 171 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                    }

            
            #line default
            #line hidden
WriteLiteral("\n                    return tcs.promise();\n                },\n                rem" +
"ove = function() {\n                    var tcs = new $.Deferred();\n             " +
"       $.ajax({\n                        type: \"DELETE\",\n                        " +
"url: \"/");


            
            #line 179 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                           Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("/Remove/\" + entity().");


            
            #line 179 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                                              Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral(@"Id(),
                        contentType: ""application/json; charset=utf-8"",
                        dataType: ""json"",
                        error: tcs.reject,
                        success: function() {
                            tcs.resolve(true);
                            app.showMessage(""Your item has been successfully removed"", ""Removed"", [""OK""])
                              .done(function () {
                                  window.location = ""#");


            
            #line 187 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                  Write(Model.EntityDefinition.Name.ToLowerInvariant());

            
            #line default
            #line hidden
WriteLiteral("\";\n                              });\n                        }\n                  " +
"  });\n\n\n                    return tcs.promise();\n                };\n\n          " +
"  var vm = {\n");


            
            #line 197 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                 foreach (var rule in Model.Form.Rules)
                    {
                        var function = rule.Dehumanize().ToCamelCase();

            
            #line default
            #line hidden
WriteLiteral("                    ");


            
            #line 200 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                     Write(function);

            
            #line default
            #line hidden
WriteLiteral(" : ");


            
            #line 200 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                 Write(function);

            
            #line default
            #line hidden
WriteLiteral(",");

WriteLiteral("\n");


            
            #line 201 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                    }

            
            #line default
            #line hidden
WriteLiteral("                activate: activate,\n                config: config,\n             " +
"   attached: attached,\n                entity: entity,\n                errors: e" +
"rrors,\n                save : save,\n");


            
            #line 208 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                 foreach (var op in Model.EntityDefinition.EntityOperationCollection)
                {
                        var function = op.Name.ToCamelCase();

            
            #line default
            #line hidden
WriteLiteral("                    ");


            
            #line 211 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                     Write(function);

            
            #line default
            #line hidden
WriteLiteral(" : ");


            
            #line 211 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                 Write(function);

            
            #line default
            #line hidden
WriteLiteral(",");

WriteLiteral("\n");


            
            #line 212 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"

                }

            
            #line default
            #line hidden
WriteLiteral("                //\n\n");


            
            #line 216 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                 foreach (var btn in Model.Form.FormDesign.FormElementCollection.OfType<Button>().Where(b => !string.IsNullOrWhiteSpace(b.CommandName)))
                {

            
            #line default
            #line hidden
WriteLiteral("                    ");


            
            #line 218 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                      Write(btn.CommandName);

            
            #line default
            #line hidden
WriteLiteral(" : ");


            
            #line 218 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                           Write(btn.CommandName);

            
            #line default
            #line hidden
WriteLiteral(" ,\n                ");

WriteLiteral("\n");


            
            #line 220 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                }

            
            #line default
            #line hidden
WriteLiteral("\n                toolbar : {\n");


            
            #line 223 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                     if (Model.Form.IsEmailAvailable)
                    {

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("emailCommand : {\n                        entity : \"");


            
            #line 226 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                             Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("\",\n                        id :id\n                    },");

WriteLiteral("\n");


            
            #line 229 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                    }

            
            #line default
            #line hidden

            
            #line 230 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                     if (Model.Form.IsPrintAvailable)
                    {

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("printCommand :{\n                        entity : \'");


            
            #line 233 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                             Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("\',\n                        id : id\n                    },");

WriteLiteral("\n");


            
            #line 236 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                    }

            
            #line default
            #line hidden

            
            #line 237 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                     if (Model.Form.IsRemoveAvailable)
            {

            
            #line default
            #line hidden
WriteLiteral("                ");

WriteLiteral("removeCommand :remove,\n                    canExecuteRemoveCommand : ko.computed(" +
"function(){\n                        return entity().");


            
            #line 241 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                    Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("Id();\n                    }),");

WriteLiteral("\n");


            
            #line 243 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
            }

            
            #line default
            #line hidden

            
            #line 244 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                     if (Model.Form.IsWatchAvailable)
                    {

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("\n                    watchCommand: function() {\n                        return wa" +
"tcher.watch(\"");


            
            #line 248 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                         Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("\", entity().");


            
            #line 248 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                                                  Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("Id())\n                            .done(function(){\n                             " +
"   watching(true);\n                            });\n                    },\n      " +
"              unwatchCommand: function() {\n                        return watche" +
"r.unwatch(\"");


            
            #line 254 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                           Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("\", entity().");


            
            #line 254 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                                                                    Write(Model.EntityDefinition.Name);

            
            #line default
            #line hidden
WriteLiteral("Id())\n                            .done(function(){\n                             " +
"   watching(false);\n                            });\n                    },\n     " +
"               watching: watching,");

WriteLiteral("\n");


            
            #line 260 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                    }

            
            #line default
            #line hidden

            
            #line 261 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                     if (!string.IsNullOrWhiteSpace(@saveOperation))
                    {

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("\n                    saveCommand : ");


            
            #line 264 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                             Write(saveOperation.ToCamelCase());

            
            #line default
            #line hidden
WriteLiteral(",\n                    ");

WriteLiteral("\n");


            
            #line 266 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                    }

            
            #line default
            #line hidden
WriteLiteral("                    commands : ko.observableArray(");


            
            #line 267 "..\..\Areas\Sph\Views\EntityFormRenderer\Script.cshtml"
                                             Write(Html.Raw(commandsJs));

            
            #line default
            #line hidden
WriteLiteral(")\n                }\n            };\n\n            return vm;\n        });\n</script>");


        }
    }
}
#pragma warning restore 1591
