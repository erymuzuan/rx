@using Bespoke.Sph.Web.Models
@{
    Layout = null;
}
<h1 data-bind="with : entity">View Designer for <span data-bind="text:Plural"></span></h1>
<div class="row">
    <a data-toggle="collapse" href="#general-ev-panel">
        <h3>
            <i class="fa fa-chevron-down"></i>
            General options
        </h3>
    </a>
    <div class="collapse in" id="general-ev-panel">

        <form class="form-horizontal" data-bind="with : view">
            <div class="form-group">
                <label for="view-name" class="col-lg-2 control-label">Name</label>
                <div class="col-lg-6">
                    <input type="text" data-bind="value: Name"
                           required pattern="^[A-Za-z_][A-Za-z0-9_ ]*$"
                           placeholder="Name for the view"
                           class="form-control" id="view-name">
                </div>
            </div>
            <div class="form-group">
                <label for="view-route" class="col-lg-2 control-label">Route</label>
                <div class="col-lg-6">
                    <input type="text" data-bind="value: Route"
                           required pattern="^[A-Za-z_][A-Za-z0-9_-]*$"
                           placeholder="route url"
                           class="form-control" id="view-route">
                </div>
            </div>
            <div class="form-group">
                <label for="icon-storeid" class="col-lg-2 control-label">Icon/Logo</label>
                <div class="col-lg-6">
                    <img width="150" height="150" data-bind="attr : {src:'/sph/image/thumbnail/' + IconStoreId()}" alt="Logo" />
                    <input type="file" data-bind="kendoUpload: IconStoreId" name="files" class="form-control" id="icon-storeid">
                </div>
            </div>
            <div class="form-group">
                <label for="view-note" class="col-lg-2 control-label">Note</label>
                <div class="col-lg-6">
                    <textarea data-bind="value: Note"
                              placeholder="Note about the view"
                              class="form-control" id="view-note"></textarea>
                </div>
            </div>
        </form>
    </div>
</div>
<div class="row" data-bind="with : view">
    <a data-toggle="collapse" href="#filters-ev-panel">
        <h3>
            <i class="fa fa-chevron-down"></i>
            Filters
        </h3>
    </a>

    <div class="collapse collapsed" id="filters-ev-panel">
        <button class="btn btn-link pull-right" data-bind="click : addFilter">+ Filter</button>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Term</th>
                    <th>Operator</th>
                    <th>Value</th>
                    <th></th>
                </tr>
            </thead>
            <tbody data-bind="foreach :FilterCollection">
                <tr>
                    <td>
                        <input class="form-control" type="text"
                               data-bind="value:Term,entityTypeaheadPath :$root.entity().EntityDefinitionId()"
                               required pattern="^[A-Za-z][A-Za-z0-9_.]*$" />
                    </td>
                    <td>
                        <select name="rule-operator" class="form-control" data-bind="value: Operator">
                            <option value="Eq">=</option>
                            <option value="Le">&lt;=</option>
                            <option value="Lt">&lt;</option>
                            <option value="Ge">&gt;=</option>
                            <option value="Gt">&gt;</option>
                            <option value="Substringof">Substringof</option>
                            <option value="StartsWith">StartsWith</option>
                            <option value="EndsWith">EndsWith</option>
                        </select>
                    </td>
                    <td>                    @Html.Partial("_TriggerFieldDropDown", new TypeModel { Path = "Field" })</td>
                    <td>
                        <a href="#" data-bind="click : $parent.removeFilter.call($parent,$data)">
                            <span class="glyphicon glyphicon-remove"></span>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>
</div>


<div class="row" data-bind="with : view">
    <a data-toggle="collapse" href="#sorts-ev-panel">
        <h3>
            <i class="fa fa-chevron-down"></i>
            Sorts
        </h3>
    </a>

    <div class="collapse collapsed" id="sorts-ev-panel">
        <button class="btn btn-link pull-right" data-bind="click : addSort">+ Sort</button>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Path</th>
                    <th>Direction</th>
                    <th></th>
                </tr>
            </thead>
            <tbody data-bind="foreach :SortCollection">
                <tr>
                    <td>
                        <input class="form-control" type="text"
                               data-bind="value:Path,entityTypeaheadPath :$root.entity().EntityDefinitionId()"
                               required pattern="^[A-Za-z][A-Za-z0-9_.]*$" />
                    </td>
                    <td>
                        <select name="rule-operator" class="form-control" data-bind="value: Direction">
                            <option value="Asc">Ascending</option>
                            <option value="Desc">Desc</option>
                        </select>
                    </td>
                    <td>
                        <a href="#" data-bind="click : $parent.removeSort.call($parent,$data)">
                            <span class="glyphicon glyphicon-remove"></span>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>
</div>


<div class="row" data-bind="with : view">
    <a data-toggle="collapse" href="#columns-ev-panel">
        <h3>
            <i class="fa fa-chevron-down"></i>
           Columns
        </h3>
    </a>

    <div class="collapse in" id="columns-ev-panel">
        <button class="btn btn-link pull-right" data-bind="click : addViewColumn">+ Column</button>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Path</th>
                    <th>Header</th>
                    <th></th>
                </tr>
            </thead>
            <tbody data-bind="foreach :ViewColumnCollection">
                <tr>
                    <td>
                        <input class="form-control" type="text" data-bind="value:Path,entityTypeaheadPath :$root.entity().EntityDefinitionId()" required pattern="^[A-Za-z][A-Za-z0-9_.]*$" />
                    </td>
                    <td>
                        <input class="form-control" type="text" data-bind="value:Header" required />
                    <td>
                        <a href="#" data-bind="click : $parent.removeViewColumn.call($parent,$data)">
                            <span class="glyphicon glyphicon-remove"></span>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>
</div>