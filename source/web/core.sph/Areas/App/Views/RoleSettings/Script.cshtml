@model IEnumerable<Bespoke.Sph.Web.ViewModels.RoleModel>
@{
    Layout = null;
}

<h2>RoleSettingsJs</h2>
<script type="text/javascript" data-script="true">
    define(['services/datacontext', objectbuilders.logger],
        function (context, logger) {

            var activate = function (rid) {
                var id = parseInt(rid);
                if (id) {
                    var query = String.format("DesignationId eq {0}", id);
                    var tcs = new $.Deferred();
                    context.loadOneAsync("Designation", query)
                        .done(function (b) {
                            vm.designation(b);
                            tcs.resolve(true);
                        });

                    return tcs.promise();

                } else {
                    vm.designation(new bespoke.sph.domain.Designation());
                }

                return true;

            },

            save = function () {
                var tcs = new $.Deferred();
                var data = ko.toJSON(vm.designation);

                context.post(data, "/Designation/Save")
                    .then(function (result) {
                        tcs.resolve(result);
                        logger.info("Designation is successfully saved");
                    });
                return tcs.promise();
            };

            var vm = {
                activate: activate,
                designation: ko.observable(),
                toolbar:{saveCommand: save}
            };

            return vm;


        });
</script>
