@model MembershipUser
@{
    Layout = null;
}
<script type="text/javascript" data-script="true">
    
define(['services/datacontext'],
    function (context) {


        var isBusy = ko.observable(false),
            username = ko.observable('@Model.UserName'),
            activate = function () {
                var query = String.format("Username eq '{0}'", username());
                var tcs = new $.Deferred();
                context.loadOneAsync("UserProfile", query)
                    .done(function(b) {
                        vm.userProfile(b);
                        tcs.resolve(true);
                    });

                return tcs.promise();
            },
            saveAsync = function () {
            var tcs = new $.Deferred();
            var data = ko.mapping.toJSON(vm.userProfile());
                context.post(data, "/Admin/UpdateUser")
                .done(function (e) {
                  tcs.resolve(e);
                });
            return tcs.promise();
        };

        var vm = {
            activate: activate,
            userProfile : ko.observable(new bespoke.sphcommercialspace.domain.UserProfile()),
            saveCommand: saveAsync,
            isBusy: isBusy,
            title: 'User profile Details'
        };

        return vm;
    });
</script>