@model dynamic

@{
    ViewBag.Title = "title";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript" data-script="true">
    define(['services/datacontext'], function (context) {
        var isBusy = ko.observable(false),
            complaint = ko.observable(new bespoke.sphcommercialspace.domain.Complaint()),
            activate = function () {
                var query = String.format("ComplaintId gt 0");
                
                var tcs = new $.Deferred();
                context.loadAsync("Complaint", query)
                    .then(function(lo) {
                        isBusy(false);
                        vm.complaintCollection(lo.itemCollection);
                        
                        tcs.resolve(true);
                    });
                return tcs.promise();
            },
            exportList = function (){};
            

        var vm = {
            activate: activate,
            complaintCollection: ko.observableArray(),
            toolbar: ko.observable({
                reloadCommand: function () {
                    return activate();
                },
                printCommand: ko.observable({
                    entity: ko.observable("Complaint"),
                    id: ko.observable(0),
                    item: complaint,
                }),
                exportCommand: exportList,
            })
        };

        return vm;
    });
</script>
