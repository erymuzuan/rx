@model dynamic

@{
    ViewBag.Title = "title";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript" data-script="true">
    define(['services/mockMaintenanceContext'], function (context) {
        var isBusy = ko.observable(false),
            activate = function() {
                var query = String.format("MaintenanceId gt 0");
                var tcs = new $.Deferred();
                context.loadAsync("Maintenance", query)
                    .then(function(lo) {
                        isBusy(false);
                        vm.maintenances(lo.itemCollection);
                        tcs.resolve(true);
                    });
                return tcs.promise();
            },
            
            assign = function() {
               var tcs = new $.Deferred();
               var data = ko.toJSON(vm.maintenances);
               isBusy(true);

               context.post(data, "/Maintenance/Assign")
                   .then(function (result) {
                       isBusy(false);
                       tcs.resolve(result);
                   });
               return tcs.promise();
            };


        var vm = {
            activate: activate,
            maintenances: ko.observableArray(),
            assignCommand : assign
        };

        return vm;
    });
</script>
