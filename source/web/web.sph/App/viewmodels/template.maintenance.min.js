define([objectbuilders.datacontext,"durandal/system","./template.base","services/jsonimportexport",objectbuilders.logger,objectbuilders.cultures,objectbuilders.defaultValueProvider],function(n,t,i,r,u,f,e){var h=ko.observable(!1),s=ko.observable(),c=function(r){var f=[],e=new bespoke.sph.domain.AddressElement(t.guid()),u,h,l,c;return e.CssClass("icon-envelope pull-left"),e.Name("Address"),f.push(e),u=new bespoke.sph.domain.MaintenanceOfficerElement(t.guid()),u.CssClass("icon-user pull-left"),u.Name("Officers"),f.push(u),i.activate(f),h=parseInt(r.id),s(h),h?(l=String.format("MaintenanceTemplateId eq {0}",s()),c=new $.Deferred,n.loadOneAsync("MaintenanceTemplate",l).done(function(n){_(n.FormDesign().FormElementCollection()).each(function(n){n.isSelected=ko.observable(!1)});o.template(n);i.designer(o.template().FormDesign());c.resolve(!0)}),c.promise()):(o.template(new bespoke.sph.domain.MaintenanceTemplate),o.template().FormDesign().Name("My form 1"),o.template().FormDesign().Description("Do whatever it takes"),i.designer(o.template().FormDesign()),!0)},l=function(){var t=new $.Deferred,r=_($("#template-form-designer>form>div")).map(function(n){return ko.dataFor(n)}),i;return o.template().FormDesign.FormElementCollection(r),i=ko.mapping.toJSON(o.template()),n.post(i,"/Template/SaveMaintenanceTemplate").then(function(n){h(!1);u.info(f.maintenance.SAVE_TEMPLATE);t.resolve(n)}),t.promise()},a=function(){return r.exportJson("template.maintenance."+o.template().MaintenanceTemplateId()+".json",ko.mapping.toJSON(o.template))},v=function(){return r.importJson().done(function(t){try{var i=JSON.parse(t),r=n.toObservable(i);o.template(r);o.template().MaintenanceTemplateId(0)}catch(f){u.logError("Fail template import tidak sah",f,this,!0)}})},y=function(){return e.loadAsync("Maintenance",o.template())},o={activate:c,viewAttached:i.viewAttached,template:ko.observable(new bespoke.sph.domain.MaintenanceTemplate),toolbar:{saveCommand:l,exportCommand:a,importCommand:v},customFormElements:i.customFormElements,formElements:i.formElements,selectFormElement:i.selectFormElement,selectedFormElement:i.selectedFormElement,removeFormElement:i.removeFormElement,removeComboBoxOption:i.removeComboBoxOption,selectPathFromPicker:i.selectPathFromPicker,showPathPicker:i.showPathPicker,addComboBoxOption:i.addComboBoxOption,loadDefaultValueFields:y};return o});
//# sourceMappingURL=template.maintenance.min.js.map