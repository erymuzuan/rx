define([objectbuilders.datacontext,"durandal/system","./template.base","services/jsonimportexport",objectbuilders.logger,objectbuilders.cultures],function(n,t,i,r,u,f){var s=ko.observable(!1),o=ko.observable(),h=function(r){var f=[],s=new bespoke.sph.domain.AddressElement(t.guid()),u,h,l,c;return s.CssClass("icon-envelope pull-left"),s.Name("Address"),f.push(s),u=new bespoke.sph.domain.MaintenanceOfficerElement(t.guid()),u.CssClass("icon-user pull-left"),u.Name("Officers"),f.push(u),i.activate(f),h=parseInt(r.id),o(h),h?(l=String.format("MaintenanceTemplateId eq {0}",o()),c=new $.Deferred,n.loadOneAsync("MaintenanceTemplate",l).done(function(n){_(n.FormDesign().FormElementCollection()).each(function(n){n.isSelected=ko.observable(!1)});e.template(n);i.designer(e.template().FormDesign());c.resolve(!0)}),c.promise()):(e.template(new bespoke.sph.domain.MaintenanceTemplate),e.template().FormDesign().Name("My form 1"),e.template().FormDesign().Description("Do whatever it takes"),i.designer(e.template().FormDesign()),!0)},c=function(){var t=new $.Deferred,r=_($("#template-form-designer>form>div")).map(function(n){return ko.dataFor(n)}),i;return e.template().FormDesign.FormElementCollection(r),i=ko.mapping.toJSON(e.template()),n.post(i,"/Template/SaveMaintenanceTemplate").then(function(n){s(!1);u.info(f.maintenance.SAVE_TEMPLATE);t.resolve(n)}),t.promise()},l=function(){return r.exportJson("template.maintenance."+e.template().MaintenanceTemplateId()+".json",ko.mapping.toJSON(e.template))},a=function(){return r.importJson().done(function(t){try{var i=JSON.parse(t),r=n.toObservable(i);e.template(r);e.template().MaintenanceTemplateId(0)}catch(f){u.logError("Fail template import tidak sah",f,this,!0)}})},e={activate:h,viewAttached:i.viewAttached,template:ko.observable(new bespoke.sph.domain.MaintenanceTemplate),toolbar:{saveCommand:c,exportCommand:l,importCommand:a},customFormElements:i.customFormElements,formElements:i.formElements,selectFormElement:i.selectFormElement,selectedFormElement:i.selectedFormElement,removeFormElement:i.removeFormElement,removeComboBoxOption:i.removeComboBoxOption,selectPathFromPicker:i.selectPathFromPicker,showPathPicker:i.showPathPicker,addComboBoxOption:i.addComboBoxOption};return e});
//# sourceMappingURL=template.maintenance.min.js.map