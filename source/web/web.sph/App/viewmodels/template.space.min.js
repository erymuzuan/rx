define(["services/datacontext","durandal/system","./template.base","services/jsonimportexport","services/logger","config"],function(n,t,i,r,u,f){var o=ko.observable(),s=function(r){var u=[],l=new bespoke.sph.domain.AddressElement(t.guid()),f,s,h,c,a,y,v;return l.CssClass("icon-envelope pull-left"),l.Name("Address"),u.push(l),f=new bespoke.sph.domain.BuildingElement(t.guid()),f.CssClass("icon-building pull-left"),f.Name("Building"),u.push(f),s=new bespoke.sph.domain.BuildingMapElement(t.guid()),s.CssClass("icon-globe pull-left"),s.Name("Map"),u.push(s),h=new bespoke.sph.domain.SpaceUnitElement(t.guid()),h.CssClass("icon-check-empty pull-left"),h.Name("Unit"),u.push(h),c=new bespoke.sph.domain.SpaceFeaturesElement(t.guid()),c.CssClass("icon-list-ol pull-left"),c.Name("Features"),u.push(c),i.activate(u),a=parseInt(r.id),o(a),a?(y=String.format("SpaceTemplateId eq {0}",o()),v=new $.Deferred,n.loadOneAsync("SpaceTemplate",y).done(function(n){_(n.FormDesign().FormElementCollection()).each(function(n){n.isSelected=ko.observable(!1)});e.template(n);i.designer(e.template().FormDesign());v.resolve(!0)}),v.promise()):(e.template(new bespoke.sph.domain.SpaceTemplate),e.template().FormDesign().Name("jenis ruang anda"),e.template().FormDesign().Description("Keterangan jenis ruang"),i.designer(e.template().FormDesign()),!0)},h=function(){var t=new $.Deferred,r=_($("#template-form-designer>form>div")).map(function(n){return ko.dataFor(n)}),i;return e.template().FormDesign().FormElementCollection(r),i=ko.mapping.toJSON(e.template()),n.post(i,"/Template/SaveSpaceTemplate").then(function(n){n.status==="OK"?(u.info("Data has been successfully save"),t.resolve(n)):(u.error(n.message),t.resolve(n))}),t.promise()},c=function(){return r.exportJson("template.space."+e.template().SpaceTemplateId()+".json",ko.mapping.toJSON(e.template))},l=function(){return r.importJson().done(function(t){try{var i=JSON.parse(t),r=n.toObservable(i);e.template(r);e.template().SpaceTemplateId(0)}catch(f){u.logError("Fail template import tidak sah",f,this,!0)}})},a=function(){var i=new $.Deferred,r=JSON;return n.post(r,"/Template/PropertyPath/Space").then(function(n){var r=_(n).map(function(n){var i=new bespoke.sph.domain.DefaultValue(t.guid()),r;return i.PropertyName(n.Name),i.TypeName(n.TypeName),i.IsNullable(n.IsNullable),r=_(e.template().DefaultValueCollection()).find(function(t){return t.PropertyName()===n.Name}),r&&i.Value(r.Value),i});e.template().DefaultValueCollection(r);i.resolve(n)}),i.promise()},e={activate:s,template:ko.observable(new bespoke.sph.domain.SpaceTemplate),toolbar:{saveCommand:h,exportCommand:c,importCommand:l},viewAttached:i.viewAttached,customFormElements:i.customFormElements,formElements:i.formElements,selectFormElement:i.selectFormElement,selectedFormElement:i.selectedFormElement,removeFormElement:i.removeFormElement,removeComboBoxOption:i.removeComboBoxOption,selectPathFromPicker:i.selectPathFromPicker,showPathPicker:i.showPathPicker,addComboBoxOption:i.addComboBoxOption,config:f,loadDefaultValueFields:a};return e});
//# sourceMappingURL=template.space.min.js.map