define(["services/datacontext","durandal/system","./template.base","services/jsonimportexport","services/logger","config",objectbuilders.defaultValueProvider],function(n,t,i,r,u,f,e){var s=ko.observable(),h=function(r){var u=[],l=new bespoke.sph.domain.AddressElement(t.guid()),f,e,h,c,a,y,v;return l.CssClass("icon-envelope pull-left"),l.Name("Address"),u.push(l),f=new bespoke.sph.domain.BuildingElement(t.guid()),f.CssClass("icon-building pull-left"),f.Name("Building"),u.push(f),e=new bespoke.sph.domain.BuildingMapElement(t.guid()),e.CssClass("icon-globe pull-left"),e.Name("Map"),u.push(e),h=new bespoke.sph.domain.SpaceUnitElement(t.guid()),h.CssClass("icon-check-empty pull-left"),h.Name("Unit"),u.push(h),c=new bespoke.sph.domain.SpaceFeaturesElement(t.guid()),c.CssClass("icon-list-ol pull-left"),c.Name("Features"),u.push(c),i.activate(u),a=parseInt(r.id),s(a),a?(y=String.format("SpaceTemplateId eq {0}",s()),v=new $.Deferred,n.loadOneAsync("SpaceTemplate",y).done(function(n){_(n.FormDesign().FormElementCollection()).each(function(n){n.isSelected=ko.observable(!1)});o.template(n);i.designer(o.template().FormDesign());v.resolve(!0)}),v.promise()):(o.template(new bespoke.sph.domain.SpaceTemplate),o.template().FormDesign().Name("jenis ruang anda"),o.template().FormDesign().Description("Keterangan jenis ruang"),i.designer(o.template().FormDesign()),!0)},c=function(){var t=new $.Deferred,r=_($("#template-form-designer>form>div")).map(function(n){return ko.dataFor(n)}),i;return o.template().FormDesign().FormElementCollection(r),i=ko.mapping.toJSON(o.template()),n.post(i,"/Template/SaveSpaceTemplate").then(function(n){n.status==="OK"?(u.info("Data has been successfully save"),t.resolve(n)):(u.error(n.message),t.resolve(n))}),t.promise()},l=function(){return r.exportJson("template.space."+o.template().SpaceTemplateId()+".json",ko.mapping.toJSON(o.template))},a=function(){return r.importJson().done(function(t){try{var i=JSON.parse(t),r=n.toObservable(i);o.template(r);o.template().SpaceTemplateId(0)}catch(f){u.logError("Fail template import tidak sah",f,this,!0)}})},v=function(){return e.loadAsync("Space",o.template())},o={activate:h,template:ko.observable(new bespoke.sph.domain.SpaceTemplate),toolbar:{saveCommand:c,exportCommand:l,importCommand:a},viewAttached:i.viewAttached,customFormElements:i.customFormElements,formElements:i.formElements,selectFormElement:i.selectFormElement,selectedFormElement:i.selectedFormElement,removeFormElement:i.removeFormElement,removeComboBoxOption:i.removeComboBoxOption,selectPathFromPicker:i.selectPathFromPicker,showPathPicker:i.showPathPicker,addComboBoxOption:i.addComboBoxOption,config:f,loadDefaultValueFields:v};return o});
//# sourceMappingURL=template.space.min.js.map