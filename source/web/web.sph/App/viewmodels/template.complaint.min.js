define([objectbuilders.datacontext,objectbuilders.system,"./template.base","services/jsonimportexport",objectbuilders.logger],function(n,t,i,r,u){var o=ko.observable(!1),e=ko.observable(),s=function(r){var o=[],s=new bespoke.sph.domain.AddressElement(t.guid()),u,h,l,c;return s.CssClass("icon-envelope pull-left"),s.Name("Address"),o.push(s),u=new bespoke.sph.domain.ComplaintCategoryElement(t.guid()),u.CssClass("icon-group pull-left"),u.Name("Category"),o.push(u),i.activate(o),h=parseInt(r.id),e(h),h?(l=String.format("ComplaintTemplateId eq {0}",e()),c=new $.Deferred,n.loadOneAsync("ComplaintTemplate",l).done(function(n){_(n.FormDesign().FormElementCollection()).each(function(n){n.isSelected=ko.observable(!1)});f.template(n);i.designer(f.template().FormDesign());c.resolve(!0)}),c.promise()):(f.template(new bespoke.sph.domain.ComplaintTemplate),f.template().FormDesign().Name("My form 1"),f.template().FormDesign().Description("Do whatever it takes"),i.designer(f.template().FormDesign()),!0)},h=function(n){i.viewAttached(n)},c=function(){var n=new bespoke.sph.domain.ComplaintCategory;f.template().ComplaintCategoryCollection.push(n)},l=function(){f.subCategoryOptions.push({text:ko.observable()})},a=function(n){f.subCategoryOptions.remove(n)},v=function(){f.template().ComplaintCategoryCollection.push(f.selectedComplaintCategory())},y=function(n){f.template().ComplaintCategoryCollection.remove(n)},p=function(n){f.selectedComplaintCategory(n);var t=_(n.SubCategoryCollection()).map(function(n){return{text:ko.observable(n)}});f.subCategoryOptions(t);$("#category-details-modal").modal({})},w=function(){var n=f.subCategoryOptions().map(function(n){return n.text()});f.selectedComplaintCategory().SubCategoryCollection(n)},b=function(){var t=new $.Deferred,r=_($("#template-form-designer>form>div")).map(function(n){return ko.dataFor(n)}),i;return f.template().FormDesign().FormElementCollection(r),i=ko.mapping.toJSON(f.template()),n.post(i,"/Template/SaveComplaintTemplate").then(function(n){o(!1);t.resolve(n.id);f.template().ComplaintTemplateId(n.id);u.info("Data has been successfully saved ")}),t.promise()},k=function(){return r.exportJson("template.complaint."+f.template().ComplaintTemplateId()+".json",ko.mapping.toJSON(f.template))},d=function(){return r.importJson().done(function(t){try{var i=JSON.parse(t),r=n.toObservable(i);f.template(r);f.template().ComplaintTemplateId(0)}catch(e){u.logError("Fail template import tidak sah",e,this,!0)}})},f={activate:s,viewAttached:h,subCategoryOptions:ko.observableArray(),template:ko.observable(new bespoke.sph.domain.ComplaintTemplate),selectedComplaintCategory:ko.observable(new bespoke.sph.domain.ComplaintCategory),addComplaintCategory:c,removeCategory:y,addSubCategory:l,removeSubCategory:a,updateCategoryCommand:v,editCategory:p,saveSubCategoryCommand:w,toolbar:{saveCommand:b,exportCommand:k,importCommand:d},customFormElements:i.customFormElements,formElements:i.formElements,selectFormElement:i.selectFormElement,selectedFormElement:i.selectedFormElement,removeFormElement:i.removeFormElement,removeComboBoxOption:i.removeComboBoxOption,addComboBoxOption:i.addComboBoxOption,selectPathFromPicker:i.selectPathFromPicker,showPathPicker:i.showPathPicker,imageStoreId:ko.observable()};return f});
//# sourceMappingURL=template.complaint.min.js.map