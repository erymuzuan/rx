define([objectbuilders.datacontext,objectbuilders.system,"./template.base","services/jsonimportexport",objectbuilders.logger,objectbuilders.defaultValueProvider],function(n,t,i,r,u,f){var s=ko.observable(!1),o=ko.observable(),h=function(r){var f=[],s=new bespoke.sph.domain.AddressElement(t.guid()),u,h,l,c;return s.CssClass("icon-envelope pull-left"),s.Name("Address"),f.push(s),u=new bespoke.sph.domain.ComplaintCategoryElement(t.guid()),u.CssClass("icon-group pull-left"),u.Name("Category"),f.push(u),i.activate(f),h=parseInt(r.id),o(h),h?(l=String.format("ComplaintTemplateId eq {0}",o()),c=new $.Deferred,n.loadOneAsync("ComplaintTemplate",l).done(function(n){_(n.FormDesign().FormElementCollection()).each(function(n){n.isSelected=ko.observable(!1)});e.template(n);i.designer(e.template().FormDesign());c.resolve(!0)}),c.promise()):(e.template(new bespoke.sph.domain.ComplaintTemplate),e.template().FormDesign().Name("My form 1"),e.template().FormDesign().Description("Do whatever it takes"),i.designer(e.template().FormDesign()),!0)},c=function(n){i.viewAttached(n)},l=function(){var n=new bespoke.sph.domain.ComplaintCategory;e.template().ComplaintCategoryCollection.push(n)},a=function(){e.subCategoryOptions.push({text:ko.observable()})},v=function(n){e.subCategoryOptions.remove(n)},y=function(){e.template().ComplaintCategoryCollection.push(e.selectedComplaintCategory())},p=function(n){e.template().ComplaintCategoryCollection.remove(n)},w=function(n){e.selectedComplaintCategory(n);var t=_(n.SubCategoryCollection()).map(function(n){return{text:ko.observable(n)}});e.subCategoryOptions(t);$("#category-details-modal").modal({})},b=function(){var n=e.subCategoryOptions().map(function(n){return n.text()});e.selectedComplaintCategory().SubCategoryCollection(n)},k=function(){var t=new $.Deferred,r=_($("#template-form-designer>form>div")).map(function(n){return ko.dataFor(n)}),i;return e.template().FormDesign().FormElementCollection(r),i=ko.mapping.toJSON(e.template()),n.post(i,"/Template/SaveComplaintTemplate").then(function(n){s(!1);t.resolve(n.id);e.template().ComplaintTemplateId(n.id);u.info("Data has been successfully saved ")}),t.promise()},d=function(){return r.exportJson("template.complaint."+e.template().ComplaintTemplateId()+".json",ko.mapping.toJSON(e.template))},g=function(){return r.importJson().done(function(t){try{var i=JSON.parse(t),r=n.toObservable(i);e.template(r);e.template().ComplaintTemplateId(0)}catch(f){u.logError("Fail template import tidak sah",f,this,!0)}})},nt=function(){return f.loadAsync("Complaint",e.template())},e={activate:h,viewAttached:c,subCategoryOptions:ko.observableArray(),template:ko.observable(new bespoke.sph.domain.ComplaintTemplate),selectedComplaintCategory:ko.observable(new bespoke.sph.domain.ComplaintCategory),addComplaintCategory:l,removeCategory:p,addSubCategory:a,removeSubCategory:v,updateCategoryCommand:y,editCategory:w,saveSubCategoryCommand:b,toolbar:{saveCommand:k,exportCommand:d,importCommand:g},customFormElements:i.customFormElements,formElements:i.formElements,selectFormElement:i.selectFormElement,selectedFormElement:i.selectedFormElement,removeFormElement:i.removeFormElement,removeComboBoxOption:i.removeComboBoxOption,addComboBoxOption:i.addComboBoxOption,selectPathFromPicker:i.selectPathFromPicker,showPathPicker:i.showPathPicker,imageStoreId:ko.observable(),loadDefaultValueFields:nt};return e});
//# sourceMappingURL=template.complaint.min.js.map