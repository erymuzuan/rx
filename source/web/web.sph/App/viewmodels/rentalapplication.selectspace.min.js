define(["services/datacontext"],function(n){var f=function(){t.searchTerm.query("IsAvailable eq 1 and IsOnline eq 1");var i=new $.Deferred,r=n.loadAsync("ApplicationTemplate","IsActive eq 1"),u=n.loadAsync("Space",t.searchTerm.query()),f=n.getDistinctAsync("Building","","State"),e=n.getDistinctAsync("Space","","Category");return $.when(r,u,f,e).done(function(n,r,u,f){t.spaces(r.itemCollection);var e=_(n.itemCollection).map(function(n){var t=_(r.itemCollection).filter(function(t){return t.ApplicationTemplateOptions().indexOf(n.ApplicationTemplateId())>-1});return{name:n.Name(),id:n.ApplicationTemplateId(),spaces:t}});t.spaces(e);t.searchTerm.stateOptions(u);t.searchTerm.categoryOptions(f);i.resolve(!0)}),n.getMaxAsync("Space","IsAvailable eq 1 and IsOnline eq 1","RentalRate").done(function(n){t.searchTerm.max(n);t.searchTerm.maxValue(n)}),n.getMinAsync("Space","IsAvailable eq 1 and IsOnline eq 1","RentalRate").done(function(n){t.searchTerm.min(n);t.searchTerm.minValue(n)}),i.promise()},e=function(){var o=new $.Deferred,f=[{range:{RentalRate:{from:i.minValue(),to:i.maxValue()}}}];r().length&&f.push({match:{"Address.State":{query:r().join(" OR ")}}});u().length&&f.push({match:{Category:{query:u().join(" OR ")}}});var s={query:{bool:{must:f}}},h=n.loadAsync("ApplicationTemplate","IsActive eq 1"),c=n.searchAsync("Space",s),e;return $.when(h,c).done(function l(i,r){var f=_(i.itemCollection).map(function(n){var t=_(r.itemCollection).filter(function(t){return t.ApplicationTemplateOptions().indexOf(n.ApplicationTemplateId())>-1?t.ApplicationTemplateOptions().indexOf(n.ApplicationTemplateId())>-1:!1});return{name:n.Name(),id:n.ApplicationTemplateId(),spaces:t}}),u;t.spaces(f);o.resolve(!0);e?e.update(r.rows):(u={element:$("#search-space-pager"),count:r.rows,changed:function(t,r){n.searchAsync({entity:"Space",page:t,size:r},s).done(function(n){l(i,n)})}},e=new bespoke.utils.ServerPager(u))}),o.promise()},r=ko.observableArray(),u=ko.observableArray(),i={query:ko.observable(),state:ko.observable(),stateOptions:ko.observableArray(),categoryOptions:ko.observableArray(),minValue:ko.observable(),maxValue:ko.observable(),min:ko.observable(),max:ko.observable()},t={activate:f,spaces:ko.observableArray([]),searchTerm:i,searchCommand:e};return t});
//# sourceMappingURL=rentalapplication.selectspace.min.js.map