define(["services/datacontext","config","viewmodels/map","services/logger"],function(n,t,i,r){var e=ko.observable(!1),o=function(t){var r=parseInt(t.id),f,i;return r===0?(u.land(new bespoke.sph.domain.Land),!0):(f="LandId eq "+r,i=new $.Deferred,n.loadOneAsync("Land",f).then(function(n){u.land(n);i.resolve(!0)}),i.promise())},s=function(){var t=new $.Deferred,i=ko.mapping.toJSON(u.land);return n.post(i,"/Land/Save").then(function(n){u.land().LandId(n);t.resolve(n)}),t.promise()},h=function(){var n=new $.Deferred,e=function(n){return i.init({panel:"map",draw:!0,polygoncomplete:c,zoom:18}).done(function(){i.setCenter(n)})},t={lat:3.1282,lng:101.6441},r=u.land().LandId(),o,s;return($("#land-map-panel").modal(),!r)?(i.geocode(u.land().Address().Street()+","+u.land().Address().City()+","+u.land().Address().Postcode()+","+u.land().Address().State()+",Malaysia.").then(function(i){e(i.status?i.point:t);n.resolve(!0)}),n.promise()):(o=$.get("/Land/GetEncodedPath/"+r),s=$.get("/Land/GetCenter/"+r),$.when(o,s).then(function(r,u){u[0]&&(t={lat:u[0].Lat,lng:u[0].Lng});e(t).done(function(){r[0]&&(f=i.add({encoded:r[0],draggable:!0,editable:!0,zoom:18}))});n.resolve(!0)}),n.promise())},f=null,c=function(n){f=n},l=function(){if(!f)return r.log("No shape"),!1;var t=new $.Deferred,e=JSON.stringify({landId:u.land().LandId(),path:i.getEncodedPath(f)});return n.post(e,"/Land/SaveMap").then(function(n){r.log("Map has been successfully saved ",n,"land.detail",!0)}),t.promise()},u={isBusy:e,activate:o,land:ko.observable(),saveMapCommand:l,showMapCommand:h,stateOptions:ko.observableArray([{Name:"Kelantan"}]),toolbar:{saveCommand:s}};return u});
//# sourceMappingURL=land.detail.min.js.map