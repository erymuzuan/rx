define([objectbuilders.datacontext,objectbuilders.logger,objectbuilders.router,objectbuilders.eximp],function(n,t,i,r){var f=ko.observable(),s=ko.observable(),p=ko.observable(!1),h=function(t){s(t);f(t.applicationId);u.title("Perincian Borang Permohonan");u.toolbar().auditTrail.id(t.applicationId);var i=new $.Deferred;return n.loadOneAsync("RentalApplication","RentalApplicationId eq "+f()).then(function(t){u.rentalapplication(t);c(t.Status()=="Menunggu"||t.Status()=="Dikembalikan");o(t.Status()=="Baru");l(t.Status()=="Baru"||t.Status()=="Dikembalikan");e(t.Status()=="Diluluskan");a(t.Status()=="Ditolak");v(t.Status()=="Selesai");y(t.Status()=="Menunggu");n.loadOneAsync("Space","SpaceId eq "+u.rentalapplication().SpaceId()).then(function(n){u.space(n);var t=_(u.rentalapplication().FeatureCollection()).reduce(function(n,t){return n+parseFloat(t.Charge())},0);u.totalRate(n.RentalRate()+t);i.resolve(!0)});$.get("/Map/SpaceImage/"+u.rentalapplication().SpaceId()+"?width=300&height=200").then(function(n){typeof u.space().StaticMap!="function"?u.space().StaticMap=ko.observable(n):u.space().StaticMap(n)})}),i.promise()},w=function(){var n=new bespoke.sph.domain.Attachment;u.rentalapplication().AttachmentCollection.push(n)},b=function(n){u.rentalapplication().AttachmentCollection.remove(n)},k=function(){$("#details-panel").modal({})},d=function(){var r=new $.Deferred,u=JSON.stringify({id:f()});return n.post(u,"/RentalApplication/WaitingList").done(function(n){t.log("Application has been insert into waiting list ",n,"rentalapplication.verify",!0);r.resolve(!0);i.navigateTo("/#/admindashboard")}),r.promise()},g=function(){var t=new $.Deferred,r=ko.mapping.toJS(u.rentalapplication().AttachmentCollection),e=JSON.stringify({id:f(),attachments:r});return n.post(e,"/RentalApplication/Returned").done(function(n){var r="/#/returnedapplication/"+n;i.navigateTo(r);t.resolve(!0)}),t.promise()},nt=function(){var i=new $.Deferred,r=ko.mapping.toJS(u.rentalapplication().AttachmentCollection),e=ko.mapping.toJS(u.rentalapplication().Remarks),o=JSON.stringify({id:f(),attachments:r,note:e});return n.post(o,"/RentalApplication/Update").done(function(){t.info("Data dikemaskini");i.resolve(!0)}),i.promise()},tt=function(){var r=new $.Deferred,u=JSON.stringify({id:f()});return n.post(u,"/RentalApplication/Declined").done(function(n){t.log("Application has been declined ",n,"rentalapplication.verify",!0);r.resolve(!0);i.navigateTo("/#/admindashboard")}),r.promise()},it=function(){var r=new $.Deferred,e=JSON.stringify({id:f()});return n.post(e,"/RentalApplication/Approved").done(function(n){if(t.log(n.message,n.message,"rentalapplication.verify",!0),n.result&&u.rentalapplication().Status("Diluluskan"),r.resolve(!0),n.result)i.navigateTo("/#/admindashboard")}),r.promise()},rt=function(){var i=new $.Deferred,r=JSON.stringify({id:u.rentalapplication().RentalApplicationId()});return n.post(r,"/RentalApplication/GenerateDeclinedLetter").done(function(n){t.log("Declined letter generated ",n,"rentalapplication.verify",!0);window.open("/RentalApplication/Download");i.resolve(!0)}),i.promise()},ut=function(){var r=new $.Deferred,f=JSON.stringify({id:u.rentalapplication().RentalApplicationId()});return n.post(f,"/RentalApplication/Complete").done(function(n){t.log("Permohonan selesai ",n,"rentalapplication.verify",!0);r.resolve(!0);i.navigateTo("/#/admindashboard")}),r.promise()},ft=function(){u.username(u.rentalapplication().Contact().IcNo()||u.rentalapplication().CompanyRegistrationNo());$("#tenant-username-dialog").modal()},et=function(){var i=new $.Deferred,r=JSON.stringify({id:u.rentalapplication().RentalApplicationId(),username:u.username()});return n.post(r,"/Tenant/Create").done(function(n){t.log("Penyewa dijana ",n,"rentalapplication.verify",!0);i.resolve(!0)}),i.promise()},ot=function(){var t=new $.Deferred,i=JSON.stringify({id:u.rentalapplication().RentalApplicationId()});return n.post(i,"/RentalApplication/Unsuccess").done(function(){t.resolve(!0)}),t.promise()},st=function(){},ht=function(){return r.exportJson("rental.application."+u.rentalapplication().RentalApplicationId()+".json",ko.toJSON(u.rentalapplication()))},c=ko.observable(),o=ko.observable(),l=ko.observable(),e=ko.observable(),a=ko.observable(),v=ko.observable(),y=ko.observable(),u={isBusy:p,activate:h,title:ko.observable(),rentalapplication:ko.observable(new bespoke.sph.domain.RentalApplication),space:ko.observable(new bespoke.sph.domain.Space),showDetailsCommand:k,addAttachmentCommand:w,username:ko.observable(),totalRate:ko.observable(),removeAttachmentCommand:b,createTenantCommand:et,toolbar:ko.observable({reloadCommand:function(){return h(s())},auditTrail:{entity:"RentalApplication",id:ko.observable()},printCommand:st,exportCommand:ht,clicks:ko.observableArray([{caption:"Sediakan Maklumat Penyewa",icon:"icon-file-text",command:ft,visible:v}]),commands:ko.observableArray([{caption:"Kemaskini",icon:"icon-eraser",command:nt},{caption:"Masuk Senarai Menunggu",icon:"icon-reorder",command:d,visible:o},{caption:"Kembalikan",icon:"icon-reply",command:g,visible:o},{caption:"Batalkan",icon:"icon-remove-sign",command:tt,visible:l},{caption:"Luluskan",icon:"icon-ok",command:it,visible:c},{caption:"1. Sediakan Tawaran",icon:"icon-file-text",command:function(){return i.navigateTo("/#/offerdetails/"+u.rentalapplication().RentalApplicationId()+"/"+u.rentalapplication().SpaceId()),{then:function(){}}},visible:e},{caption:"2. Sediakan Kontrak",icon:"icon-file-text",command:function(){return i.navigateTo("/#/contract.create/"+u.rentalapplication().RentalApplicationId()),{then:function(){}}},visible:e},{caption:"3. Selesai",icon:"icon-file-text",command:ut,visible:e},{caption:"Cetak Surat Pembatalan",icon:"icon-file-text",command:rt,visible:a},{caption:"Tidak Berjaya",icon:"icon-file-text",command:ot,visible:y}])})};return u});
//# sourceMappingURL=rentalapplication.verify.min.js.map