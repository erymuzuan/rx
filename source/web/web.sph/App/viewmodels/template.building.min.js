define([objectbuilders.datacontext,"durandal/system","./template.base","services/jsonimportexport",objectbuilders.logger,"durandal/app",objectbuilders.router,objectbuilders.cultures,objectbuilders.defaultValueProvider],function(n,t,i,r,u,f,e,o,s){var c=ko.observable(!1),l=ko.observable(),a=function(r){var u=[],s=new bespoke.sph.domain.AddressElement(t.guid()),f,e,o,c,v,a;return s.CssClass("icon-envelope pull-left"),s.Name("Address"),u.push(s),f=new bespoke.sph.domain.BuildingMapElement,f.CssClass("icon-globe pull-left"),f.Name("Show map button"),f.Label("Show map"),u.push(f),e=new bespoke.sph.domain.BuildingFloorsElement,e.CssClass("icon-table pull-left"),e.Name("Floors Table"),u.push(e),o=new bespoke.sph.domain.BuildingBlocksElement,o.CssClass("icon-building pull-left"),o.Name("Blocks Table"),u.push(o),i.activate(u),c=parseInt(r.id),l(c),c?(v=String.format("BuildingTemplateId eq {0}",l()),a=new $.Deferred,n.loadOneAsync("BuildingTemplate",v).done(function(n){_(n.FormDesign().FormElementCollection()).each(function(n){n.isSelected=ko.observable(!1)});h.template(n);i.designer(h.template().FormDesign());a.resolve(!0)}),a.promise()):(h.template(new bespoke.sph.domain.BuildingTemplate),h.template().FormDesign().Name("My form 1"),h.template().FormDesign().Description("Do whatever it takes"),i.designer(h.template().FormDesign()),!0)},v=function(n){$("#imageStoreId").kendoUpload({async:{saveUrl:"/BinaryStore/Upload",removeUrl:"/BinaryStore/Remove",autoUpload:!0},multiple:!1,error:function(){},success:function(n){var t=n.response.storeId,i=n.operation==="upload",r=n.operation!="upload";i&&h.template().FormDesign().ImageStoreId(t);r&&h.template().FormDesign().ImageStoreId("")}});i.viewAttached(n)},y=function(){var t=new $.Deferred,r=_($("#template-form-designer>form>div")).map(function(n){return ko.dataFor(n)}),i;return h.template().FormDesign().FormElementCollection(r),i=ko.mapping.toJSON(h.template()),n.post(i,"/Template/SaveBuildingTemplate").then(function(n){if(c(!1),n.status===bespoke.ServerOperationStatus.OK)h.template().BuildingTemplateId(n.id),u.info(String.format(o.messages.SAVE_SUCCESS,o.building.TEMPLATE_NAME));else{var i=_(n.errors).reduce(function(n,t){return n+"<br/>"+t.Message+"("+t.PropertyName+")"},n.message);u.error(i)}t.resolve(!0)}),t.promise()},p=function(){return f.showMessage("Are you sure you want to remove this template","Remove Template",["Ya","Tidak"]).done(function(t){if(t==="Ya"){var i=new $.Deferred,r=ko.mapping.toJSON(h.template),f=h.template().Name();return c(!0),n.post(r,"/Template/RemoveBuildingTemplate").then(function(n){n.status===bespoke.ServerOperationStatus.ERROR?u.error(n.message):(u.info(String.format(o.messages.DELETE_SUCCESS,f)),e.navigateTo("/#/building.template.list"));i.resolve(t)}),i.promise()}return Task.fromResult(!0)})},w=function(){return r.exportJson("template.building."+h.template().BuildingTemplateId()+".json",ko.mapping.toJSON(h.template))},b=function(){return r.importJson().done(function(t){try{var r=JSON.parse(t),i=n.toObservable(r);i.BuildingTemplateId(0);h.template(i)}catch(f){u.logError("Fail template import tidak sah",f,this,!0)}})},k=function(){return s.loadAsync("Building",h.template())},h={activate:a,viewAttached:v,template:ko.observable(new bespoke.sph.domain.BuildingTemplate),toolbar:{saveCommand:y,exportCommand:w,importCommand:b,removeCommand:p},customFormElements:i.customFormElements,formElements:i.formElements,selectFormElement:i.selectFormElement,selectedFormElement:i.selectedFormElement,removeFormElement:i.removeFormElement,removeComboBoxOption:i.removeComboBoxOption,selectPathFromPicker:i.selectPathFromPicker,showPathPicker:i.showPathPicker,addComboBoxOption:i.addComboBoxOption,loadDefaultValueFields:k};return h});
//# sourceMappingURL=template.building.min.js.map