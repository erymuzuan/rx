define([objectbuilders.datacontext,"durandal/system","./template.base","services/jsonimportexport",objectbuilders.logger,"durandal/app",objectbuilders.router,objectbuilders.cultures],function(n,t,i,r,u,f,e,o){var h=ko.observable(!1),c=ko.observable(),l=function(r){var u=[],h=new bespoke.sph.domain.AddressElement(t.guid()),f,e,o,l,v,a;return h.CssClass("icon-envelope pull-left"),h.Name("Address"),u.push(h),f=new bespoke.sph.domain.BuildingMapElement,f.CssClass("icon-globe pull-left"),f.Name("Show map button"),f.Label("Show map"),u.push(f),e=new bespoke.sph.domain.BuildingFloorsElement,e.CssClass("icon-table pull-left"),e.Name("Floors Table"),u.push(e),o=new bespoke.sph.domain.BuildingBlocksElement,o.CssClass("icon-building pull-left"),o.Name("Blocks Table"),u.push(o),i.activate(u),l=parseInt(r.id),c(l),l?(v=String.format("BuildingTemplateId eq {0}",c()),a=new $.Deferred,n.loadOneAsync("BuildingTemplate",v).done(function(n){_(n.FormDesign().FormElementCollection()).each(function(n){n.isSelected=ko.observable(!1)});s.template(n);i.designer(s.template().FormDesign());a.resolve(!0)}),a.promise()):(s.template(new bespoke.sph.domain.BuildingTemplate),s.template().FormDesign().Name("My form 1"),s.template().FormDesign().Description("Do whatever it takes"),i.designer(s.template().FormDesign()),!0)},a=function(n){$("#imageStoreId").kendoUpload({async:{saveUrl:"/BinaryStore/Upload",removeUrl:"/BinaryStore/Remove",autoUpload:!0},multiple:!1,error:function(){},success:function(n){var t=n.response.storeId,i=n.operation==="upload",r=n.operation!="upload";i&&s.template().FormDesign().ImageStoreId(t);r&&s.template().FormDesign().ImageStoreId("")}});i.viewAttached(n)},v=function(){var t=new $.Deferred,r=_($("#template-form-designer>form>div")).map(function(n){return ko.dataFor(n)}),i;return s.template().FormDesign().FormElementCollection(r),i=ko.mapping.toJSON(s.template()),n.post(i,"/Template/SaveBuildingTemplate").then(function(n){if(h(!1),n.status===bespoke.ServerOperationStatus.OK)s.template().BuildingTemplateId(n.id),u.info(String.format(o.messages.SAVE_SUCCESS,o.building.TEMPLATE_NAME));else{var i=_(n.errors).reduce(function(n,t){return n+"<br/>"+t.Message+"("+t.PropertyName+")"},n.message);u.error(i)}t.resolve(!0)}),t.promise()},y=function(){return f.showMessage("Are you sure you want to remove this template","Remove Template",["Ya","Tidak"]).done(function(t){if(t==="Ya"){var i=new $.Deferred,r=ko.mapping.toJSON(s.template),f=s.template().Name();return h(!0),n.post(r,"/Template/RemoveBuildingTemplate").then(function(n){n.status===bespoke.ServerOperationStatus.ERROR?u.error(n.message):(u.info(String.format(o.messages.DELETE_SUCCESS,f)),e.navigateTo("/#/building.template.list"));i.resolve(t)}),i.promise()}return Task.fromResult(!0)})},p=function(){return r.exportJson("template.building."+s.template().BuildingTemplateId()+".json",ko.mapping.toJSON(s.template))},w=function(){return r.importJson().done(function(t){try{var r=JSON.parse(t),i=n.toObservable(r);i.BuildingTemplateId(0);s.template(i)}catch(f){u.logError("Fail template import tidak sah",f,this,!0)}})},s={activate:l,viewAttached:a,template:ko.observable(new bespoke.sph.domain.BuildingTemplate),toolbar:{saveCommand:v,exportCommand:p,importCommand:w,removeCommand:y},customFormElements:i.customFormElements,formElements:i.formElements,selectFormElement:i.selectFormElement,selectedFormElement:i.selectedFormElement,removeFormElement:i.removeFormElement,removeComboBoxOption:i.removeComboBoxOption,selectPathFromPicker:i.selectPathFromPicker,showPathPicker:i.showPathPicker,addComboBoxOption:i.addComboBoxOption};return s});
//# sourceMappingURL=template.building.min.js.map